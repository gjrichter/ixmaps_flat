(function(){function Ea(k){h.HTMLWindow&&h.pushInitAction(()=>{h.HTMLWindow.ixmaps.htmlgui_onMapInit(window)});h.Event=new r.Event;h.SVGRootElement.setAttribute("onmouseover","map.Event.defaultMouseOver(evt)");h.SVGRootElement.setAttribute("onmouseout","map.Event.defaultMouseOut(evt)");h.SVGRootElement.setAttribute("onmousedown","map.Event.defaultMouseDown(evt)");h.SVGRootElement.setAttribute("ontouchstart","map.Event.defaultMouseDown(evt)");h.SVGRootElement.setAttribute("onmouseup","map.Event.defaultMouseUp(evt)");
h.SVGRootElement.setAttribute("ontouchend","map.Event.defaultMouseUp(evt);map.Event.defaultMouseClick(evt)");h.SVGRootElement.setAttribute("onmousemove","map.Event.defaultMouseMove(evt)");h.SVGRootElement.setAttribute("ontouchmove","map.Event.defaultMouseUp(evt);map.Event.defaultMouseMove(evt);map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()");h.SVGRootElement.setAttribute("onclick","map.Event.defaultMouseClick(evt)");h.SVGRootElement.setAttribute("onkeydown","map.Event.defaultKeyDown(evt)");h.SVGRootElement.setAttribute("onkeyup",
"map.Event.defaultKeyUp(evt)");typeof h.Event.doDefaultZoom=="function"&&(h.SVGRootElement.addEventListener("SVGZoom",h.Event.doDefaultZoom,!1),h.SVGRootElement.addEventListener("SVGScroll",h.Event.doDefaultPan,!1),h.SVGRootElement.addEventListener("SVGResize",h.Event.doDefaultResize,!1));h.Layer=new r.Layer(k);h.antiZoomAndPanList=new ra(k);h.antiZoomAndPanList.initAntiZoomPattern(k,null);h.antiZoomAndPanList.initAntiZoomSymbols(null,h.SVGDocument.getElementById("symbolstore"));h.antiZoomAndPanList.initAntiZoomStyles(k);
h.Layer.initPatternScaling(k,null);h.Zoom=new r.Zoom(h.Scale.initScale);h.Tiles=new r.Tiles;h.Label=new r.Label;h.Viewport=new r.Viewport(k);h.Layer.switchScaleDependentLayer(k);h.Scale.refreshCSSStyles();h.pushAction(()=>{h.Layer.scaleLineDecorations(h.SVGRootElement,1)});try{h.Dom.clearGroup(contextMenu.firstChild)}catch(p){}try{h.HTMLWindow.ixmaps.htmlgui_setScaleSelect(String(n(Math.floor(h.Scale.nTrueMapScale*h.Scale.nZoomScale)),0,"BLANK"))}catch(p){}try{h.HTMLWindow.ixmaps.htmlgui_setCurrentEnvelope(h.Zoom.getEnvelopeString(),
!0)}catch(p){}try{h.HTMLWindow.ixmaps.htmlgui_queryMapFeatures()}catch(p){}h.fClipMap&&!h.fClipMapDynamic||h.Zoom.removeClipping();h.fPDFEmbed&&(h.Tiles.switchScaleDependentTiles(k),ia());setTimeout(()=>{h.Zoom.init()},1E3);setTimeout(()=>{h.fadeLogo()},1E4);h.Layer.prepareCheckOverlap(k,h.Layer.layerNode);h.fInitializing=!1;h.HTMLWindow&&h.pushInitAction(()=>{h.HTMLWindow.ixmaps.htmlgui_onMapReady(window)});h.pushInitAction(()=>{h.showAll()});h.pushInitAction(()=>{nothing()})}function t(){try{typeof h.HTMLWindow.ixmaps.SVGResources_includePath!=
"undefined"&&setTimeout("loadSVGIncludes(null,'"+h.HTMLWindow.ixmaps.SVGResources_includePath+"')")}catch(k){}}function K(k,p){p?(h.fSVGEmbeded=!0,document.embeds[p]&&(h.SVGDocument=document.embeds[p].getSVGDocument(),h.EmbedHeight=document.embeds[p].height,h.EmbedWidth=document.embeds[p].width)):h.SVGDocument=k?k.target.ownerDocument:document.getElementById("svg_map_document");h.SVGDocument.getElementById("widgetstore")&&h.SVGDocument.getElementById("widgetstore").childNodes.length>2&&(h.fAllIncluded=
!0);window.parent&&window.screen&&window.location||(h.fPDFEmbed=!0);h.fLocalHost=String(window.location).match(/localhost/);l=navigator.appName;navigator.appName.match(/Adobe/)&&navigator.appVersion.match(/6.0x/)?l="Adobe6.0":navigator.appName.match(/Adobe/)&&navigator.appVersion.match(/3.0/)?l="Adobe3.0":navigator.appName.match(/Opera/)?l="Opera":navigator.appName.match(/Netscape/)&&(l="Netscape");navigator.userAgent&&navigator.userAgent.match(/Chrome/)?l="Chrome":navigator.userAgent&&navigator.userAgent.match(/Firefox/)&&
(l="Firefox");(k=h.SVGDocument.getAttribute("xmlns:xmap"))&&k.length>3&&(a=k);h.HTMLWindow=window}function y(k){if(k){k=k.getAttribute("transform");var p=null;if(k&&(p=k.match(F)))return k=p[1].split(" "),[Number(k[0]),Number(k[1]),Number(k[2]),Number(k[3]),Number(k[4]),parseFloat(k[5])];if(k&&(p=k.match(v)))return k=p[1].split(","),[Number(k[0]),Number(k[1]),Number(k[2]),Number(k[3]),Number(k[4]),Number(k[5])]}return[1,0,0,1,0,0]}function B(k,p,q){if(k&&p.length==6){var D=!0;p.forEach(function(S){isNaN(S)&&
(D=!1)});if(D){var H=k.getAttributeNS(null,"transform");p="matrix("+p[0]+" "+p[1]+" "+p[2]+" "+p[3]+" "+p[4]+" "+p[5]+")";H=H?H.split(")"):[];for(var N=0;N<H.length;N++)H[N].length>3&&(H[N].match(/rotate/)||H[N].match(/scale/)||q&&H[N].match(/translate/))&&(p=p+" "+H[N]+")");k.setAttributeNS(null,"transform",p)}}}function A(k){return k?(k=y(k),new G(Number(k[4]),Number(k[5]))):new G(0,0)}function J(k,p,q){var D=y(k);D[4]=p;D[5]=q;B(k,[D[0],D[1],D[2],D[3],D[4],D[5]])}function L(k){return k?(k=y(k),
new G(Number(k[0]),Number(k[3]))):new G(1,1)}function da(k,p){p||="transform";return k&&(k=k.getAttributeNS(null,p),p=null,k&&(p=k.match(E)))?Number(p[1]):0}function V(k,p,q){q||="transform";if(k){var D=!1,H="",N=k.getAttributeNS(null,q);N=N?N.split(")"):[];for(var S=0;S<N.length;S++)N[S].match(/rotate/)?(H=H+" rotate("+p+")",D=!0):N[S].length>3&&(H=H+" "+N[S]+")");D||(H=H+" rotate("+p+")");k.setAttributeNS(null,q,H)}}function U(k){if(k.nodeType!=1)return null;for(this.szId="";this.szId===""&&k.parentNode&&
k.nodeType==1;)if(this.szId=k.getAttributeNS(null,"id"),typeof this.szId!="string"||this.szId===""||this.szId.match(/noobject/))k=k.parentNode,this.szId="";this.objNode=k;this.fu=new P(k)}function P(k){this.nodeObj=k}function fa(k,p){if(!k||!p)return null;k=k.split(";");for(var q,D=0;D<k.length;D++)if(k[D].match(/stroke-width/))q=k[D].split(":"),q[1]=String(parseFloat(q[1])*p),k[D]=q.join(":");else if(k[D].match(/font-size/))q=k[D].split(":"),q[1]=String(parseFloat(q[1])*p)+"px",k[D]=q.join(":");
else if(k[D].match(/stroke-dashoffset/))q=k[D].split(":"),q[1]=String(parseFloat(q[1])*p),k[D]=q.join(":");else if(k[D].match(/stroke-dasharray/)){q=k[D].split(":");var H=q[1].split(",");H.length>1?(k[D]=q[0]+":",q=0):(H=q[1].split(" "),k[D]=q[0]+":",q=0);for(;q<H.length;q++)H[q]=String(parseFloat(H[q])*p),k[D]+=H[q],q<H.length-1&&(k[D]+=",")}return k.join(";")}function ra(k){this.listA=[];this.buildList(k)}function Ta(k){return k==h._activeTheme}function W(){h._legendIdent&&(h._legendIdent.style.setProperty("display",
"none",""),h._legendIdent=null);h._activeTheme=null;h.highLightList.removeAll()}function X(){g&&clearTimeout(g);h._tooltip&&(h.SVGTltipGroup.fu.clear(),h._tooltip=null);try{h.HTMLWindow.ixmaps.htmlgui_onTooltipDelete()&&(h.highLightList.unlock(),h.highLightList.removeAll())}catch(k){}}function Z(k,p,q){if(q!="notify"||h.fNotify)if(typeof k!="string"||k.length===0)h.SVGMessageGroup.fu.clear();else{R&&(clearTimeout(R),R=null);k=h.Dictionary.getLocalText(k);if(q!="notify"&&q!="big")if(h.isInitializing())try{h.HTMLWindow.ixmaps.htmlgui_displayInfo(k);
return}catch(mb){}else try{if(h.HTMLWindow.ixmaps.htmlgui_isInfoDisplay()){h.HTMLWindow.ixmaps.htmlgui_displayInfo(k);p&&ia(p);return}}catch(mb){}if(q=="big")var D=64,H="transparent",N=new G(h.Scale.bBox.width/2+h.Scale.mapPosition.x,h.Scale.normalY(38));else q=="notify"?(D=24,H="flat",N=new G(h.Scale.bBox.width/2+h.Scale.mapPosition.x,h.Scale.mapPosition.y+(h.Scale.normalY(D*2/3)+h.nToolMarginTop))):q=="top"?(D=24,H="flat",N=new G(h.Scale.bBox.width/2+h.Scale.mapPosition.x,h.Scale.mapPosition.y+
(h.Scale.normalY(D*2/3)+h.nToolMarginTop))):(D=36,H="flat",N=new G(h.Scale.bBox.width/2+h.Scale.mapPosition.x,h.Scale.bBox.height/2+h.Scale.mapPosition.y-h.Scale.normalX(D/2)));if(h.SVGDocument&&h.SVGMessageGroup&&(q=="notify"?h.SVGNotifyGroup.fu.clear():h.SVGMessageGroup.fu.clear(),k&&k.length)){var S=null;try{var ha=new TextField(null,q=="notify"?h.SVGNotifyGroup:h.SVGMessageGroup,H,D);ha.setText(k);S=ha.textGroup;var Ia=S.fu.getBox();S.fu.setPosition(N.x-Ia.width/2,N.y+Ia.height/2)}catch(mb){S=
c(h.SVGDocument,q=="notify"?h.SVGNotifyGroup:h.SVGMessageGroup,"popup_message",k,D);try{Ia=S.fu.getBox(),S.fu.setPosition(N.x-Ia.width/2,N.y+Ia.height/2)}catch(Sc){S.fu.setPosition(N.x-h.Scale.normalX(50),N.y+h.Scale.normalX(10))}}}p&&(q=="notify"?p?(ca&&clearTimeout(ca),ca=setTimeout("clearNotify()",p)):h.SVGNotifyGroup.fu.clear():ia(p))}}function ia(k){R&&!k||ma(k||0)}function ma(k){if(k)R&&clearTimeout(R),R=setTimeout("do_clearMessage()",k);else{try{h.HTMLWindow.ixmaps.htmlgui_killInfo()}catch(p){}h.SVGMessageGroup.fu.clear()}}
function va(k,p,q,D,H,N){h.SVGDocument&&h.SVGMessageGroup&&(q=h.Dom.newGroup(h.SVGMessageGroup,"popup_progressbar"),q.fu.setPosition(0,0),q.fu.scale(20,20),h.Dom.newShape("rect",q,0,0,h.SVGWidth/p*k,1.5,"fill:#3787D7;stroke:none;"));D&&ia(D)}function d(k){if(typeof console!="undefined"&&typeof console.log!="undefined"){var p=new Date;p=p.getMinutes()+":"+String(p.getSeconds())+"."+String(p.getMilliseconds());console.log("_LOG: time["+p+"] "+k)}}function c(k,p,q,D,H){H||=12;if(k&&p)return k=h.Dom.newGroup(p,
q),p=h.Dom.newShape("rect",k,1,1,1,1,"fill:#aaaaaa;opacity:0.5;stroke:none"),q=h.Dom.newShape("rect",k,1,1,1,1,"fill:#fefeff;stroke:#aaaaaa;stroke-width:"+h.Scale.normalX(.2)),h.Dom.newText(k,0,h.Scale.normalY(H*1.25),"font-family:arial;font-size:"+h.Scale.normalY(H)+"px;fill:"+h.szInfoBodyColor,D),qa=k,T=q,xa=p,Ja=H,e(),k}function e(){var k=Ja,p=h.Dom.getBox(qa);T.setAttributeNS(null,"rx",h.Scale.normalX(4));T.setAttributeNS(null,"ry",h.Scale.normalX(4));T.setAttributeNS(null,"x",-h.Scale.normalX(k*
.75));T.setAttributeNS(null,"y",-h.Scale.normalY(1));T.setAttributeNS(null,"width",p.width+h.Scale.normalX(k*1.5));T.setAttributeNS(null,"height",p.height+h.Scale.normalY(k)/2);xa.setAttributeNS(null,"rx",h.Scale.normalX(4));xa.setAttributeNS(null,"ry",h.Scale.normalX(4));xa.setAttributeNS(null,"x",-h.Scale.normalX(k*.75)+h.Scale.normalX(1));xa.setAttributeNS(null,"y",h.Scale.normalY(1));xa.setAttributeNS(null,"width",p.width+h.Scale.normalX(k*1.5)+h.Scale.normalX(1.5));xa.setAttributeNS(null,"height",
p.height+h.Scale.normalX(k)/2-h.Scale.normalX(0))}function b(k){if(typeof k=="undefined"||k==null||k.length<2)return null;try{for(var p=[],q=k.split(";"),D=0;D<q.length;D++)if(q[D].length){var H=q[D].split(":");p[H[0]]=H[1]}return p}catch(N){alert("ERROR parsing: "+k)}return null}function n(k,p,q){k=Number(k);if(!isFinite(k)||!isFinite(p)||k===0||k>1E12||k<-1E12)return String(k);h.fDecimalPointComma||(q+="|BLANK");p||=0;p=Math.max(0,p);if(k>1E-7&&p>0)for(;k.toFixed(p)===0;)p++;k=k.toFixed(p+1);var D=
Math.pow(10,p);k=q&&q.match(/CEIL/)?Math.ceil(k*D)/D:q&&q.match(/FLOOR/)?Math.floor(k*D)/D:Math.round(k*D)/D;D=String(k);for(D=D.match(/\./)?D.split(".")[1]:"";D.length<p;)D+="0";p=k<0?"-":"";var H="";k=Math.floor(Math.abs(k));if(!q||!q.match(/NOBREAKS/)){for(var N=1E3;k>N;)N*=1E3;N/=1E3;for(var S,ha=" ";N>=1E3;)S=Math.floor(k/N),p+=m(S,H),k%=N,N/=1E3,S&&(H="0",ha=q&&q.match(/BLANK/)?" ":"."),p+=ha;p+=m(k,H);p.length&&p!="-"||(p+="0");D.length&&(p+=(q&&q.match(/BLANK/)?".":",")+D)}return p}function m(k,
p){p||="";var q="";k<100&&(q+=p);k<10&&(q+=p);return q=k===0?q+p:q+String(k)}function u(){this.szUrlA=[];this.stackA=[];this.nPending=0;this.importSVGFile=function(k,p,q,D){if(this.szUrlA[k]==q)return!1;this.doImportSVGFile(k,p,q,D)};this.push=function(k,p,q,D){this.stackA.push({szUrl:k,svgDocument:p,targetGroup:q,callback:D})};this.pop=function(){if(!this.isWaiting()){var k=this.stackA.shift();k&&this.doImportSVGFile(k.szUrl,k.svgDocument,k.targetGroup,k.callback)}};this.doImportSVGFile=function(k,
p,q,D){function H(N){this.parent=N}this.nPending++;H.prototype.operationComplete=function(N,S,ha){this.parent.nPending--;this.parent.pop();S&&N==200&&(this.processImported(S.documentElement),d("SVGLoader: "+k+" (loaded)"))};H.prototype.processImported=function(N){if(k.match(/widget/))for(var S=h.Dom.getAllIds(N),ha=0;ha<S.length;ha++){var Ia=h.SVGDocument.getElementById(S[ha]);Ia&&Ia.parentNode.removeChild(Ia)}k.match(/pattern/)&&(q=h.Dom.newGroup(q,String(Math.random())));q.appendChild(N);if(!this.initMenu(q)){this.initCSS(q);
this.initScripts(q);k.match(/widget/)&&this.initToolbar(q);k.match(/logo/)&&this.initLogo(q);this.loadScripts(q);try{h.antiZoomAndPanList.initAntiZoomPattern(null,q),h.Layer.initPatternScaling(null,q)}catch(mb){}k.match(/symbol/)&&h.Scale.normalizeSymbols(q);k.match(/widget/)&&h.Scale.normalizeButtons(q)}};H.prototype.initMenu=function(N){N=N.getElementsByTagName("menu");if(N.length){for(var S=0;S<N.length;S++){var ha=N.item(S).getAttributeNS(null,"id");(ha=h.SVGDocument.getElementById(ha))&&ha!=
N.item(S)&&(ha.parentNode.removeChild(ha),S--)}return!0}return!1};H.prototype.initToolbar=function(N){try{h.Toolbar.init(),h.Legend.init()}catch(S){}return!0};H.prototype.initLogo=function(N){var S=h.SVGDocument.getElementById("mapbackground:logo");S===null&&(S=h.Dom.newGroup(h.SVGDocument.getElementById("mapbackground"),"mapbackground:logo"));if(S){h.Dom.clearGroup(S);N=N.getElementsByTagName("svg").item(0).childNodes;for(var ha=0;ha<N.length;ha++)S.appendChild(N.item(ha)),ha--}return!0};H.prototype.loadScripts=
function(N){N=N.getElementsByTagName("script");for(var S=0;S<N.length;S++){var ha=N.item(S).getAttributeNS("http://www.w3.org/1999/xlink","href");ha&&ha.length&&(new w).loadScript(ha)}return!0};H.prototype.initScripts=function(N){N=N.getElementsByTagName("script");for(var S=0;S<N.length;S++)if(N.item(S).firstChild){var ha=N.item(S).firstChild.nodeValue;try{eval(ha)}catch(Ia){d("ERROR: could not eval loaded script!")}}return!0};H.prototype.initCSS=function(N){return N.getElementsByTagName("style").length?
(h.SVGDocument.getElementById("mapstyles"),!0):!1};k.length>0&&O(k,new H(this))};this.isWaiting=function(){return this.nPending}}function z(){this.szUrlA=[];this.stackA=[];this.nToLoad=this.nRequest=this.nPending=0;this.importSVGFile=function(k,p,q,D){if(q&&this.szUrlA[k]==q)return!1;this.nRequest++;this.nToLoad++;h.fLoadingSilent?this.doImportSVGFile(k,p,q,D):!h.fLoadMultiTiles&&this.isWaiting()?this.push(k,p,q,D):(Z(h.Dictionary.getLocalText("loading map")),va(0,1,h.Dictionary.getLocalText("loading map")),
this.push(k,p,q,D),setTimeout("__svgLoaderMap.pop()",10));return!0};this.push=function(k,p,q,D){this.isStacked(k,p,q)||this.stackA.push({szUrl:k,svgDocument:p,targetGroup:q,callback:D})};this.pop=function(){if(!this.isWaiting()){var k=this.stackA.shift();k?(va(this.nToLoad-this.nPending-this.stackA.length,this.nToLoad,h.Dictionary.getLocalText("loading map elements")),this.doImportSVGFile(k.szUrl,k.svgDocument,k.targetGroup,k.callback)):this.nToLoad=this.nRequest=0}};this.isStacked=function(k,p,q){for(var D=
0;D<this.stackA.length;D++)if(this.stackA[D].szUrl==k&&this.stackA[D].svgDocument==p&&this.stackA[D].targetGroup==q)return!0;return!1};this.isAnyStacked=function(){return this.stackA.length};this.doImportSVGFile=function(k,p,q,D){function H(N){this.parent=N}if(q&&this.szUrlA[k]==q)return!1;this.szUrlA[k]=q;this.nPending++;H.prototype.operationComplete=function(N,S,ha){this.parent.szUrlA[k]=null;this.parent.nPending--;this.parent.nRequest--;S&&N==200?this.processImported(S.documentElement):Z("error loading map");
this.parent.pop()};H.prototype.processImported=function(N){var S=function(ha,Ia){Ia&&ha?(ha.parentNode.insertBefore(Ia,ha),ha.parentNode.removeChild(ha)):Ia?Ia.parentNode.nodeName=="defs"?h.SVGRootElement.appendChild(Ia.parentNode):h.SVGRootElement.appendChild(Ia):ha&&ha.parentNode.removeChild(ha)};h.hideAll();S(h.SVGDocument.getElementsByTagName("metadata")[2],N.getElementsByTagName("metadata")[0]);S(h.SVGDocument.getElementById("maplayer"),N.getElementById("maplayer"));S(h.SVGDocument.getElementById("extension"),
N.getElementById("extension"));S(h.SVGDocument.getElementById("mapclipdef"),N.getElementById("mapclipdef"));S(h.SVGDocument.getElementById("mapstyles"),N.getElementById("mapstyles"));(S=N.getElementsByTagName("pattern"))&&S[0]&&(N=N.getElementsByTagName("pattern")[0].parentNode,h.SVGRootElement.appendChild(N));h.Scale=new r.Scale(null);h.Scale.superclass=h;h.Scale.createWidgetStyles();h.Scale.normalizeSymbols(h.SVGDocument.getElementById("symbolstore"));h.Scale.normalizeButtons(h.SVGDocument.getElementById("widgetstore"));
h.Layer=new r.Layer(null);h.Layer.initPatternScaling(null,null);h.Zoom=new r.Zoom(h.Scale.initScale);h.Tiles=new r.Tiles;h.Label=new r.Label;h.Viewport=new r.Viewport;h.Query=new r.Query;h.Layer.switchScaleDependentLayer();h.Scale.refreshCSSStyles();h.HTMLWindow.ixmaps.htmlgui_onMapReady(window);setTimeout("map.showAll()",1E3)};console.log("*** load new map ***");console.log(k);console.log("********************");return k.length>0?(O(k,new H(this)),!0):!1};this.isWaiting=function(){return this.nPending};
this.isLoading=function(){return this.nPending|this.isAnyStacked()}}function x(){this.loaderA=[];this.szSuffix=".js";this.loadedUrlA=[];this.loadingUrlA=[];this.errorUrlA=[]}function w(){this.loadedScripts=[];this.reqCnt=0;this.isLoading=!1;this.finishedCallback=this.errorCallback=null;this.szMessage="... loading ...";this.pool=Za;this.pool.add(this)}function O(k,p){if(window.getURL)window.getURL(k,p);else if(window.XMLHttpRequest){var q=function(){D.readyState==4&&p.operationComplete(D.status,D.responseXML,
D.responseText)};try{var D=null;D=new XMLHttpRequest;D.open("GET",k,!0);D.onreadystatechange=q;D.send(null)}catch(H){}}else alert("your browser/svg viewer neither supports window.getURL nor window.XMLHttpRequest!")}var a="http://www.medienobjekte.de",f=96,g=null,l="Adobe3.0";typeof printNode=="undefined"&&eval("function printNode(node){var serializer = new XMLSerializer();var xml = serializer.serializeToString(node);return xml;}");var h=null,r=function(){this.fInitializing=!1;this.Api=this.Viewport=
this.Toolbar=this.Legend=this.Themes=this.Query=this.Zoom=this.Tiles=this.Layer=this.Scale=this.Event=null;this.mapRoot="";this.Loader=new u;this.rootGroup=this.SVGDocument=null;this.nNodesCreated=0;this.fObjectPseudoShadow=!0;this.fSVGEmbeded=this.fEmbedScale=!1;this.EmbedHeight=this.EmbedWidth=this.SVGOrigViewBoxString=this.SVGViewBox=this.SVGHeight=this.SVGWidth=this.SVGTempGroup=this.SVGHiddenGroup=this.SVGTltipGroup=this.SVGMenuGroup=this.SVGMessageGroup=this.SVGNotifyGroup=this.SVGPopupGroup=
this.SVGFixedGroup=this.SVGThemeGroup=this.SVGToolsGroup=this.SVGRootElement=this.HTMLWindow=null;this.fTransparentMap=!1;this.fClipMap=!0;this.fAllIncluded=this.fPDFEmbed=this.fZoomByViewer=this.fClipMapDynamic=!1;this.fSwitchByCSS=!0;this.fLocalHost=!1;this.fDynamicTiles=this.fDynamicLayer=this.fLoadIncludes=!0;this.fTilesLoaded=!1;this.fDiscardTiles="delayed";this.fLoadMultiTiles=!0;this.fLoadingSilent=this.fMarkTiles=!1;this.fExecuteSilent=!0;this.fNotify=!1;this.szObjectGroupId="mapobjects";
this.szShadowFilterId="DropShadowFilterObjects:antizoomandpan";this.szShadowFilterToolsId="DropShadowFilterTools:antizoomandpan";this.szShadowFilterShapeId="DropShadowFilterShape:antizoomandpan";this.fSymbolScalingDynamic=this.fObjectScaling=this.fFeatureScaling=this.fAntiZoomAndPan=!0;this.fFeatureScalingDynamic=!1;this.fCheckLabelOverlap=this.fAdaptLabelToScaling=!0;this.fCheckLabelSpace=!1;this.nCheckLabelSpace=.8;this.fCheckLabelSize=this.fCheckLabelSqueeze=!0;this.fCheckLabelOnlyOne=this.fKillOverlappingLabel=
!1;this.fCheckOverlapAllLayer=this.fCheckOverlapImplicit=!0;this.fTileTextNoClip=this.fCheckOverlapClipOnTiles=!1;this.fFeatureScalingByLayer=!0;this.fPanByViewer=this.fPendingNewGeoBounds=this.fFroozeDynamicContent=!1;this.fPanHideTools=this.fPanToolByViewer=!0;this.fEndPan="normal";this.fRotateOnMouseMove=!1;this.fPreserveMapRatio=this.fTriggerMouseMoveForPan=!0;this.fMapBorder3D=this.fMapBorder=this.fInitLegendOff=!1;this.nMapBorderWidth=1;this.szMapBorderColor="#B6BAC0";this.szMapPanBorderStyle=
"fill:#E0E5F0";this.szMapPanBorderOnoverStyle="fill:#d0d5e0";this.szMapBackgroundColor=this.szMapBackgroundStyle=null;this.fLegendToggleButtons=this.fClipMapToLegend=!1;this.fNorthArrow="rotatable";this.szNorthArrowPosition="INMAP";this.szLocalPopupAlignment=null;this.szMessagePosition="center";this.nToolMarginTop=0;this.nFixedInfoScale=1;this.fScaleBar=!0;this.fActivateInfoOnClick=this.fSetToolCursor=this.fStatus=this.fDebug=!1;this.szTextGridStyle="background:#dddddd";this.fCheckSublayerCollapse=
!1;this.fCreatTextLink=!0;this.nClipTextLink=30;this.nInfoOffsetX=25;this.nInfoOffsetY=-25;this.szInfoTitleColor="#000000";this.szInfoTitleBgColor="#ffffff";this.szInfoBodyColor="#444444";this.szInfoBodyBgColor="#FFFFDD";this.nInfoRoundRect=2;this.fDecimalPointComma=this.fActiveThemeInfo=this.fInfoShowShape=!1;this.nNormalSymbolSize=20;this.nNormalButtonSize=10;this.nNormalFontSize=12;this.nHighlightToggle=0;this.fScaleToFullscreen=this.fLoadExternalData=!1;this.fAdaptMapScaleToSize=this.fHighlightHint=
!0;this.fLimitMapToExtent=!1;this.szMapToolType="";this.szLinkTarget="_blank";this.szEmbedName="SVGMap";this.highLightList=this.zoomAndPanHistory=this.bookmarkList=this.mapTiles=this.mapTool=this.mouseObject=this.antiZoomAndPanList=this._tooltip=this._activeItem=this._activeTheme=this._legendIdent=this.newShape=null;this.initActionA=[];this.initMessageA=[];this.actionA=[];this.messageA=[]};r.prototype.setFeatures=function(k){this.szFeatures=(this.szFeatures||"")+";"+k;k=k.split(";");for(var p in k){var q=
k[p].split(":");switch(q[0]){case "featurescaling":q[1]=="dynamic"?this.fFeatureScalingDynamic=this.fFeatureScaling=!0:(this.fFeatureScaling=q[1]=="false"?!1:q[1],this.fFeatureScalingDynamic=!1);break;case "objectscaling":this.fObjectScaling=q[1]=="dynamic"?"dynamic":q[1]=="false"?!1:q[1];break;case "objectlayer":this.szObjectGroupId=q[1]=="belowlabel"?"mapobjects_below_label":q[1];break;case "dynamiclabel":(this.fAdaptLabelToScaling=q[1]=="false"?!1:q[1])?(this.fKillOverlappingLabel=this.fCheckLabelSqueeze=
this.fCheckLabelSpace=this.fCheckLabelOverlap=!0,this.fCheckLabelOnlyOne=!1,q[1].match(/CHECKSPACE/)&&(this.fCheckLabelSpace=!0),q[1].match(/NOCHECKSPACE/)&&(this.fCheckLabelSpace=!1),q[1].match(/NOREPOSITIONING/)&&(this.fKillOverlappingLabel=this.fCheckLabelOverlap=!0),q[1].match(/NOREMOVE/)&&(this.fKillOverlappingLabel=!1),q[1].match(/CHECKOVERLAP/)&&(this.fCheckLabelOverlap=!0),q[1].match(/NOCHECKOVERLAP/)&&(this.fCheckLabelOverlap=!1),q[1].match(/ONLYONE/)&&(this.fCheckLabelOnlyOne=!0),q[1].match(/SQUEEZE/)&&
(this.fCheckLabelSpace=!0),q[1].match(/NOSQUEEZE/)&&(this.fCheckLabelSqueeze=!1),q[1].match(/SIZE/)&&(this.fCheckLabelSize=!0),q[1].match(/NOSIZE/)&&(this.fCheckLabelSize=!1),q[1].match(/CLIPONTILES/)&&(this.fCheckOverlapClipOnTiles=!0),q[1].match(/NOCLIPONTILES/)&&(this.fCheckOverlapClipOnTiles=!1)):this.fCheckLabelOnlyOne=this.fKillOverlappingLabel=this.fCheckLabelSize=this.fCheckLabelSqueeze=this.fCheckLabelSpace=this.fCheckLabelOverlap=!1;break;case "dynamiclayer":this.fDynamicLayer=q[1]=="false"?
!1:q[1];break;case "dynamictiles":this.fDynamicTiles=q[1]=="false"?!1:q[1];break;case "discardtiles":this.fDiscardTiles=q[1]=="false"?!1:q[1];break;case "loadmultitiles":this.fLoadMultiTiles=q[1]=="false"?!1:q[1];break;case "loadexternaldata":this.fLoadExternalData=q[1]=="false"?!1:q[1];break;case "loadincludes":this.fLoadIncludes=q[1]=="false"?!1:q[1];break;case "loadsilent":this.fLoadingSilent=q[1]=="false"?!1:q[1];break;case "worksilent":this.fExecuteSilent=q[1]=="false"?!1:q[1];break;case "notify":this.fNotify=
q[1]=="false"?!1:q[1];break;case "fastpan":this.fPanToolByViewer=q[1]=="false"?!1:q[1];break;case "fullscreen":this.fScaleToFullscreen=q[1]=="false"?!1:q[1];break;case "realtimerotate":this.fRotateOnMouseMove=q[1]=="false"?!1:q[1];break;case "tooltipdelay":this.nTooltipTimeout=Number(q[1]);break;case "popupdelay":this.nInfoTimeout=Number(q[1]);break;case "popupgridstyle":this.szTextGridStyle=q[1];break;case "buttonsize":this.nNormalButtonSize=Number(q[1]);break;case "symbolsize":this.nNormalSymbolSize=
Number(q[1]);break;case "panborder":this.fMapBorder=!0;this.nMapBorderWidth=Number(q[1]);break;case "sidebarbuttons":this.fLegendToggleButtons=q[1]=="false"?!1:q[1];break;case "3Dborder":this.fMapBorder3D=q[1]=="false"?!1:q[1];break;case "mapbackgroundstyle":this.szMapBackgroundStyle=q[1];break;case "mapbackgroundcolor":this.szMapBackgroundColor=q[1];break;case "transparent":case "transparentbackground":this.fTransparentMap=!0;break;case "mapopacity":this.nOpacity=parseFloat(q[1]);this.setOpacity(this.nOpacity,
"absolute");break;case "clipmap":q[1]=="dynamic"?this.fClipMapDynamic=this.fClipMap=!0:(this.fClipMap=q[1]=="false"?!1:q[1],this.fClipMapDynamic=!1);break;case "checklabeloverlap":this.fCheckLabelOverlap=q[1]=="false"?!1:q[1];break;case "onlyonelabel":this.fCheckLabelOnlyOne=q[1]=="false"?!1:q[1];break;case "labelspace":this.nCheckLabelSpace=parseFloat(q[1]);break;case "decimalpoint":this.fDecimalPointComma=q[1]==","||q[1]=="komma"||q[1]=="Komma"||q[1]=="comma"?!0:!1;break;case "dynamicscale":this.fAdaptMapScaleToSize=
q[1]=="false"?!1:q[1];break;case "toolcursor":this.fSetToolCursor=q[1]=="false"?!1:q[1];break;case "scalebar":this.fScaleBar=q[1]=="false"?!1:q[1];break;case "northarrow":this.fNorthArrow=q[1]=="false"?!1:q[1];break;case "northarrowposition":this.szNorthArrowPosition=q[1];break;case "screenppi":(f=Number(q[1]))||(f=96);break;case "embedname":this.szEmbedName=q[1];break;case "debug":this.fDebug=q[1];break;case "marktiles":this.fMarkTiles=q[1];break;case "popupalignment":this.szLocalPopupAlignment=
q[1];break;case "toolmargintop":this.nToolMarginTop=Number(q[1]);break;case "messageposition":this.szMessagePosition=q[1];break;case "maxThemeCharts":this.Themes.nMaxThemeCharts=Number(q[1]);break;case "maxShadowCharts":this.Themes.nMaxShadowCharts=Number(q[1]);break;case "flushPaintShape":this.Themes.nflushPaintShape=Number(q[1]);break;case "flushChartDraw":this.Themes.nflushChartDraw=Number(q[1]);this.Themes.activeTheme&&(this.Themes.activeTheme.nflushChartDraw=Number(q[1]));break;case "flushLabelDraw":this.Label.nflushLabelDraw=
Number(q[1]);break;case "activeThemeInfo":this.fActiveThemeInfo=q[1];break;case "fixedInfoScale":this.nFixedInfoScale=Number(q[1]);break;case "normalSizeScale":this.Scale.nNormalSizeScale=Number(q[1]);break;case "dynamicScalePow":this.Scale.nDynamicScalePow=Number(q[1])}}this.fClipMap&&!this.fClipMapDynamic||h.Zoom.removeClipping()};r.prototype.getFeatures=function(){this.szFeatures+=";mapopacity:"+String(this.nOpacity||1);return this.szFeatures+=";flushChartDraw:"+String(this.Themes.nflushChartDraw||
1E5)};r.prototype.isLoading=function(){return this.Loader&&this.Loader.isWaiting()||this.mapLoader&&this.mapLoader.isWaiting()||h.Tiles&&h.Tiles.isLoading()||Za.isLoading()?!0:!1};r.prototype.isInitializing=function(){return this.fInitializing||this.Legend&&this.Legend.fInitializing||!this.Scale?!0:!1};r.prototype.isIdle=function(){return this.isInitializing()||this.isLoading()||this.actionA.length!==0||this.initActionA.length!==0?!1:!0};r.prototype.pushAction=function(k,p){if(k.toString().match(/geobounds/i)){for(var q=
0;q<this.actionA.length;q++)this.actionA[q].toString().match(/geobounds/i)&&(this.actionA[q].slice(q,1),this.messageA[q]&&this.messageA[q].slice(q,1));this.fPendingNewGeoBounds=!0}if(k.toString().match(/toview/i)){for(q=0;q<this.actionA.length;q++)this.actionA[q].toString().match(/toview/i)&&(this.actionA[q].slice(q,1),this.messageA[q]&&this.messageA[q].slice(q,1));this.fPendingNewGeoBounds=!0}this.actionA.push(k);this.messageA.push(p);this.isInitializing()||this.actionA.length!=1||setTimeout("map.popAction()",
10)};r.prototype.pushInitAction=function(k,p){this.initActionA.push(k);this.initMessageA.push(p);this.initActionA.length==1&&setTimeout("map.popInitAction()",10)};r.prototype.popAction=function(){if(this.actionA.length!==0)if(this.isLoading()||this.isInitializing())if(this.isLoading()?this.npopActionWaitInit=0:this.npopActionWaitInit++,this.npopActionWaitInit<100)setTimeout("map.popAction()",500);else{alert("Error at initializing !\nResource missing or corrupted ?\n");this.actionA.length=0;this.initActionA.length=
0;this.fInitializing=!1;try{h.HTMLWindow&&h.HTMLWindow.ixmaps.htmlgui_onMapError(window)}catch(q){}}else{var k=this.actionA.shift(),p=this.messageA.shift();p&&Z(p,1E3);if(typeof k==="function")try{k()}catch(q){q&&typeof q!="undefined"&&q.description&&typeof q.description!="undefined"&&alert("Error: "+q.description+":\n\n"+k)}else{alert("wrong pushInitAction() usage with string: "+k);try{eval(k)}catch(q){q&&typeof q!="undefined"&&q.description&&typeof q.description!="undefined"&&alert("Error: "+q.description+
":\n\n"+k)}}setTimeout("map.popAction()",10)}};r.prototype.popInitAction=function(){if(this.initActionA.length===0)h.npopActionWaitInit=0,h.popAction();else{if(!this.isLoading()){var k=this.initActionA.shift(),p=this.initMessageA.shift();p&&Z(p,1E3);if(typeof k==="function")try{k()}catch(q){}else{alert("wrong pushInitAction() uasge");try{eval(k)}catch(q){}}}setTimeout("map.popInitAction()",10)}};r.prototype.checkVersion=function(k){return k===null||k!=this.version?!1:!0};r.prototype.fadeLogo=function(){var k=
this.SVGDocument.getElementById("mapbackground:logo");k&&k.parentNode.removeChild(k)};r.prototype.hideAll=function(){var k=this.SVGDocument.getElementById("mapcanvas");k&&k.style.setProperty("display","none","")};r.prototype.showAll=function(){var k=this.SVGDocument.getElementById("mapcanvas");k&&k.style.setProperty("display","inline","")};r.prototype.hideMap=function(){if(!this.fHidden){var k=this.SVGDocument.getElementById("maplayer");k&&k.style.setProperty("display","none","");(k=this.SVGDocument.getElementById("mapobjects"))&&
k.style.setProperty("display","none","");this.fHidden=!0}};r.prototype.showMap=function(){if(this.fHidden){var k=this.SVGDocument.getElementById("maplayer");k&&k.style.setProperty("display","inline","");(k=this.SVGDocument.getElementById("mapobjects"))&&k.style.setProperty("display","inline","");this.fHidden=!1}};r.prototype.setOpacity=function(k,p){var q=this.SVGDocument.getElementById("maplayer");if(q)if(p=="absolute")q.style.setProperty("opacity",k,""),this.nOpacity=k;else{p=q.style.getPropertyValue("opacity");
if(p===null||p.length===0)p="1";p=parseFloat(p);this.nOpacity=p=Math.min(Math.max(p+k,0),1);q.style.setProperty("opacity",p,"")}};r.prototype.toggleOpacity=function(){var k=this.SVGDocument.getElementById("maplayer");if(k){var p=k.style.getPropertyValue("opacity");if(p===null||p.length===0)p="1";p=parseFloat(p);k.style.setProperty("opacity",p<1?1:0,"")}};r.prototype.clearAll=function(){h.Dom.clearGroup(h.SVGToolsGroup);h.Dom.clearGroup(h.SVGFixedGroup);h.removeAllHighlights();h.Themes.removeAll();
setMapTool("");this.Scale.nObjectScaling=1};r.prototype.loadMap=function(k){this.mapLoader||(this.mapLoader=new z);if(this.mapLoader.importSVGFile(k,this.SVGDocument)){try{h.HTMLWindow.ixmaps.loadingMap=k}catch(p){}k.match(/http/)?(k=k.split(/\//),k.splice(-1),k=k.join("/"),this.mapRoot=k+"/"):this.mapRoot="";this.clearAll();h.Dom.clearGroup(h.Layer.objectGroup)}};h=new r;h.version="0.95";window.map=h;window.thisversion="0.95";var C=0;r.Dom=function(k){this.targetDocument=window.document;k&&(this.targetDocument=
k.target.ownerDocument);this.rootElement=h.SVGDocument;this.idList=[];this.objStackA=[]};r.Dom.prototype=new r;r.Dom.prototype.setTargetDocument=function(k){k&&(this.targetDocument=k)};r.Dom.prototype.setTargetGroup=function(k){k&&(this.targetGroup=k)};r.Dom.prototype.newNode=function(k,p){k=this.targetDocument.createElementNS("http://www.w3.org/2000/svg",k);(p||this.targetGroup).appendChild(k);return k};r.Dom.prototype.newGroup=function(k,p){if(k=this.newNode("g",k))p&&k.setAttribute("id",p),k.fu=
new P(k);return k};r.Dom.prototype.newObject=function(k,p){if(k=this.newNode(k,p))k.fu=new P(k);return k};r.Dom.prototype.getObjectById=function(k){if(k=this.targetDocument.getElementById(k))k.fu=new P(k);return k};r.Dom.prototype.clearGroup=function(k){if(k&&k.hasChildNodes())for(var p=k.childNodes,q=p.length-1;q>=0;q--)k.removeChild(p.item(q))};r.Dom.prototype.removeElementById=function(k){(k=h.SVGDocument.getElementById(k))&&k.parentNode&&k.parentNode.removeChild(k)};r.Dom.prototype.constructNode=
function(k,p,q){k=this.newObject(k,p);for(var D in q)D.match(/xlink/)?k.setAttributeNS("http://www.w3.org/1999/xlink",D,q[D]):k.setAttribute(D,q[D]);return k};r.Dom.prototype.pushObj=function(k){var p="stackedObject"+String(Math.random());this.objStackA[p]=k;return p};r.Dom.prototype.popObj=function(k){return this.objStackA[k]};r.Dom.prototype.newShape=function(k,p,q,D,H,N,S,ha,Ia,mb,Sc,vb,Rb){ha=null;switch(k){case "rect":isNaN(H)||H<=0||isNaN(N)||N<=0||(ha={x:String(q),y:String(D),width:String(H),
height:String(N),style:S});break;case "circle":isFinite(H)&&H>0&&(ha={cx:String(q),cy:String(D),r:String(H),style:N});break;case "line":isFinite(q)&&isFinite(D)&&isFinite(H)&&isFinite(N)&&(ha={x1:String(q),y1:String(D),x2:String(H),y2:String(N),style:S});break;case "path":ha={d:String(q),style:D}}return ha?this.constructNode(k,p,ha):null};r.Dom.prototype.newText=function(k,p,q,D,H){if(!isFinite(p)||!isFinite(q))return null;H&&typeof H!="undefined"||(H="(undefined)");H=String(H);if(h.fCreatTextLink&&
H.substr(0,7)=="http://"||h.fCreatTextLink&&H.substr(0,8)=="https://")return this.newTextLink(k,p,q,D,H);k=this.constructNode("text",k,{x:String(p),y:String(q),style:D});H=this.targetDocument.createTextNode(H);k.appendChild(H);return k};r.Dom.prototype.newTSpan=function(k,p,q){if(k.nodeName!="text")return null;q||="(undefined)";k=this.constructNode("tspan",k,{style:p});q=this.targetDocument.createTextNode(q);k.appendChild(q);return k};r.Dom.prototype.newTextOnPath=function(k,p,q,D,H){q&&typeof q!=
"undefined"||(q="(undefined)");q=String(q);var N=this.constructNode("text",k,{style:D});k=this.constructNode("textPath",k,{style:D});k.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+p);k.setAttributeNS(null,"startOffset",H);p=this.targetDocument.createTextNode(q);k.appendChild(p);N.appendChild(k);return N};r.Dom.prototype.newTextLink=function(k,p,q,D,H,N){k=this.constructNode("a",k);k.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",N?N:H);k.setAttributeNS(null,"target",
szLinkTarget);H&&H.length>30&&(H=H.substr(0,29)+" ...");p=this.constructNode("text",k,{x:String(p),y:String(q),style:D});H=this.targetDocument.createTextNode(H);p.appendChild(H);p.style.setProperty("fill","blue","");p.style.setProperty("text-decoration","underline","");return k};r.Dom.prototype.wrapText=function(k,p){var q=k.firstChild.data,D=k.style.getPropertyValue("font-size");if(q){var H=k.getAttributeNS(null,"x");q=q.split(" ");k.removeChild(k.firstChild);var N=this.newTSpan(k,"",q[0]);N.setAttributeNS(null,
"x",H);for(var S=1,ha=1;ha<q.length;ha++){var Ia=N.firstChild.data.length;N.firstChild.data+=" "+q[ha];N.getComputedTextLength()>p&&(N.firstChild.data=N.firstChild.data.slice(0,Ia),N=this.newTSpan(k,"",q[ha]),N.setAttributeNS(null,"x",H),N.setAttributeNS(null,"dy",D),S++)}return S}};r.Dom.prototype.getAllIds=function(k,p){p===null&&(this.idList.length=0);if(k&&k.hasChildNodes())for(k.hasAttributes&&(p=k.getAttributeNS(null,"id"))&&(this.idList[this.idList.length]=p),k=k.childNodes,p=0;p<k.length;p++)this.getAllIds(k.item(p),
1);return this.idList};r.Dom.prototype.extendAllIds=function(k,p){if(k&&k.nodeType==1){var q=k.getAttributeNS(null,"id");k.setAttributeNS(null,"id",q+p);k=k.childNodes;for(q=0;q<k.length;q++)this.extendAllIds(k.item(q),p)}};r.Dom.prototype.getParentByNodename=function(k,p){if(k)for(;k=k.parentNode;)if(k.nodeName==p)return k;return null};r.Dom.prototype.getAttributeByNodeOrParents=function(k,p,q){for(var D;k&&k.nodeType==1;)if(D=k.getAttributeNS(p,q),D===null||D.length===0)k=k.parentNode;else return D;
return""};r.Dom.prototype.getClipRect=function(k){var p=null;(k=k.getAttributeNS(null,"clip-path"))&&(k=k.match(M))&&k[1]&&(k=h.SVGDocument.getElementById(k[1]))&&k.hasChildNodes&&(p=k.firstChild);return p};r.Dom.prototype.setClipRect=function(k,p){var q=this.getClipRect(k);if(!q){var D=k.getAttributeNS(null,"id");q=h.Dom.newNode("clipPath",k.parentNode);q.setAttributeNS(null,"id",D+":clippath");q.setAttributeNS(null,"style","pointer-events:all");q=h.Dom.newShape("rect",q,0,0,1,1,"fill:none;stroke:none;opacity:0");
q.setAttributeNS(null,"id",D+":cliprect");k.setAttributeNS(null,"clip-path","url(#"+D+":clippath)")}q.setAttributeNS(null,"x",p.x);q.setAttributeNS(null,"y",p.y);q.setAttributeNS(null,"width",p.width);q.setAttributeNS(null,"height",p.height);return q};r.Scale=function(){h.fScaleToFullscreen&&!h.fPDFEmbed&&window.screen&&(h.SVGRootElement.currentScale=1,h.SVGRootElement.currentScale=Math.min(window.innerWidth/h.SVGWidth,window.innerHeight/h.SVGHeight));this.viewBox=new I(h.SVGViewBox[0],h.SVGViewBox[1],
h.SVGViewBox[2],h.SVGViewBox[3]);this.szMapUnits=this.nMapScale=this.scaleNode=null;this.szMapProjection="UTM";this.mapPosition=new G(0,0);this.mapOffset=new G(0,0);this.offsetNode=h.SVGDocument.getElementById("mapoffset");this.canvasNode=h.SVGDocument.getElementById("mapcanvas");this.zoomNode=h.SVGDocument.getElementById("mapzoomandpan");this.canvasNode&&(this.mapOffset=A(this.canvasNode));this.offsetNode&&(this.mapPosition=A(this.offsetNode));this.CSSStyleNodes=h.SVGDocument.getElementById("mapstyles");
this.fCSSStyleNodeChanged=!1;this.scaledSymbolsA=[];this.rotatedSymbolsA=[];this.screenX=1024;this.screenY=768;this.nPPI=f;this.objectScaling_lastScale=this.symbolScaling_lastScale=this.featureScaling_lastScale=1;this.metadataNode=null;var k=h.SVGRootElement.getElementsByTagName("metadata");if(this.metadataNode=k[k.length-1]){console.log(this.metadataNode);this.creationNode=this.metadataNode.getElementsByTagName("xmap:creation").item(0);if(this.extentNode=this.metadataNode.getElementsByTagName("xmap:extension").item(0))this.minBoundX=
Number(this.extentNode.getAttribute("minboundx")),this.maxBoundX=Number(this.extentNode.getAttribute("maxboundx")),this.minBoundY=Number(this.extentNode.getAttribute("minboundy")),this.maxBoundY=Number(this.extentNode.getAttribute("maxboundy")),this.minX=Number(this.extentNode.getAttribute("minx")),this.minY=Number(this.extentNode.getAttribute("miny")),this.maxX=Number(this.extentNode.getAttribute("maxx")),this.maxY=Number(this.extentNode.getAttribute("maxy")),this.bBox=new I(this.minX,this.minY,
this.maxX-this.minX,this.maxY-this.minY),this.mapUnitsPPX=(this.maxBoundX-this.minBoundX)/(this.maxX-this.minX),this.mapUnitsPPY=(this.maxBoundY-this.minBoundY)/(this.maxY-this.minY),this.origMinX=this.minX,this.origMinY=this.minY;if(this.scaleNode=this.metadataNode.getElementsByTagName("xmap:scale").item(0))this.nMapScale=Number(this.scaleNode.getAttribute("mapscale")),this.nMapPPI=Number(this.scaleNode.getAttribute("dpi")),this.nMapPPI||(this.nMapPPI=72),this.szMapUnits=this.scaleNode.getAttribute("mapunitsstr"),
this.initScale=this.scaleNode.getAttribute("mapinitscale"),this.initZoomNode=this.metadataNode.getElementsByTagName("xmap:initzoom").item(0),this.nObjectScaling=this.nLabelScaling=this.nLineScaling=this.nBorderScaling=this.nFeatureScaling=1,this.nTrueMapScale=this.getTrueMapScale(),this.nNormalSizeScale=this.nMapScale,this.nDynamicScalePow=3;if(this.coordsysNode=this.metadataNode.getElementsByTagName("xmap:coordsys").item(0))this.szMapProjection=this.coordsysNode.getAttribute("projection"),this.szDatum=
this.coordsysNode.getAttribute("datum"),this.szUTMZone=this.coordsysNode.getAttribute("UTMZone"),this.nFalseEasting=Number(this.coordsysNode.getAttribute("falseeasting")),this.nFalseNorthing=Number(this.coordsysNode.getAttribute("falsenorthing")),this.nCorrectEasting=Number(this.coordsysNode.getAttribute("correcteasting")),this.nCorrectNorthing=Number(this.coordsysNode.getAttribute("correctnorthing"));if(this.featuresNode=this.metadataNode.getElementsByTagName("xmap:features").item(0))(k=this.featuresNode.getAttributeNS(null,
"mapfeatures"))&&k.length>1&&h.setFeatures(k),this.featuresNode.getAttributeNS(null,"cliptextpath")=="true"&&(h.fAdaptLabelToScaling="delayed"),this.featuresNode.getAttributeNS(null,"initlegendoff")=="true"&&(h.fInitLegendOff=!0),this.featuresNode.getAttributeNS(null,"checklabeloverlap")=="true"&&(h.fCheckLabelOverlap=!0),this.featuresNode.getAttributeNS(null,"onlyonelabel")=="true"&&(h.fCheckLabelOnlyOne=!0),this.featuresNode.getAttributeNS(null,"tiletextnoclip")=="true"&&(h.fTileTextNoClip=!0),
this.nFeatureScaling=Number(this.featuresNode.getAttribute("featurescaling")),this.nBorderScaling=Number(this.featuresNode.getAttribute("borderscaling")),this.nLineScaling=Number(this.featuresNode.getAttribute("linescaling")),this.nLabelScaling=Number(this.featuresNode.getAttribute("labelscaling")),this.nObjectScaling=Number(this.featuresNode.getAttribute("objectscaling")),this.nFeatureScaling=this.nFeatureScaling?this.nFeatureScaling:1,this.nBorderScaling=this.nBorderScaling?this.nBorderScaling:
1,this.nLineScaling=this.nLineScaling?this.nLineScaling:1,this.nLabelScaling=this.nLabelScaling?this.nLabelScaling:1,this.nObjectScaling=this.nObjectScaling?this.nObjectScaling:1}this.nButtonSize=this.nNormalButtonSize;this.nSymbolSize=this.nNormalSymbolSize;this.nFontSize=this.nNormalFontSize;this.nScaleX=this.viewBox.width/this.getEmbedWidth()*this.getEmbedScale();this.nScaleY=this.viewBox.height/this.getEmbedHeight()*this.getEmbedScale();this.nZoomScale=1;this.mapCenter=new G(0,0);this.mapCanvasCenter=
new G(this.mapPosition.x+this.bBox.width/2,this.mapPosition.y+this.bBox.height/2);this.setCanvasSize(0,0,window.innerWidth,window.innerHeight,"center")};r.Scale.prototype=new r;r.Scale.prototype.reset=function(){h.fScaleToFullscreen&&!h.fPDFEmbed&&window.screen&&(h.SVGRootElement.currentScale=1,h.SVGRootElement.currentScale=Math.min(window.innerWidth/h.SVGWidth,window.innerHeight/h.SVGHeight));this.canvasNode&&(this.mapOffset=A(this.canvasNode));this.offsetNode&&(this.mapPosition=A(this.offsetNode));
this.mapCanvasCenter=new G(this.mapPosition.x+this.bBox.width/2,this.mapPosition.y+this.bBox.height/2);this.setCanvasSize(0,0,window.innerWidth,window.innerHeight,"center")};r.Scale.prototype.setCanvasSize=function(k,p,q,D,H){if(!q||!D)return!1;this.nScaleY=this.nScaleX=20;var N=""+String(k)+" "+String(p)+" "+String(this.normalX(q))+" "+String(this.normalX(D));k=this.normalX(q)-this.mapPosition.x;p=this.normalX(D)-this.mapPosition.y;var S=k-(this.maxX-this.minX),ha=p-(this.maxY-this.minY);H=="extendmax"?
(this.maxX+=S,this.maxY+=ha,this.maxBoundX+=S*this.mapUnitsPPX,this.minBoundY-=ha*this.mapUnitsPPY):(this.minX-=S/2,this.minY-=ha/2,this.maxX+=S/2,this.maxY+=ha/2,this.minBoundX-=S/2*this.mapUnitsPPX,this.maxBoundY+=ha/2*this.mapUnitsPPY,this.maxBoundX+=S/2*this.mapUnitsPPX,this.minBoundY-=ha/2*this.mapUnitsPPY,this.canvasNode&&(J(this.canvasNode,this.maxX,this.maxY),this.mapOffset=A(this.canvasNode)));h.SVGWidth=q;h.SVGHeight=D;h.SVGRootElement.setAttribute("width",h.SVGWidth+"px");h.SVGRootElement.setAttribute("height",
h.SVGHeight+"px");h.SVGRootElement.setAttribute("viewBox",N);h.SVGOrigViewBoxString=h.SVGRootElement.getAttribute("viewBox");h.SVGViewBox=h.SVGRootElement.getAttribute("viewBox").split(" ");h.SVGViewBox[0]=Number(h.SVGViewBox[0]);h.SVGViewBox[1]=Number(h.SVGViewBox[1]);h.SVGViewBox[2]=Number(h.SVGViewBox[2]);h.SVGViewBox[3]=Number(h.SVGViewBox[3]);this.viewBox=new I(h.SVGViewBox[0],h.SVGViewBox[1],h.SVGViewBox[2],h.SVGViewBox[3]);this.bBox=new I(this.minX,this.minY,this.maxX-this.minX,this.maxY-this.minY);
this.mapCanvasCenter=new G(this.mapPosition.x+this.bBox.width/2,this.mapPosition.y+this.bBox.height/2);this.nScaleX=this.viewBox.width/this.getEmbedWidth()*this.getEmbedScale();this.nScaleY=this.viewBox.height/this.getEmbedHeight()*this.getEmbedScale();if(H=h.SVGDocument.getElementById("mapcliprect"))H.setAttributeNS(null,"width",k),H.setAttributeNS(null,"height",p);h.SVGDocument.getElementById("mapcliprect2");if(H=h.SVGDocument.getElementById("map:annotation"))H.fu=new P(H),k=H.fu.getBox(),H.fu.setPosition(this.normalX(q-
2)-this.mapPosition.x,this.normalY(D)-this.mapPosition.y-k.height*2)};r.Scale.prototype.resizeCanvas=function(k,p,q,D,H){H||="center";this.setCanvasSize(k,p,q,D,H);try{h.Viewport.reformat(),h.Themes.reformat(),h.Themes.redraw(),h.Legend.reformat()}catch(N){}try{displayScale(null,"bottom")}catch(N){}};r.Scale.prototype.getDistanceInMeter=function(k,p,q,D){var H=q-k,N=D-p;this.szMapProjection=="Mercator"&&(this.szMapUnits="degrees");switch(this.szMapUnits){case "feet":H/=3.2808399,N/=3.2808399;case "meter":case "meters":H=
H*this.nZoomScale*this.mapUnitsPPX;N=N*this.nZoomScale*this.mapUnitsPPY;q=Math.sqrt(H*H+N*N);q>100&&(q=Math.round(q));q=q>10?Math.round(q*10)/10:Math.round(q*100)/100;break;default:k=h.Scale.getMapPosition(k,p),D=h.Scale.getMapPosition(q,D),q=h.Scale.getMapCoordinate(k.x,k.y),D=h.Scale.getMapCoordinate(D.x,D.y),q=h.Scale.getGeoCoordinateOfPoint(q.x,q.y),D=h.Scale.getGeoCoordinateOfPoint(D.x,D.y),k=q.y/180*Math.PI,p=D.y/180*Math.PI,q=Math.pow(Math.sin(Math.abs(p-k)/2),2)+Math.cos(k)*Math.cos(p)*Math.pow(Math.sin(Math.abs(D.x/
180*Math.PI-q.x/180*Math.PI)/2),2),q=2*Math.atan2(Math.sqrt(q),Math.sqrt(1-q))*6378.388*1E3}return q};r.Scale.prototype.formatDistanceString=function(k){return k>1E3?String(Math.round(k/100)/10)+" km":k>100?String(Math.round(k*10)/10)+" m":String(Math.round(k*100)/100)+" m"};r.Scale.prototype.formatSurfaceString=function(k){k=k>1E6?String(Math.round(k/1E6*1E3)/1E3)+" km2":String(Math.round(k*1E3)/1E3)+" m2";var p=k.split(".");p.length>1&&(k=p[0]+","+p[1]);return k};r.Scale.prototype.getDeltaXofDistanceInMeter=
function(k){return 1E3/this.getDistanceInMeter(1E3,1E3,2E3,1E3)*k};r.Scale.prototype.getDeltaYofDistanceInMeter=function(k){return 1E3/this.getDistanceInMeter(1E3,1E3,1E3,2E3)*k};r.Scale.prototype.getMapCoordinate=function(k,p){k+=this.mapOffset.x;p=this.maxY-this.minY-(p+this.mapOffset.y);switch(this.szMapUnits){case "feet":case "meter":case "meters":k=this.minBoundX+k*this.mapUnitsPPX;p=this.minBoundY+p*this.mapUnitsPPY;break;default:k=this.minBoundX+k*this.mapUnitsPPX,p=this.minBoundY+p*this.mapUnitsPPY}return new G(k,
p)};r.Scale.prototype.getMapCoordinateUTM=function(k,p){k=this.getMapCoordinate(k,p);this.szMapProjection=="Mercator"?k=Ma(k.y,k.x):this.szMapProjection=="WinkelTripel"?k=Oa(k.y,k.x):this.szMapProjection=="EqualEarth"?k=Pa(k.y,k.x):this.szMapUnits!="feet"&&this.szMapUnits!="meter"&&this.szMapUnits!="meters"&&(k=oa("WGS84",k.y,k.x));return k};r.Scale.prototype.getMapPositionOfUTM=function(k,p,q,D){k=Ca(q,k,p,D);k=h.Scale.getMapCoordinateOfLatLon(k.y,k.x);return{x:(k.x-h.Scale.minBoundX)/h.Scale.mapUnitsPPX-
h.Scale.mapOffset.x,y:h.Scale.bBox.height-(k.y-h.Scale.minBoundY)/h.Scale.mapUnitsPPY-h.Scale.mapOffset.y}};r.Scale.prototype.getMapPositionOfLatLon=function(k,p){k=h.Scale.getMapCoordinateOfLatLon(k,p);return{x:(k.x-h.Scale.minBoundX)/h.Scale.mapUnitsPPX-h.Scale.mapOffset.x,y:h.Scale.bBox.height-(k.y-h.Scale.minBoundY)/h.Scale.mapUnitsPPY-h.Scale.mapOffset.y}};r.Scale.prototype.getMapCoordinateOfLatLon=function(k,p){if(this.szMapProjection=="Mercator")var q=Ma(k,p);else if(this.szMapProjection==
"WinkelTripel")q=Oa(k,p);else if(this.szMapProjection=="EqualEarth")q=Pa(k,p);else if(this.szMapUnits=="feet"||this.szMapUnits=="meter"||this.szMapUnits=="meters"){if(!this.szDatum&&!this.szUTMZone)return null;q=oa(this.szDatum,k,p,this.szUTMZone);this.nFalseEasting&&(q.x+=this.nFalseEasting-5E5);q.y+=this.nFalseNorthing+this.nCorrectNorthing;q.x+=this.nCorrectEasting;q.y+=this.nCorrectNorthing}return q};r.Scale.prototype.getGeoCoordinateOfPoint=function(k,p){if(this.szMapProjection=="Mercator")return p=
Math.atan(ib(p*Aa))*wb,new G(k,p);if(this.szMapProjection=="EqualEarth"){for(;p>6378137;)p-=6378137;for(;k>6378137;)k-=6378137;for(;p<-6378137;)p+=6378137;for(;k<-6378137;)k+=6378137;for(var q=k/=6378137,D=q*q,H=D*D*D,N,S=0;S<12&&!(N=q*(1.340264+-.081106*D+H*(8.93E-4+.003796*D))-k,D=1.340264+3*-.081106*D+H*(7*8.93E-4+.034164*D),q-=N/=D,D=q*q,H=D*D*D,Math.abs(N)<.1);++S);return new G(wb*db*(p/6378137)*(1.340264+3*-.081106*D+H*(7*8.93E-4+.034164*D))/Math.cos(q),wb*Math.asin(Math.sin(q)/db))}if(this.szMapUnits!=
"feet"&&this.szMapUnits!="meter"&&this.szMapUnits!="meters")return new G(k,p);if(!this.szDatum&&!this.szUTMZone)return null;p=new G(k,p);this.nFalseEasting&&(p.x-=this.nFalseEasting-5E5);p.y-=this.nFalseNorthing+this.nCorrectNorthing;p.x-=this.nCorrectEasting;p.y-=this.nCorrectNorthing;return Ca(this.szDatum,p.y,p.x,this.szUTMZone)};r.Scale.prototype.getMapPosition=function(k,p){var q=y(this.zoomNode),D=q[0],H=q[3],N=h.antiZoomAndPanList.getActualMatrix();k=k*N[0]+N[4];p=p*N[3]+N[5];k=k-this.mapPosition.x-
this.mapOffset.x;p=p-this.mapPosition.y-this.mapOffset.y;k=(k-q[4])/D;p=(p-q[5])/H;return new G(k,p)};r.Scale.prototype.clipWidgetPositionToMap=function(k){k.x>=this.mapPosition.x+this.bBox.width&&(k.x=this.mapPosition.x+this.bBox.width);k.x<=this.mapPosition.x&&(k.x=this.mapPosition.x);k.y>=this.mapPosition.y+this.bBox.height&&(k.y=this.mapPosition.y+this.bBox.height);k.y<=this.mapPosition.y&&(k.y=this.mapPosition.y);return k};r.Scale.prototype.isWidgetPositionInMap=function(k){return k.x>this.mapPosition.x+
this.bBox.width||k.x<this.mapPosition.x||k.y>this.mapPosition.y+this.bBox.height||k.y<this.mapPosition.y?!1:!0};r.Scale.prototype.clipWidgetObjectToMap=function(k,p,q){k=h.Dom.getBox(k);p.x+q.x+k.width>this.mapPosition.x+this.bBox.width&&(p.x-=k.width+q.x*2);p.y+q.y+k.height>this.mapPosition.y+this.bBox.height&&(p.y-=k.height+q.y*2);return new G(p.x+q.x,p.y+q.y)};r.Scale.prototype.clipWidgetObjectToSVG=function(k,p,q,D){D||=h.Dom.getBox(k);k.getAttributeNS(null,"clip-path")&&(k=k.getAttributeNS(null,
"clip-path"),k.match(/url/)&&(k=k.substr(5,k.length-6),k=h.SVGDocument.getElementById(k)))&&(k=k.firstChild,D.x=Number(k.getAttributeNS(null,"x")),D.y=Number(k.getAttributeNS(null,"y")),D.width=Number(k.getAttributeNS(null,"width")),D.height=Number(k.getAttributeNS(null,"height")));k=new G(p.x+q.x,p.y+q.y);k.x+D.width>this.viewBox.width&&(k.x=p.x-D.width-q.x);k.x<0&&(k.x=h.Scale.normalX(5),q.y<=0&&(k.y-=q.y,q.y=h.Scale.normalY(20),k.y+=q.y));k.y+D.height>this.viewBox.height&&(k.y=p.y-D.height-q.y);
k.y<0&&(k.y=h.Scale.normalX(5));return k};r.Scale.prototype.getEmbedWidth=function(){if(typeof HTMLDocument!="undefined"&&HTMLDocument!=null)try{var k=HTMLDocument.embeds[h.szEmbedName].clientWidth,p=k/HTMLDocument.embeds[h.szEmbedName].clientHeight,q=h.SVGWidth/h.SVGHeight;return p<q?k:q/p*k}catch(D){return h.SVGWidth}return h.fSVGEmbeded&&h.fEmbedScale?h.EmbedWidth.indexOf("%")!=-1?document.embeds.svgMain.clientWidth:h.EmbedWidth:h.fPDFEmbed?(p=window.innerWidth/window.innerHeight,q=h.SVGWidth/
h.SVGHeight,p<q?window.innerWidth:q/p*window.innerWidth):h.SVGWidth};r.Scale.prototype.getEmbedHeight=function(){if(typeof HTMLDocument!="undefined"&&HTMLDocument!=null)try{var k=HTMLDocument.embeds[h.szEmbedName].clientHeight,p=HTMLDocument.embeds[h.szEmbedName].clientWidth/k,q=h.SVGWidth/h.SVGHeight;return q<p?k:p/q*k}catch(D){return h.SVGHeight}return h.fSVGEmbeded&&h.fEmbedScale?h.EmbedHeight.indexOf("%")!=-1?document.embeds.svgMain.clientHeight:h.EmbedHeight:h.fPDFEmbed?(p=window.innerWidth/
window.innerHeight,q=h.SVGWidth/h.SVGHeight,q<p?window.innerHeight:p/q*window.innerHeight):h.SVGHeight};r.Scale.prototype.getEmbedScale=function(){if(typeof HTMLDocument!="undefined"&&HTMLDocument!=null)try{var k=HTMLDocument.embeds[h.szEmbedName].clientWidth,p=HTMLDocument.embeds[h.szEmbedName].clientHeight,q=h.SVGWidth/h.SVGHeight;return q<k/p?p/h.SVGHeight:k/h.SVGWidth}catch(D){return 1}return h.fPDFEmbed?(k=window.innerWidth/window.innerHeight,q=h.SVGWidth/h.SVGHeight,q<k?window.innerHeight/h.SVGHeight:
window.innerWidth/h.SVGWidth):1};r.Scale.prototype.getTrueMapScale=function(){return h.fAdaptMapScaleToSize?this.nMapScale/this.getEmbedScale()*this.nPPI/this.nMapPPI:this.nMapScale*this.nPPI/this.nMapPPI};r.Scale.prototype.normalX=function(k){return k*this.nScaleX};r.Scale.prototype.normalY=function(k){return k*this.nScaleY};r.Scale.prototype.embedX=function(k){return k/this.nScaleX};r.Scale.prototype.embedY=function(k){return k/this.nScaleY};r.Scale.prototype.scaleX=function(k){return k/h.SVGRootElement.currentScale*
this.viewBox.width/this.getEmbedWidth()};r.Scale.prototype.scaleY=function(k){return k/h.SVGRootElement.currentScale*this.viewBox.height/this.getEmbedHeight()};r.Scale.prototype.toSVGx=function(k){return this.scaleX(k*h.SVGRootElement.currentScale-h.SVGRootElement.currentTranslate.x)+this.viewBox.x};r.Scale.prototype.toSVGy=function(k){return this.scaleY(k*h.SVGRootElement.currentScale-h.SVGRootElement.currentTranslate.y)+this.viewBox.y};r.Scale.prototype.toScreenX=function(k){return(k-this.scaleX(-h.SVGRootElement.currentTranslate.x)+
Number(viewBox[0]))/h.SVGRootElement.currentScale/viewBoxScale};r.Scale.prototype.toScreenY=function(k){return(k-this.scaleY(-h.SVGRootElement.currentTranslate.y)+Number(viewBox[3]))/h.SVGRootElement.currentScale/viewBoxScale};r.Scale.prototype.toMapX=function(k){return(k-this.scaleX(-h.SVGRootElement.currentTranslate.x)+Number(viewBox[0]))/h.SVGRootElement.currentScale/viewBoxScale};r.Scale.prototype.toMapY=function(k){return(k-this.scaleY(-h.SVGRootElement.currentTranslate.y)+Number(viewBox[3]))/
h.SVGRootElement.currentScale/viewBoxScale};r.Scale.prototype.getSVGOffset=function(k){var p=k;p.nodeName!="svg"&&(p=h.Dom.getParentByNodename(k,"svg"));return p&&p!=h.SVGRootElement&&(k=p.getAttribute("viewBox").split(" "),k.length==4)?new G(Number(k[0]),Number(k[1])):new G(0,0)};r.Scale.prototype.getGroupOffset=function(k){var p=new G(0,0);if(k)for(;k=k.parentNode;){if(k==h.Zoom.zoomNode||k.nodeType!=1)return p;var q=y(k);p.x=p.x*q[0]+q[4];p.y=p.y*q[3]+q[5]}return new G(0,0)};r.Scale.prototype.getGroupScale=
function(k){var p=new G(1,1);for(k=k.parentNode;k&&k.nodeType==1;){var q=L(k);q&&(p.x*=q.x,p.y*=q.y);k=k.parentNode}return p};r.Scale.prototype.getMapOffset=function(k){var p=this.getSVGOffset(k);k=this.getGroupOffset(k);return new G(-p.x+k.x,-p.y+k.y)};r.Scale.prototype.getScreenPosition=function(k){var p=this.getSVGOffset(k),q=this.getGroupOffset(k),D=A(k);if(k=h.Dom.getBox(k))D.x+=k.x+k.width/2,D.y+=k.y+k.height/2;k=h.antiZoomAndPanList.getActualMatrix();var H=y(this.zoomNode);D=h.Scale.rotatePoint(D,
-1);return new G((this.mapPosition.x+this.mapOffset.x+H[4]+(D.x-p.x+q.x)*H[0]-k[4])*k[0],(this.mapPosition.y+this.mapOffset.y+H[5]+(D.y-p.y+q.y)*H[3]-k[5])*k[3])};r.Scale.prototype.getClientMousePosition=function(k,p){var q=null;if(k){q=h.SVGDocument.parentNode.parentNode.offsetLeft;const H=h.SVGDocument.parentNode.parentNode.offsetTop;var D=h.fEmbedScale;h.fEmbedScale=!0;p&&h.antiZoomAndPanList&&h.antiZoomAndPanList.isContained(p)?(q=new G(this.normalX(k.clientX-q),this.normalY(k.clientY-H)),k=new G(this.getEmbedScale(),
this.getEmbedScale()),q.x/=k.x,q.y/=k.y):q=new G(this.toSVGx(k.clientX-q),this.toSVGy(k.clientY-H));p&&(p=h.Scale.getGroupScale(p),q.x/=p.x,q.y/=p.y);h.fEmbedScale=D}return q};r.Scale.prototype.refreshCSSStyles=function(){this.fCSSStyleNodeChanged&&(this.CSSStyleNodes.parentNode.parentNode.appendChild(this.CSSStyleNodes.parentNode),this.fCSSStyleNodeChanged=!1)};r.Scale.prototype.normalizeSymbols=function(k){this.featureScaling_lastScale==1&&this.normalizeElements(k,/symbol/,h.nNormalSymbolSize);
this.nSymbolSize=this.nNormalButtonSize};r.Scale.prototype.normalizeButtons=function(k){this.normalizeElements(k,/button/,this.nNormalButtonSize);this.normalizeElements(k,/icon/,this.nNormalButtonSize);this.nButtonSize=this.nNormalButtonSize};r.Scale.prototype.normalizeElements=function(k,p,q){if(k){var D=k.getElementsByTagName("g");k=[];for(var H=0;H<D.length;H++)k[H]=D.item(H);for(H=0;H<k.length;H++){D=k[H];var N=D.getAttributeNS(null,"id");if(N&&N.match(p)){var S=h.SVGDocument.getElementById(N);
S&&S!=D&&S.parentNode.removeChild(S);D.fu=new P(D);S=h.Dom.getBox(D);S.width===0&&(S=h.Dom.constructNode("use",h.SVGTempGroup,{"xlink:href":"#"+N}),S=h.Dom.getBox(S));var ha=this.normalX(q)/S.height;D.fu.setPosition((-S.x-S.width/2)*ha,(-S.y-S.height/2)*ha);D.fu.scale(ha,ha);l.match(/Firefox/i)&&(D.setAttributeNS(null,"id",""),S=h.Dom.newGroup(D.parentNode),S=D.parentNode.insertBefore(S,D),S.appendChild(D),S.setAttributeNS(null,"id",N))}}}h.Dom.clearGroup(h.SVGTempGroup)};r.Scale.prototype.changeRotation=
function(k,p){var q=da(h.Scale.canvasNode);q=(360+Number(q)+Number(p))%360;V(h.Scale.canvasNode,q);h.Layer.setObjectRotate(k,-q);h.Layer.setPatternRotate(k,-q);h.Layer.setLabelRotate(k,-q)};r.Scale.prototype.setRotation=function(k,p){p=Math.floor(p);V(h.Scale.canvasNode,p);h.Layer.setSymbolRotate(k,-p);h.Layer.setObjectRotate(k,-p);h.Layer.setPatternRotate(k,-p);h.Layer.setLabelRotate(k,-p);h.Themes&&h.Themes.resortCharts();h.Dom.clearGroup(h.SVGToolsGroup);h.Dom.clearGroup(h.SVGFixedGroup);h.removeAllHighlights()};
r.Scale.prototype.rotatePoint=function(k,p){var q=da(h.Scale.canvasNode)/180*Math.PI;if(q){p==-1&&(q=-q);p=k.x;var D=k.y;k.x=p*Math.cos(q)+D*Math.sin(q);k.y=-p*Math.sin(q)+D*Math.cos(q)}return k};r.Scale.prototype.createWidgetStyles=function(){if(typeof k!="string")var k="font-family:arial;font-size:12px;fill:#444444;pointer-events:none;";if(typeof p!="string")var p=k;if(typeof q!="string")var q="font-family:arial;font-size:10px;fill:#888888;font-weight:bold;font-style:italic;pointer-events:none;";
if(typeof D!="string")var D="font-family:arial;font-size:11px;fill:#555555;;pointer-events:none;";if(typeof H!="string")var H="font-family:arial;font-size:10px;fill:#444444;pointer-events:none;";if(typeof N!="string")var N="font-family:arial;font-size:11px;fill:darkgrey;font-style:italic;stroke:none;pointer-events:none;";if(typeof S!="string")var S="font-family:arial;font-size:10px;fill:#798697;font-style:normal;stroke:none;pointer-events:none;";this.tStyle={};this.tStyle.ContainerTitle=this.createTextObject(k);
this.tStyle.InfoContainerTitle=this.createTextObject(p);this.tStyle.Description=this.createTextObject(q);this.tStyle.Snippet=this.createTextObject(D);this.tStyle.Summary=this.createTextObject(H);this.tStyle.Note=this.createTextObject(N);this.tStyle.Values=this.createTextObject(S)};r.Scale.prototype.createTextObject=function(k){var p={};p.szStyle=fa(k,this.normalY(1));a:{if(k=p.szStyle){k=k.split(";");for(var q=0;q<k.length;q++)if(k[q].match(/font-size/)){k=k[q].split(":");k=parseFloat(k[1]);break a}}k=
-1}p.nFontHeight=k;return p};r.Scale.prototype.getScaleParam=function(){var k={};this.nFeatureScaling&&this.nFeatureScaling!=1&&(k.featureScaling=this.nFeatureScaling);this.nBorderScaling&&this.nBorderScaling!=1&&(k.borderScaling=this.nBorderScaling);this.nLineScaling&&this.nLineScaling!=1&&(k.lineScaling=this.nLineScaling);this.nObjectScaling&&this.nObjectScaling!=1&&(k.objectScaling=this.nObjectScaling);this.nLabelScaling&&this.nLabelScaling!=1&&(k.labelScaling=this.nLabelScaling);this.nNormalSizeScale&&
this.nNormalSizeScale!=1&&(k.normalSizeScale=this.nNormalSizeScale);this.nDynamicScalePow&&this.nDynamicScalePow!=3&&(k.dynamicScalePow=this.nDynamicScalePow);return k};r.Scale.prototype.setScaleParam=function(k){var p=this.featureScaling_lastScale;this.nObjectScaling=this.nLabelScaling=this.nLineScaling=this.nBorderScaling=this.nFeatureScaling=1;k.featureScaling&&k.featureScaling!=1&&(this.nFeatureScaling=k.featureScaling);k.borderScaling&&k.borderScaling!=1&&(this.nBorderScaling=k.borderScaling);
k.lineScaling&&k.lineScaling!=1&&(h.Layer.changeLineScaling(null,k.lineScaling/this.nLineScaling),this.featureScaling_lastScale=p);k.labelScaling&&k.labelScaling!=1&&(h.Layer.changeLabelScaling(null,k.labelScaling/this.nLabelScaling),this.featureScaling_lastScale=p);k.objectScaling&&k.objectScaling!=1&&(this.nObjectScaling=k.objectScaling);k.normalSizeScale&&k.normalSizeScale!=1&&(this.nNormalSizeScale=Number(k.normalSizeScale));this.nDynamicScalePow=3;k.dynamicScalePow&&k.dynamicScalePow!=3&&(this.nDynamicScalePow=
Number(k.dynamicScalePow));h.Layer.doDynamicObjectScaling(h.Scale.nZoomScale)};var F=/matrix\(([^,]*)\)/,v=/matrix\(([0-9., -e]*)\)/,E=/rotate\(([0-9]*)\)/,M=/url\(#([a-zA-Z0-9\-\._:]*)\)/,G=function(k,p){this.x=k;this.y=p},I=function(k,p,q,D){this.x=Number(k);this.y=Number(p);this.width=Number(q);this.height=Number(D)};I.prototype.scale=function(k){var p=this.width*k;k*=this.height;this.x-=(p-this.width)/2;this.y-=(k-this.height)/2;this.width=p;this.height=k};I.prototype.check=function(){return isNaN(this.x)||
isNaN(this.y)||isNaN(this.width)||isNaN(this.height)?!1:!0};r.Dom.prototype.getBox=function(k){try{var p=k.getBBox();return new I(p.x,p.y,p.width,p.height)}catch(q){return new I(0,0,0,0)}};U.prototype.getContextMenuId=function(){var k;for(k=this.objNode;k;k=k.parentNode)if(k.nodeType==1){var p=k.getAttributeNS(a,"menu");if(p&&p.length)return p}return null};U.prototype.setContextMenuId=function(k){this.objNode.setAttributeNS(a,"menu",k)};P.prototype.setMatrix=function(k){B(this.nodeObj,k)};P.prototype.getPosition=
function(){var k=y(this.nodeObj);return new G(Number(k[4]),Number(k[5]))};P.prototype.setPosition=function(k,p){var q=y(this.nodeObj);q[4]=k;q[5]=p;B(this.nodeObj,[q[0],q[1],q[2],q[3],q[4],q[5]])};P.prototype.scale=function(k,p){var q=y(this.nodeObj);q[0]=k;q[3]=p;B(this.nodeObj,[q[0],q[1],q[2],q[3],q[4],q[5]])};P.prototype.scaleBy=function(k,p){var q=this.getBox(),D=q.width/2+q.x;q=q.height/2+q.y;var H=y(this.nodeObj);H[0]*=k;H[3]*=p;k>1?(H[4]-=D*k-D,H[5]-=q*p-q):(H[4]-=D-D/k,H[5]-=q-q/p);B(this.nodeObj,
[H[0],H[1],H[2],H[3],H[4],H[5]])};P.prototype.rotateBy=function(k){V(this.nodeObj,k)};P.prototype.getScale=function(){var k=y(this.nodeObj);return new G(Number(k[0]),Number(k[3]))};P.prototype.getParentScale=function(){var k=y(this.nodeObj.parentNode);return new G(Number(k[0]),Number(k[3]))};P.prototype.getGroupScale=function(){return h.Scale.getGroupScale(this.nodeObj)};P.prototype.scaleTo=function(k,p){var q=this.getBox();k&&p?this.scaleBy(k/q.width,p/q.height):k?this.scaleBy(k/q.width,k/q.width):
p&&this.scaleBy(p/q.height,p/q.height)};P.prototype.getBox=function(){var k=h.Dom.getBox(this.nodeObj),p=this.getScale();k=new I(k.x,k.y,k.width,k.height);k.x*=p.x;k.y*=p.y;k.width*=p.x;k.height*=p.y;return k};P.prototype.getTextLength=function(){return this.nodeObj.nodeName=="text"?this.nodeObj.getComputedTextLength():0};P.prototype.focus=function(k,p,q){B(this.nodeObj,[q,0,0,q,Number(k*q),Number(p*q)])};P.prototype.clear=function(){h.Dom.clearGroup(this.nodeObj)};P.prototype.isContained=function(k){for(;k=
k.parentNode;)if(k==this.nodeObj)return!0;return!1};P.prototype.extendAllIds=function(k){h.Dom.extendAllIds(this.objNode,k)};r.CSS=function(k){this.stylesA=[];k=k.firstChild.nextSibling.nodeValue.split("}");for(var p=0;p<k.length;p++){var q=k[p].split("{")[0];q=q.split(".")[1];this.stylesA[q]=b(k[p].split("{")[1])}};r.CSS.prototype.getStyleString=function(){var k="",p;for(p in this.stylesA){k+=" ."+p+"{";for(var q in this.stylesA[p])k+=q+":"+this.stylesA[p][q]+";";k+="}"}return k};r.CSS.prototype.setStyle=
function(k,p,q){try{this.stylesA[k][p]=q}catch(D){}};ra.prototype.addGroup=function(k){this.listA[this.listA.length]=k};ra.prototype.buildList=function(k){k=h.SVGRootElement.childNodes;for(var p=0;p<k.length;p++)try{k.item(p).nodeType=="1"&&k.item(p).getAttributeNS(null,"id").match(/antizoomandpan/)&&this.addGroup(k.item(p))}catch(q){}};ra.prototype.isContained=function(k){for(;k;){if(this.checkGroup(k))return!0;k=k.parentNode}return!1};ra.prototype.checkGroup=function(k){for(var p=0;p<this.listA.length;p++)if(k==
this.listA[p])return!0;return!1};ra.prototype.adjustGroups=function(k){if(h.fAntiZoomAndPan){k=h.SVGRootElement.getAttribute("viewBox").split(" ");var p=h.SVGOrigViewBoxString.split(" ");p=Number(p[2])/Number(k[2]);for(var q,D=0;D<this.listA.length;D++){var H=this.listA[D];if(q=y(H))q[0]=1/h.SVGRootElement.currentScale/p,q[3]=1/h.SVGRootElement.currentScale/p,q[4]=h.Scale.scaleX(-h.SVGRootElement.currentTranslate.x)+Number(k[0]),q[5]=h.Scale.scaleY(-h.SVGRootElement.currentTranslate.y)+Number(k[1]),
B(H,q)}}};ra.prototype.getActualMatrix=function(k){return y(this.listA[0])};ra.prototype.setDisplay=function(k,p){for(k=0;k<this.listA.length;k++)this.listA[k].style.setProperty("display",p,"")};ra.prototype.initAntiZoomPattern=function(k,p){p===null&&(p=h.SVGDocument);k&&(p=k.target.ownerDocument);k=p.getElementsByTagName("pattern");if(k!==null&&k.length!==0){p=k.length;for(var q=k.item(0).parentNode,D,H=0;H<p;H++)k.item(H).getAttributeNS(null,"id").match(/antizoomandpan/)||(D=k.item(H).cloneNode(1E3),
D.setAttributeNS(null,"id",D.getAttributeNS(null,"id")+":antizoomandpan"),q.appendChild(D));q.parentNode.appendChild(q)}};ra.prototype.initAntiZoomSymbols=function(k,p){if(p!==null&&(k=p.getElementsByTagName("g"),k!==null&&k.length!==0)){p=k.length;for(var q=k.item(0).parentNode,D,H=0;H<p;H++){var N=k.item(H).getAttributeNS(null,"id");N&&N.length&&N.match(/symbol/)&&!N.match(/antizoomandpan/)&&(D=k.item(H).cloneNode(1E3),D.setAttributeNS(null,"id",N+":antizoomandpan"),q.appendChild(D))}q.parentNode.appendChild(q)}};
ra.prototype.extendAllPatternStyles=function(k,p,q){p&&p.nodeType==1&&(k=p.style.getPropertyValue("fill"))&&k.length>1&&k.match(/url/)&&(k=k.split(")")[0]+q+")",p.style.setProperty("fill",k,""))};ra.prototype.initAntiZoomStyles=function(k){var p=h.SVGDocument.getElementById("widgets:antizoomandpan");this.extendAllPatternStyles(k,p,":antizoomandpan")};var ea=null,pa=function(){this.szDictionary=[]};h.Dictionary=new pa;pa.prototype.add=function(k,p){this.szDictionary[k]||(this.szDictionary[k]=p)};pa.prototype.replace=
function(k,p){this.szDictionary[k]=p};pa.prototype.getLocalText=function(k){try{if(typeof this.szDictionary[k]!="undefined")return String(this.szDictionary[k]);for(var p="",q=k.split(" "),D=0;D<q.length;D++){var H=this.szDictionary["'"+q[D]+"'"];p+=String(H?H:q[D]);p+=D<q.length-1?" ":""}return p}catch(N){return k}};pa.prototype.applyToNode=function(k){k=k.getElementsByTagName("text");for(var p=0;p<k.length;p++)k.item(p).firstChild.nodeValue=this.getLocalText(k.item(p).firstChild.nodeValue)};var R=
null,ca=null,aa=0,wa=new Date,qa=null,T=null,xa=null,Ja=12,Da=0,Za=new x;x.prototype.add=function(k){this.loaderA[this.loaderA.length]=k};x.prototype.evalScripts=function(){if(this.isLoading()===!1){for(var k=0;k<this.loaderA.length;k++)for(var p=this.loaderA[k],q=0;q<p.loadedScripts.length;q++)this.isScriptLoaded(p.szUrl)||(this.evalScript(p.loadedScripts[q]),this.setScriptLoaded(p.szUrl));this.loaderA.length=0}};x.prototype.evalScript=function(){eval(arguments[0])};x.prototype.setScriptError=function(k){this.errorUrlA[this.errorUrlA.length]=
k};x.prototype.setScriptLoaded=function(k){this.loadedUrlA[this.loadedUrlA.length]=k};x.prototype.setScriptLoading=function(k){this.loadingUrlA[this.loadingUrlA.length]=k};x.prototype.isScriptLoaded=function(k){for(var p=0;p<this.loadedUrlA.length;p++)if(this.loadedUrlA[p]==k)return!0;return!1};x.prototype.isScriptLoading=function(k){for(var p=0;p<this.loadingUrlA.length;p++)if(this.loadingUrlA[p]==k)return!0;return!1};x.prototype.isScriptError=function(k){for(var p=0;p<this.errorUrlA.length;p++)if(this.errorUrlA[p]==
k)return!0;return!1};x.prototype.resetScriptLoading=function(k){for(var p=0;p<this.loadingUrlA.length;p++)this.loadingUrlA[p]==k&&(this.loadingUrlA[p]="");for(p=0;p<this.loadedUrlA.length;p++)this.loadedUrlA[p]==k&&(this.loadedUrlA[p]="");for(p=0;p<this.errorUrlA.length;p++)this.errorUrlA[p]==k&&(this.errorUrlA[p]="")};x.prototype.isLoading=function(){var k;for(k=0;k<this.loaderA.length;k++)if(this.loaderA[k].reqCnt>0)return!0;return!1};w.prototype.loadScript=function(k,p){p&&this.pool.resetScriptLoading(k);
try{k.match(/./)||(k+=this.pool.szSuffix),this.szUrl=k,this.pool.isScriptError(this.szUrl)?eval(this.errorCallback):this.pool.isScriptLoaded(this.szUrl)?eval(this.finishedCallback):this.pool.isScriptLoading(this.szUrl)||(this.isLoading=!0,this.reqCnt++,this.pool.setScriptLoading(this.szUrl),O(k,this))}catch(q){}};w.prototype.operationComplete=function(k,p,q){k!=200||!p&&!q?(this.pool.setScriptError(this.szUrl),this.errorCallback&&(this.finishedCallback=null,eval(this.errorCallback))):this.loadedScripts.push(q);
this.reqCnt--;this.reqCnt<=0&&this.evalScripts()};w.prototype.processImported=function(k){alert(k)};w.prototype.evalScripts=function(){this.pool.evalScripts();this.isLoading=!1;this.finishedCallback&&eval(this.finishedCallback)};w.prototype.isLoading=function(){return this.reqCnt>0};const ib=function(k){return(Math.exp(k)-Math.exp(-k))/2},Aa=Math.PI/180,wb=180/Math.PI,eb=Math.atan(ib(Math.PI))*wb,nb={WGS84:{_EquatorialRadius:6378137,_eccentricitySquared:.00669438},Airy:{_EquatorialRadius:6377563,
_eccentricitySquared:.00667054},"Australian National":{_EquatorialRadius:6378160,_eccentricitySquared:.006694542},"Bessel 1841":{_EquatorialRadius:6377397,_eccentricitySquared:.006674372},"Bessel 1841 (Nambia]":{_EquatorialRadius:6377484,_eccentricitySquared:.006674372},"Clarke 1866":{_EquatorialRadius:6378206,_eccentricitySquared:.006768658},"Clarke 1880":{_EquatorialRadius:6378249,_eccentricitySquared:.006803511},Everest:{_EquatorialRadius:6377276,_eccentricitySquared:.006637847},"Fischer 1960 (Mercury]":{_EquatorialRadius:6378166,
_eccentricitySquared:.006693422},"Fischer 1968":{_EquatorialRadius:6378150,_eccentricitySquared:.006693422},"GRS 1967":{_EquatorialRadius:6378160,_eccentricitySquared:.006694605},"GRS 1980":{_EquatorialRadius:6378137,_eccentricitySquared:.00669438},"Helmert 1906":{_EquatorialRadius:6378200,_eccentricitySquared:.006693422},Hough:{_EquatorialRadius:6378270,_eccentricitySquared:.00672267},International:{_EquatorialRadius:6378388,_eccentricitySquared:.00672267},Krassovsky:{_EquatorialRadius:6378245,_eccentricitySquared:.006693422},
"Modified Airy":{_EquatorialRadius:6377340,_eccentricitySquared:.00667054},"Modified Everest":{_EquatorialRadius:6377304,_eccentricitySquared:.006637847},"Modified Fischer 1960":{_EquatorialRadius:6378155,_eccentricitySquared:.006693422},"South American 1969":{_EquatorialRadius:6378160,_eccentricitySquared:.006694542},"WGS 60":{_EquatorialRadius:6378165,_eccentricitySquared:.006693422},"WGS 66":{_EquatorialRadius:6378145,_eccentricitySquared:.006694542},"WGS-72":{_EquatorialRadius:6378135,_eccentricitySquared:.006694318},
"WGS-84":{_EquatorialRadius:6378137,_eccentricitySquared:.00669438}},oa=function(k,p,q,D){nb[k]||(k="WGS84");var H=nb[k]._EquatorialRadius;k=nb[k]._eccentricitySquared;var N=q+180-Math.floor((q+180)/360)*360-180;q=p*Aa;var S=N*Aa,ha=Math.floor((N+180)/6)+1;p>=56&&p<64&&N>=3&&N<12&&(ha=32);p>=72&&p<84&&(N>=0&&N<9?ha=31:N>=9&&N<21?ha=33:N>=21&&N<33?ha=35:N>=33&&N<42&&(ha=37));D&&D.length&&(ha=parseInt(D));D=k/(1-k);N=H/Math.sqrt(1-k*Math.sin(q)*Math.sin(q));var Ia=Math.tan(q)*Math.tan(q),mb=D*Math.cos(q)*
Math.cos(q);S=Math.cos(q)*(S-((ha-1)*6-180+3)*Aa);H=.9996*(H*((1-k/4-3*k*k/64-5*k*k*k/256)*q-(3*k/8+3*k*k/32+45*k*k*k/1024)*Math.sin(2*q)+(15*k*k/256+45*k*k*k/1024)*Math.sin(4*q)-35*k*k*k/3072*Math.sin(6*q))+N*Math.tan(q)*(S*S/2+(5-Ia+9*mb+4*mb*mb)*S*S*S*S/24+(61-58*Ia+Ia*Ia+600*mb-330*D)*S*S*S*S*S*S/720));p<0&&(H+=1E7);return new G(.9996*N*(S+(1-Ia+mb)*S*S*S/6+(5-18*Ia+Ia*Ia+72*mb-58*D)*S*S*S*S*S/120)+5E5,H)},Ca=function(k,p,q,D){nb[k]||(k="WGS84");if(!D)return null;var H=nb[k]._EquatorialRadius;
k=nb[k]._eccentricitySquared;var N=(1-Math.sqrt(1-k))/(1+Math.sqrt(1-k));q-=5E5;var S=p;p=parseInt(D);D.substr(D.length-1,1)>="N"||(S-=1E7);D=k/(1-k);S=S/.9996/(H*(1-k/4-3*k*k/64-5*k*k*k/256));N=S+(3*N/2-27*N*N*N/32)*Math.sin(2*S)+(21*N*N/16-55*N*N*N*N/32)*Math.sin(4*S)+151*N*N*N/96*Math.sin(6*S);var ha=H/Math.sqrt(1-k*Math.sin(N)*Math.sin(N));S=Math.tan(N)*Math.tan(N);var Ia=D*Math.cos(N)*Math.cos(N);q/=ha*.9996;H=N-ha*Math.tan(N)/(H*(1-k)/Math.pow(1-k*Math.sin(N)*Math.sin(N),1.5))*(q*q/2-(5+3*S+
10*Ia-4*Ia*Ia-9*D)*q*q*q*q/24+(61+90*S+298*Ia+45*S*S-252*D-3*Ia*Ia)*q*q*q*q*q*q/720);H*=wb;k=(q-(1+2*S+Ia)*q*q*q/6+(5-2*Ia+28*S-3*Ia*Ia+8*D+24*S*S)*q*q*q*q*q/120)/Math.cos(N);k=(p-1)*6-180+3+k*wb;return new G(k,H)},Ma=function(k,p){k=Math.max(Math.min(k,eb),-eb);return new G(p,Math.log(Math.tan(Math.PI/4+k*Aa/2))*wb)},Oa=function(k,p){var q;p-0<-180&&(p=-180);p-0>180&&(p=180);k*=Aa;p=.5*Aa*(p-0);var D=Math.acos(Math.cos(k)*Math.cos(p));if(D===0)var H=q=0;else q=Math.sin(k)/Math.sin(D),D*=6378137,
H=2*D*Math.sqrt(1-q*q),H=H<0&&p>0?-H:H>0&&p<0?-H:H,q*=D;return new G(.5*(H+12756274*p*Math.cos(50.467)),.5*(q+6378137*k))},db=Math.sqrt(3)/2,Pa=function(k,p){k*=Aa;p*=Aa;k=Math.asin(db*Math.sin(k));var q=k*k,D=q*q*q;return new G(6378137*p*Math.cos(k)/(db*(1.340264+3*-.081106*q+D*(7*8.93E-4+.034164*q))),6378137*k*(1.340264+-.081106*q+D*(8.93E-4+.003796*q)))};window.ixMap=r;window.map=h;window.getMatrix=y;window.setMatrix=B;window.getTranslate=A;window.setTranslate=J;window.getScale=L;window.setScale=
function(k,p,q){if(k){var D=y(k);D[0]=p;D[3]=q;B(k,[D[0],D[1],D[2],D[3],D[4],D[5]],!0)}};window.getRotateAttributeValue=da;window.setRotate=V;window.getPatternMatrix=function(k){if(k){if((k=k.getAttribute("patternTransform"))&&(k=k.match(F)))return k=k[1].split(" "),[Number(k[0]),Number(k[1]),Number(k[2]),Number(k[3]),Number(k[4]),Number(k[5])];if(k&&=k.match(v))return k=k[1].split(","),[Number(k[0]),Number(k[1]),Number(k[2]),Number(k[3]),Number(k[4]),Number(k[5])]}return[1,0,0,1,0,0]};window.activateTheme=
function(k){if(!k.match(/:label/)&&(k=h.Tiles.getMasterId(k),h._activeTheme!=k&&k!="mapcanvas")){var p=h.SVGDocument.getElementById("legend:ident:"+k);if(p){W();h._legendIdent=p;if((p=h._legendIdent.nextSibling.nextSibling)&&p.nodeName=="text")try{var q=h.Dom.getBox(p);h._legendIdent.setAttributeNS(null,"width",q.width+h.Scale.normalX(10))}catch(H){}h._legendIdent.style.setProperty("display","inline","");h._activeTheme=k;if(h.fActiveThemeInfo){q=new G(h.Scale.mapPosition.x,h.Scale.mapPosition.y+h.Scale.normalX(h.nToolMarginTop));
h.Viewport.szPopupAlignment.match(/TOP/)&&(q.y=h.Scale.bBox.height+h.Scale.mapPosition.y-h.Scale.normalY(38));q=new InfoContainer(h.SVGDocument,h.SVGMenuGroup,"movable",q,{x:h.Scale.normalX(5),y:h.Scale.normalY(5)},"fix");q.frameNode.style.setProperty("fill","#fafafa","");q.setTitle("info on");q.setOnRemove("clearThemes()");var D=h.Scale.tStyle.Description.szStyle;h.Dom.newText(q.workspaceNode,h.Scale.normalX(5),h.Scale.tStyle.Description.nFontHeight,D,p.firstChild.nodeValue);q.reformat()}try{h.HTMLWindow.ixmaps.htmlgui_setActiveTheme(k)}catch(H){}try{h.Themes.redrawInfoAll(null)}catch(H){}}else{W();
_removeInfo(null);h._activeTheme=k;try{h.HTMLWindow.ixmaps.htmlgui_setActiveTheme(k)}catch(H){}try{h.Themes.redrawInfoAll(null)}catch(H){}}h.Layer.setPointerEvents(h._activeTheme);h._activeItem=null}};window.getActiveTheme=function(){return h._activeTheme};window.isActiveTheme=Ta;window.deactivateTheme=function(k){Ta(k)&&W()};window.clearThemes=W;window.displayTooltip=function(k,p){if(p&&p.nodeType==1){for(var q=p.getAttributeNS(a,"tooltip")||"";(p=p.parentNode)!=null&&p.nodeName=="g";){var D=p.getAttributeNS(a,
"tooltip");D&&D.length&&(q=D)}if(q&&q.length){try{q=h.User.onTooltipDisplay(null,q,p)}catch(N){}try{q=h.HTMLWindow.ixmaps.htmlgui_onTooltipDisplay(k,q)}catch(N){}g&&clearTimeout(g);if(q&&q.length){k=h.Scale.getClientMousePosition(k,h.SVGPopupGroup);X();p=setTimeout;if(q&&q.length){D=q.split('"');q=D[0];for(var H=1;H<D.length;H++)q+="``"+D[H]}g=p('doDisplayTooltip("'+q+'",'+k.x+","+k.y+")",500)}return!0}}return!1};window.killTooltip=X;window.displayMessage=Z;window.clearMessage=ia;window.point=G;window.box=
I;window.initAll=function(k,p){console.log("*** iXMaps mapscript version: "+h.version);console.log("*** some .svg or .js files may not be found, this is normal and due to hierarchical location files ***");K(k,null);setTimeout("delayedInitAll(null,'"+p+"')",10)};window.delayedInitAll=function(k,p){if(window.innerWidth<=0||window.innerHeight<=0)console.log("window dimension is zero -> no map"),setTimeout("delayedInitAll(null,'"+p+"')",1E3);else if(!h.fInitializing)if(h.fInitializing=!0,K(k,null),h.hideAll(),
h.Dom=new r.Dom(k),h.SVGRootElement=h.SVGDocument,h.fSVGEmbeded&&(k=h.Dom.newNode("g",h.SVGRootElement),k.setAttribute("id","embed"),k.setAttribute("name",p)),h.rootGroup=h.Dom.newGroup(h.SVGRootElement,"objects:antizoomandpan"),h.SVGToolsGroup=h.Dom.newGroup(h.rootGroup,"ToolsGroup"),h.SVGFixedGroup=h.Dom.newGroup(h.rootGroup,"FixedGroup"),h.SVGThemeGroup=h.Dom.newGroup(h.rootGroup,"ThemeGroup"),h.SVGThemeGroup.style.setProperty("display","none",""),h.SVGPopupGroup=h.Dom.newGroup(h.rootGroup,"PopupGroup"),
h.SVGNotifyGroup=h.Dom.newGroup(h.rootGroup,"NotifyGroup"),h.SVGMessageGroup=h.Dom.newGroup(h.rootGroup,"MessageGroup"),h.SVGMenuGroup=h.Dom.newGroup(h.rootGroup,"MenuGroup"),h.SVGTltipGroup=h.Dom.newGroup(h.rootGroup,"TltipGroup"),h.SVGHiddenGroup=h.Dom.newGroup(h.rootGroup,"HiddenGroup"),h.SVGHiddenGroup.style.setProperty("display","none",""),h.SVGTempGroup=h.Dom.newGroup(h.rootGroup,"TempGroup"),h.SVGWidth=parseInt(h.SVGRootElement.getAttribute("width")),h.SVGHeight=parseInt(h.SVGRootElement.getAttribute("height")),
h.SVGOrigViewBoxString=h.SVGRootElement.getAttribute("viewBox"),h.SVGViewBox=h.SVGRootElement.getAttribute("viewBox").split(" "),h.SVGViewBox[0]=Number(h.SVGViewBox[0]),h.SVGViewBox[1]=Number(h.SVGViewBox[1]),h.SVGViewBox[2]=Number(h.SVGViewBox[2]),h.SVGViewBox[3]=Number(h.SVGViewBox[3]),h.Scale=new r.Scale,h.Scale.scaleNode&&h.Scale.extentNode){h.Scale.superclass=h;if(h.fAllIncluded||h.fPDFEmbed)h.Scale.createWidgetStyles(),h.Scale.normalizeSymbols(h.SVGDocument.getElementById("symbolstore")),h.Scale.normalizeButtons(h.SVGDocument.getElementById("widgetstore")),
h.Event=new r.Event,h.Event.initUseNodes(h.SVGDocument.getElementById("widgetstore"));else{h.pushAction(()=>{h.Scale.createWidgetStyles()});h.pushAction(()=>{h.Scale.normalizeSymbols(h.SVGDocument.getElementById("symbolstore"))});h.pushAction(()=>{h.Scale.normalizeButtons(h.SVGDocument.getElementById("widgetstore"))});try{typeof h.HTMLWindow.ixmaps.SVGResources_includePath!="undefined"?h.Loader.importSVGFile(h.HTMLWindow.ixmaps.SVGResources_includePath+"/maplocal.svg",h.SVGDocument,h.SVGTempGroup,
null):typeof ixmaps.szResourceBase!="undefined"?h.Loader.importSVGFile(ixmaps.szResourceBase+"/maps/svg/resources/svg/maplocal.svg",h.SVGDocument,h.SVGTempGroup,null):h.Loader.importSVGFile("../../maps/svg/resources/svg/maplocal.svg",h.SVGDocument,h.SVGTempGroup,null)}catch(q){}}h.SVGDocument.getElementById(h.szShadowFilterToolsId)||(k=h.Dom.newNode("filter",h.rootGroup),k.setAttributeNS(null,"id",h.szShadowFilterToolsId),k.setAttributeNS(null,"filterUnits","objectBoundingBox"),k.setAttributeNS(null,
"x","-50%"),k.setAttributeNS(null,"y","-50%"),k.setAttributeNS(null,"width","200%"),k.setAttributeNS(null,"height","200%"),p=h.Dom.newNode("feGaussianBlur",k),p.setAttributeNS(null,"stdDeviation","50"),p.setAttributeNS(null,"result","BlurAlpha"),p=h.Dom.newNode("feOffset",k),p.setAttributeNS(null,"in","BlurAlpha"),p.setAttributeNS(null,"dx","20"),p.setAttributeNS(null,"dy","20"),p.setAttributeNS(null,"result","OffsetBlurAlpha"),p=h.Dom.newNode("feColorMatrix",k),p.setAttributeNS(null,"in","OffsetBlurAlpha"),
p.setAttributeNS(null,"type","matrix"),p.setAttributeNS(null,"values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0"),p.setAttributeNS(null,"result","matrixOut"),p=h.Dom.newNode("feMerge",k),k=h.Dom.newNode("feMergeNode",p),k.setAttributeNS(null,"in","matrixOut"),k=h.Dom.newNode("feMergeNode",p),k.setAttributeNS(null,"in","SourceGraphic"));l.match(/Firefox/i)&&(h.pushAction(()=>{h.Scale.normalizeSymbols(h.SVGDocument.getElementById("symbolstore"))}),h.pushAction(()=>{h.Scale.normalizeButtons(h.SVGDocument.getElementById("widgetstore"))}));
C++;h.fLoadIncludes&&(h.fLoadIncludes=="delayed"?h.pushInitAction(()=>{t()}):t());h.fAllIncluded||h.fPDFEmbed?Ea():h.pushInitAction(()=>{Ea(null)}," ... ")}else alert("SVG source not valid SVGGIS map !")};window.getData=O;window.AntiZoomAndPan=ra;window.createTextField=c;window.sizeTextField=e;window.executeWithMessage=function(k,p,q){h.fExecuteSilent||(typeof q=="undefined"&&(q=250),Z(p,null,h.szMessagePosition));p=setTimeout;k=k&&k.length?k.replace(/\\/gi,"\\\\").replace(/"/gi,'\\"'):k;p('doExecuteWithMessage("'+
k+'")',q)};window.doExecuteWithMessage=function(k){h.isIdle();try{eval(k)}catch(p){alert("error '"+p+"' on: "+k)}};window.executeWithProgressBar=function(k,p,q,D,H,N){va(p,q,D,0,H,N);setTimeout(k,1)};window.__timer_getSEC=function(){return((new Date).getTime()-Da)/1E3};window.__timer_reset=function(){Da=(new Date).getTime()};window.__formatValue=n;window.__getStyleObj=function(k){if(k===null||k.length<2)return null;try{h.styleObj={};for(var p=k.split(";"),q=0;q<p.length;q++)if(p[q].length){var D=
p[q].split(":"),H=D[0].length+1,N=p[q].substr(H,p[q].length-H);try{h.styleObj[D[0].trim()]=JSON.parse(N)}catch(S){h.styleObj[D[0].trim()]=N}}return h.styleObj}catch(S){alert("ERROR parsing: "+k)}return null};window.__getStyleArray=b;window.__scaleStyleString=fa;window.__scaleLineStyleString=function(k,p){if(!k||!p)return null;k=k.split(";");for(var q,D=0;D<k.length;D++)if(k[D].match(/stroke-width/))q=k[D].split(":"),q[1]=String(parseFloat(q[1])*p),k[D]=q.join(":");else if(k[D].match(/stroke-dashoffset/))q=
k[D].split(":"),q[1]=String(parseFloat(q[1])*p),k[D]=q.join(":");else if(k[D].match(/stroke-dasharray/)){q=k[D].split(":");var H=q[1].split(",");H.length>1?(k[D]=q[0]+":",q=0):(H=q[1].split(" "),k[D]=q[0]+":",q=0);for(;q<H.length;q++)H[q]=String(parseFloat(H[q])*p),k[D]+=H[q],q<H.length-1&&(k[D]+=",")}return k.join(";")};window.__scaleTextStyleString=function(k,p){if(!k||!p)return null;k=k.split(";");for(var q,D=0;D<k.length;D++)k[D].match(/font-size/)&&(q=k[D].split(":"),q[1]=String(parseFloat(q[1])*
p)+"px",k[D]=q.join(":"));return k.join(";")};window.highlightTheme=function(k){for(;k&&k.objNode.nodeName!="g"&&k.objNode.parentNode;)if((k=new U(k.objNode.parentNode))===null)return;var p=k.szId;h.Tiles&&(p=h.Tiles.getMasterId(p));var q=k.objNode.getAttributeNS(a,"value");(!q||q.length<1)&&k.objNode.firstChild&&k.objNode.firstChild.nextSibling&&(q=k.objNode.firstChild.nextSibling.getAttributeNS(a,"value"));q&&q.length&&(p=p.split("::")[0]+"::"+q);if(ea=h.SVGDocument.getElementById("legend:ident:"+
p))(k=ea.nextSibling.nextSibling)&&k.nodeName=="text"&&(k=h.Dom.getBox(k),ea.setAttributeNS(null,"width",k.width+h.Scale.normalX(10))),ea.style.setProperty("display","inline","")};window.highlightThemeRemove=function(){ea&&(ea.style.setProperty("display","none",""),ea=null)};window.nInfoTimeout=250;window.loadSVGIncludes=function(k,p,q){alert("ohhh");k=k?k.target.ownerDocument:h.SVGDocument;var D=k.getElementById("mapinclude");if(D){if(p&&p.length>1){var H=p.substr(p.length-1,1);H!="\\"&&H!="/"&&
(p+="/")}D=D.getElementsByTagName("g");for(H=0;H<D.length;H++){var N=D.item(H),S=N.getAttribute("xlink:href");!S||S.match(/maplocal/)||S.match(/mapmenu/)||S.match(/mapimages/)||S.match(/mappattern/)||S.match(/mapfilter/)||!(S&&S.length>1)||q&&S!=q||(S=p+S,new u,h.Loader.importSVGFile(S,k,N,null))}}};window.MapObject=U;window.Methods=P;window._TRACE=function(k){if(typeof console!="undefined"&&typeof console.log!="undefined"){var p=new Date,q=p-wa;wa=p;console.log("_TRACE: time["+q+"] "+k)}else if(!h.fPDFEmbed||
h.fDebug)try{TRACE(k)}catch(D){if(h.fDebug)try{h.SVGDocument&&h.SVGMenuGroup&&(c(h.SVGDocument,h.SVGMenuGroup,"message",k).fu.setPosition(h.Scale.normalX(0),h.Scale.normalY(aa*18)),++aa>20&&(aa=0,h.SVGMenuGroup.fu.clear()))}catch(H){}}};window._LOG=d;window._STATUS=function(k){if(h.fStatus){var p=h.Dom.getObjectById("legend:statusgroup");p||(p=h.Dom.getObjectById("legend:scalegroup"),p=h.Dom.newGroup(p,"legend:statusgroup"));h.Dom.clearGroup(p);h.Dom.newText(p,h.Scale.normalX(220),h.Scale.normalY(12),
"font-family:arial;font-size:"+h.Scale.normalY(12)+"px;fill:black",k)}};window._ERROR=function(k){try{h.HTMLWindow.ixmaps.htmlgui_errorLog(k)}catch(p){h.fDebug&&h.SVGDocument&&h.SVGMessageGroup&&c(h.SVGDocument,h.SVGMessageGroup,"message",k).fu.setPosition(h.Scale.normalX(0),h.Scale.normalY(0))}};window.displayProgressBar=va;window.do_clearMessage=ma;window.szMapNs=a;window.szXlink="http://www.w3.org/1999/xlink";window.szHTTP="http://";window.szHTTPS="https://";window.nInch=2.54})();(function(){function Ea(){this.itemA=[];this.historyPointer=0;this.fSuspend=!1;this.newItem()}function t(){try{this.szEnvelope=map.Zoom.getEnvelopeString()}catch(a){}}function K(a,f){if(f!="circle"&&f!="isolate"&&f!="scale"&&(a=map.Layer.getLayerItemNodeOfNode(a),!a))return null;this.node=a;this.szMode=f;this.doHighLight()}function y(a,f,g){if(a&&!a.touches)a=map.Scale.getClientMousePosition(a,map.SVGPopupGroup);else{a=map.Scale.getScreenPosition(f);if(!map.Scale.isWidgetPositionInMap(a))return null;
g+="|pointer"}if(g.match(/delayed/))B(),u=f,z=setTimeout("doDisplayInfo("+a.x+","+a.y+",'"+g+"')",nInfoTimeout);else return u=f,x(a.x,a.y,g)}function B(){z&&clearTimeout(z);u=null}function A(a,f){if(map.fScaleBar){var g=map.Scale.nTrueMapScale*map.Scale.nZoomScale;for(a=0;g>10;a++)g/=10;for(g=g>5?10:g>2.5?5:g>=1.1?2.5:1;a>0;a--)g*=10;var l=g/(map.Scale.nMapScale*map.Scale.nZoomScale)*(map.Scale.nMapPPI/nInch);(a=map.Dom.getObjectById("legend:scalegroup"))||(a=map.Dom.newGroup(map.SVGMenuGroup,"legend:scalegroup"));
a.hasChildNodes();a.fu.clear();var h=a.getAttributeNS(szMapNs,"scaleunits"),r=a.getAttributeNS(szMapNs,"barcolor"),C=a.getAttributeNS(szMapNs,"bgcolor"),F=a.getAttributeNS(szMapNs,"bgstyle"),v=a.getAttributeNS(szMapNs,"bgopacity"),E=a.getAttributeNS(szMapNs,"maxwidth");if(F==null||F.length<1)F=C==null||C.length<1?"fill:white;":"fill:"+C+";",v&&(F+="opacity:"+v+";");E===0&&(E=map.Scale.bBox.width/3/map.Scale.normalX(1));if(r==null||r.length<1)r="red";r="fill:"+r+(r=="#ffffff"?";stroke:black;stroke-width:0.1;":
"")+";pointer-events:none";F=map.Dom.newShape("rect",a,map.Scale.normalX(0),map.Scale.normalY(0),map.Scale.normalX(0),map.Scale.normalY(0),F);C=map.Scale.nTrueMapScale*map.Scale.nZoomScale;C=C>=1?"1:"+String(__formatValue(C,0,"BLANK")):String(__formatValue(1/C,0,"BLANK"))+":1";map.Dom.newText(a,0,map.Scale.normalY(12),"font-family:arial;font-size:"+map.Scale.normalY(9)+"px;fill:"+map.szInfoBodyColor,C).fu.setPosition(map.Scale.normalX(9),-map.Scale.normalY(9.5));if(E>0){C=0;h=h.length?h:"meters";
v=100;h=="feet"?(v=33.3,g>3E4&&(h="miles",v=5280*33.3)):g>1E4&&(h="km",v=1E5);for(var M=0;M<20;M++){var G=M%2==1?r:"fill:black;pointer-events:none";map.Dom.newShape("rect",a,map.Scale.normalX(C),map.Scale.normalY(5),map.Scale.normalX(l),map.Scale.normalY(5),G);G=Math.floor(g/v*M*100)/100;var I=h;M>0&&(I=Math.floor(G)!=G?String(G):String(Math.floor(G)));map.Dom.newText(a,M===0?map.Scale.normalX(C):map.Scale.normalX(C-4),map.Scale.normalY(18),"font-family:arial;font-size:"+map.Scale.normalY(8)+"px;fill:"+
map.szInfoBodyColor+";pointer-events:none;",I);C+=l;if(E>1&&C>E||map.Scale.mapPosition.x&&map.Scale.normalX(C)>map.Scale.bBox.width*9/10||!map.Scale.mapPosition.x&&map.Scale.normalX(C)>map.Scale.bBox.width/2)break}}else map.Dom.newShape("rect",a,map.Scale.normalX(50),map.Scale.normalY(20),map.Scale.normalX(1),map.Scale.normalY(1),"fill:white;opacity:0;");g=map.Dom.getBox(a);F&&(F.setAttributeNS(null,"x",g.x-map.Scale.normalX(7)),F.setAttributeNS(null,"y",g.y-map.Scale.normalY(2)),F.setAttributeNS(null,
"width",g.width+map.Scale.normalX(14)),F.setAttributeNS(null,"height",g.height+map.Scale.normalY(4)),F.setAttributeNS(null,"rx",map.Scale.normalY(2)),F.setAttributeNS(null,"ry",map.Scale.normalY(2)));f&&(E=map.Scale.normalX(8),l=map.Scale.normalX(map.nMapBorderWidth),map.Scale.mapPosition.y+map.Scale.bBox.height<map.Scale.viewBox.height&&(E=map.Scale.normalX(2),l=0),E=map.Scale.mapPosition.x+E,f=="bottom"?a.fu.setPosition(E+l,map.Scale.normalY(map.Scale.getEmbedHeight()/map.Scale.getEmbedScale())-
l-g.height):a.fu.setPosition(E+l,-g.y+map.Scale.normalY(2)+map.Scale.normalY(1)+l));a.fu.setPosition(50,map.Scale.normalY(map.Scale.getEmbedHeight()/map.Scale.getEmbedScale())-90);F&&(f=a.fu.getPosition().y>map.Scale.normalY(100)?"top":"bottom",F.setAttributeNS(null,"onclick","displayScale(evt,'"+f+"')"));map.SVGPopupGroup&&(map.SVGPopupGroup.fu.clear(),a.setAttributeNS(szMapNs,"tooltip","click to move it"))}}function J(a,f){a=new box(0,0,0,0);if(f)try{if(f.nodeName=="text")return map.Dom.getBox(f);
var g=f.childNodes;for(f=0;f<g.length;f++)if(g.item(f).nodeType==1){var l=getScale(g.item(f)),h=getTranslate(g.item(f)),r=map.Dom.getBox(g.item(f));r.x=h.x+r.x*l.x;r.y=h.y+r.y*l.y;r.width*=l.x;r.height*=l.y;if(g.item(f).getAttributeNS(null,"id").match(/overviewmap/)){var C=map.SVGDocument.getElementById("overviewmap:clippath");C&&(r=map.Dom.getBox(C),r.height=C.firstChild.getAttribute("height"),r.width=C.firstChild.getAttribute("width"),r.height=a.height+r.height*map.Scale.getGroupScale(C).y,r.width*=
map.Scale.getGroupScale(C).x)}isNaN(r.width)||isNaN(r.height)||r.width<0||r.height<0||(a.x=Math.min(a.x,r.x),a.y=Math.min(a.y,r.y),a.width=Math.max(a.width,r.x+r.width),a.height=Math.max(a.height,r.y+r.height))}if(isNaN(a.width)||isNaN(a.height)||a.width<0||a.height<0)a=new box(0,0,0,0)}catch(F){a=new box(0,0,0,0)}return a}function L(a,f){if(a!=null){var g=a.getAttributeNS(null,"id");if(!g.match(/label/)){var l,h=g.split(":");g=h[0]+":item:"+h[2];for(l=3;l<h.length;l++)g=g+":"+h[l];if(g=a.ownerDocument.getElementById(g)){var r=
g.childNodes;for(l=0;l<r.length;l++)if(r.item(l).nodeType==1&&r.item(l).getAttributeNS(null,"id")&&r.item(l).getAttributeNS(null,"id").match(/collapsable/)){h=0;switch(f){case "collapse":if(r.item(l).getAttributeNS(szMapNs,"state")=="collapsed"||r.item(l).getAttributeNS(null,"id").match(/placeholder/))break;(a=a.ownerDocument.getElementById(r.item(l).getAttributeNS(null,"id")+":end"))?h=-a.getAttributeNS(null,"y")+map.Scale.normalY(20):(a=map.Dom.getBox(r.item(l)),h=-a.height);f=map.Dom.newGroup(r.item(l).parentNode,
r.item(l).getAttributeNS(null,"id")+":placeholder");f.setAttributeNS(szMapNs,"state","collapsed");f.parentNode.insertBefore(f,r.item(l));map.SVGHiddenGroup.appendChild(r.item(l+1));break;case "expand":if(r.item(l).getAttributeNS(szMapNs,"state")=="collapsed"||r.item(l).getAttributeNS(null,"id").match(/placeholder/)){if(r.item(l).getAttributeNS(null,"id").match(/placeholder/)){f=r.item(l);r=f.getAttributeNS(null,"id").split(":");h="";for(l=0;l<r.length-1;l++)h+=l>0?":":"",h+=r[l];l=map.SVGDocument.getElementById(h);
f.parentNode.replaceChild(l,f);l=map.SVGDocument.getElementById(h)}else l=r.item(l);l.setAttributeNS(szMapNs,"state","expanded");(a=a.ownerDocument.getElementById(l.getAttributeNS(null,"id")+":end"))?h=a.getAttributeNS(null,"y")-map.Scale.normalY(20):(a=map.Dom.getBox(l),h=a.height)}}for(l=g.nextSibling;l&&h;)if(l.nodeType==1&&(a=getMatrix(l),a[5]+=h,setMatrix(l,a)),l=l.nextSibling,l==null)for(;g.parentNode&&g.parentNode.getAttributeNS(null,"id").match(/legend/);)if(g=g.parentNode,g.getAttributeNS(null,
"id").match(/item/)){l=g.nextSibling;break}try{map.Legend.init(null)}catch(C){}break}}}}}ixMap.Viewport=function(a){map.Scale.metadataNode&&(this.szPopupAlignment=(this.alignmentNode=map.Scale.metadataNode.getElementsByTagNameNS(szMapNs,"alignments").item(0))?this.alignmentNode.getAttributeNS(null,"popupwindow"):"",this.szPopupAlignment=map.szLocalPopupAlignment?map.szLocalPopupAlignment:this.szPopupAlignment);if(this.eventRect=map.SVGDocument.getElementById("mapbackground:eventrect"))map.szMapBackgroundStyle&&
this.eventRect.setAttributeNS(null,"style",map.szMapBackgroundStyle+";pointer-events:all"),map.szMapBackgroundColor&&this.eventRect.setAttributeNS(null,"style","fill:"+map.szMapBackgroundColor+";opacity:1;pointer-events:all");this.clipToolsGroup();this.createPanBorder();this.createNorthArrow();return!0};ixMap.Viewport.prototype=new Map;ixMap.Viewport.prototype.reformat=function(){this.clipToolsGroup();this.createPanBorder();this.createNorthArrow()};ixMap.Viewport.prototype.clipToolsGroup=function(){map.Dom.setClipRect(map.SVGToolsGroup,
new box(map.Scale.mapPosition.x+map.Scale.normalX(map.nMapBorderWidth),map.Scale.mapPosition.y+map.Scale.normalY(map.nMapBorderWidth),map.Scale.bBox.width-map.Scale.normalX(map.nMapBorderWidth)*2,map.Scale.bBox.height-map.Scale.normalY(map.nMapBorderWidth)*2));this.widgetBox=new box(map.Scale.mapPosition.x+map.Scale.normalX(map.nMapBorderWidth),map.Scale.mapPosition.y+map.Scale.normalY(map.nMapBorderWidth+map.nToolMarginTop),map.Scale.bBox.width-map.Scale.normalX(map.nMapBorderWidth)*2,map.Scale.bBox.height-
map.Scale.normalY(map.nMapBorderWidth)*2)};ixMap.Viewport.prototype.createPanBorder=function(){var a=map.SVGDocument;if(map.fMapBorder){var f=a.getElementById("widgets:antizoomandpan");if(f){var g=map.szMapBorderColor,l=map.Scale.normalX(map.nMapBorderWidth),h=a.getElementById("mapBorderClipCover");h&&h.parentNode.removeChild(h);h=map.Dom.newGroup(f,"mapBorderClipCover");h.setAttributeNS(null,"style","fill:white;opacity:1.0");f.insertBefore(h,f.firstChild);map.Dom.newShape("rect",h,0,0,map.Scale.mapPosition.x,
map.Scale.viewBox.height,"");map.Dom.newShape("rect",h,0,0,map.Scale.viewBox.width+1E4,map.Scale.mapPosition.y,"");map.Dom.newShape("rect",h,0,map.Scale.mapPosition.y+map.Scale.bBox.height,map.Scale.viewBox.width+1E4,map.Scale.viewBox.height-(map.Scale.mapPosition.y+map.Scale.bBox.height)+1E4,"");map.Dom.newShape("rect",h,map.Scale.mapPosition.x+map.Scale.bBox.width,0,map.Scale.viewBox.width-(map.Scale.mapPosition.x+map.Scale.bBox.width)+1E4,map.Scale.bBox.height,"");(h=a.getElementById("mapBorder"))&&
h.parentNode.removeChild(h);h=map.Dom.newGroup(f,"mapBorder");if(map.fMapBorder3D&&map.Scale.mapPosition.x)g="#ffffff",f.insertBefore(h,f.firstChild),h.fu.setPosition(0,0),l=map.Scale.normalX(250),a=map.Scale.normalX(-3),f=map.Dom.newShape("rect",h,map.Scale.mapPosition.x,map.Scale.mapPosition.y-l+a,map.Scale.bBox.width,l,"fill:"+g+";opacity:0.5"),f.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)"),f=map.Dom.newShape("rect",h,0,map.Scale.mapPosition.y+map.Scale.bBox.height-
a,map.Scale.mapPosition.x+map.Scale.bBox.width,l,"fill:"+g+";opacity:0.5"),f.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)"),f=map.Dom.newShape("rect",h,0,0,map.Scale.mapPosition.x,map.Scale.mapPosition.y+map.Scale.bBox.height,"fill:"+g+";opacity:0.5"),f.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)"),f=map.Dom.newShape("rect",h,map.Scale.mapPosition.x+map.Scale.bBox.width-a,0,l,map.Scale.mapPosition.y+map.Scale.bBox.height,"fill:"+
g+";opacity:0.5"),f.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)");else if(h.setAttributeNS(null,"transform","matrix(1 0 0 1 "+map.Scale.mapPosition.x+" "+map.Scale.mapPosition.y+")"),map.Dom.newShape("rect",h,0,0,map.Scale.bBox.width,l,"fill:"+g+";opacity:1.0"),map.Dom.newShape("rect",h,0,map.Scale.bBox.height-l,map.Scale.bBox.width,l,"fill:"+g+";opacity:1.0"),map.Dom.newShape("rect",h,0,0,l,map.Scale.bBox.height,"fill:"+g+";opacity:1.0"),map.Dom.newShape("rect",
h,map.Scale.bBox.width-l,0,l,map.Scale.bBox.height,"fill:"+g+";opacity:1.0"),map.nMapBorderWidth>2){g=map.szMapPanBorderStyle+";stroke-width:"+map.Scale.normalX(1)+";opacity:1.0";a=map.szMapPanBorderOnoverStyle+";stroke-width:"+map.Scale.normalX(1)+";opacity:1.0";var r=map.Scale.bBox,C=r.width/10,F=r.width/3/+map.Scale.normalX(1);f=map.Dom.newShape("rect",h,C,0,r.width-C*2,l,g);f.setAttributeNS(null,"onclick","map.Viewport.doPanMap(0,"+F+")");f.setAttributeNS(szMapNs,"tooltip","pan");f.setAttributeNS(szMapNs,
"onoverstyle",a);f=map.Dom.newShape("rect",h,C,r.height-l-1,r.width-C*2,l,g);f.setAttributeNS(null,"onclick","map.Viewport.doPanMap(0,"+-F+")");f.setAttributeNS(szMapNs,"tooltip","pan");f.setAttributeNS(szMapNs,"onoverstyle",a);f=map.Dom.newShape("rect",h,0,C,l,r.height-C*2,g);f.setAttributeNS(szMapNs,"onoverstyle",a);f.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+F+",0)");f.setAttributeNS(szMapNs,"tooltip","pan");f.setAttributeNS(szMapNs,"onoverstyle",a);f=map.Dom.newShape("rect",h,r.width-
l-1,C,l,r.height-C*2,g);f.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+-F+",0)");f.setAttributeNS(szMapNs,"onoverstyle",a);f.setAttributeNS(szMapNs,"tooltip","pan");f=map.Dom.newShape("path",h,"M0,0 l "+C+",0 0,"+l+" "+-(C-l)+",0 0,"+(C-l)+" "+-l+",0 z",g);f.setAttributeNS(szMapNs,"onoverstyle",a);f.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+F+","+F+")");f.setAttributeNS(szMapNs,"tooltip","pan");f.setAttributeNS(szMapNs,"onoverstyle",a);f=map.Dom.newShape("path",h,"M"+r.width+
","+r.height+" l "+-C+",0 0,"+-l+" "+(C-l)+",0 0,"+-(C-l)+" "+l+",0 z",g);f.setAttributeNS(szMapNs,"tooltip","pan");f.setAttributeNS(szMapNs,"onoverstyle",a);f.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+-F+","+-F+")");f.setAttributeNS(szMapNs,"tooltip","pan");f.setAttributeNS(szMapNs,"onoverstyle",a);f=map.Dom.newShape("path",h,"M"+r.width+",0 l "+-C+",0 0,"+l+" "+(C-l)+",0 0,"+(C-l)+" "+l+",0 z",g);f.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+-F+","+F+")");f.setAttributeNS(szMapNs,
"onoverstyle",a);f.setAttributeNS(szMapNs,"tooltip","pan");f=map.Dom.newShape("path",h,"M0,"+r.height+" l "+C+",0 0,"+-l+" "+-(C-l)+",0 0,"+-(C-l)+" "+-l+",0 z",g);f.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+F+","+-F+")");f.setAttributeNS(szMapNs,"tooltip","pan");f.setAttributeNS(szMapNs,"onoverstyle",a)}}}};ixMap.Viewport.prototype.doPanMap=function(a,f){executeWithMessage("map.Viewport.panMap("+a+","+f+")","please wait ...",100)};ixMap.Viewport.prototype.panMap=function(a,f){map.Zoom.setNewPan(a,
f);map.Event.doDefaultZoom(null)};ixMap.Viewport.prototype.setBackgroundColor=function(a){this.eventRect&&this.eventRect.setAttributeNS(null,"style","fill:"+a+";opacity:1;pointer-events:all")};ixMap.Viewport.prototype.togglePanBorder=function(){var a=map.SVGDocument.getElementById("mapBorder");a?a.parentNode.removeChild(a):map.Viewport.createPanBorder()};ixMap.Viewport.prototype.createNorthArrow=function(){if(map.fNorthArrow){var a=map.SVGDocument.getElementById("widgets:antizoomandpan");if(a){var f=
"none";this.northGroup&&(f=this.northGroup.style.getPropertyValue("display"),this.northGroup.parentNode.removeChild(this.northGroup));this.northGroup=map.Dom.newGroup(a,"mapNorthArrow");f&&this.northGroup.style.setProperty("display",f);map.szNorthArrowPosition=="TOP"?this.northGroup.fu.setPosition(this.widgetBox.x+this.widgetBox.width-map.Scale.normalX(75),map.Scale.normalX(45+map.nToolMarginTop)):this.northGroup.fu.setPosition(this.widgetBox.x+this.widgetBox.width-map.Scale.normalX(75),this.widgetBox.y+
map.Scale.normalX((this.widgetBox.y?50:60)+map.nToolMarginTop));a=map.Scale.normalY(30);f=map.Scale.normalY(12);map.Dom.newShape("circle",this.northGroup,0,0,a,"fill:white;opacity:0.2");map.Dom.newShape("path",this.northGroup,"M0,"+-a/2+" l "+f/2+","+a*1.2+" "+-f/2+","+-a/5+" "+-f/2+","+a/5+" z","fill:#444444;stroke:#ffffff;stroke-width:"+map.Scale.normalX(.4)+";");map.Dom.newText(this.northGroup,map.Scale.normalX(-5),map.Scale.normalY(-19),"font-family:arial;font-size:"+map.Scale.normalX(12)+"px;font-weight:bold;fill:#444444;stroke:white;stroke-width:0.2;pointer-events:none",
"N");map.Dom.newShape("rect",this.northGroup,-f/2,-a,f,a,"fill:green;opacity:0.0");map.fNorthArrow=="rotatable"&&(this.northGroup.setAttributeNS(null,"cursor","pointer"),this.northGroup.setAttributeNS(szMapNs,"tooltip",map.Dictionary.getLocalText("click to move it")),this.northArrowObj=new X(this.northGroup,100,"0,360","1",90,9),this.northArrowObj.parent=this);a=new ra(this.northGroup,"mapNorthArrow:zoomin","BUTTON","#plus_button1","map.Zoom.doZoomMap(2)","","zoom in");a.setPosition(map.Scale.normalY(0),
map.Scale.normalY(40));a.scale(1.3,1.3);a.nodeObj.style.setProperty("fill-opacity","0.5","");a=new ra(this.northGroup,"mapNorthArrow:zoomout","BUTTON","#minus_button1","map.Zoom.doZoomMap(0.5)","","zoom out");a.setPosition(map.Scale.normalY(0),map.Scale.normalY(40+map.nNormalButtonSize*2));a.scale(1.3,1.3);a.nodeObj.style.setProperty("fill-opacity","0.5","")}}};ixMap.Viewport.prototype.onClick=function(a){this.northArrowObj&&executeWithMessage("map.Scale.setRotation(null,0)","...")};ixMap.Viewport.prototype.onMouseUp=
function(a){this.northArrowObj&&!map.fRotateOnMouseMove&&executeWithMessage("map.Scale.setRotation(null,"+this.northArrowObj.getAngle()+")","...")};ixMap.Viewport.prototype.onMouseMove=function(a){this.northArrowObj&&map.fRotateOnMouseMove&&(a=this.northArrowObj.getAngle(),a!=this.nAngle&&(map.Scale.setRotation(null,a),this.nAngle=a))};ixMap.Viewport.prototype.showNorthArrow=function(){this.northGroup&&this.northGroup.style.setProperty("display","inline","")};ixMap.Viewport.prototype.hideNorthArrow=
function(){this.northGroup&&this.northGroup.style.getPropertyValue("display")!="none"&&(this.northGroup.style.setProperty("display","none",""),this.northArrowObj&&executeWithMessage("map.Scale.setRotation(null,0)","..."))};ixMap.Viewport.prototype.clipMap=function(a){var f=map.SVGDocument.getElementById("mapcliprect");f&&f.setAttributeNS(null,"width",map.Scale.normalX(a))};ixMap.Viewport.prototype.clipLayer=function(a,f){a||(a=map._activeTheme);var g=map.SVGDocument.getElementById(a);a=map.SVGDocument.getElementById(a+
":values");typeof this.lastClippedLayer!="undefined"&&this.lastClippedLayer!=g&&(map.Dom.setClipRect(this.lastClippedLayer,new box(-map.Scale.mapOffset.x,-map.Scale.mapOffset.y,map.Scale.bBox.width,map.Scale.bBox.height)),this.lastClippedLayer=null);typeof this.lastClippedLayerV!="undefined"&&this.lastClippedLayerV!=a&&(map.Dom.setClipRect(this.lastClippedLayerV,new box(-map.Scale.mapOffset.x,-map.Scale.mapOffset.y,map.Scale.bBox.width,map.Scale.bBox.height)),this.lastClippedLayerV=null);g&&(map.Dom.setClipRect(g,
new box(-map.Scale.mapOffset.x,-map.Scale.mapOffset.y,map.Scale.normalX(f),map.Scale.bBox.height)),this.lastClippedLayer=g);a&&(map.Dom.setClipRect(a,new box(-map.Scale.mapOffset.x,-map.Scale.mapOffset.y,map.Scale.normalX(f),map.Scale.bBox.height)),this.lastClippedLayerV=a)};ixMap.Zoom=function(a){this.canvasNode=map.SVGDocument.getElementById("mapcanvas");this.zoomNode=map.SVGDocument.getElementById("mapzoomandpan");this.nZoomY=this.nZoomX=this.nZoom=1;this.doCenter=this.doArea=this.doZoom=null;
this.fAreaSet=!1;a&&a>1&&this.doExecuteZoomMap(a,1)};ixMap.Zoom.prototype=new Map;ixMap.Zoom.prototype.init=function(){if(map.Scale.initZoomNode){var a=Number(map.Scale.initZoomNode.getAttribute("MinBoundX")),f=Number(map.Scale.initZoomNode.getAttribute("MaxBoundX")),g=Number(map.Scale.initZoomNode.getAttribute("MinBoundY")),l=Number(map.Scale.initZoomNode.getAttribute("MaxBoundY"));map.Scale.initZoomNode.getAttribute("units")=="degree"?this.doZoomMapToGeoBounds(g,a,l,f):this.Zoom.doZoomMapToEnvelope(a,
f,g,l)}};ixMap.Zoom.prototype.toFullExtend=function(){setTimeout("map.Zoom.reset()",100)};ixMap.Zoom.prototype.setNewZoom=function(a){this.doZoom=a;map.Zoom.execute()};ixMap.Zoom.prototype.setNewPan=function(a,f){this.doPanMap(a,f)};ixMap.Zoom.prototype.setNewArea=function(a){this.fAreaSet=!0;this.doSetAreaByParentMap(a)||(this.doArea=new box(a.x,a.y,a.width,a.height),map.Zoom.execute())};ixMap.Zoom.prototype.setNewCenter=function(a){this.doCenterByParentMap(a)||(this.doCenter=new box(a.x,a.y,a.width,
a.height),map.Zoom.execute())};ixMap.Zoom.prototype.execute=function(){this.doZoom&&(this.doExecuteZoomMap(this.doZoom,this.nZoom),this.nZoom=this.doZoom,this.doZoom=null);this.doArea&&(this.doZoomMapToArea(this.doArea),this.doArea=null);this.doCenter&&(this.doCenterMapToArea(this.doCenter),this.doCenter=null);map.SVGPopupGroup&&map.SVGPopupGroup.fu.clear()};ixMap.Zoom.prototype.cancel=function(){this.doCenter=this.doArea=this.doZoom=null};ixMap.Zoom.prototype.reset=function(){this.zoomNode.setAttributeNS(null,
"transform","matrix(1 0 0 1 0 0)");map.SVGRootElement.currentTranslate.x=0;map.SVGRootElement.currentTranslate.y=0;this.nZoom=1;map.Event.doDefaultZoom(null);clearMessage(100)};ixMap.Zoom.prototype.getBox=function(){var a=getMatrix(this.canvasNode),f=getMatrix(this.zoomNode),g=-a[4]/this.nZoomX;a=-a[5]/this.nZoomY;g-=(map.Scale.normalX(map.SVGRootElement.currentTranslate.x)+f[4])/this.nZoomX;a-=(map.Scale.normalY(map.SVGRootElement.currentTranslate.y)+f[5])/this.nZoomY;return new box(g,a,map.Scale.bBox.width/
this.nZoomX,map.Scale.bBox.height/this.nZoomY)};ixMap.Zoom.prototype.getEnvelope=function(){var a=this.getBox(),f=map.Scale.getMapCoordinate(a.x,a.y);a=map.Scale.getMapCoordinate(a.x+a.width,a.y+a.height);return[f,a]};ixMap.Zoom.prototype.getEnvelopeString=function(){var a=this.getEnvelope();return String("MinBoundX='"+a[0].x+"' MaxBoundX='"+a[1].x+"' MinBoundY='"+a[1].y+"' MaxBoundY='"+a[0].y+"'")};ixMap.Zoom.prototype.getFractionBox=function(){var a=getMatrix(this.zoomNode),f=map.Scale.rotatePoint(new point(a[4],
a[5]),-1);a[4]=f.x;a[5]=f.y;f=(map.Scale.normalX(map.SVGRootElement.currentTranslate.x)+a[4])/this.nZoomX;a=(map.Scale.normalY(map.SVGRootElement.currentTranslate.y)+a[5])/this.nZoomY;var g=map.Scale.bBox.width-map.Scale.bBox.width/this.nZoomX,l=map.Scale.bBox.height-map.Scale.bBox.height/this.nZoomY;return g>0&&l>0?new box(.5-f/g,.5-a/l,1/this.nZoomX,1/this.nZoomY):new box(0,0,1/this.nZoomX,1/this.nZoomY)};ixMap.Zoom.prototype.setFractionBox=function(a){var f=map.Scale.bBox.width*a.width,g=map.Scale.bBox.height*
a.height;a=new box((map.Scale.bBox.width-f)*a.x+map.Scale.bBox.x,(map.Scale.bBox.height-g)*a.y+map.Scale.bBox.y,f,g);map.Zoom.setNewCenter(a)};ixMap.Zoom.prototype.clipArea=function(a){a.width/a.height!=map.Scale.bBox.width/map.Scale.bBox.height&&(a.width>a.height?a.height=a.width/map.Scale.bBox.width*map.Scale.bBox.height:a.width=a.height/map.Scale.bBox.height*map.Scale.bBox.width);var f=a.x-map.Scale.bBox.x,g=map.Scale.bBox.x+map.Scale.bBox.width-(a.x+a.width),l=a.y-map.Scale.bBox.y,h=map.Scale.bBox.y+
map.Scale.bBox.height-(a.y+a.height);if(f<0||g<0||l<0||h<0){if(f<0&&g<0)a.x=map.Scale.bBox.x,a.width=map.Scale.bBox.width;else if(f<0)a.x+=-f,a.width-=g>-f?0:-f-g;else if(g<0)return a.x-=-g,this.clipArea(a);if(l<0&&h<0)a.y=map.Scale.bBox.y,a.height=map.Scale.bBox.heigt;else if(l<0)a.y+=-l,a.height-=h>-l?0:-l-h;else if(h<0)return a.y-=-h,this.clipArea(a)}return a};ixMap.Zoom.prototype.isVisibleBox=function(a){try{var f=this.getBox();return a.x+a.width<f.x||a.x>f.x+f.width||a.y+a.height<f.y||a.y>f.y+
f.height?!1:!0}catch(g){return!1}};ixMap.Zoom.prototype.isCompletelyVisibleBox=function(a){var f=this.getBox();return a.x<f.x||a.x+a.width>f.x+f.width||a.y<f.y||a.y+a.height>f.y+f.height?!1:!0};ixMap.Zoom.prototype.doExecuteZoomMap=function(a,f){a=this.checkZoomLimit(a);if(a!=this.nZoom){var g=getMatrix(this.zoomNode),l=(map.SVGRootElement.currentTranslate.x+map.Scale.embedX(g[4]))/f*a;g=(map.SVGRootElement.currentTranslate.y+map.Scale.embedX(g[5]))/f*a;this.nOldZoomX=this.nZoomX;this.nOldZoomY=this.nZoomY;
this.nZoomX=this.nZoomX/f*a;this.nZoomY=this.nZoomY/f*a;map.fPanByViewer?(this.zoomNode.setAttributeNS(null,"transform","matrix("+this.nZoomX+" 0 0 "+this.nZoomY+" 0 0)"),map.SVGRootElement.currentTranslate.x=l,map.SVGRootElement.currentTranslate.y=g):this.zoomNode.setAttributeNS(null,"transform","matrix("+this.nZoomX+" 0 0 "+this.nZoomY+" "+map.Scale.normalX(l)+" "+map.Scale.normalY(g)+")");this.nZoom=a;map.Event.doDefaultZoom(null)}};ixMap.Zoom.prototype.doZoomMapToArea=function(a){if(a.width&&
a.height){this.fAreaSet=!0;var f=getMatrix(this.canvasNode);new point(f[4],f[5]);f=Math.min(map.Scale.bBox.width/a.width,map.Scale.bBox.height/a.height);var g=map.Scale.bBox.width/a.width,l=map.Scale.bBox.height/a.height;f=Math.round(f*1E6)/1E6;g=Math.round(g*1E6)/1E6;l=Math.round(l*1E6)/1E6;var h=this.checkZoomLimit(f);h!=f&&a.scale(f/h);f=h;f!=this.nZoom&&(map.fPreserveMapRatio&&(g=l=f),map.fZoomByViewer&&map.fPanByViewer?(this.zoomNode.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)"),map.SVGRootElement.currentScale=
f):map.fPanByViewer?(this.zoomNode.setAttributeNS(null,"transform","matrix("+g+" 0 0 "+l+" 0 0)"),map.SVGRootElement.currentScale=1):this.zoomNode.setAttributeNS(null,"transform","matrix("+g+" 0 0 "+l+" 0 0)"),this.nZoom=f,this.nOldZoomX=this.nZoomX,this.nOldZoomY=this.nZoomY,this.nZoomX=g,this.nZoomY=l);this.doCenterMapToArea(a)}};ixMap.Zoom.prototype.doCenterMapToArea=function(a){this.fAreaSet=!0;this.fExternalZoom=!1;var f=getMatrix(this.canvasNode),g=new point(f[4],f[5]),l=getMatrix(this.zoomNode);
f=l[0];l=l[3];a.x+=a.width/2;a.y+=a.height/2;a.x=a.x*f+g.x;a.y=a.y*l+g.y;g=-a.x+map.Scale.bBox.width/2;var h=-a.y+map.Scale.bBox.height/2;h=map.Scale.rotatePoint(new point(g,h));g=h.x;h=h.y;map.fZoomByViewer&&map.fPanByViewer?(map.SVGRootElement.currentScale=this.nZoom,map.SVGRootElement.currentTranslate.x=map.Scale.embedX(g-a.width/2)*this.nZoomX,map.SVGRootElement.currentTranslate.y=map.Scale.embedY(h-a.height/2)*this.nZoomY):map.fPanByViewer?(map.SVGRootElement.currentTranslate.x=map.Scale.embedX(g),
map.SVGRootElement.currentTranslate.y=map.Scale.embedY(h)):(a=getTranslate(this.zoomNode),this.zoomNode.setAttributeNS(null,"transform","matrix("+f+" 0 0 "+l+" "+g+" "+h+")"),this.doPanFixed(g-a.x,h-a.y));map.fFroozeDynamicContent||(map.isIdle()?map.Event.doDefaultZoom(null):map.pushAction(()=>{map.Event.doDefaultZoom(null)}))};ixMap.Zoom.prototype.doPanFixed=function(a,f){for(var g=map.SVGFixedGroup.childNodes,l=0;l<g.length;l++){var h=g.item(l).fu.getPosition();g.item(l).fu.setPosition(h.x+a,h.y+
f)}g=map.SVGToolsGroup.childNodes;for(l=0;l<g.length;l++)h=g.item(l).fu.getPosition(),g.item(l).fu.setPosition(h.x+a,h.y+f)};ixMap.Zoom.prototype.doZoomMapToWidgetRect=function(a){var f=Math.min(a.width,a.height)<map.Scale.normalX(25)?!0:!1;new point(a.x,a.y);new point(a.x-a.width,a.y-a.height);var g=getMatrix(map.Scale.zoomNode),l=g[0],h=g[3],r=map.antiZoomAndPanList.getActualMatrix(),C=map.Scale.rotatePoint(new point(g[4],g[5]),-1);g[4]=C.x;g[5]=C.y;a.x=a.x*r[0]+r[4];a.y=a.y*r[3]+r[5];a.width*=
r[0];a.height*=r[3];a.x=a.x-map.Scale.mapPosition.x-map.Scale.mapOffset.x;a.y=a.y-map.Scale.mapPosition.y-map.Scale.mapOffset.y;a.x=(a.x-g[4])/l;a.y=(a.y-g[5])/h;a.width/=l;a.height/=h;f?map.Zoom.setNewCenter(a):map.Zoom.setNewArea(a)};ixMap.Zoom.prototype.doZoomMapToEnvelope=function(a,f,g,l){this.doCheckEnvelope(a,f,g,l)?(a=(a-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x,l=map.Scale.maxY-map.Scale.minY-(l-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y,map.Zoom.setNewArea(new box(a,
l,(f-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x-a,map.Scale.maxY-map.Scale.minY-(g-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y-l),300)):map.Zoom.doZoomMapToLayer("maplayer")};ixMap.Zoom.prototype.doCenterMapToEnvelope=function(a,f,g,l){this.doCheckEnvelope(a,f,g,l)&&(a=(a-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x,l=map.Scale.maxY-map.Scale.minY-(l-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y,map.Zoom.doCenterMapToArea(new box(a,
l,(f-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x-a,map.Scale.maxY-map.Scale.minY-(g-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y-l)))};ixMap.Zoom.prototype.doCenterMapToGeoPosition=function(a,f){(a=map.Scale.getMapCoordinateOfLatLon(a,f))?this.doSetCenterByParentMap(a.x,a.y)||this.doCenterMapToEnvelope(a.x,a.x,a.y,a.y):displayMessage("missing projection ! lat/lon could not be resolved",1E3)};ixMap.Zoom.prototype.doCenterMapToGeoBounds=function(a,f,g,l){this.fExternalZoom=
!1;a=map.Scale.getMapCoordinateOfLatLon(a,f);g=map.Scale.getMapCoordinateOfLatLon(g,l);a&&g?this.doCenterMapToEnvelope(a.x,g.x,a.y,g.y):displayMessage("missing projection ! lat/lon could not be resolved",1E3)};ixMap.Zoom.prototype.doZoomMapToGeoBounds=function(a,f,g,l){a=map.Scale.getMapCoordinateOfLatLon(a,f);g=map.Scale.getMapCoordinateOfLatLon(g,l);a&&g?this.doSetEnvelopeByParentMap(a.x,g.x,a.y,g.y)||this.doZoomMapToEnvelope(a.x,g.x,a.y,g.y):displayMessage("missing projection ! lat/lon could not be resolved",
1E3)};ixMap.Zoom.prototype.doZoomMapToView=function(a,f){try{map.HTMLWindow.ixmaps.htmlgui_setCenterAndZoom({lat:a[0],lng:a[1]},f)}catch(g){return!1}};ixMap.Zoom.prototype.doZoomMapToLayer=function(a){if(map.fPendingNewGeoBounds)map.fPendingNewGeoBounds=!1;else{var f=map.SVGDocument.getElementById(a),g=map.Dom.getBox(f);f=map.Scale.getMapOffset(f);g.x+=f.x;g.y+=f.y;g=new box(g.x,g.y,g.width,g.height);g.scale(.8);if(a=="maplayer"){f=a=3E4;var l=-3E4,h=-3E4,r=!1,C;for(C in map.Layer.listA)if(!C.match(/legend/)){var F=
map.SVGDocument.getElementById(C+"::bbox");F&&(a=Math.min(a,Number(F.getAttributeNS(null,"minboundx"))),f=Math.min(f,Number(F.getAttributeNS(null,"minboundy"))),l=Math.max(l,Number(F.getAttributeNS(null,"maxboundx"))),h=Math.max(h,Number(F.getAttributeNS(null,"maxboundy"))),r=!0)}r&&(g=new box(a,f,Math.abs(l-a),Math.abs(h-f)))}g.width&&g.height&&g.width<map.Scale.bBox.width&&g.height<map.Scale.bBox.height&&(map.Zoom.doSetAreaByParentMap(g)||map.Zoom.setNewArea(g))}};ixMap.Zoom.prototype.doZoomMapToItem=
function(a){if(map.fPendingNewGeoBounds)map.fPendingNewGeoBounds=!1;else{var f=map.SVGDocument.getElementById(a);a=map.Dom.getBox(f);f=map.Scale.getMapOffset(f);a.x+=f.x;a.y+=f.y;a=new box(a.x,a.y,a.width,a.height);a.width&&a.height&&a.width<map.Scale.bBox.width&&a.height<map.Scale.bBox.height&&(map.Zoom.doSetAreaByParentMap(a)||map.Zoom.setNewArea(a))}};ixMap.Zoom.prototype.doSetMapToGeoBounds=function(a,f,g,l){this.fExternalZoom=!1;a=map.Scale.getMapCoordinateOfLatLon(a,f);g=map.Scale.getMapCoordinateOfLatLon(g,
l);a&&g?this.doZoomMapToEnvelope(a.x,g.x,a.y,g.y):displayMessage("missing projection ! lat/lon could not be resolved",1E3)};ixMap.Zoom.prototype.getCenterOfMapInGeoPosition=function(){var a=this.getBox();a=map.Scale.getMapCoordinate(a.x+a.width/2,a.y+a.height/2);return a=map.Scale.getGeoCoordinateOfPoint(a.x,a.y)};ixMap.Zoom.prototype.getBoundsOfMapInGeoBounds=function(){var a=this.getBox(),f=map.Scale.getMapCoordinate(a.x,a.y+a.height);a=map.Scale.getMapCoordinate(a.x+a.width,a.y);f=map.Scale.getGeoCoordinateOfPoint(f.x,
f.y);a=map.Scale.getGeoCoordinateOfPoint(a.x,a.y);return[f,a]};ixMap.Zoom.prototype.doCheckEnvelope=function(a,f,g,l){return map.fLimitMapToExtent?a<map.Scale.minBoundX&&f>map.Scale.maxBoundX&&g<map.Scale.minBoundY&&l>map.Scale.maxBoundY&&f-a>(map.Scale.maxBoundX-map.Scale.minBoundX)*2||a>map.Scale.maxBoundX||f<map.Scale.minBoundX||g>map.Scale.maxBoundY||l<map.Scale.minBoundY?(displayMessage("position outside",500),!1):!0:!0};ixMap.Zoom.prototype.doSetAreaByParentMap=function(a){var f=map.Scale.getMapCoordinate(a.x,
a.y);a=map.Scale.getMapCoordinate(a.x+a.width,a.y+a.height);return this.doSetEnvelopeByParentMap(f.x,a.x,f.y,a.y)};ixMap.Zoom.prototype.doSetEnvelopeByParentMap=function(a,f,g,l){try{var h=map.Scale.getGeoCoordinateOfPoint(a,g),r=map.Scale.getGeoCoordinateOfPoint(f,l);this.fExternalZoom=!0;return map.HTMLWindow.ixmaps.htmlgui_setCurrentEnvelopeByGeoBounds(h,r)}catch(C){return!1}};ixMap.Zoom.prototype.doCenterByParentMap=function(a){a=map.Scale.getMapCoordinate(a.x+a.width/2,a.y+a.height/2);return this.doSetCenterByParentMap(a.x,
a.y)};ixMap.Zoom.prototype.doSetCenterByParentMap=function(a,f){try{var g=map.Scale.getGeoCoordinateOfPoint(a,f);return map.HTMLWindow.ixmaps.htmlgui_setCurrentCenterByGeoBounds(g)}catch(l){return!1}};ixMap.Zoom.prototype.doZoomMap=function(a,f){if(this.zoomNode){displayMessage("please wait ...",500);var g=getMatrix(map.Zoom.zoomNode)[0];if(a===0)return this.toFullExtend(),Math.round(map.Scale.nMapScale);switch(f){case "absolute":g=a;break;case "byscale":g=map.Scale.nTrueMapScale/a;break;default:g*=
a}this.setNewZoom(g);return Math.round(map.Scale.nMapScale/g)}};ixMap.Zoom.prototype.doPanMap=function(a,f){var g=getMatrix(this.zoomNode),l=g[0],h=g[3];a=map.SVGRootElement.currentTranslate.x+a;f=map.SVGRootElement.currentTranslate.y+f;f=map.Scale.rotatePoint(new point(a,f));a=f.x;f=f.y;a+=map.Scale.embedX(g[4]);f+=map.Scale.embedY(g[5]);map.fPanByViewer?(map.SVGRootElement.currentTranslate.x=a,map.SVGRootElement.currentTranslate.y=f):(a=map.Scale.normalX(a),f=map.Scale.normalY(f),g=getTranslate(this.zoomNode),
this.zoomNode.setAttributeNS(null,"transform","matrix("+l+" 0 0 "+h+" "+a+" "+f+")"),this.doPanFixed(a-g.x,f-g.y));if(map.Scale.szMapProjection=="Mercator")try{var r=this.getBox(),C=map.Scale.getMapCoordinate(r.x+r.width/2,r.y+r.height/2);this.doSetCenterByParentMap(C.x,C.y)}catch(F){try{map.HTMLWindow.ixmaps.htmlgui_setCurrentEnvelope(this.getEnvelopeString(),!1)}catch(v){}}};ixMap.Zoom.prototype.doPanMapByViewer=function(a,f){f=map.SVGRootElement.currentTranslate.y+f;map.SVGRootElement.currentTranslate.x+=
a;map.SVGRootElement.currentTranslate.y=f};ixMap.Zoom.prototype.checkZoomLimit=function(a){var f=1E6;map.fPDFEmbed&&(f=20,map.Tiles&&map.Tiles.nCount>1&&(f=20));return a>=f?f:a=Math.round(a*1E6)/1E6};ixMap.Zoom.prototype.removeClipping=function(a){map.fClipMapDynamic&&map.SVGDocument.getElementById("mapclip").setAttributeNS(null,"clip-path","")};ixMap.Zoom.prototype.activateClipping=function(a){map.fClipMapDynamic&&map.SVGDocument.getElementById("mapclip").setAttributeNS(null,"clip-path","url(#mapclippath)")};
ixMap.Zoom.prototype.onMouseMove=function(a){};ixMap.Zoom.prototype.onMouseDown=function(a){};ixMap.Zoom.prototype.onMouseUp=function(a){this.setFractionBox(new box(this.overviewThumbObj.fraction.x,this.overviewThumbObj.fraction.y,1/this.nZoomX,1/this.nZoomY))};ixMap.Layer=function(a){this.document=a?a.target.ownerDocument:map.SVGDocument;this.layerNode=map.SVGDocument.getElementById("maplayer");this.listA=[];this.depListA=[];this.generatedLabelA=[];this.changedFeatureNodesA=[];this.objectGroup=map.SVGDocument.getElementById(map.szObjectGroupId);
this.fSwitchSublayer=!0;this.nDynamicObjectScale=this.nObjectScale=this.nFeatureScale=1;var f=map.SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(f.length)for(this.listA.legend_body=new ixMap.Layer.Item(null),a=0;a<f.length;a++)this.listA[f.item(a).getAttributeNS(null,"name")]=new ixMap.Layer.Item(f.item(a));f=map.SVGDocument.getElementsByTagNameNS(szMapNs,"scaledependency");if(!(f.length<=0))for(a=0;a<f.length;a++){var g=f.item(a).getAttributeNS(null,"feature");this.depListA[g]=new ixMap.Layer.Dependency(f.item(a))}};
ixMap.Layer.prototype=new Map;ixMap.Layer.Item=function(a){if(a){if(this.szName=a.getAttributeNS(null,"name"),this.szLegendName=a.getAttributeNS(null,"legendname"),this.szFlag=a.getAttributeNS(null,"flag"),this.szType=a.getAttributeNS(null,"type"),this.nItems=Number(a.getAttributeNS(null,"items")),this.nRenderer=a.getAttributeNS(null,"renderer"),this.szRenderer=a.getAttributeNS(null,"rendererfield"),this.szLabel=a.getAttributeNS(null,"label"),this.szSelection=a.getAttributeNS(null,"selection"),this.szFilter=
a.getAttributeNS(null,"filter"),this.szFilterValue=a.getAttributeNS(null,"filtervalue"),this.szHighlight=a.getAttributeNS(null,"highlightstyle"),this.szDisplay=a.getAttributeNS(null,"display"),this.szDisplayLabel=a.getAttributeNS(null,"displaylabel"),this.categoryA=this.labelBoxA=null,a=a.getElementsByTagNameNS(szMapNs,"category"),a.length){this.categoryA=[];for(var f=0;f<a.length;f++){var g=this.categoryA[a.item(f).getAttributeNS(null,"name")]={};g.legendname=a.item(f).getAttributeNS(null,"legendname");
g.fill=a.item(f).getAttributeNS(null,"fill");g.stroke=a.item(f).getAttributeNS(null,"stroke");g.style=a.item(f).getAttributeNS(null,"style");g.display="inline"}}}else this.szFlag="",this.szType="dummy",this.szDisplayLabel=this.szDisplay="inline"};ixMap.Layer.Dependency=function(a){a&&(this.shapeId=a.getAttributeNS(null,"shape"),this.szFeature=a.getAttributeNS(null,"feature"),this.depClass=a.getAttributeNS(null,"classname"),this.nUpper=1E11,this.nLower=0,this.depLower=a.getAttributeNS(null,"lower"),
(this.depUpper=a.getAttributeNS(null,"upper"))&&this.depUpper.length&&(this.nUpper=Number(this.depUpper.split(":")[1])),this.depLower&&this.depLower.length&&(this.nLower=Number(this.depLower.split(":")[1])),this.szDisplayAttribute="inline")};ixMap.Layer.prototype.switchLayer=function(a,f,g,l){var h=l?"inline":"none",r=this.listA[f.split(":")[0]];if(!r)return!1;if(g&&g.match(/legendgroup/))return!0;if(f&&!f.match(/label/)&&!f.match(/::/)&&(f.match(/group/)||this.fSwitchSublayer)){var C="legend:collapsable:"+
f.split(":")[0];map.SVGDocument.getElementById(C)&&setTimeout('__doSwitchGroupThemes("'+f+'",'+l+")",250)}f&&!f.match(/label/)&&f.match(/::/)&&l===!0&&(C=this.fSwitchSublayer,this.fSwitchSublayer=!1,this.switchLayer(a,f.split("::")[0],g,!0),this.fSwitchSublayer=C,(C=map.SVGDocument.getElementById("legend:off:"+f.split("::")[0]))&&C.style.getPropertyValue("display")!="inline"&&(C=map.SVGDocument.getElementById("legend:suboff:"+f.split("::")[0]))&&C.style.setProperty("display","inline",""));f.match(/label/)&&
!f.match(/:bg/)&&this.switchLayer(a,f+":bg",g,l);f.match(/::/)&&f.split("::")[1]&&r.categoryA[f.split("::")[1]]?r.categoryA[f.split("::")[1]].display=h:(r.categoryA&&r.categoryA[null]&&(r.categoryA[null].display=h),r.display=h,r.nState=h=="none"?!1:!0);return r&&(this.switchLayerByFeature(f,l)||this.switchLayerOnTiles(f,l))?(f.match(/:label/)?r.szDisplayLabel=h:(r.nState=l,r.szDisplay=h),r.szLabel&&this.adaptLabel(a),setTimeout("map.Layer.adaptLabel()",100),!0):g&&!f.match(/:label/)?(this.switchLayerByCSS(null,
f,g,l?"inline":"none"),r&&(r.szDisplay=h),setTimeout("map.Layer.adaptLabel()",100),!0):!1};ixMap.Layer.prototype.switchLayerOnTiles=function(a,f){var g=!1;if(map.Tiles&&map.Tiles.nCount>0){a=map.Tiles.getTileNodeIds(a);for(var l=0;l<a.length;l++)g=this.switchLayerByFeature(a[l],f)?!0:g}return g};ixMap.Layer.prototype.switchLayerByFeature=function(a,f){var g,l=!1,h=this.document.getElementById(a);if(h)if(this.addChangedFeatureNode(h),h.getAttributeNS(null,"class")=="linetemplate"||h.getAttributeNS(szMapNs,
"class")=="linetemplate")if(a.match(/#/))for(a=a.split("#"),g=0;g<10;g++){if(h=this.document.getElementById(a[0]+"_"+g+"#"+a[1]))h.style.setProperty("display",f?"inline":"none",""),l=!0}else for(g=0;g<10;g++){if(h=this.document.getElementById(a+"_"+g))h.style.setProperty("display",f?"inline":"none",""),l=!0}else h.style.setProperty("display",f?"inline":"none",""),l=!0;return l};ixMap.Layer.prototype.switchLayerByCSS=function(a,f,g,l){if(g!="(null)"){if(f&&(f=f.split(":")[0],this.listA[f+"_1"])){var h=
g.substr(f.length,g.length-f.length),r=parseInt(h),C=parseInt(h.substr(h.length-1,1));h=g.substr(0,f.length);for(g=1;this.listA[f+"_"+g];)r++,this.switchLayerByCSS(a,null,h+"-"+g+r+"s"+C,l),g++;return}map.Scale.CSSStyleNodes&&(a=map.Scale.CSSStyleNodes,map.CSS=new ixMap.CSS(map.Scale.CSSStyleNodes),map.CSS.setStyle(g,"display",l),map.Scale.fCSSStyleNodeChanged=!0,a.firstChild.nextSibling.nodeValue=map.CSS.getStyleString(),displayMessage("please wait ...",500),setTimeout("map.Scale.refreshCSSStyles()",
200))}};ixMap.Layer.prototype.switchScaleDependentLayer=function(a,f){if(map.fDynamicLayer&&this.depListA!=null){var g=0;for(g in this.depListA){if(map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.depListA[g].nLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.depListA[g].nUpper)var l="inline";else l="none",!this.depListA[g].shapeId.match(/:label/)&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.depListA[g].nUpper&&(map.Themes&&map.Themes.getThemeCount()!==0||displayMessage("'"+this.depListA[g].shapeId+
"' not visible at actual zoom level!",3E3,"notify"));if(this.depListA[g].szDisplayAttribute!=l){this.depListA[g].szDisplayAttribute=l;if(this.isChangedFeature(this.depListA[g].shapeId)){if(this.depListA[g].szOldDisplayAttribute==l)continue;this.depListA[g].szOldDisplayAttribute=this.depListA[g].szDisplayAttribute}var h=this.depListA[g].szFeature;map.Legend&&map.Legend.switchLegendCheckBox(a,h,l)}try{var r=this.depListA[g].shapeId;r.match(/label/)?(r.split(":"),this.listA[r.split(":")[0]].szDisplayLabel=
l):this.listA[r].szDisplay=l}catch(C){alert("Syntax error: "+r)}}if(map.Scale.CSSStyleNodes&&map.Scale.CSSStyleNodes.firstChild.nextSibling&&map.fSwitchByCSS){a=map.Scale.CSSStyleNodes;map.CSS=new ixMap.CSS(map.Scale.CSSStyleNodes);for(g in this.depListA)f=this.depListA[g],f.szDisplayAttribute!=f.szOldDisplayAttribute&&(l=f.depClass,l.length>3?(map.CSS.setStyle(l,"display",f.szDisplayAttribute),map.Scale.fCSSStyleNodeChanged=!0):(l=map.SVGDocument.getElementById(f.shapeId))&&l.style.setProperty("display",
f.szDisplayAttribute,""));map.Scale.fCSSStyleNodeChanged&&(a.firstChild.nextSibling.nodeValue=map.CSS.getStyleString())}else for(f=f?f:map.SVGRootElement,g=f.getElementsByTagName("g"),a=0;a<g.length;a++)f=g.item(a).getAttributeNS(null,"id"),f=map.Tiles.getMasterId(f),this.depListA[f]&&g.item(a).style.setProperty("display",this.depListA[f].szDisplayAttribute,"")}};ixMap.Layer.prototype.isScaleDependentLayer=function(a){return this.depListA&&this.depListA[a]?!0:!1};ixMap.Layer.prototype.isScaleDependentLayerOn=
function(a){return this.depListA&&this.depListA[a]?this.depListA[a].szDisplayAttribute.match(/none/)?!1:!0:!0};ixMap.Layer.prototype.zoomToScaleDependentLayerOn=function(a){if(typeof this.listA[a]!="undefined"){map.Event.doDefaultZoom(null);var f=map.Scale.nTrueMapScale*map.Scale.nZoomScale;a=this.depListA&&this.depListA[a]&&this.depListA[a].nUpper?this.depListA[a].nUpper:map.Tiles.depUpper?map.Tiles.depUpper.split(":")[1]:0;var g=Math.ceil(f/a);f=map.Zoom.getBox();a=f.width/g;g=f.height/g;f.x+=(f.width-
a)/2;f.y+=(f.height-g)/2;f.width=a;f.height=g;map.Zoom.setNewArea(f);setTimeout("map.Tiles.switchScaleDependentTiles()",5E3)}};ixMap.Layer.prototype.isLayerOn=function(a){return this.listA[a]?this.listA[a].szDisplay.match(/none/)?!1:!0:!1};ixMap.Layer.prototype.changeLayerOpacity=function(a,f){var g;(g=this.changeOpacity(a,f))||(g=this.changeOpacityOnTiles(a,f));return g};ixMap.Layer.prototype.changeOpacityOnTiles=function(a,f){var g=!1;if(map.Tiles&&map.Tiles.nCount>0){a=map.Tiles.getTileNodeIds(a);
for(var l=0;l<a.length;l++)g=this.changeOpacity(a[l],f)?!0:g}else g=this.changeOpacity(a,f)?!0:g;return g};ixMap.Layer.prototype.changeOpacity=function(a,f){var g,l=!1,h=this.document.getElementById(a);if(h)if(h.getAttributeNS(null,"class")=="linetemplate"||h.getAttributeNS(szMapNs,"class")=="linetemplate")if(a.match(/#/))for(a=a.split("#"),g=0;g<10;g++){if(h=this.document.getElementById(a[0]+"_"+g+"#"+a[1]))this.changeNodeOpacity(h,f),l=!0}else for(g=0;g<10;g++){if(h=this.document.getElementById(a+
"_"+g))this.changeNodeOpacity(h,f),l=!0}else this.changeNodeOpacity(h,f),l=!0;return l};ixMap.Layer.prototype.changeNodeOpacity=function(a,f,g){var l=a.style.getPropertyValue(g?g:"opacity");l&&l.length!==0||(l="1");l=Number(l);l=Math.min(1,l*f);l=Math.max(0,l);a.style.setProperty(g?g:"opacity",String(l),"")};ixMap.Layer.prototype.initPatternScaling=function(a,f){f||(f=map.SVGRootElement);a=1/map.Scale.getEmbedScale()*map.Scale.nFeatureScaling;f=f.getElementsByTagName("pattern");for(var g=0;g<f.length;g++)f.item(g).getAttributeNS(null,
"id").match(/antizoomandpan/)||(getPatternMatrix(f.item(g)),f.item(g).setAttributeNS(null,"patternTransform","matrix("+a+" 0 0 "+a+" 0 0)"))};ixMap.Layer.prototype.changeLineScaling=function(a,f){this.doFeatureScaling(f);map.Scale.nLineScaling*=f};ixMap.Layer.prototype.changeLabelScaling=function(a,f){this.doLabelScaling(f);map.Scale.nLabelScaling*=f};ixMap.Layer.prototype.changeFeatureScaling=function(a,f,g){if(!(f>=1&&map.Scale.featureScaling_lastScale>=1)||g){var l=f/map.Scale.getEmbedScale();
g=f;if(map.fFeatureScalingDynamic){var h=Math.log(1/f);h>1&&(f*=h)}map.Layer.nFeatureScale=f;map.Layer.nDynamicScale=map.Layer.nFeatureScale/map.Scale.nZoomScale;h=f/map.Scale.featureScaling_lastScale;map.Scale.featureScaling_lastScale=f;if(h!==0&&h!==1)if(map.fFeatureScaling){var r=map.SVGRootElement.getElementsByTagName("pattern");var C=getMatrix(map.Scale.zoomNode);var F=C[4]+map.Scale.scaleX(map.SVGRootElement.currentTranslate.x),v=C[5]+map.Scale.scaleY(map.SVGRootElement.currentTranslate.y);
F=-F*l;v=-v*l;for(C=0;C<r.length;C++)r.item(C).getAttributeNS(null,"id").match(/antizoomandpan/)||(getPatternMatrix(r.item(C)),r.item(C).setAttributeNS(null,"patternTransform","matrix("+l+" 0 0 "+l+" "+String(F)+" "+String(v)+")"));a=a?a.target.ownerDocument:map.SVGDocument;r=!0;map.Scale.nFeatureScaling<1&&(r=!1,h<1&&map.Scale.nFeatureScaling*map.Zoom.nZoom>=1&&(map.Scale.nFeatureScaling*map.Zoom.nZoom*h<1&&(h=1/map.Scale.nFeatureScaling/map.Zoom.nZoom),r=!0),h>1&&map.Scale.nFeatureScaling*map.Zoom.nZoom*
h>=1&&(map.Scale.nFeatureScaling*map.Zoom.nZoom<1&&(h=map.Zoom.nZoom*h/(1/map.Scale.nFeatureScaling)),r=!0));if(r){r=map.SVGRootElement.getElementsByTagName("filter");for(C=0;C<r.length;C++)if(!r.item(C).getAttributeNS(null,"id").match(/antizoomandpan/))for(l=r.item(C).childNodes,F=0;F<l.length;F++)l.item(F).nodeName=="feMorphology"&&l.item(F).setAttributeNS(null,"radius",Number(l.item(F).getAttributeNS(null,"radius"))*h),l.item(F).nodeName=="feOffset"&&(l.item(F).setAttributeNS(null,"dx",Number(l.item(F).getAttributeNS(null,
"dx"))*h),l.item(F).setAttributeNS(null,"dy",Number(l.item(F).getAttributeNS(null,"dy"))*h)),l.item(F).nodeName=="feGaussianBlur"&&l.item(F).setAttributeNS(null,"stdDeviation",Number(l.item(F).getAttributeNS(null,"stdDeviation"))*h);this.doFeatureScaling(h);this.doLabelScaling(h);l=h;if(r=map.SVGDocument.getElementById("marker_symbols"))for(r=r.childNodes,C=0;C<r.length;C++)if(r.item(C).nodeType==1&&(F=r.item(C).getAttributeNS(null,"id"))&&F.length&&!F.match(/antizoomandpan/)){var E=getMatrix(r.item(C));
E&&(E[0]*=h,E[3]*=h,setMatrix(r.item(C),E),map.Scale.scaledSymbolsA["#"+F]=!0)}if(r=map.SVGDocument.getElementById("symbolstore"))for(r=r.getElementsByTagName("g"),C=0;C<r.length;C++)(F=r.item(C).getAttributeNS(null,"id"))&&F.length&&F.match(/symbol/)&&!F.match(/antizoomandpan/)&&(E=getMatrix(r.item(C)))&&(E[0]*=h,E[3]*=h,E[4]*=h,E[5]*=h,setMatrix(r.item(C),E),map.Scale.scaledSymbolsA["#"+F]=!0);r=map.SVGDocument.getElementById("widgets:antizoomandpan").getElementsByTagName("use");for(C=0;C<r.length;C++)F=
r.item(C).getAttributeNS(szXlink,"href"),map.Scale.scaledSymbolsA[F]&&(E=getMatrix(r.item(C)))&&(E[0]/=h,E[3]/=h,setMatrix(r.item(C),E));r=map.SVGHiddenGroup.getElementsByTagName("use");for(C=0;C<r.length;C++)F=r.item(C).getAttributeNS(szXlink,"href"),map.Scale.scaledSymbolsA[F]&&(E=getMatrix(r.item(C)))&&(E[0]/=h,E[3]/=h,setMatrix(r.item(C),E));this.scaleTextOffsets(map.SVGRootElement,f,l,a.getElementById("mapstyles"));this.scaleLineDecorations(map.SVGRootElement,f);this.doObjectScaling(g)}}else this.doObjectScaling(g)}};
ixMap.Layer.prototype.doFeatureScaling=function(a){var f=map.SVGDocument.getElementById("mapstyles");if(f){var g=f.firstChild.nextSibling.nodeValue;var l=__scaleLineStyleString(g,a);f.firstChild.nextSibling.nodeValue=l;map.Scale.fCSSStyleNodeChanged=!0}else if(map.fFeatureScalingByLayer){f=[];g=[];var h=!1;for(l in map.Layer.listA){var r=map.Layer.listA[l];if(r.szFlag.match(/tiled/)){if(!h){h=!0;var C=map.Tiles.getTileInfo();if(C)for(var F=0;F<C.length;F++){var v=Number(C[F].tileGroup.getAttributeNS(szMapNs,
"deltaTBD"));if(C[F].tileGroup.style.getPropertyValue("display")=="inline"){r=C[F].tileGroup.getElementsByTagName("g");for(var E=0;E<r.length;E++)r.item(E).getAttributeNS(null,"id").match(/:label/)||(f[f.length]=r.item(E),g[f.length-1]=v?v:1);C[F].tileGroup.setAttributeNS(szMapNs,"deltaTBD","1")}else C[F].tileGroup.hasChildNodes()&&C[F].tileGroup.setAttributeNS(szMapNs,"deltaTBD",String(a*(v?v:1)))}}}else if(r.szName&&(r=map.SVGDocument.getElementById(r.szName)))for(f[f.length]=r,g[f.length-1]=1,
r=r.getElementsByTagName("g"),E=0;E<r.length;E++)r.item(E).getAttributeNS(null,"id").match(/:label/)||(f[f.length]=r.item(E),g[f.length-1]=1)}r=map.SVGDocument.getElementById("mapobjects");r=r.getElementsByTagName("g");for(E=0;E<r.length;E++)f[f.length]=r.item(E),g[f.length-1]=1;for(h=0;h<f.length;h++)(l=f[h].getAttributeNS(null,"style"))&&l.length&&(l=__scaleLineStyleString(l,a*g[h]),f[h].setAttributeNS(null,"style",l))}};ixMap.Layer.prototype.doDynamicObjectScaling=function(a){map.Layer.nObjectScale=
a;map.fObjectScaling=="dynamic"&&(map.Layer.nObjectScale*=Math.pow(1/(map.Scale.nTrueMapScale*map.Scale.nZoomScale/map.Scale.nNormalSizeScale),1/map.Scale.nDynamicScalePow));map.Layer.nDynamicObjectScale=map.Layer.nObjectScale/a};ixMap.Layer.prototype.doObjectScaling=function(a){if(map.fObjectScaling){this.doDynamicObjectScaling(a);var f=map.Layer.nObjectScale/map.Scale.objectScaling_lastScale;map.Scale.objectScaling_lastScale=map.Layer.nObjectScale;if(f!==0&&f!==1&&(a=!0,map.Scale.nObjectScaling<
1&&(a=!1,f<1&&map.Scale.nObjectScaling*map.Zoom.nZoom>=1&&(map.Scale.nObjectScaling*map.Zoom.nZoom*f<1&&(f=1/map.Scale.nObjectScaling/map.Zoom.nZoom),a=!0),f>1&&map.Scale.nObjectScaling*map.Zoom.nZoom*f>=1&&(map.Scale.nObjectScaling*map.Zoom.nZoom<1&&(f=map.Zoom.nZoom*f/(1/map.Scale.nObjectScaling)),a=!0)),a)){a=f;f=f/map.Zoom.nOldZoomX*map.Zoom.nOldZoomY/map.Zoom.nZoomY*map.Zoom.nZoomX;for(var g=map.Layer.objectGroup.childNodes,l=0;l<g.length;l++)if(g.item(l).getAttributeNS(null,"id").match(/featuregroup/)){var h=
g.item(l).style.getPropertyValue("stroke-width")*a;g.item(l).style.setProperty("stroke-width",String(h))}else if(map.antiZoomAndPanList.isContained(g.item(l))){h=g.item(l).childNodes;for(var r=0;r<h.length;r++)h.item(r).firstChild&&h.item(r).firstChild.style.getPropertyValue("stroke-width")&&h.item(r).firstChild.style.setProperty("stroke-width",h.item(r).firstChild.style.getPropertyValue("stroke-width")*a)}else for(h=g.item(l).childNodes,r=0;r<h.length;r++){var C=getMatrix(h.item(r));C&&(C[0]*=a,
C[3]*=f,setMatrix(h.item(r),C))}}}};ixMap.Layer.prototype.doStoredFeatureScaling=function(a){if(map.fFeatureScaling){var f;if(!(a?a.target.ownerDocument:map.SVGDocument).getElementById("mapstyles")){a=[];var g=[];if(f=map.Tiles.getTileInfo())for(var l=0;l<f.length;l++)if(f[l].tileGroup.style.getPropertyValue("display")=="inline"){var h=Number(f[l].tileGroup.getAttributeNS(szMapNs,"deltaTBD"));if(h&&h!=1){var r=f[l].tileGroup.getElementsByTagName("g");for(var C=0;C<r.length;C++)a[a.length]=r.item(C),
g[a.length-1]=h?h:1,f[l].tileGroup.setAttributeNS(szMapNs,"deltaTBD","1")}}for(r=0;r<a.length;r++)a[r].getAttributeNS(null,"id").match(/:label/)||(f=a[r].getAttributeNS(null,"style"))&&f.length&&(f=__scaleLineStyleString(f,g[r]),a[r].setAttributeNS(null,"style",f))}}};ixMap.Layer.prototype.scaleTextOffsets=function(a,f,g,l){for(var h=a.getElementsByTagName("rect"),r=0;r<h.length;r++){var C=h.item(r).getAttributeNS(null,"id");if(C&&C.match(/textbg/)&&(C=h.item(r).nextSibling.nextSibling)&&C.nodeName==
"text")if(C=map.Dom.getBox(C),C.width<0||C.height<0)h.item(r).setAttributeNS(null,"width",0),h.item(r).setAttributeNS(null,"height",0);else{l&&(C.x*=g,C.y*=g,C.width*=g,C.height*=g);var F=map.Scale.normalX(1)*f;h.item(r).setAttributeNS(null,"x",C.x-F);h.item(r).setAttributeNS(null,"y",C.y-F);h.item(r).setAttributeNS(null,"width",C.width+F*2);h.item(r).setAttributeNS(null,"height",C.height+F*2)}}h=a.getElementsByTagName("text");for(r=0;r<h.length;r++)if((C=h.item(r).parentNode.getAttributeNS(null,
"id"))&&C.match(/label/)&&(C=h.item(r),a=C.getAttributeNS(null,"transform"))){a=a.split(" ");for(f=0;f<a.length;f++)a[f].match(/translate/)&&(l=a[f].substr(10,a[f].length-11).split(","),a[f]="translate("+Number(l[0])*g+","+Number(l[1])*g+")");l="";for(f=0;f<a.length;f++)l=l+a[f]+" ";C.setAttributeNS(null,"transform",l)}};ixMap.Layer.prototype.scaleLineDecorations=function(a,f){a=a.getElementsByTagName("text");for(var g=0;g<a.length;g++)if(a.item(g)&&a.item(g).getAttributeNS(null,"id")&&a.item(g).getAttributeNS(null,
"id").match(/linedecoration/)){var l=a.item(g).style.getPropertyValue("dominant-baseline"),h=parseFloat(a.item(g).style.getPropertyValue("baseline-shift")),r=parseFloat(a.item(g).style.getPropertyValue("font-size")),C=0;l=="mathematical"&&(C+=r/3);l=="hanging"&&(C-=r);C-=h*f;a.item(g).setAttributeNS(null,"dy",C)}};ixMap.Layer.prototype.doLabelScaling=function(a){var f=map.SVGDocument.getElementById("mapstyles");if(f){var g=f.firstChild.nextSibling.nodeValue;var l=__scaleTextStyleString(g,a);f.firstChild.nextSibling.nodeValue=
l;map.Scale.fCSSStyleNodeChanged=!0;map.Scale.refreshCSSStyles()}else for(f=map.Scale.canvasNode.getElementsByTagName("g"),g=0;g<f.length;g++)if(!map.antiZoomAndPanList.isContained(f.item(g))){var h=f.item(g).getAttributeNS(null,"id");if(h&&h.length!==0&&h.match(/label/)&&(l=f.item(g).getAttributeNS(null,"style"))&&l.length)if(a===0)map.Layer.switchLayer(null,h,null,f.item(g).style.getPropertyValue("display")=="none"?!0:!1);else{l=__scaleStyleString(l,a);f.item(g).setAttributeNS(null,"style",l);h=
f.item(g).childNodes;for(var r=0;r<h.length;r++)h.item(r).nodeName=="text"&&(l=h.item(r).getAttributeNS(null,"style"))&&l.length&&(l=__scaleStyleString(l,a),h.item(r).setAttributeNS(null,"style",l))}}for(var C in map.Layer.generatedLabelA)if(map.Layer.generatedLabelA[C])for(f=map.Layer.generatedLabelA[C].getElementsByTagName("text"),g=0;g<f.length;g++)(l=f.item(g).getAttributeNS(null,"style"))&&l.length&&(l=__scaleStyleString(l,a),f.item(g).setAttributeNS(null,"style",l));this.adaptLabel(null)};ixMap.Layer.prototype.changeObjectScaling=
function(a,f,g){var l,h;f===0&&(f=1/map.Scale.nObjectScaling);if(g){var r=g.childNodes;for(g=0;g<r.length;g++){if(a=getMatrix(r.item(g)))a[0]*=f,a[3]*=f,setMatrix(r.item(g),a);(l=r.item(g).childNodes[0])&&(a=getMatrix(l))&&(a[4]/=Math.pow(f,.5),a[5]/=Math.pow(f,.5),setMatrix(l,a))}}else if(!(map.Scale.nObjectScaling*f>8||map.Scale.nObjectScaling*f<.1))for(map.Scale.nObjectScaling*=f,l=map.Layer.objectGroup.childNodes,g=0;g<l.length;g++)if(!map.antiZoomAndPanList.isContained(l.item(g)))for(r=l.item(g).childNodes,
h=0;h<r.length;h++)if(a=getMatrix(r.item(h)))a[0]*=f,a[3]*=f,setMatrix(r.item(h),a)};ixMap.Layer.prototype.setObjectRotate=function(a,f,g){var l;if(g){var h=g.childNodes;for(g=0;g<h.length;g++)setRotate(h.item(g),(360+Number(f))%360)}else for(a=map.Layer.objectGroup.childNodes,g=0;g<a.length;g++)if(!map.antiZoomAndPanList.isContained(a.item(g)))for(h=a.item(g).childNodes,l=0;l<h.length;l++)setRotate(h.item(l),(360+Number(f))%360)};ixMap.Layer.prototype.setPatternRotate=function(a,f,g){g||(g=map.SVGRootElement);
a=g.getElementsByTagName("pattern");for(g=0;g<a.length;g++)a.item(g).getAttributeNS(null,"id").match(/antizoomandpan/)||setRotate(a.item(g),(360+Number(f))%360,"patternTransform")};ixMap.Layer.prototype.setSymbolRotate=function(a,f,g){if(a=map.SVGDocument.getElementById("marker_symbols"))for(a=a.childNodes,g=0;g<a.length;g++)if(a.item(g).nodeType==1){var l=a.item(g).getAttributeNS(null,"id");l&&l.length&&!l.match(/antizoomandpan/)&&(setRotate(a.item(g),(360+Number(f))%360),map.Scale.rotatedSymbolsA["#"+
l]=!0)}if(a=map.SVGDocument.getElementById("symbolstore"))for(a=a.getElementsByTagName("g"),g=0;g<a.length;g++)(l=a.item(g).getAttributeNS(null,"id"))&&l.length&&l.match(/symbol/)&&!l.match(/antizoomandpan/)&&(setRotate(a.item(g),(360+Number(f))%360),map.Scale.rotatedSymbolsA["#"+l]=!0);a=map.SVGDocument.getElementById("widgets:antizoomandpan").getElementsByTagName("use");for(g=0;g<a.length;g++)l=a.item(g).getAttributeNS(szXlink,"href"),map.Scale.rotatedSymbolsA[l]&&setRotate(a.item(g),(360+Number(-f))%
360);a=map.SVGHiddenGroup.getElementsByTagName("use");for(g=0;g<a.length;g++)l=a.item(g).getAttributeNS(szXlink,"href"),map.Scale.rotatedSymbolsA[l]&&setRotate(a.item(g),(360+Number(-f))%360)};ixMap.Layer.prototype.changeObjectRotate=function(a,f,g){if(g){var l=g.childNodes;for(g=0;g<l.length;g++){var h=getRotateAttributeValue(l.item(g));setRotate(l.item(g),(360+Number(h)+Number(f))%360)}}else for(a=map.Layer.objectGroup.childNodes,g=0;g<a.length;g++)if(!map.antiZoomAndPanList.isContained(a.item(g)))for(l=
a.item(g).childNodes,g=0;g<l.length;g++)h=getRotateAttributeValue(l.item(g)),setRotate(l.item(g),(360+Number(h)+Number(f))%360)};ixMap.Layer.prototype.setLabelRotate=function(a,f){var g;a=map.Layer.layerNode.getElementsByTagName("text");for(g=0;g<a.length;g++)map.antiZoomAndPanList.isContained(a.item(g))||a.item(g).firstChild&&a.item(g).firstChild.nodeName=="textPath"||setRotate(a.item(g),(360+Number(f))%360);this.adaptLabel()};ixMap.Layer.prototype.changeLabelRotate=function(a,f){var g;a=map.Scale.canvasNode.getElementsByTagName("text");
for(g=0;g<a.length;g++)if(!(map.antiZoomAndPanList.isContained(a.item(g))||a.item(g).firstChild&&a.item(g).firstChild.nodeName=="textPath")){var l=getRotateAttributeValue(a.item(g));setRotate(a.item(g),(360+Number(l)+Number(f))%360)}this.adaptLabel()};ixMap.Layer.prototype.adaptLabel=function(a,f){map.fAdaptLabelToScaling&&this.adaptLabelToScaling(a,f);if(map.fCheckLabelOverlap||map.fCheckLabelSpace||map.fCheckLabelSqueeze)f&&this.prepareCheckOverlap(a,f),this.checkLabelOverlapping(a,f)};ixMap.Layer.prototype.adaptLabelToScaling=
function(a,f){f||(f=map.SVGRootElement);if(map.fAdaptLabelToScaling||map.fCheckLabelOnlyOne){a=!1;for(var g in map.Layer.listA){var l=map.Layer.listA[g];l.nRenderer&12&&l.szType=="line"&&l.szDisplayLabel=="inline"&&(a=!0)}if(a){f=f.getElementsByTagName("textPath");if(map.Scale.oldZoomScale!=map.Scale)for(g=0;g<f.length;g++)f.item(g).parentNode.getAttributeNS(null,"id").match(/:linedecoration/)||f.item(g).parentNode.style.setProperty("display","none","");map.Label.fAdaptLabelToScalingPending||(map.Label.fAdaptLabelToScalingPending=
!0,map.fAdaptLabelToScaling=="delayed"?map.pushAction(()=>{setTimeout(()=>{map.Label.adaptLabelToScaling(null)},1500)}):map.pushAction(()=>{map.Label.adaptLabelToScaling(null,null)}))}}};ixMap.Layer.prototype.checkLabelOverlapping=function(a,f){if(map.fCheckLabelOverlap||map.fCheckLabelSpace||map.fCheckLabelSqueeze)f||(f=map.Layer.layerNode),f||(f=map.Scale.canvasNode),map.Label.initCheckOverlap(f)};ixMap.Layer.prototype.prepareCheckOverlap=function(a,f){if(map.fCheckLabelOverlap||map.fCheckLabelSpace)f||
(f=map.Layer.layerNode),f||(f=map.Scale.canvasNode),map.Label.prepareCheckOverlap(f)};ixMap.Layer.prototype.addChangedFeatureNode=function(a){var f;if(this.changedFeatureNodesA){for(f=0;f<this.changedFeatureNodesA.length;f++)if(this.changedFeatureNodesA[f]==a)return;this.changedFeatureNodesA[this.changedFeatureNodesA.length]=a}};ixMap.Layer.prototype.isChangedFeature=function(a){var f;if(this.changedFeatureNodesA)for(f=0;f<this.changedFeatureNodesA.length;f++)if(map.Tiles.getMasterId(this.changedFeatureNodesA[f].getAttributeNS(null,
"id"))==a)return!0;return!1};ixMap.Layer.prototype.removeChangedFeatures=function(a){var f,g;if(this.changedFeatureNodesA)for(f=0;f<this.changedFeatureNodesA.length;f++)if(map.Tiles.getMasterId(this.changedFeatureNodesA[f].getAttributeNS(null,"id"))==a){this.changedFeatureNodesA[f].setAttributeNS(null,"style","");for(g=f;g<this.changedFeatureNodesA.length-1;g++)this.changedFeatureNodesA[g]=this.changedFeatureNodesA[g+1];this.changedFeatureNodesA.length--;f--}};ixMap.Layer.prototype.setPointerEvents=
function(a){for(var f in map.Layer.listA){var g=map.Layer.listA[f].szName;if(g){var l=map.SVGDocument.getElementById(g);g=a==null||a==g?null:"none";l&&(g?l.style.setProperty("pointer-events",g,""):l.style.removeProperty("pointer-events"))}}};ixMap.Layer.prototype.getLayerObj=function(a){if(!a)return null;var f=a.split("#")[0].split(":")[0];f=="legend"&&(f=a.split(":")[2]);return this.listA[f]};ixMap.Layer.prototype.getLayerName=function(a){return(a=this.getLayerObj(a))?a.szName:null};ixMap.Layer.prototype.getLayerObjOfNode=
function(a){if(a)for(;a.parentNode&&a.parentNode.nodeName!="SVG";){var f=this.getLayerObj(a.getAttributeNS(null,"id"));if(f)return f;a=a.parentNode}return null};ixMap.Layer.prototype.getLayerItemNodeOfNode=function(a){for(;a.parentNode&&a.parentNode.nodeName!="SVG";){if(this.getLayerObj(a.getAttributeNS(null,"id")))return a;a=a.parentNode}return null};ixMap.Layer.prototype.getLayerItemNodes=function(a){if(a=this.getLayerItemNodeOfNode(a)){var f=a.getAttributeNS(null,"id");return this.getLayerObj(f).szType==
"point"&&map.fTileTextNoClip||map.Tiles.getMasterId(f)==f?Array(a):map.Tiles.getTileNodes(map.Tiles.getMasterId(f))}return[]};ixMap.Layer.prototype.getStyleOrClass=function(a){var f={};f.szClass=map.Dom.getAttributeByNodeOrParents(a,null,"class");f.szStyle=map.Dom.getAttributeByNodeOrParents(a,null,"style");return f};ixMap.Layer.prototype.isMapObject=function(a){for(;a;){if(a==map.Scale.canvasNode)return!0;a=a.parentNode}return!1};ixMap.Layer.prototype.isLoaded=function(a){return(a=this.getLayerObj(a))?
a.szFlag.match(/tiled/)?map.Tiles.isAnyLayerTileLoaded():!0:!1};ixMap.Label=function(a){this.document=a?a.target.ownerDocument:map.SVGDocument;this.checkItemA=[];this.checkOvlA=[];this.nodeA=[];this.boxA=[];this.rootNode=null;this.zoomScale=0;this.fCheckLabelOverlappingPending=!1;this.ALTS_rootNode=this.ALTS_nodeA=this.ALTS_textA=null;this.killProcess=this.fAdaptLabelToScalingPending=!1};ixMap.Label.prototype=new Map;ixMap.Label.Item=function(a){if(a)this.textNode=a,this.szId=a.getAttributeNS(null,
"id")||"noId",this.bgNode=map.SVGDocument.getElementById(this.szId+":bg"),this.bbNode=map.SVGDocument.getElementById(this.szId+":textbg"),this.poNode=map.SVGDocument.getElementById(this.szId.slice(0,this.szId.length-1)),this.poNode||(a=map.Tiles.getMasterId(this.szId),a=a.slice(0,a.length-1),this.poNode=map.SVGDocument.getElementById(a)),this.bBox=null;else return this.szId="mapLabelNullItem",null};ixMap.Label.Item.prototype.setDisplay=function(a){this.textNode.style.setProperty("display",a,"");this.bgNode&&
this.bgNode.style.setProperty("display",a,"");this.bbNode&&this.bbNode.style.setProperty("display",a,"");this.poNode&&this.poNode.nodeName=="use"&&this.poNode.style.setProperty("display",a,"")};ixMap.Label.Item.prototype.setScale=function(a,f){setScale(this.textNode,a,f);this.bgNode&&setScale(this.bgNode,a,f);this.bbNode&&setScale(this.bbNode,a,f)};ixMap.Label.Item.prototype.scaleBackground=function(){if(this.bbNode&&this.textNode){var a=map.Scale.normalX(2)*map.Scale.nZoomScale,f=map.Dom.getBox(this.textNode),
g=getTranslateAttributeValue(this.textNode);f.width>0&&f.height>0&&(this.bbNode.setAttributeNS(null,"x",f.x+(g.x?g.x-a:0)),this.bbNode.setAttributeNS(null,"y",f.y-a+g.y),this.bbNode.setAttributeNS(null,"width",f.width+a*2),this.bbNode.setAttributeNS(null,"height",f.height+a*2))}};ixMap.Label.prototype.stopProcessing=function(){this.killProcess=!0};ixMap.Label.prototype.prepareCheckOverlap=function(a){a=a.getElementsByTagName("text");for(var f=0;f<a.length;f++)a.item(f).firstChild&&a.item(f).firstChild.nodeName!=
"textPath"&&!a.item(f).getAttributeNS(null,"id").match(/:bg/)&&(new ixMap.Label.Item(a.item(f))).setDisplay("none")};ixMap.Label.prototype.initCheckOverlap=function(a){this.killProcess=!1;this.fCheckLabelOverlappingPending||(this.fCheckLabelOverlappingPending=!0,this.checkItemA.length=0,this.checkOvlA.length=0,this.nodeA.length=0,this.boxA.length=0,this.rootNode=a,map.fPDFEmbed||!map.Tiles.dataNode?setTimeout(()=>{map.Label.collectCheckOverlap()},0):map.pushAction(()=>{map.Label.collectCheckOverlap()}))};
ixMap.Label.prototype.getCheckItem=function(a){return this.checkItemA[a]};ixMap.Label.prototype.getCheckItemCount=function(){return this.checkItemA.length};ixMap.Label.prototype.addCheckItem=function(a,f){if(a){var g=map.Layer.getLayerObjOfNode(a);if(g&&(!g||a.parentNode.getAttributeNS(null,"id").match(/value/)||g.szDisplayLabel=="inline")&&(map.fCheckLabelOverlap||g.szType=="polygon")&&a.firstChild&&a.firstChild.nodeName!="textPath"&&!a.getAttributeNS(null,"id").match(/:bg/)){var l=getMatrix(a);
l=new point(Number(l[4]),Number(l[5]));var h=map.Scale.getMapOffset(a);l.x+=h.x;l.y+=h.y;l.x<this.zoomBox.x||l.x>this.zoomBox.x+this.zoomBox.width||l.y<this.zoomBox.y||l.y>this.zoomBox.y+this.zoomBox.height||(a=new ixMap.Label.Item(a),a.fRef=g&&g.szType=="polygon"?!0:!1,a.fScale=f,this.checkItemA[this.checkItemA.length]=a)}}else a=new ixMap.Label.Item(null),this.checkItemA[this.checkItemA.length]=a};ixMap.Label.prototype.collectCheckOverlap=function(){var a=!1,f=[],g;for(g in map.Layer.listA)map.Layer.listA[g].szType==
"polygon"&&f.push(g);map.fCheckOverlapAllLayer||f.push("resetoverlap");for(g in map.Layer.listA)map.Layer.listA[g].szType!="polygon"&&f.push(g);this.zoomBox=map.Zoom.getBox();for(g=f.length-1;g>=0;g--)if(f[g]=="resetoverlap")this.addCheckItem(null);else{var l=map.Layer.listA[f[g]];if(l.szFlag.match(/tiled/)){if(!a&&(a=!0,l=map.Tiles.getTileInfo())){this.addCheckItem(null);for(var h=0;h<l.length;h++)if(l[h].tileGroup.style.getPropertyValue("display")=="inline"){var r=l[h].tileGroup.getElementsByTagName("text");
for(var C=r.length-1;C>=0;C--)r.item(C).parentNode.style.getPropertyValue("display")!="none"&&this.addCheckItem(r.item(C));map.fCheckOverlapClipOnTiles&&this.addCheckItem(null)}}}else if(l.szName){if(h=map.SVGDocument.getElementById(l.szName+":label"))if((C=h.getElementsByTagName("g"))&&C.length>0)for(var F=0;F<C.length;F++){if(r=C.item(F).getElementsByTagName("text"),r.length)for(h=r.length-1;h>=0;h--)this.addCheckItem(r.item(h))}else if(r=h.getElementsByTagName("text"),r.length)for(h=r.length-1;h>=
0;h--)this.addCheckItem(r.item(h));if(h=map.SVGDocument.getElementById(l.szName+":values"))if(r=h.getElementsByTagName("text"),r.length)for(h=r.length-1;h>=0;h--)this.addCheckItem(r.item(h))}}a=map.Themes.getTextObjects();for(h=0;h<a.length;h++)this.addCheckItem(a[h],!0);this.zoomScale=map.Scale.nZoomScale;this.checkItemA.length?setTimeout("map.Label.getBoxCheckOverlap(0)",100):this.fCheckLabelOverlappingPending=!1};ixMap.Label.prototype.getBoxCheckOverlap=function(a){var f=new ixMap.Sleep("map.Label.getBoxCheckOverlap",
this.nflushLabelDraw,"");for(_STATUS("ixMap.Label: getBoxCheckOverlap ==== "+a+" ====== >>>");a>=0;a++){if(this.killProcess){this.fCheckLabelOverlappingPending=this.killProcess=!1;break}if(f.checkSleep(a,10))break;var g=this.getCheckItem(a);if(g)if(g.szId=="mapLabelNullItem"&&map.fCheckOverlapImplicit)this.nodeA.length=0;else try{g.szOldDisplay=g.textNode.style.getPropertyValue("display");g.textNode.style.setProperty("display","inline","");g.setScale(1,1);g.textNode.setAttributeNS(null,"x",0);g.textNode.setAttributeNS(null,
"y",0);g.bgNode&&(g.bgNode.style.setProperty("display","inline",""),g.bgNode.setAttributeNS(null,"x",0),g.bgNode.setAttributeNS(null,"y",0));var l=map.Dom.getBox(g.textNode);g.fScale&&(l.x*=map.Layer.nFeatureScale,l.y*=map.Layer.nFeatureScale,l.width*=map.Layer.nFeatureScale,l.height*=map.Layer.nFeatureScale);var h=map.Scale.getMapOffset(g.textNode);l.x+=h.x;l.y+=h.y;h=getTranslate(g.textNode);l.x+=h.x;l.y+=h.y;if(map.Zoom.isVisibleBox(l)&&this.checkLabelSpace(g,l)){getRotateAttributeValue(g.textNode)>
15&&getRotateAttributeValue(g.textNode)<345&&g.setScale(1,1);g.bBox=l;var r=this.nodeA.length;this.checkOvlA[r]=g;this.nodeA[r]=g.textNode;this.boxA[r]=l;map.fCheckLabelOverlap||(g.setDisplay("inline"),g.scaleBackground());map.fCheckOverlapImplicit&&this.execCheckLabelOverlappingOne(r)}else g.setDisplay("none")}catch(C){}else{map.fCheckOverlapImplicit?this.fCheckLabelOverlappingPending=!1:setTimeout("map.Label.doCheckOverlap()",100);break}}};ixMap.Label.prototype.checkLabelSpace=function(a,f){if(!a.fRef)return!0;
if(a.szId.match(/#/)){var g=a.szId.split("#");g=g[0].substr(0,g[0].length-1)+"#"+g[1]}else g=a.szId.substr(0,a.szId.length-1);if(g=map.SVGDocument.getElementById(g))if(a.refBox=map.Dom.getBox(g),g=a.refBox,g.width*=map.nCheckLabelSpace,f.width>g.width&&map.fAdaptLabelToScaling){var l=1;map.fCheckLabelSqueeze&&(f.width<=g.width*2||!map.fCheckLabelSpace)&&(l=Math.max(.7,g.width/f.width),f.width*=l,a.setScale(l,1));if(map.fCheckLabelSize&&(f.width<=g.width*1.5||!map.fCheckLabelSpace)){var h=Math.max(.7,
g.width/f.width);f.width*=h;f.height*=h;a.setScale(l*h,h)}if(!map.fCheckLabelSpace||f.width<=g.width)a.setDisplay("inline");else return a.setDisplay("none"),!1}else a.setDisplay("inline");else a.setDisplay(a.szOldDisplay);return!0};ixMap.Label.prototype.doCheckOverlap=function(){map.fCheckLabelOverlap?this.nodeA.length>2E4?(this.checkOvlA.length=0,this.nodeA.length=0,this.boxA.length=0):(this.zoomScale=map.Scale.nZoomScale,map.fCheckLabelOverlap=="delayed"?setTimeout(()=>{map.Label.execCheckLabelOverlappingOnly(0)},
2E3):map.pushAction(()=>{map.Label.execCheckLabelOverlappingOnly(0)})):this.fCheckLabelOverlappingPending=!1};ixMap.Label.prototype.execCheckLabelOverlappingOnly=function(a){for(var f=new ixMap.Sleep("map.Label.execCheckLabelOverlappingOnly",25,"");a<this.checkOvlA.length;a++){if(this.killProcess){this.fCheckLabelOverlappingPending=this.killProcess=!1;return}if(f.checkSleep(a,10))return;this.execCheckLabelOverlappingOne(a)}this.fCheckLabelOverlappingPending=!1};ixMap.Label.prototype.execCheckLabelOverlappingOne=
function(a){var f=this.checkOvlA[a];if(map.Zoom.isVisibleBox(f.bBox)){f.refBox||f.setDisplay("inline");if(map.fCheckLabelOverlap)for(var g=f.textNode.firstChild.nodeValue,l=f.bBox,h=Number(f.textNode.getAttributeNS(szMapNs,"pos")),r=!1,C=0;C<a;C++){var F=this.checkOvlA[C].textNode.firstChild.nodeValue,v=this.checkOvlA[C].bBox;if(map.fCheckLabelOnlyOne&&g==F){F=Number(f.textNode.getAttributeNS(szMapNs,"partlen"));var E=Number(this.checkOvlA[C].textNode.getAttributeNS(szMapNs,"partlen"));if(F>E){this.checkOvlA[C].bBox=
null;this.checkOvlA[C].setDisplay("none");continue}f.setDisplay("none");f.bBox=null}if(F=l&&v&&f.textNode!=this.checkOvlA[C].textNode&&map.Tiles.getMasterId(f.szId)!=map.Tiles.getMasterId(this.checkOvlA[C].szId))F=l&&v?l.x+l.width<v.x||l.x>v.x+v.width||l.y+l.height<v.y||l.y>v.y+v.height?!1:!0:!1;if(F){if(r){v.height<l.height&&(f.refBox||!this.checkOvlA[C].refBox)?(this.checkOvlA[C].bBox=null,map.fKillOverlappingLabel&&this.checkOvlA[C].setDisplay("none")):(f.bBox=null,map.fKillOverlappingLabel&&f.setDisplay("none"));
break}if(f.fRef)l.y>v.y?(f.textNode.setAttributeNS(null,"y",l.height),f.bgNode&&f.bgNode.setAttributeNS(null,"y",l.height),l.y+=l.height):(f.textNode.setAttributeNS(null,"y",-l.height),f.bgNode&&f.bgNode.setAttributeNS(null,"y",-l.height),l.y-=l.height);else if(F=parseInt(f.textNode.style.getPropertyValue("font-size"))||14,l.y>=v.y&&(h===11||h===12||h===1||h===9||h===3||h===0))f.textNode.setAttributeNS(null,"y",F),f.bgNode&&f.bgNode.setAttributeNS(null,"y",F),l.y+=parseInt(F);else if(l.y<=v.y&&(h===
7||h===6||h===5||h===9||h===3||h===0))f.textNode.setAttributeNS(null,"y",-l.height),f.bgNode&&f.bgNode.setAttributeNS(null,"y",-l.height),l.y-=l.height;else if(l.x<=v.x&&(h==1||h==3||h==5))f.textNode.setAttributeNS(null,"x",-(l.width+50*map.Scale.nZoomScale)),f.bgNode&&f.bgNode.setAttributeNS(null,"x",-(l.width+50*map.Scale.nZoomScale)),l.x-=l.width+50*map.Scale.nZoomScale;else if(l.x>=v.x&&(h==11||h==9||h==7))f.textNode.setAttributeNS(null,"x",+(l.width+50*map.Scale.nZoomScale)),f.bgNode&&f.bgNode.setAttributeNS(null,
"x",+(l.width+50*map.Scale.nZoomScale)),l.x+=l.width+50*map.Scale.nZoomScale;else if(v.height<l.height&&(f.refBox||!this.checkOvlA[C].refBox)){this.checkOvlA[C].bBox=null;this.checkOvlA[C].setDisplay("none");continue}r=!0;C=0}}f.bbNode&&f.scaleBackground()}};ixMap.Label.prototype.adaptLabelToScaling=function(a,f){this.killProcess=!1;f||(f=map.SVGRootElement);this.fAdaptLabelToScalingPending=!1;this.ALTS_nodeA=[];this.ALTS_textA=[];this.ALTS_rootNode=f;a=this.ALTS_nodeA;f=null;var g=map.Tiles.getTileInfo();
if(g)for(var l=0;l<g.length;l++)if(g[l].tileGroup.style.getPropertyValue("display")=="inline"){f=g[l].tileGroup.getElementsByTagName("textPath");for(var h=0;h<f.length;h++)f.item(h).parentNode.getAttributeNS(null,"id").match(/:bg/)||f.item(h).parentNode.getAttributeNS(null,"id").match(/:linedecoration/)||(a[a.length]=f.item(h))}if(a==null||a.length===0)for(f=map.SVGRootElement.getElementsByTagName("textPath"),l=0;l<f.length;l++)f.item(l).parentNode.getAttributeNS(null,"id").match(/:bg/)||f.item(l).parentNode.getAttributeNS(null,
"id").match(/:linedecoration/)||(a[a.length]=f.item(l));map.pushAction(()=>{map.Label.execAdaptLabelToScaling(0)})};ixMap.Label.prototype.execAdaptLabelToScaling=function(a){for(var f=new ixMap.Sleep("map.Label.execAdaptLabelToScaling",25,""),g=this.ALTS_nodeA,l=this.ALTS_rootNode,h;a<g.length&&!f.checkSleep(a,10);a++){var r=g[a].getAttributeNS(szXlink,"href");r=r.substr(1,r.length-1);var C=l.getElementById(r);if(C){var F=C.parentNode.getAttributeNS(null,"id");h=map.Tiles.getMasterId(F);F=map.Tiles.getTileId(F);
if(map.Layer.isScaleDependentLayerOn(h)===!1)g[a].parentNode.style.setProperty("display","none","");else if(h=g[a].firstChild.nodeValue,!(this.ALTS_textA[h+F]&&map.Tiles.getTileNodes(map.Tiles.getMasterId(r)).length<=1)){var v=map.Dom.getBox(C);g[a].setAttributeNS(szXlink,"href","");g[a].parentNode.style.setProperty("display","inline","");g[a].parentNode.style.setProperty("font-stretch","normal","");var E=map.Dom.getBox(g[a].parentNode);g[a].setAttributeNS(szXlink,"href","#"+r);E=Math.sqrt(E.width*
E.width+E.height*E.height);var M=Math.sqrt(v.width*v.width+v.height*v.height),G=g[a].parentNode,I=map.SVGDocument.getElementById(G.getAttributeNS(null,"id")+":bg");I&&I.style.setProperty("display","inline","");if(E*.9<M){if(E*1.3<M?(G.style.setProperty("font-stretch","normal",""),I&&I.style.setProperty("font-stretch","normal","")):(G.style.setProperty("font-stretch","narrower",""),I&&I.style.setProperty("font-stretch","narrower","")),map.fCheckLabelOnlyOne){var ea=map.Scale.getMapOffset(C);v.x+=ea.x;
v.y+=ea.y;ea=getTranslate(C);v.x+=ea.x;v.y+=ea.y;C=new box(v.x,v.y,v.width,v.height);C.scale(E/M,E/M);map.Zoom.isCompletelyVisibleBox(C)?map.fTileTextNoClip?this.ALTS_textA[h]=r:this.ALTS_textA[h+F]=r:(G.style.setProperty("display","none",""),I&&I.style.setProperty("display","none",""))}}else G.style.setProperty("display","none",""),I&&I.style.setProperty("display","none","")}}}};ixMap.Label.prototype.getLabel=function(a){if(!map.SVGDocument.getElementById(a)){var f=map.Tiles.getTileNodes(map.Tiles.getMasterId(a));
if(f.length<1)return null;for(var g=0;g<f.length;g++){var l=this.getLabel(f[g].getAttributeNS(null,"id"));if(l)return l}}a=map.SVGDocument.getElementById(a);if(!a)return null;if(a.tagName=="g")for(f=a.childNodes,g=0;g<f.length;g++)if(f.item(g).nodeType==1){a=f.item(g);break}if(f=a.getAttributeNS(null,"id"))if(f.match(/#/)?(f=f.split("#"),f=map.SVGDocument.getElementById(f[0]+"T#"+f[1])):f=map.SVGDocument.getElementById(f+"T"),f)return f.firstChild.nodeValue;return a.getAttributeNS(szMapNs,"tooltip")};
ixMap.Sleep=function(a,f,g){this.szFunction=a;this.initCheckSleep(f,g);this.fShowProgressBar=this.fEnableProgressBar=!1;this.nCount=0;this.szCancel="__cancelSleep()"};ixMap.Sleep.prototype.initCheckSleep=function(a,f){this.checkSleepMaxCount=a;this.checkSleepCount=0;this.checkSleepMessage=f;this.runningTime=0;this.fShowProgressBar=this.fMessageDisplay=!1;typeof this.checkSleepMessage=="string"&&this.checkSleepMessage.length&&(map.fExecuteSilent||displayMessage(this.checkSleepMessage,1E3));__timer_reset()};
ixMap.Sleep.prototype.checkSleep=function(a,f){return this.checkSleepMaxCount&&this.checkSleepCount++>=this.checkSleepMaxCount?(this.checkSleepCount=0,a=this.szFunction+"('"+String(a)+"')",this.fShowProgressBar?(this.runningTime=__timer_getSEC(),executeWithProgressBar(a,this.nDoneCount,this.nCount,this.checkSleepMessage,this.szCancel,this.runningTime)):(this.fMessageDisplay||(map.fExecuteSilent||displayMessage(this.checkSleepMessage,1E3),this.fMessageDisplay=!0),setTimeout(a,f?f:1)),!0):!1};ixMap.Sleep.prototype.checkSleepMS=
function(a,f){return this.checkSleepMaxCount&&__timer_getMS()>this.checkSleepMaxCount?(__timer_reset(),setTimeout(this.szFunction+"('"+String(a)+"')",f?f:1),!0):!1};ixMap.Tiles=function(){var a=map.SVGDocument.getElementsByTagNameNS(szMapNs,"tiles");a.length&&(this.tilesNode=map.SVGDocument.getElementsByTagNameNS(szMapNs,"maptiles"),this.dataNode=a.item(0),this.nCount=this.dataNode.getAttributeNS(null,"count"),this.tileWidth=this.dataNode.getAttributeNS(null,"width"),this.tileHeight=this.dataNode.getAttributeNS(null,
"height"),this.tilesRoot=this.dataNode.getAttributeNS(null,"root").split(".")[0],this.tilesSuffix=this.dataNode.getAttributeNS(null,"root").split(".")[1],this.depUpper=this.dataNode.getAttributeNS(null,"upper"),this.depLower=this.dataNode.getAttributeNS(null,"lower"),map.fMarkTiles&&this.markTiles(),this.xLoader=null,this.fDiscardPending=!1)};ixMap.Tiles.prototype=new Map;ixMap.Tiles.prototype.getTileNodes=function(a){var f=[];a=this.getTileNodeIds(a);for(var g=0;g<a.length;g++){var l=map.SVGDocument.getElementById(a[g]);
l&&(f[f.length]=l)}return f};ixMap.Tiles.prototype.getTileNodeIds=function(a){var f=a.split(":");a=f[0];for(var g="",l=1;l<f.length;l++)g+=":"+f[l];f=[];for(l=0;l<this.nCount;l++)for(var h=0;h<this.nCount;h++)f[f.length]=a+"#"+this.buildTileExtension(h,l)+g;return f};ixMap.Tiles.prototype.getTilePositions=function(){for(var a=map.Scale.origMinX,f=map.Scale.origMinY,g=[],l=0;l<this.nCount;l++)for(var h=0;h<this.nCount;h++)if(h<this.nCount&&l<this.nCount){var r=new box(a+h*this.tileWidth,f+l*this.tileHeight,
this.tileWidth,this.tileHeight);g[g.length]=r}return g};ixMap.Tiles.prototype.getTileBox=function(a){var f=a.split("#")[1];if(f==null||f.length<=0)return null;a=Number(f.substr(0,3));f=Number(f.substr(3,3));return new box(f*this.tileWidth-map.Scale.mapOffset.x,a*this.tileHeight-map.Scale.mapOffset.x,this.tileWidth,this.tileHeight)};ixMap.Tiles.prototype.getTileInfo=function(){for(var a=map.Scale.origMinX,f=map.Scale.origMinY,g=[],l=1,h=Math.floor(this.nCount/2);h<=this.nCount&&h>=0;){for(var r=1,
C=Math.floor(this.nCount/2);C<=this.nCount&&C>=0;){if(C<this.nCount&&h<this.nCount){var F=this.tilesRoot+"_"+this.buildTileExtension(C,h)+"."+this.tilesSuffix,v="tile"+this.buildTileExtension(C,h),E=map.SVGDocument.getElementById(v),M=new box(a+C*this.tileWidth,f+h*this.tileHeight,this.tileWidth,this.tileHeight);g[g.length]={szUrl:F,szGroup:v,tileGroup:E,x:C,y:h,bBox:M};F=this.tilesRoot+"_"+this.buildTileExtension(C,h)+"_ncl."+this.tilesSuffix;v="tile"+this.buildTileExtension(C,h)+":noclip";(E=map.SVGDocument.getElementById(v))&&
(g[g.length]={szUrl:F,szGroup:v,tileGroup:E,x:C,y:h,bBox:M})}C+=r;r=Math.abs(r)+1;(r&1)===0&&(r=-r)}h+=l;l=Math.abs(l)+1;(l&1)===0&&(l=-l)}a=g.length;l=f=0;for(var G in g)g[G].tileGroup&&(g[G].tileGroup.hasChildNodes()&&f++,g[G].tileGroup.style.getPropertyValue("display")=="inline"&&l++);_STATUS("Tiling: "+a+"/"+f+"/"+l);return g};ixMap.Tiles.prototype.getMasterId=function(a){if(a==null)return null;a=a.split(":");for(var f=a[0].split("#")[0],g=1;g<a.length;g++)f+=":"+a[g];a.length=0;return f};ixMap.Tiles.prototype.getTileId=
function(a){if(a==null)return null;a=a.split(":");var f=a[0];a.length=0;return f};ixMap.Tiles.prototype.buildTileExtension=function(a,f){return __maptheme_formatpart(f,"0")+__maptheme_formatpart(a,"0")};ixMap.Tiles.prototype.setShapeStyle=function(a,f){if(a&&this.nCount&&(a=new MapObject(a),a!=null)){a=this.getMasterId(a.szId);var g=a.split(":")[0];a=a.substr(g.length,a.length-g.length);g=this.getTileNodeIds(g);for(var l=0;l<g.length;l++){var h=map.SVGDocument.getElementById(g[l]+a);h&&h.setAttributeNS(null,
"style",f)}}};ixMap.Tiles.prototype.markTiles=function(){var a=map.SVGDocument.getElementById("maptilesbg");if(a)for(var f=0;f<this.nCount;f++)for(var g=0;g<this.nCount;g++)map.Dom.newShape("rect",a,-this.tileWidth*this.nCount/2+g*this.tileWidth,-this.tileHeight*this.nCount/2+f*this.tileHeight,this.tileWidth,this.tileHeight,"fill:none;stroke:gray;stroke-width:0.01")};ixMap.Tiles.prototype.switchScaleDependentTiles=function(a){if(map.fDynamicTiles&&!this.clearTiles(a)){var f=!1;if(this.nCount>0){getMatrix(map.Zoom.canvasNode);
var g=map.Scale.origMinX,l=map.Scale.origMinY,h=map.Zoom.getBox(),r=this.getTileInfo();if(r)for(var C=0;C<r.length;C++){var F=r[C].szUrl,v=r[C].szGroup,E=r[C].x,M=r[C].y,G=r[C].bBox,I=r[C].tileGroup;I&&((E=new box(g+E*this.tileWidth,l+M*this.tileHeight,this.tileWidth,this.tileHeight),E.x==G.x&&E.y==G.y&&E.width==G.width&&E.height==G.height||alert("switchScaleDependentTiles box error !!"),E.x+E.width<h.x||E.y+E.height<h.y||E.x>h.x+h.width||E.y>h.y+h.height)?I.hasChildNodes()&&(I.getAttributeNS(szMapNs,
"type")=="external"?(I.style.setProperty("display","none",""),map.fDiscardTiles&&map.fDiscardTiles!="delayed"&&(map.Themes.removeFromThemeNodesCache(I),map.Dom.clearGroup(I))):I.style.setProperty("display","none","")):I.hasChildNodes()||I.getAttributeNS(szMapNs,"type")!="external"?I.style.getPropertyValue("display")!="inline"&&(I.style.setProperty("display","inline",""),f=!0,map.fAdaptLabelToScaling&&map.Layer.adaptLabelToScaling(a,I)):(I.style.setProperty("display","inline",""),setTimeout("map.Tiles.loadScaleDependentTiles('"+
v+"','"+F+"')",10)))}}map.fDiscardTiles=="delayed"&&this.discardTiles();f&&(map.Layer.adaptLabel(a,map.Layer.layerNode),map.Layer.doStoredFeatureScaling())}};ixMap.Tiles.prototype.loadScaleDependentTiles=function(a,f){_STATUS("Loading Tile:"+f+","+a);a=map.SVGDocument.getElementById(a);this.xLoader||(this.xLoader=new SVGLoaderTiles);this.xLoader.importSVGFile(f,map.SVGDocument,a,null)&&(map.fTilesLoaded=!0)};ixMap.Tiles.prototype.isLoading=function(){return this.xLoader?this.xLoader.isLoading():!1};
ixMap.Tiles.prototype.clearTiles=function(a){if(!map.fDynamicTiles)return!1;try{for(var f in map.Layer.listA){var g=map.Layer.listA[f];if(g.szFlag.match(/tiled/)&&map.Themes.isThemeLayerUsed(g.szName)&&map.Layer.isScaleDependentLayerOn(g.szName))return!1}}catch(h){}if(this.nCount>0){a=1E11;f=0;g=this.depUpper;var l=this.depLower;g&&g.length&&(a=Number(g.split(":")[1]));l&&l.length&&(f=Number(l.split(":")[1]));if(map.Scale.nTrueMapScale*map.Scale.nZoomScale>=f&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=
a)return!1;if(a=this.getTileInfo())for(f=0;f<a.length;f++)(g=a[f].tileGroup)&&g.hasChildNodes()&&(g.style.setProperty("display","none",""),map.fDiscardTiles&&map.fDiscardTiles!="delayed"&&(map.Themes.removeFromThemeNodesCache(g),map.Dom.clearGroup(g)))}map.fDiscardTiles=="delayed"&&this.discardTiles();return!0};ixMap.Tiles.prototype.discardTiles=function(a){map.fTilesLoaded&&map.fDiscardTiles&&!this.fDiscardPending&&(setTimeout("map.Tiles.doDiscardTiles()",5E3),this.fDiscardPending=!0)};ixMap.Tiles.prototype.doDiscardTiles=
function(a){if(map.fDynamicTiles&&map.fTilesLoaded)if(map.mouseObject)setTimeout("map.Tiles.doDiscardTiles()",6E3);else{if(map.Tiles&&map.Tiles.nCount>0&&(a=map.Tiles.getTileInfo()))for(var f=0;f<a.length;f++){var g=a[f].tileGroup;if(g&&g.style.getPropertyValue("display")=="none"&&g.hasChildNodes()){map.Themes.removeFromThemeNodesCache(g);map.Dom.clearGroup(g);setTimeout("map.Tiles.doDiscardTiles()",2E3);return}}this.fDiscardPending=!1}else this.fDiscardPending=!1};ixMap.Tiles.prototype.isAnyTiledLayerVisible=
function(){for(var a in map.Layer.listA){var f=map.Layer.listA[a];if(f.szFlag.match(/tiled/)&&(f.nState===!0||f.szDisplay!="none"||f.szDisplayLabel!="none"))return!0}return!1};ixMap.Tiles.prototype.allTilesLoaded=function(){var a=this.getTileInfo();if(a){var f=a.length,g=0,l;for(l in a)a[l].tileGroup&&a[l].tileGroup.hasChildNodes()&&g++;return f==g}return!1};ixMap.Tiles.prototype.isAnyLayerTileLoaded=function(a){if(a=this.getTileInfo())for(var f in a)if(a[f].tileGroup&&a[f].tileGroup.hasChildNodes())return!0;
return!1};ixMap.Event=function(){this.fPanDone=!1;this.onoverShape=null;this.fMouseDown=!1;this.contextMenuObj=null;this.onoverPopup=!1;this.tooltipDone=this.popupContextObj=null};ixMap.Event.prototype=new Map;ixMap.Event.prototype.initUseNodes=function(a){if(a&&(a=a.getElementsByTagName("use"))&&a.length)for(var f=0;f<a.length;f++)a.item(f).style.setProperty("pointer-events","none","")};ixMap.Event.prototype.resolveInstance=function(a){if(!a)return null;if(typeof a.nodeType!="undefined")return a;
for(;a.parentNode&&a.correspondingUseElement=="undefined";)a=a.parentNode;return a.correspondingUseElement};ixMap.Event.prototype.stopMouseEvent=function(a){a&&(a.stopPropagation(),a.preventDefault())};ixMap.Event.prototype.defaultMouseOver=function(a){if(a&&a.target){var f=this.resolveInstance(a.target);if(f.nodeType==1){var g=new MapObject(f);if(g&&g.szId&&g.szId.match(/widget/))ma.onMouseOver(a);if(!this.fMouseDown||!this.fMouseDownMoved){if(map.szMapToolType=="idle")try{if(!g){map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle();
return}var l=g.szId;if(!(l.match(/legend/)||l.match(/tool/)||l.match(/button/)||l.match(/widget/)||l.match(/movable/)||l.match(/checked/)||l.match(/unchecked/))){map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle();return}}catch(C){}map.SVGPopupGroup.fu.isContained(f)||map.SVGFixedGroup.fu.isContained(f)?(this.popupContextObj&&da(a,this.popupContextObj),this.onoverPopup=!0):this.onoverPopup=!1;if(map.szMapToolType!==""||this.onoverPopup){if(map.szMapToolType=="clickinfo")try{if(g.szId.match(/text/i)&&
(g=new MapObject(f.parentNode)),g.szId.match(/:chart:box/i)&&(l=g.szId.split(":chart:box")[0]+":chartgroup",g=new MapObject(g.objNode.ownerDocument.getElementById(l))),map.szMapToolType="",map.HTMLWindow.ixmaps.htmlgui_onItemClick(a,g.szId))return l=g,l.objNode||(l=new MapObject(l)),l.objNode&&map.highLightList&&!map.highLightList.checkItem(l.objNode)&&(map.highLightList.unlock(),map.highLightList.removeAll(),map.highLightList.addItem(l.objNode,"circle"),map.highLightList.lock()),map.SVGPopupGroup.fu.clear(),
killTooltip(),map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle(),null}catch(C){}if(this.onoverPopup||!da(a,f)||map.szMapToolType!=="info"&&map.szMapToolType!=="clickinfo"&&map.szMapToolType!==""){if(f)try{var h=f.getAttributeNS(szMapNs,"origstyle");if(!h||h=="null"){var r=f.getAttributeNS(szMapNs,"onoverstyle");r&&(f.setAttributeNS(szMapNs,"origstyle",f.getAttributeNS(null,"style")),f.setAttributeNS(null,"style",r))}}catch(C){}try{if(console.log(g.szId),map.HTMLWindow.ixmaps.htmlgui_onItemOver(a,g.szId))return null}catch(C){}this.tooltipDone=
displayTooltip(a,f);this.onoverShape=f}else{try{if(map.HTMLWindow.ixmaps.htmlgui_onItemOver(a,g.szId,f))return map.SVGPopupGroup.fu.clear(),map.highLightList.unlock(),map.highLightList.removeAll(),map.highLightList.addItem(g.objNode,"scale"),map.highLightList.lock(),map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle(),null}catch(C){}y(a,f,"delayed|pointer");this.onoverShape=f;try{highlightTheme(new MapObject(f))}catch(C){}}try{f.getAttributeNS(null,"id")=="mapbackground:eventrect"&&map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()}catch(C){}}}}}};
var da=function(a,f){var g=new MapObject(f);if(g==null)return!1;a=!0;var l=null;g=g.szId;if(g.length===0||g.match(/legend/)||g.match(/background/)||g.match(/button/)||g.match(/widget/)||g.match(/textgrid/)||map.szMapToolType!="clickinfo"&&map.szMapToolType!="info"&&map.szMapToolType!=="")return map.highLightList&&map.highLightList.removeAll(),!1;if(map.highLightList&&!map.highLightList.checkItem(f)){g=f;g.nodeName!="g"&&(g=g.parentNode);if((g=g.getAttributeNS(null,"id"))&&!g.match(/chartgroup/)&&
map._activeTheme!=map.Tiles.getMasterId(g.split(":")[0]))if(map.Layer.getLayerObj(g),map.fHighlightHint)l="hint",a=!1;else return!1;map.highLightList.removeAll();f=map.Layer.getLayerItemNodes(f);for(g=0;g<f.length;g++)map.highLightList.addItem(f[g],l)}return a};ixMap.Event.prototype.defaultMouseOut=function(a){if(a&&a.target){var f=this.resolveInstance(a.target),g=new MapObject(f);if(g&&g.szId&&g.szId.match(/widget/))ma.onMouseOut(a);if(f)try{var l=f.getAttributeNS(szMapNs,"origstyle");l&&l.length>
2&&(f.removeAttributeNS(szMapNs,"origstyle"),f.setAttributeNS(null,"style",l))}catch(h){}this.onoverShape&&setTimeout("_removeInfo()",1E3);this.onoverShape&&!map._activeItem&&(map.highLightList.removeItem(this.onoverShape),this.onoverShape=null,highlightThemeRemove());killTooltip();B()}};ixMap.Event.prototype.defaultMouseClick=function(a){if(a&&a.target){var f=this.resolveInstance(a.target);if(f&&f.nodeType==1&&(new MapObject(f),f==this.ondownShape))if(this.fMouseDownMoved>5)this.fMouseDownMoved=
0;else{var g=f.parentNode;if(g.nodeName=="a"){g=g.getAttributeNS(szXlink,"href");try{map.HTMLWindow.ixmaps.htmlgui_popupWindow(g),this.stopMouseEvent(a)}catch(h){}}var l=new MapObject(f);if(l!=null){g=l.objNode;l=l.szId;try{if(map.User.onClick(a,l))return null}catch(h){}try{if(map.HTMLWindow.ixmaps.htmlgui_onItemClick(a,l))return null}catch(h){}if(l){if(ma.onClick(a))return;try{l=="mapbackground:eventrect"&&map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()}catch(h){}}map.Legend&&map.Legend.legendMouseClick(a,
g)?this.stopMouseEvent(a):!g||g.nodeType!=1||!g.parentNode||g.parentNode.nodeType!=1||map.Legend&&map.Legend.legendMouseClick(a,g.parentNode)||!(l=g.parentNode.getAttributeNS(null,"id"))||l=="PopupGroup"||l.match(/widget/)||!map.fActivateInfoOnClick&&map.szMapToolType!="info"&&map.szMapToolType!="clickinfo"&&map.szMapToolType!==""&&map.szMapToolType!="zoomrect"||(isActiveTheme(map.Layer.getLayerName(l))?(map.SVGPopupGroup.fu.clear(),y(a,f,"add|fix|pointer")):(activateTheme(l.split(":")[0]),map.szMapToolType.match(/select/),
map.Zoom.cancel(),this.defaultMouseOver(a),killTooltip()))}}}};ixMap.Event.prototype.defaultMouseDown=function(a){if(a&&a.target&&!map.fInitializing){var f=this.resolveInstance(a.target);if(a.button==2)this.contextMenuObj=f,this.contextMenuCurrentObj=a.currentTarget,__setContextMenu(a);else if(!a.button||a.button===0){this.fMouseDown=!0;this.ondownShape=f;this.fMouseDownMoved=0;var g=new MapObject(f);if(g!=null){f=g.objNode;g=String(g.szId);try{if(map.User.onMouseDown(a,g))return null}catch(l){}this.stopMouseEvent(a);
ma.onMouseDown(a);if(g.match(/movabley/))map.mouseObject=new fa(a,f,"yonly");else if(g.match(/movablex/))map.mouseObject=new fa(a,f,"xonly");else if(g.match(/movable/))map.mouseObject=new fa(a,f);else if(g.match(/maptoolnode/))va.onMouseDown(a);else if(g.match(/widget/))ma.onMouseDown(a);else g.match(/legend/)?(a=g.split(":"),a.length>2&&f.ownerDocument.getElementById(a[2])&&(a[1]=="minus"&&setTimeout("__opacityMinus('"+a[2]+"')",200),a[1]=="plus"&&setTimeout("__opacityPlus('"+a[2]+"')",200))):(a.shiftKey||
a.altKey||a.crtlKey||!map.Layer.isMapObject(f)||map.szMapToolType&&map.szMapToolType!==""&&new d(a,map.szMapToolType),a.shiftKey&&!a.altKey&&!a.crtlKey&&map.Layer.isMapObject(f)&&(map.szMapToolType===""?new d(a,"pan"):new d(a,map.szMapToolType)),!map.fTriggerMouseMoveForPan||g.match(/legend/)||g.match(/tool/)||g.match(/button/)||g.match(/widget/)||g.match(/movable/)||g.match(/checked/)||g.match(/unchecked/)||map.szMapToolType!="info"&&map.szMapToolType!==""||(this.triggerMoveForPan=!0))}}}};ixMap.Event.prototype.defaultMouseUp=
function(a){if(a&&a.target&&!map.fInitializing){this.stopMouseEvent(a);try{if(map.User.onMouseUp(a))return null}catch(f){}this.fMouseDown=!1;if(map.mouseObject){try{map.mouseObject.onMouseUp(a)}catch(f){}map.mouseObject=null}ma.onMouseUp(a);this.triggerMoveForPan=!1}};ixMap.Event.prototype.defaultMouseMove=function(a){if(a&&a.target&&!map.fInitializing){var f=this.resolveInstance(a.target);this.triggerMoveForPan&&this.fMouseDownMoved&&(new d(a,"pan"),this.triggerMoveForPan=!1);if(!map.mouseObject)try{var g=
(new MapObject(f)).objNode.getAttributeNS(null,"id");if(!(g.match(/legend/)||g.match(/tool/)||g.match(/button/)||g.match(/widget/)||g.match(/movable/)||g.match(/checked/)||g.match(/unchecked/)||map.szMapToolType!="idle"&&g!="mapbackground:eventrect")){setTimeout("map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()",1E3);return}}catch(l){}this.stopMouseEvent(a);if(map.mouseObject)try{map.mouseObject.onMouseMove(a)}catch(l){}this.fPanDone&&(this.fPanDone=!1,this.doDefaultZoom(null));this.fMouseDownMoved+=
this.fMouseDown?1:0;ma.onMouseMove(a)}};var V=!1,U=null;ixMap.Event.prototype.defaultKeyDown=function(a){!a||V||!a.shiftKey||a.altKey||a.crtlKey||(U=map.szMapToolType,map.szMapToolType=="pan"?c("zoomrect"):map.szMapToolType=="zoomrect"?c("pan"):map.szMapToolType=="info"&&c("pan"),V=!0)};ixMap.Event.prototype.defaultKeyUp=function(a){!a||!V||a.shiftKey||a.altKey||a.crtlKey||(c(U),V=!1)};ixMap.Event.prototype.doDefaultZoom=function(a){if(!map.fFroozeDynamicContent){map.SVGNotifyGroup.fu.clear();try{map.Themes.getTheme().unlabelMap()}catch(C){}map.showMap();
var f=map.SVGRootElement.getAttribute("viewBox").split(" "),g=map.SVGOrigViewBoxString.split(" ");g=1/(Number(g[2])/Number(f[2]));if(f=map.Scale.zoomNode){var l=getMatrix(f);g/=l[0]}map.Scale.oldZoomScale=map.Scale.nZoomScale;map.Scale.oldMapCenter=map.Scale.mapCenter;if(map.Scale.nZoomScale!=g){map.Dom.clearGroup(map.SVGToolsGroup);map.Dom.clearGroup(map.SVGFixedGroup);map.removeAllHighlights();map.Api.clearHighlight();map.Api.clearAllOverlays();try{map.HTMLWindow.ixmaps.htmlgui_onItemClick(a,"mapbackground:eventrect")}catch(C){}}map.Scale.nZoomScale=
g;map.Scale.mapCenter=new point(l[4],l[5]);if(map.fPanByViewer===!1){if(map.SVGRootElement.currentTranslate.x!==0||map.SVGRootElement.currentTranslate.y!==0){f=map.Scale.zoomNode;l=getMatrix(f);g=l[0];var h=l[3],r=map.Scale.rotatePoint(map.SVGRootElement.currentTranslate);map.SVGRootElement.currentTranslate.x=r.x;map.SVGRootElement.currentTranslate.y=r.y;r=l[4]+map.Scale.scaleX(map.SVGRootElement.currentTranslate.x);l=l[5]+map.Scale.scaleY(map.SVGRootElement.currentTranslate.y);f.setAttributeNS(null,
"transform","matrix("+g+" 0 0 "+h+" "+r+" "+l+")");map.Scale.mapCenter=new point(r,l);map.SVGRootElement.currentTranslate.x=0;map.SVGRootElement.currentTranslate.y=0}}else{if(l=map.SVGDocument.getElementById("mapcliprect"))l.setAttributeNS(null,"x",map.Scale.scaleX(-map.SVGRootElement.currentTranslate.x)),l.setAttributeNS(null,"y",map.Scale.scaleY(-map.SVGRootElement.currentTranslate.y)),l.setAttributeNS(null,"width",map.Scale.scaleX(map.Scale.getEmbedWidth())),l.setAttributeNS(null,"height",map.Scale.scaleX(map.Scale.getEmbedHeight()));
if(l=map.SVGDocument.getElementById("mapbackground:eventrect"))l.setAttributeNS(null,"x",map.Scale.scaleX(-map.SVGRootElement.currentTranslate.x)),l.setAttributeNS(null,"y",map.Scale.scaleY(-map.SVGRootElement.currentTranslate.y)),l.setAttributeNS(null,"width",map.Scale.scaleX(map.Scale.getEmbedWidth())),l.setAttributeNS(null,"height",map.Scale.scaleX(map.Scale.getEmbedHeight()))}a&&map.antiZoomAndPanList.adjustGroups(a);Math.abs(map.Scale.oldZoomScale-map.Scale.nZoomScale)>map.Scale.oldZoomScale/
100?(map.fFeatureScaling=="delayed"?setTimeout("map.Layer.changeFeatureScaling(null,'"+map.Scale.nZoomScale+"')",1E3):map.Layer.changeFeatureScaling(a,map.Scale.nZoomScale),map.Scale.oldZoomScale>map.Scale.nZoomScale&&map.fDynamicLayer=="delayed"?setTimeout("map.Layer.switchScaleDependentLayer(null)",500):map.Layer.switchScaleDependentLayer(a),A(a)):map.fDynamicTiles=="delayed"?setTimeout("map.Layer.doStoredFeatureScaling()",500):map.Layer.doStoredFeatureScaling(a);map.fDynamicTiles=="delayed"?setTimeout("map.Tiles.switchScaleDependentTiles(null)",
500):map.Tiles.switchScaleDependentTiles(a);if(this.fFrozenDynamicContent||map.Scale.oldZoomScale!=map.Scale.nZoomScale||Math.abs(map.Scale.oldMapCenter.x-map.Scale.mapCenter.x)>10||Math.abs(map.Scale.oldMapCenter.y-map.Scale.mapCenter.y)>10){try{map.HTMLWindow.ixmaps.htmlgui_onZoomAndPan(map.Scale.nZoomScale)}catch(C){}map.fDynamicTiles=="delayed"||map.fDynamicLayer=="delayed"?setTimeout("map.Layer.adaptLabel()",500):setTimeout("map.Layer.adaptLabel()",10);if(this.fFreezeDynamicContent)this.fFrozenDynamicContent=
!0;else try{this.fFrozenDynamicContent?(map.Themes.actualizeActiveTheme(.99),this.fFrozenDynamicContent=!1):map.Scale.oldZoomScale!=map.Scale.nZoomScale?map.Themes.actualizeActiveTheme(map.Scale.oldZoomScale/map.Scale.nZoomScale):setTimeout("map.Themes.actualizeActiveTheme("+map.Scale.oldZoomScale/map.Scale.nZoomScale+")",10)}catch(C){}try{map.HTMLWindow.ixmaps.htmlgui_setScaleSelect(String(__formatValue(Math.floor(map.Scale.nTrueMapScale*map.Scale.nZoomScale)),0,"BLANK"))}catch(C){}}map.zoomAndPanHistory.newItem();
map.Scale.refreshCSSStyles()}};ixMap.Event.prototype.doPrintZoom=function(a){map.Scale.nZoomScale/=5;map.Scale.oldZoomScale!=map.Scale.nZoomScale?(map.fFeatureScaling=="delayed"?setTimeout("map.Layer.changeFeatureScaling(null,'"+map.Scale.nZoomScale+"')",1E3):map.Layer.changeFeatureScaling(a,map.Scale.nZoomScale),map.Scale.oldZoomScale>map.Scale.nZoomScale&&map.fDynamicLayer=="delayed"?setTimeout("map.Layer.switchScaleDependentLayer(null)",500):map.Layer.switchScaleDependentLayer(a),A(a)):map.fDynamicTiles==
"delayed"?setTimeout("map.Layer.doStoredFeatureScaling()",500):map.Layer.doStoredFeatureScaling(a);map.fDynamicTiles=="delayed"?setTimeout("map.Tiles.switchScaleDependentTiles(null)",500):map.Tiles.switchScaleDependentTiles(a);if(map.Scale.oldZoomScale!=map.Scale.nZoomScale||map.Scale.oldMapCenter.x!=map.Scale.mapCenter.x||map.Scale.oldMapCenter.y!=map.Scale.mapCenter.y){map.fDynamicTiles=="delayed"||map.fDynamicLayer=="delayed"?setTimeout("map.Layer.adaptLabel()",500):setTimeout("map.Layer.adaptLabel()",
10);try{map.Themes.actualizeActiveTheme(map.Scale.oldZoomScale/map.Scale.nZoomScale)}catch(f){}}try{map.HTMLWindow.ixmaps.htmlgui_setScaleSelect(String(__formatValue(Math.floor(map.Scale.nTrueMapScale*map.Scale.nZoomScale)),0,"BLANK")),map.HTMLWindow.ixmaps.htmlgui_setCurrentEnvelope(map.Zoom.getEnvelopeString(),map.Scale.oldZoomScale!=map.Scale.nZoomScale)}catch(f){}map.Scale.refreshCSSStyles()};ixMap.Event.prototype.doDefaultResize=function(a){map&&map.Layer&&(map.Layer.switchScaleDependentLayer(a),
A(a))};ixMap.Event.prototype.doDefaultPan=function(a){a&&!map.mouseObject&&(map.antiZoomAndPanList.adjustGroups(a),map.Event.fPanDone=!0)};ixMap.Event.prototype.doDefaultAdjustPan=function(a){this.fPanDone&&(this.fPanDone=!1,this.doDefaultZoom(null))};ixMap.Event.prototype.moveToFrontOfGroup=function(a){a&&a.currentTarget&&a.currentTarget.parentNode&&a.currentTarget!=a.currentTarget.parentNode.lastChild&&a.currentTarget.parentNode.appendChild(a.currentTarget)};Ea.prototype.add=function(a){this.historyPointer=
this.itemA.length;this.itemA[this.itemA.length]=a};Ea.prototype.newItem=function(){this.fSuspend?this.fSuspend=!1:this.add(new t)};Ea.prototype.backwards=function(){this.historyPointer>0&&(this.fSuspend=!0,this.itemA.length=this.historyPointer,this.historyPointer--,this.itemA[this.historyPointer].exec())};Ea.prototype.forwards=function(){this.historyPointer<this.itemA.length-1&&(this.fSuspend=!0,this.historyPointer++,this.itemA[this.historyPointer].exec())};Ea.prototype.clear=function(){this.itemA.length=
0};t.prototype.exec=function(){try{var a=this.szEnvelope.split("="),f=a[1].split("'")[1],g=a[2].split("'")[1],l=a[3].split("'")[1],h=a[4].split("'")[1];map.Zoom.doZoomMapToEnvelope(f,g,l,h)}catch(r){alert("History Item not valid")}};var P=function(a,f,g,l,h,r,C){f&&g&&g.length>2&&(this.szId=g+":movable",this.objectNode=map.Dom.newGroup(f,this.szId),this.ptPosition=l,this.ptOffsetOrig=new point(h.x,h.y),this.ptOffset=h,this.szMode=r,this.szTitle=C,this.nFontheight=14,this.onRemove="",this.fClipped=
!0,this.create())};P.prototype.create=function(){this.ptPosition||(this.ptPosition=new point(1E3,1E3));this.ptOffset||(this.ptOffset=new point(100,100));this.szMode||(this.szMode="");this.szMode.match(/left/)&&(this.ptOffset.x=-(this.ptOffset.x*2),this.ptOffset.y*=3);this.frameNode=map.Dom.newShape("rect",this.objectNode,0,0,map.Scale.normalX(10),map.Scale.normalY(10),"fill:#ffffff;stroke:black;stroke-width:"+map.Scale.normalX(0));this.frameNode.setAttributeNS(null,"rx",map.Scale.normalX(map.nInfoRoundRect*
2));this.frameNode.setAttributeNS(null,"ry",map.Scale.normalX(map.nInfoRoundRect*2));map.SVGDocument.getElementById(map.szShadowFilterToolsId)&&this.frameNode.style.setProperty("filter","url(#"+map.szShadowFilterToolsId+")","");this.canvasNode=map.Dom.newGroup(this.objectNode,this.szId+":canvas");this.canvasNode.fu.setPosition(map.Scale.normalX(1),map.Scale.normalY(1));this.titleNode=map.Dom.newGroup(this.objectNode,this.szId+":title");this.titleTextNode=map.Dom.newGroup(this.titleNode,this.szId+
":titletext");this.szTitle&&map.Dom.newText(this.titleTextNode,map.Scale.normalX(10),map.Scale.normalY(this.nFontheight+10),"font-family:arial;font-size:"+map.Scale.normalY(this.nFontheight/4*3)+"px;fill:black;pointer-events:none",this.szTitle);this.scrollObj=new b(null,this.canvasNode,null,10,10,10),this.scrollObj.reformat(),this.workspaceNode=this.scrollObj.workspaceNode;this.workspaceNode||(this.scrollObj=null,this.workspaceNode=map.Dom.newGroup(this.canvasNode,this.szId+":workspace"),this.workspaceClipRect=
map.Dom.setClipRect(this.workspaceNode,new box(0,0,10,10)));this.objectNode.setAttributeNS(null,"onclick","map.Event.moveToFrontOfGroup(evt)");this.objectNode.setAttributeNS(null,"ontouchend","map.Event.moveToFrontOfGroup(evt)");this.szMode.match(/fix/)?(this.deleteButton=new ra(this.titleNode,this.szId,"BUTTON","#delete_button","map.Dom.removeElementById('"+this.szId+"');","remove"),this.deleteButton.scale(1,1),this.deleteButton.setPosition(map.Scale.normalX(10),map.Scale.normalY(10))):this.szMode.match(/pin/)&&
map.SVGDocument.getElementById("pin_button")&&(this.pinButton=new ra(this.titleNode,this.szId,"BUTTON","#pin_button","doDisplayInfo("+this.ptPosition.x+","+this.ptPosition.y+",'pointer|fix');","","fix it"),this.pinButton.scale(1,1),this.pinButton.setPosition(map.Scale.normalX(10),map.Scale.normalY(10)));this.widgetObj=new ia(this.objectNode,this)};P.prototype.setTitle=function(a,f){f||(f=map.Scale.tStyle.ContainerTitle);map.Dom.clearGroup(this.titleTextNode);(this.szTitle=a)&&map.Dom.newText(this.titleTextNode,
map.Scale.normalX(10),f.nFontHeight*1.3,f.szStyle,this.szTitle);this.reformat()};P.prototype.reformat=function(){this.bBox=map.Dom.getBox(this.workspaceNode);this.tBox=map.Dom.getBox(this.titleTextNode);this.bBox.height<0&&(this.bBox.height=0);this.bBox.width<0&&(this.bBox.width=0);this.tBox.height<0&&(this.tBox.height=0);if(this.bBox.width!==0&&this.bBox.height!==0||this.szTitle&&this.szTitle.length){this.bBox.height==1&&(this.bBox.height=-200);var a=map.Scale.normalX(15+map.Scale.nButtonSize);if(this.fClipped){a=
Math.min(Math.max(this.bBox.width+a,this.tBox.width+a),map.Scale.bBox.width/2);var f=Math.min(this.bBox.height+this.tBox.height,map.Scale.bBox.height/2.4)}else a=Math.max(this.bBox.width+a,this.tBox.width+a),f=this.bBox.y+this.bBox.height+this.tBox.height+map.Scale.normalY(10);f>map.Scale.bBox.height/4*5&&(a=Math.min(this.bBox.width+map.Scale.normalX(10)+map.Scale.normalY(10),map.Scale.bBox.width/2.4));a>map.Scale.bBox.width/4*5&&(f=Math.min(this.bBox.height+this.tBox.height+map.Scale.normalY(10),
map.Scale.bBox.height/2.4));this.scrollObj?(this.scrollObj.setWidth(a/map.Scale.normalX(1)-1),this.scrollObj.setHeight(f/map.Scale.normalY(1)),this.scrollObj.reformat(),this.scrollObj.hasScrollBars()?(f<this.bBox.height+map.Scale.normalX(this.scrollObj.nScrollBarWidth)&&(this.scrollObj.setHeight(f/map.Scale.normalY(1)+this.scrollObj.nScrollBarWidth+6),this.scrollObj.reformat(),f+=map.Scale.normalY(this.scrollObj.nScrollBarWidth+1)),this.canvasNode.fu.setPosition(map.Scale.normalX(5),map.Scale.normalY(8)+
this.tBox.height),a+=map.Scale.normalX(10)+map.Scale.normalX(7),f+=map.Scale.normalY(2)+map.Scale.normalY(10)+map.Scale.normalY(5)+this.tBox.height*2):(this.canvasNode.fu.setPosition(map.Scale.normalX(5),map.Scale.normalY(10)+this.tBox.height*1.3),f+=map.Scale.normalY(10)+this.tBox.height-map.Scale.normalY(7))):(this.workspaceClipRect.setAttributeNS(null,"width",a),this.workspaceClipRect.setAttributeNS(null,"height",f));var g=map.Scale.tStyle.ContainerTitle;g=map.Scale.normalY(map.Scale.nButtonSize/
3)+g.nFontHeight/2;var l=map.Scale.normalY(map.Scale.nButtonSize/3);this.pinButton?this.pinButton.setPosition(a-l,g):this.deleteButton?this.deleteButton.setPosition(a-l,g):a-=map.Scale.normalX(map.Scale.nButtonSize);this.bBox.width=a;this.bBox.height=f;this.frameNode&&(this.frameNode.setAttributeNS(null,"width",this.bBox.width+map.Scale.normalX(5)*2),this.frameNode.setAttributeNS(null,"height",this.bBox.height+map.Scale.normalX(5)));this.shadowNode&&(this.shadowNode.setAttributeNS(null,"width",this.bBox.width+
map.Scale.normalX(5)*2+map.Scale.normalX(.5)),this.shadowNode.setAttributeNS(null,"height",this.bBox.height+map.Scale.normalX(5)+map.Scale.normalY(1)));a=map.Scale.getGroupOffset(this.objectNode);this.newPosition=map.Scale.clipWidgetObjectToSVG(this.objectNode,new point(this.ptPosition.x+a.x,this.ptPosition.y+a.y),this.ptOffsetOrig,this.bBox);this.newPosition.x-=a.x;this.newPosition.y-=a.y;this.objectNode.fu.setPosition(this.newPosition.x,this.newPosition.y);this.ptOffset.x=this.newPosition.x-this.ptPosition.x;
this.ptOffset.y=this.newPosition.y-this.ptPosition.y;this.szMode.match(/pointer/)&&this.makePointer()}else this.remove()};P.prototype.makePointer=function(){map.Scale.normalX(15);var a=map.Scale.normalX(10);map.Scale.normalX(5);this.pointerObj?(map.Dom.clearGroup(this.pointerObj),map.Dom.clearGroup(this.pointShObj)):(this.pointerObj=map.Dom.newGroup(this.objectNode),this.pointShObj=map.Dom.newGroup(this.objectNode),this.pointShObj.parentNode.insertBefore(this.pointShObj,this.pointShObj.parentNode.firstChild));
if(!(this.ptOffset.y<0&&this.ptOffset.y>-this.bBox.height&&this.ptOffset.x<0&&this.ptOffset.x>-this.bBox.width)){var f=this.ptOffset.y+this.bBox.height/2;var g=this.ptOffset.x+this.bBox.width/2;Math.abs(f)+this.bBox.width/2-this.bBox.height/2>Math.abs(g)?(g=0,this.ptOffset.x>-a*2&&(g=this.ptOffset.x+a*2),this.ptOffset.x<-this.bBox.width+a*2&&(g=this.ptOffset.x+this.bBox.width-a*2),f>0?(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(g-map.Scale.normalX(8))+
","+(this.ptOffset.y+map.Scale.normalX(1))+" "+map.Scale.normalX(20)+",0 z","fill:black;fill-opacity:0.2"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(g-map.Scale.normalX(7.5))+","+(this.ptOffset.y+map.Scale.normalX(1))+" "+map.Scale.normalX(15)+",0 z","fill:white")):(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(g-map.Scale.normalX(8))+","+(this.ptOffset.y+this.bBox.height-map.Scale.normalX(1))+" "+map.Scale.normalX(20)+
",0 z","fill:black;fill-opacity:0.2"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(g-map.Scale.normalX(7.5))+","+(this.ptOffset.y+this.bBox.height-map.Scale.normalX(1))+" "+map.Scale.normalX(15)+",0 z","fill:white"))):(f=0,this.ptOffset.y>-a*2&&(f=this.ptOffset.y+a*2),this.ptOffset.y<-this.bBox.height+a*2&&(f=this.ptOffset.y+this.bBox.height-a*2),g>0?(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+
map.Scale.normalX(1))+","+(f-map.Scale.normalX(8))+" 0,"+map.Scale.normalX(20)+" z","fill:black;fill-opacity:0.2"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+map.Scale.normalX(1))+","+(f-map.Scale.normalX(7.5))+" 0,"+map.Scale.normalX(15)+" z","fill:white")):(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+this.bBox.width+map.Scale.normalX(1))+","+(f-map.Scale.normalX(8))+" 0,"+map.Scale.normalX(20)+
" z","fill:black;fill-opacity:0.2"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+this.bBox.width+map.Scale.normalX(1))+","+(f-map.Scale.normalX(7.5))+" 0,"+map.Scale.normalX(15)+" z","fill:white")))}};P.prototype.onMouseMove=function(){if(this.fMouseDown){var a=this.objectNode.fu.getPosition();this.ptOffset.x+=a.x-this.beforeMovePosition.x;this.ptOffset.y+=a.y-this.beforeMovePosition.y;this.beforeMovePosition=this.objectNode.fu.getPosition();
this.szMode.match(/pointer/)&&this.makePointer()}};P.prototype.onMouseUp=function(){var a=this.objectNode.fu.getPosition();this.ptOffset.x+=a.x-this.beforeMovePosition.x;this.ptOffset.y+=a.y-this.beforeMovePosition.y;this.fMouseDown=!1;this.szMode.match(/pointer/)&&this.makePointer()};P.prototype.onMouseDown=function(){this.beforeMovePosition=this.objectNode.fu.getPosition();this.fMouseDown=!0};P.prototype.setOnRemove=function(a){this.deleteButton&&this.deleteButton.buttonNode&&this.deleteButton.setActionOn("map.Dom.removeElementById('"+
this.szId+"');"+a)};P.prototype.remove=function(){this.objectNode.parentNode.removeChild(this.objectNode);this.objectNode=null};P.prototype.clear=function(){map.Dom.clearGroup(this.workspaceNode)};var fa=function(a,f,g,l){f&&(this.objNode=f,this.objNode.fu=new Methods(this.objNode),this.objStartPosition=this.objNode.fu.getPosition(),this.szFlag=g?g:"",this.parent=l);this.mouseStartPosition=a?map.Scale.getClientMousePosition(a,this.objNode):new point(0,0)};fa.prototype.onMouseMove=function(a){var f=
map.Scale.getClientMousePosition(a,this.objNode);try{if(map.User.onMouseMove(a,this.objNode.getAttributeNS(null,"id"),f))return null}catch(l){}switch(this.szFlag){case "yonly":f.x=this.mouseStartPosition.x;break;case "xonly":f.y=this.mouseStartPosition.y}if(this.objNode&&!this.szFlag.match(/parentonly/)){var g=this.objNode.fu.getScale();this.objNode.fu.setPosition(this.objStartPosition.x+(f.x-this.mouseStartPosition.x)/g.x,this.objStartPosition.y+(f.y-this.mouseStartPosition.y)/g.y)}if(this.parent)this.parent.onMouseMove(a)};
fa.prototype.onMouseUp=function(a){if(this.parent)this.parent.onMouseUp(a)};var ra=function(a,f,g,l,h,r,C){this.targetGroup=a;this.szId=f?f:"button:"+String(Math.random());this.szType=g?g:"SIMPLE";this.szStyle=l?l:"";this.szActionOn=h;this.szActionOff=r;this.szTooltip=C?C:"";this.draw()};ra.prototype.draw=function(a){!this.szType.match(/SELECTED/)||this.szType.match(/CHECKBOX/)?(this.nodeObj=map.Dom.newGroup(this.targetGroup),this.nodeObj.setAttributeNS(null,"cursor","pointer"),a=map.Dom.constructNode("a",
this.nodeObj,{}),this.shapeObj=map.Dom.newGroup(a)):this.shapeObj=this.nodeObj=map.Dom.newGroup(this.targetGroup);this.nodeObj.setAttributeNS(null,"id",this.szId+":button");if(this.szType.match(/CHECKBOX/)){a=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":"#unchecked_button"});var f=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":"#checked_button"});a.setAttributeNS(null,"id",this.szId+":unchecked");f.setAttributeNS(null,"id",this.szId+":checked");this.szType.match(/SELECTED/)&&(this.checked=
!0);this.szType.match(/SELECTED/)||(this.checked=!1,f.style.setProperty("display","none",""));a=map.Dom.newShape("rect",this.shapeObj,map.Scale.normalX(-map.Scale.nButtonSize/2),map.Scale.normalX(-map.Scale.nButtonSize/2),map.Scale.normalX(map.Scale.nButtonSize),map.Scale.normalX(map.Scale.nButtonSize),"fill:red;fill-opacity:0");a.setAttributeNS(null,"id",this.szId+":widget:eventrect");a.setAttributeNS(szMapNs,"tooltip",this.szTooltip);a.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)");
new ia(a,this)}else if(this.szType.match(/TEXTBUTTON/)){f=this.szStyle;a=map.Scale.normalY(map.Scale.nButtonSize*.6);var g="font-family:arial;font-size:"+a+"px;fill:#444444;baseline-shift:-30%;pointer-events:none",l=a/2*f.length;this.szType.match(/SELECTED/)?l=map.Dom.newShape("rect",this.shapeObj,-a/5,-a/3*2,l,a/5*6,"fill:#eeeeff;stroke:black;stroke-width:"+map.Scale.normalX(1)+";stroke-opacity:0.3"):(l=map.Dom.newShape("rect",this.shapeObj,-a/5,-a/3*2,l,a/5*6,"fill:white;stroke:none;opacity:0"),
l.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)"),l.setAttributeNS(null,"onmouseout","map.Event.stopMouseEvent(evt)"),l.setAttributeNS(null,"onclick",this.szActionOn),l.setAttributeNS(null,"ontouchend",this.szActionOn),l.setAttributeNS(szMapNs,"tooltip",this.szTooltip));f=map.Dom.newText(this.shapeObj,0,0,g,f);this.bBox=new box(-a/5,-a/3*2,f.getComputedTextLength()+a/5*2,a/5*6);l.setAttributeNS(null,"width",String(this.bBox.width));this.buttonNode=l}else this.szType.match(/BUTTON/)&&
(a=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":this.szStyle}),a.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)"),a.setAttributeNS(null,"onmousedown","map.Event.stopMouseEvent(evt)"),a.setAttributeNS(null,"onclick",this.szActionOn),a.setAttributeNS(null,"ontouchend",this.szActionOn),a.setAttributeNS(szMapNs,"tooltip",this.szTooltip),this.buttonNode=a)};ra.prototype.scale=function(a,f){this.nodeObj&&this.nodeObj.fu.scale(a,f)};ra.prototype.setPosition=function(a,f){this.nodeObj&&
this.nodeObj.fu.setPosition(a,f)};ra.prototype.getPosition=function(a,f){if(this.nodeObj)return this.nodeObj.fu.getPosition()};ra.prototype.remove=function(){this.nodeObj&&this.nodeObj.parentNode.removeChild(this.nodeObj)};ra.prototype.setActionOn=function(a){this.szActionOn=a;this.buttonNode&&(this.buttonNode.setAttributeNS(null,"onclick",this.szActionOn),this.buttonNode.setAttributeNS(null,"ontouchend",this.szActionOn))};ra.prototype.onClick=function(a){this.toggleCheckBox(a);map.Event.stopMouseEvent(a)};
ra.prototype.toggleCheckBox=function(a){a=map.SVGDocument.getElementById(this.szId+":checked");this.checked?(a.style.setProperty("display","none",""),eval(this.szActionOff)):(a.style.setProperty("display","inline",""),eval(this.szActionOn));this.checked=!this.checked};var Ta=function(a,f,g,l,h,r){a&&(this.hBar=this.vBar=0,this.vScale=this.hScale=1,this.maxBox=g,this.bWidth=l,this.bHeight=h,this.hThumb=g.width,this.vThumb=g.height,this.vValue=this.hValue=this.vThumbOffset=this.hThumbOffset=0,this.contObj=
a,this.contBox=a=map.Dom.getBox(a),this.contObj.fu=new Methods(this.contObj),a.width+a.x<=g.width-g.x+1&&a.height+a.y<=g.height-g.y+1||(a.width+a.x>g.width-g.x&&(this.hBar=h),a.height+a.y>g.height-g.y-this.hBar&&(this.vBar=l),a.width+a.x>g.width-g.x-this.vBar&&(this.hBar=h),this.vBar&&(this.maxBox.width-=this.vBar+r),this.hBar&&(this.maxBox.height-=this.hBar+r),this.hMax=this.maxBox.width-this.hBar*2,this.vMax=this.maxBox.height-this.vBar*2,this.hScale=(a.width+a.x)/this.maxBox.width,this.vScale=
(a.height+a.y)/this.maxBox.height,this.hScale>1&&(this.hThumb=Math.floor(this.hMax/this.hScale),this.hThumbOffset=Math.min(this.hMax-this.hThumb,-(f.x/this.hScale)),this.hValue=-f.x/(a.width+a.x-this.maxBox.width)),this.vScale>1&&(this.vThumb=Math.floor(this.vMax/this.vScale),this.vThumbOffset=Math.min(this.vMax-this.vThumb,-(f.y/this.vScale)),this.vValue=-f.y/(a.height+a.y-this.maxBox.height)),this.hThumbStyle="fill:#99aacc;stroke:#dddddd;stroke-width:"+map.Scale.normalX(.3)+";opacity:0.3",this.vThumbStyle=
"fill:#99aacc;stroke:#dddddd;stroke-width:"+map.Scale.normalY(.3)+";opacity:0.3"))};Ta.prototype.draw=function(a){if(this.contObj){var f="fill:white;stroke:black;stroke-width:"+map.Scale.normalX(.2)+";opacity:1.0",g="fill:#e8e8f8;stroke:white;stroke-width:"+map.Scale.normalX(.5)+";opacity:1.0";map.Scale.normalX(2);var l="fill:white;stroke:#dddddd;stroke-width:"+map.Scale.normalX(.2)+";opacity:1.0";this.remove(a);if(this.hScale!=1||this.vScale!=1){a=map.Dom.newGroup(this.contObj.parentNode);a.setAttributeNS(null,
"id","scrollwidget");this.scrollWidget=a;this.vScale>1&&this.hScale>1&&map.Dom.newShape("rect",a,this.maxBox.width,this.maxBox.height,this.bWidth+map.Scale.normalX(1),this.bHeight+map.Scale.normalX(1),f);if(this.hScale>1){map.Dom.newShape("rect",a,this.bWidth,this.maxBox.height,this.hMax,this.bHeight+map.Scale.normalX(.8),l);if(f=map.Dom.newShape("rect",a,this.bWidth,this.maxBox.height,this.hMax/2,this.bHeight,"fill:black;stroke:black;opacity:0"))f.setAttributeNS(null,"id","widget:scrollbar:bigstepleft"),
new ia(f,this);if(f=map.Dom.newShape("rect",a,this.bWidth+this.hMax/2,this.maxBox.height,this.hMax/2,this.bHeight,"fill:black;stroke:black;opacity:0"))f.setAttributeNS(null,"id","widget:scrollbar:bigstepright"),new ia(f,this);f=map.Dom.newShape("rect",a,map.Scale.normalX(1.5),map.Scale.normalY(1.5),Math.max(2,this.hThumb-map.Scale.normalX(2)),Math.max(2,this.bHeight-map.Scale.normalY(2)),this.hThumbStyle?this.hThumbStyle:g);f.fu.setPosition(this.bWidth,this.maxBox.height);this.hThumbObj=new W(f,new box(0,
0,this.hMax-this.hThumb,0));this.hThumbObj.parent=this;this.hThumbObj.setValue(new point(this.hValue,0))}if(this.vScale>1){map.Dom.newShape("rect",a,this.maxBox.width+map.Scale.normalX(2),this.bHeight,this.bWidth-map.Scale.normalX(2),this.vMax,l);if(f=map.Dom.newShape("rect",a,this.maxBox.width,this.bHeight,this.bWidth,this.vMax/2,"fill:black;stroke:black;opacity:0"))f.setAttributeNS(null,"id","widget:scrollbar:bigstepup"),new ia(f,this);if(f=map.Dom.newShape("rect",a,this.maxBox.width,this.bHeight+
this.vMax/2,this.bWidth,this.vMax/2,"fill:black;stroke:black;opacity:0"))f.setAttributeNS(null,"id","widget:scrollbar:bigstepdown"),new ia(f,this);f=map.Dom.newShape("rect",a,map.Scale.normalX(1.5),map.Scale.normalY(1.5),Math.max(2,this.bWidth-map.Scale.normalX(2)),Math.max(2,this.vThumb-map.Scale.normalY(2)),this.vThumbStyle?this.vThumbStyle:g);f.fu.setPosition(this.maxBox.width,this.bHeight);this.vThumbObj=new W(f,new box(0,0,0,this.vMax-this.vThumb));this.vThumbObj.parent=this;this.vThumbObj.setValue(new point(0,
this.vValue))}}else this.contObj.fu.setPosition(0,0)}};Ta.prototype.hasScrollBars=function(a){return this.vScale>1||this.hScale>1};Ta.prototype.onMouseDown=function(a){};Ta.prototype.onMouseMove=function(a){var f=a=0;this.hScale>1&&(a=this.hThumbObj.fraction.x);this.vScale>1&&(f=this.vThumbObj.fraction.y);this.contObj.fu.setPosition(-a*(this.contBox.x+this.contBox.width-this.maxBox.width),-f*(this.contBox.y+this.contBox.height-this.maxBox.height))};Ta.prototype.onMouseUp=function(a){};Ta.prototype.onClick=
function(a){a=(new MapObject(a.target)).szId;var f=a.match(/big/)?map.Scale.normalX(100):map.Scale.normalX(5);a.match(/stepdown/)?this.vThumbObj.moveThumb(0,f):a.match(/stepup/)?this.vThumbObj.moveThumb(0,-f):a.match(/stepleft/)?this.hThumbObj.moveThumb(-f,0):a.match(/stepright/)&&this.hThumbObj.moveThumb(f,0)};Ta.prototype.remove=function(a){this.scrollWidget&&this.scrollWidget.parentNode.removeChild(this.scrollWidget)};var W=function(a,f,g,l,h){this.szId=null;this.moveArea=f;this.scaleArea=g;this.value=
new point(0,0);this.fraction=new point(0,0);this.onUp=this.onMove=null;h&&(this.valuesA=h.split(","));this.objNode=a;this.objNode.setAttributeNS(null,"id","widget:slider:"+String(Math.random()));a.fu=new Methods(a);this.ptNull=a.fu.getPosition();ma.add(this)};W.prototype.setMoveArea=function(a){this.moveArea=a};W.prototype.setId=function(a){this.szId=a};W.prototype.onMouseOver=function(a){if(this.parent)try{this.parent.onMouseOver(a,this.szId,this)}catch(f){}};W.prototype.onMouseOut=function(a){if(this.parent)try{this.parent.onMouseOut(a,
this.szId,this)}catch(f){}};W.prototype.onMouseDown=function(a){map.mouseObject=this.moveArea.width===0?new fa(a,this.objNode,"yonly"):this.moveArea.height===0?new fa(a,this.objNode,"xonly"):new fa(a,this.objNode,null);map.mouseObject.parent=this;if(this.parent)try{this.parent.onMouseDown(a,this.szId,this)}catch(f){}};W.prototype.onMouseMove=function(a){var f=this.objNode.fu.getPosition();f.x=Math.min(f.x,this.ptNull.x+this.moveArea.x+this.moveArea.width);f.x=Math.max(f.x,this.ptNull.x+this.moveArea.x);
f.y=Math.min(f.y,this.ptNull.y+this.moveArea.y+this.moveArea.height);f.y=Math.max(f.y,this.ptNull.y+this.moveArea.y);this.objNode.fu.setPosition(f.x,f.y);this.value=new point(0,0);this.moveArea.width>0&&(this.value.x=f.x-this.ptNull.x,this.fraction.x=this.value.x/this.moveArea.width);this.moveArea.height>0&&(this.value.y=f.y-this.ptNull.y,this.fraction.y=this.value.y/this.moveArea.height);if(this.parent)try{this.parent.onMouseMove(a,this.szId,this)}catch(g){}};W.prototype.onMouseUp=function(a){if(this.parent)try{this.parent.onMouseUp(a,
this.szId,this)}catch(f){}};W.prototype.moveThumb=function(a,f){var g=this.objNode.fu.getPosition();g.x+=a;g.y+=f;this.objNode.fu.setPosition(g.x,g.y);this.onMouseMove()};W.prototype.setValue=function(a){this.objNode.fu.setPosition(a.x*this.moveArea.width+this.ptNull.x,a.y*this.moveArea.height+this.ptNull.y);this.onMouseMove()};W.prototype.remove=function(){ma.removeWidget(this)};var X=function(a,f,g,l,h,r){this.circlethumb=map.Dom.newGroup(a.parentNode,"widget:rotationslider:thumb");this.circlethumb.setAttributeNS(null,
"area","-1000,-1000,1000,1000");this.circlethumb.setAttributeNS(null,"range",g);this.circlethumb.setAttributeNS(null,"scale",l);this.nStep=h;this.nSnap=r;this.pBase=a.fu.getPosition();this.circlethumb.fu.setPosition(this.pBase.x,this.pBase.y);this.circlethumbNode=map.Dom.newShape("circle",this.circlethumb,0,0,map.Scale.normalX(5),"fill:#ff0000;opacity:0.0;pointer-events:none");this.circleOverNode2=map.Dom.newShape("circle",this.circlethumb,0,0,map.Scale.normalX(6),"fill:none;stroke:#ffffff;stroke-width:"+
map.Scale.normalX(11)+";opacity:0.6;pointer-events:none;display:none");this.circleOverNode=map.Dom.newShape("path",this.circlethumb,"M-"+map.Scale.normalX(5.5)+",0 a"+map.Scale.normalX(6)+","+map.Scale.normalX(6)+" 0 1,0 "+map.Scale.normalX(5)+","+-map.Scale.normalX(5),"fill:none;stroke:#888888;stroke-width:"+map.Scale.normalX(1)+";opacity:0.8;pointer-events:none;display:none");setRotate(this.circleOverNode,45);setRotate(this.circleOverNode2,45);f=map.Dom.newNode("defs",this.circlethumb);f=map.Dom.newNode("marker",
f);f.setAttributeNS(null,"id","Triangle");f.setAttributeNS(null,"refX","0");f.setAttributeNS(null,"refY","0");f.setAttributeNS(null,"orient","auto");f.setAttributeNS(null,"style","overflow:visible");f.setAttributeNS(null,"path","M 0 0 L "+map.Scale.normalX(10)+" "+map.Scale.normalX(5)+" L 0 "+map.Scale.normalX(10)+" z");this.circleOverNode.style.setProperty("marker-start","url(#Triangle)","");this.circleOverNode.style.setProperty("marker-end","url(#Triangle)","");this.objNode=a;this.objNode.setAttributeNS(null,
"id","widget:slider:"+String(Math.random()));ma.add(this);this.isActive=!1};X.prototype.setValue=function(a){setRotate(this.objNode,a)};X.prototype.onMouseOver=function(a){this.circleOverNode.style.setProperty("display","inline","");this.circleOverNode2.style.setProperty("display","inline","");if(this.parent)try{this.parent.onMouseOver(a)}catch(f){}};X.prototype.onMouseOut=function(a){this.isActive||(this.circleOverNode.style.setProperty("display","none",""),this.circleOverNode2.style.setProperty("display",
"none",""));if(this.parent)try{this.parent.onMouseOut(a)}catch(f){}};X.prototype.onMouseDown=function(a){var f=map.Scale.getClientMousePosition(a,map.SVGToolsGroup);this.startPosition=new point(f.x-this.pBase.x,f.y-this.pBase.y);this.circlethumbNode.fu.setPosition(this.startPosition.x,this.startPosition.y);map.mouseObject=new fa(a,this.circlethumbNode);map.mouseObject.parent=this;this.isActive=!0;if(this.parent)try{this.parent.onMouseDown(a)}catch(g){}};X.prototype.onMouseMove=function(a){if(this.isActive&&
(setRotate(this.objNode,this.getAngle()),this.parent))try{this.parent.onMouseMove(a)}catch(f){}};X.prototype.onMouseUp=function(a){this.isActive=!1;this.circleOverNode.style.setProperty("display","none","");this.circleOverNode2.style.setProperty("display","none","");if(this.parent){try{this.parent.onMouseUp(a)}catch(f){}this.objNode.style.setProperty("opacity","1.0","")}};X.prototype.onClick=function(a){this.isActive=!1;this.circleOverNode.style.setProperty("display","none","");this.circleOverNode2.style.setProperty("display",
"none","");setRotate(this.objNode,0);if(this.parent){try{this.parent.onClick(a)}catch(f){}this.objNode.style.setProperty("opacity","1.0","")}};X.prototype.getAngle=function(a){var f=this.circlethumbNode.fu.getPosition();a=f.x;f=f.y;var g=Math.asin(a/Math.sqrt(a*a+f*f))/Math.PI*180;g=isNaN(g)?180:g;a>=0&&f>=0&&(g=180-g);a<0&&f>=0&&(g=180-g);a<0&&f<0&&(g=360+g);this.nStep&&this.nSnap&&(g%this.nStep<this.nSnap?(g=Math.floor(g/this.nStep)*this.nStep,this.objNode.style.setProperty("opacity","1.0","")):
this.objNode.style.setProperty("opacity","0.5",""));return g};var Z=function(){this.widgetA=[]};Z.prototype.add=function(a){this.widgetA[this.widgetA.length]=a};Z.prototype.getWidget=function(a){for(var f in this.widgetA)if(this.widgetA[f].objNode==a)return this.widgetA[f];return null};Z.prototype.onMouseOver=function(a){var f=new MapObject(a.target);f=this.getWidget(f.objNode);try{f.onMouseOver(a)}catch(g){}try{f.owner.onMouseOver(a)}catch(g){}};Z.prototype.onMouseOut=function(a){var f=new MapObject(a.target);
f=this.getWidget(f.objNode);try{f.onMouseOut(a)}catch(g){}try{f.owner.onMouseOut(a)}catch(g){}};Z.prototype.onMouseDown=function(a){var f=new MapObject(a.target);f=this.getWidget(f.objNode);try{f.onMouseDown(a)}catch(g){}try{f.owner.onMouseDown(a)}catch(g){}};Z.prototype.onMouseUp=function(a){var f=new MapObject(a.target);f=this.getWidget(f.objNode);try{f.onMouseUp(a)}catch(g){}try{f.owner.onMouseUp(a)}catch(g){}};Z.prototype.onMouseMove=function(a){var f=new MapObject(a.target);f=this.getWidget(f.objNode);
try{f.onMouseMove(a)}catch(g){}try{f.owner.onMouseMove(a)}catch(g){}};Z.prototype.onClick=function(a){var f=new MapObject(a.target);if(f=this.getWidget(f.objNode)){try{f.onClick(a)}catch(g){}try{f.owner.onClick(a)}catch(g){}return!0}return!1};Z.prototype.removeWidget=function(a){for(var f=0;f<this.widgetA.length;f++)if(this.widgetA[f].objNode==a){for(;f<this.widgetA.length-1;f++)this.widgetA[f]=this.widgetA[f+1];this.widgetA.length--}};Z.prototype.clear=function(){this.widgetA.length=0};var ia=function(a,
f){this.objNode=a;this.owner=f;ma.add(this)};ia.prototype.remove=function(){ma.removeWidget(this)};var ma=new Z;Z=function(){this.toolsA=[]};Z.prototype.add=function(a,f){f&&f<this.toolsA.length-1?this.toolsA.splice(f,0,a):this.toolsA[this.toolsA.length]=a};Z.prototype.getMapTool=function(a){for(var f in this.toolsA)if(this.toolsA[f].objNode==a.parentNode)return this.toolsA[f];return null};Z.prototype.removeMapTool=function(a){for(var f=0;f<this.toolsA.length;f++)if(this.toolsA[f].objNode==a.parentNode){for(this.toolsA[f].remove();f<
this.toolsA.length-1;f++)this.toolsA[f]=this.toolsA[f+1];this.toolsA.length--;this.toolsA.length&&this.toolsA[0].redraw()}};Z.prototype.clear=function(){this.toolsA.length=0};Z.prototype.onMouseDown=function(a){var f=new MapObject(a.target),g=va.getMapTool(f.objNode);g&&(map.mouseObject=new fa(a,f.objNode,"parentonly",g),map.mouseObject.parent=g)};var va=new Z,d=function(a,f,g){this.nFontSize=14;this.szLineStyle="fill:none;stroke:darkblue;stroke-width:"+map.Scale.normalX(1)+";opacity:1.0;";this.szLineStyleLite=
"fill:none;stroke:darkblue;stroke-width:"+map.Scale.normalX(.75)+";opacity:1.0;";this.szLineBgStyle="fill:none;stroke:white;stroke-width:"+map.Scale.normalX(5)+";opacity:0.5;";this.szFillBgStyle="fill:white;stroke:none;opacity:0.6";this.szTextStyle="font-family:arial;font-size:"+map.Scale.normalY(this.nFontSize)+"px;fill:darkblue;pointer-events:none;";this.szPolylineStyle="fill:none;stroke:blue;stroke-width:"+map.Scale.normalX(2.5)+";stroke-opacity:0.5;";this.szPolygonStyle="fill:blue;stroke:black;stroke-width:"+
map.Scale.normalX(1)+";fill-opacity:0.2;";this.szBufferStyle="fill:blue;stroke:darkblue;stroke-width:"+map.Scale.normalX(1)+";fill-opacity:0.2;";this.szType=f;this.objNode=map.Dom.newGroup(map.SVGToolsGroup,f+String(Math.random()));var l=this.szPolygonStyle;switch(f){case "coord":map.mouseObject=new fa(a,null,"parentonly");map.mouseObject.parent=this;l=map.Dom.newGroup(this.objNode,"distance-text"+String(Math.random()));map.Dom.newShape("rect",l,-map.Scale.normalX(this.nFontSize*.3),0,1,1,this.szFillBgStyle);
map.Dom.newText(l,0,0,this.szTextStyle,"");map.Dom.newText(l,0,0,this.szTextStyle,"");l=map.Dom.newGroup(this.objNode,"endpoint"+String(Math.random())+":maptoolnode");l.setAttributeNS(szMapNs,"menu","maptoolmenu");map.Dom.newShape("circle",l,0,0,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",l,-map.Scale.normalX(10),0,map.Scale.normalX(10),0,this.szLineStyleLite);map.Dom.newShape("line",l,0,-map.Scale.normalY(10),0,map.Scale.normalY(10),this.szLineStyleLite);map.Dom.newShape("circle",
l,0,0,map.Scale.normalX(3.7),this.szLineStyle);l.fu.setPosition(map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y);this.redraw();break;case "polyline":l=this.szPolylineStyle;case "polygon":map.mouseObject=new fa(a,null,"parentonly");map.mouseObject.parent=this;a=map.SVGDocument.getElementById("maptools_polypath");a==null&&(a=map.Dom.newNode("path",map.SVGToolsGroup),a.setAttributeNS(null,"id","maptools_polypath"),a.setAttributeNS(szMapNs,"menu","polygonmenu"),a.setAttributeNS(null,
"style",l),a.parentNode.insertBefore(a,this.objNode),va.toolShape=a);l=map.Dom.newGroup(this.objNode,"endpoint"+String(Math.random())+":maptoolnode");l.setAttributeNS(szMapNs,"menu","maptoolmenu");map.Dom.newShape("circle",l,0,0,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",l,-map.Scale.normalX(10),0,map.Scale.normalX(10),0,this.szLineStyleLite);map.Dom.newShape("line",l,0,-map.Scale.normalY(10),0,map.Scale.normalY(10),this.szLineStyleLite);map.Dom.newShape("circle",l,0,0,map.Scale.normalX(3.7),
this.szLineStyle);l.fu.setPosition(map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y);break;case "measurement":case "measurebuffer":case "selectbuffer":map.mouseObject=new fa(a,null);map.mouseObject.parent=this;map.Dom.newShape("circle",this.objNode,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.Scale.normalX(1),this.szLineBgStyle);map.Dom.newShape("circle",this.objNode,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,
map.Scale.normalX(1),this.szType=="measurebuffer"||this.szType=="selectbuffer"?this.szBufferStyle:this.szLineStyle);map.Dom.newShape("line",this.objNode,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,this.szLineBgStyle);map.Dom.newShape("line",this.objNode,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,
this.szLineStyle);l=map.Dom.newGroup(this.objNode,"distance-text"+String(Math.random()));map.Dom.newShape("rect",l,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y-map.Scale.normalY(5)-map.Scale.normalY(this.nFontSize*7/7),1E3,map.Scale.normalY(this.nFontSize*1.3),this.szFillBgStyle);map.Dom.newText(l,map.mouseObject.mouseStartPosition.x+map.Scale.normalX(5),map.mouseObject.mouseStartPosition.y-map.Scale.normalY(5),this.szTextStyle,"test");l=map.Dom.newGroup(this.objNode,
"endpoint"+String(Math.random()));map.Dom.newShape("circle",l,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",l,map.mouseObject.mouseStartPosition.x-map.Scale.normalX(10),map.mouseObject.mouseStartPosition.y,map.mouseObject.mouseStartPosition.x+map.Scale.normalX(10),map.mouseObject.mouseStartPosition.y,this.szLineStyleLite);map.Dom.newShape("line",l,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y-
map.Scale.normalX(10),map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y+map.Scale.normalX(10),this.szLineStyleLite);map.Dom.newShape("circle",l,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.Scale.normalX(3.7),this.szLineStyle);l=map.Dom.newGroup(this.objNode,"startpoint"+String(Math.random()));map.Dom.newShape("circle",l,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",
l,map.mouseObject.mouseStartPosition.x-map.Scale.normalX(10),map.mouseObject.mouseStartPosition.y,map.mouseObject.mouseStartPosition.x+map.Scale.normalX(10),map.mouseObject.mouseStartPosition.y,this.szLineStyleLite);map.Dom.newShape("line",l,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y-map.Scale.normalX(10),map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y+map.Scale.normalX(10),this.szLineStyleLite);map.Dom.newShape("circle",l,map.mouseObject.mouseStartPosition.x,
map.mouseObject.mouseStartPosition.y,map.Scale.normalX(3.7),this.szLineStyle);break;case "zoomrect":case "selectrect":map.mouseObject=new fa(a,null);map.mouseObject.parent=this;map.Dom.newShape("rect",this.objNode,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,10,10,this.szLineBgStyle);map.Dom.newShape("rect",this.objNode,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,10,10,this.szLineStyle);break;case "pan":map.mouseObject=new fa(a,null),map.mouseObject.parent=
this,this.beginPan(a)}this.mapToolList=va;va.add(this,g)};d.prototype.onMouseDown=function(a){var f=new MapObject(a.target);map.mouseObject=new fa(a,f.objNode);map.mouseObject.parent=this};d.prototype.onMouseMove=function(a){var f=map.Scale.getClientMousePosition(a,map.SVGToolsGroup),g=f.x-map.mouseObject.mouseStartPosition.x,l=f.y-map.mouseObject.mouseStartPosition.y;switch(this.szType){case "coord":a=this.objNode.childNodes;var h=0;a.item(h++);g=a.item(h++);f=map.Scale.clipWidgetPositionToMap(f);
g.fu.setPosition(f.x,f.y);this.redraw();break;case "measurement":case "measurebuffer":case "selectbuffer":a=this.objNode.childNodes;h=0;var r=a.item(h++),C=a.item(h++),F=a.item(h++),v=a.item(h++),E=a.item(h++);a=a.item(h++);r.setAttributeNS(null,"r",String(Math.sqrt(g*g+l*l)));C.setAttributeNS(null,"r",String(Math.sqrt(g*g+l*l)));F.setAttributeNS(null,"x2",String(f.x));F.setAttributeNS(null,"y2",String(f.y));v.setAttributeNS(null,"x2",String(f.x));v.setAttributeNS(null,"y2",String(f.y));a.fu.setPosition(g,
l);E.fu.setPosition(g/2,l/2);g=E.firstChild;l=g.nextSibling;f=map.Scale.getDistanceInMeter(map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,f.x,f.y);l.firstChild.nodeValue=map.Scale.formatDistanceString(f);f=map.Dom.getBox(l);g.setAttributeNS(null,"width",f.width+f.height*.7);break;case "zoomrect":case "selectrect":a=this.objNode.childNodes;h=0;f=a.item(h++);a=a.item(h++);f.setAttributeNS(null,"width",String(Math.max(1,g)));f.setAttributeNS(null,"height",String(Math.max(1,
l)));a.setAttributeNS(null,"width",String(Math.max(1,g)));a.setAttributeNS(null,"height",String(Math.max(1,l)));break;case "pan":map.fPDFEmbed||!map.fPanToolByViewer?(map.Zoom.doPanMap(g/map.Scale.normalX(1),l/map.Scale.normalY(1)),map.mouseObject.mouseStartPosition.x=f.x,map.mouseObject.mouseStartPosition.y=f.y):(f=map.Scale.getClientMousePosition(a,null),g=f.x-map.mouseObject.mouseStartPosition.x,l=f.y-map.mouseObject.mouseStartPosition.y,map.Zoom.doPanMapByViewer(g/map.Scale.normalX(1),l/map.Scale.normalY(1)));
break;case "polyline":case "polygon":this.objNode.firstChild.fu.setPosition(f.x,f.y),this.redraw()}};d.prototype.onMouseUp=function(a){switch(this.szType){case "coord":this.redraw();break;case "polyline":case "polygon":this.redraw();break;case "pan":displayMessage("please wait ...",500);setTimeout("map.Event.doDefaultZoom(null)",map.fPanToolByViewer?5:200);this.endPan(a);break;case "measurement":case "measurebuffer":var f=this.objNode.childNodes;var g=0;this.szType=="measurement"&&(a=f.item(g++),
g=f.item(g++),a.parentNode.removeChild(a),g.parentNode.removeChild(g));break;case "selectbuffer":f=this.objNode.childNodes;g=0;f.item(g++);g=f.item(g++);a=g.parentNode.getAttributeNS(null,"id")+":shape";g.setAttributeNS(null,"id",a);(a=map.Selections.newSelection("activeLayer",a,"type:circle"))?a.mapTool=this:this.remove();break;case "selectrect":f=this.objNode.childNodes;g=0;f.item(g++);g=f.item(g++);a=g.parentNode.getAttributeNS(null,"id")+":shape";g.setAttributeNS(null,"id",a);(a=map.Selections.newSelection("activeLayer",
a,"type:square"))?a.mapTool=this:this.remove();break;case "zoomrect":f=this.objNode.childNodes,g=0,a=f.item(g++),a=map.Dom.getBox(a),this.objNode.parentNode.removeChild(this.objNode),map.Zoom.doZoomMapToWidgetRect(a),c("")}};d.prototype.beginPan=function(a){map.fFroozeDynamicContent=!0};d.prototype.endPan=function(a){map.fFroozeDynamicContent=!1};d.prototype.doEndPan=function(a){map.fFroozeDynamicContent=!1};d.prototype.hideTools=function(a){this.toolsHidden&&this.toolsHidden!==!1||(map.antiZoomAndPanList.setDisplay(a,
"none"),this.toolsHidden=!0)};d.prototype.showTools=function(a){this.toolsHidden===!0&&(map.antiZoomAndPanList.setDisplay(a,"inline"),this.toolsHidden=!1)};d.prototype.hideLayer=function(a){for(var f in map.Layer.listA)if(a=map.Layer.listA[f],a.szFlag.match(/invisiblepan/)){if(map.Tiles&&map.Tiles.nCount>0)for(var g=map.Tiles.getTileNodeIds(f),l=0;l<g.length;l++){var h=g[l],r=map.SVGDocument.getElementById(h);r&&(a.szBeforeHideStyle=r.style.getPropertyValue("display"),r.style.setProperty("display",
"none",""));if(r=map.SVGDocument.getElementById(h+":label"))a.szBeforeHideLabelStyle=r.style.getPropertyValue("display"),r.style.setProperty("display","none","");if(r=map.SVGDocument.getElementById(h+":label:bg"))a.szBeforeHideLabelStyle=r.style.getPropertyValue("display"),r.style.setProperty("display","none","")}if(r=map.SVGDocument.getElementById(f))a.szBeforeHideStyle=r.style.getPropertyValue("display"),r.style.setProperty("display","none","");if(r=map.SVGDocument.getElementById(f+":label"))a.szBeforeHideLabelStyle=
r.style.getPropertyValue("display"),r.style.setProperty("display","none","");if(r=map.SVGDocument.getElementById(f+":label:bg"))a.szBeforeHideLabelStyle=r.style.getPropertyValue("display"),r.style.setProperty("display","none","")}};d.prototype.showLayer=function(a){for(var f in map.Layer.listA)if(a=map.Layer.listA[f],a.szFlag.match(/invisiblepan/)){if(map.Tiles&&map.Tiles.nCount>0)for(var g=map.Tiles.getTileNodeIds(f),l=0;l<g.length;l++){var h=g[l],r=map.SVGDocument.getElementById(h);r&&(a.szBeforeHideStyle.length?
r.style.setProperty("display",a.szBeforeHideStyle,""):r.style.removeProperty("display"));(r=map.SVGDocument.getElementById(h+":label"))&&(a.szBeforeHideLabelStyle.length?r.style.setProperty("display",a.szBeforeHideLabelStyle,""):r.style.removeProperty("display"));(r=map.SVGDocument.getElementById(h+":label:bg"))&&(a.szBeforeHideLabelStyle.length?r.style.setProperty("display",a.szBeforeHideLabelStyle,""):r.style.removeProperty("display"))}(r=map.SVGDocument.getElementById(f))&&(a.szBeforeHideStyle.length?
r.style.setProperty("display",a.szBeforeHideStyle,""):r.style.removeProperty("display"));(r=map.SVGDocument.getElementById(f+":label"))&&(a.szBeforeHideLabelStyle.length?r.style.setProperty("display",a.szBeforeHideLabelStyle,""):r.style.removeProperty("display"));(r=map.SVGDocument.getElementById(f+":label:bg"))&&(a.szBeforeHideLabelStyle.length?r.style.setProperty("display",a.szBeforeHideLabelStyle,""):r.style.removeProperty("display"))}};d.prototype.redraw=function(a){switch(this.szType){case "polygon":var f=
map.SVGDocument.getElementById("maptools_polypath");if(f==null)break;var g=[],l=this.mapToolList.toolsA,h="",r=l[0].objNode.firstChild;r.fu=new Methods(r);r=r.fu.getPosition();g[g.length]=r;h+="M"+r.x+","+r.y;for(var C=1;C<l.length;C++)r=l[C].objNode.firstChild,r.fu=new Methods(r),r=r.fu.getPosition(),g[g.length]=r,h+=" "+r.x+","+r.y;f.setAttributeNS(null,"d",h+"z");(h=map.SVGDocument.getElementById("maptools_phantomPointGroup"))?map.Dom.clearGroup(h):h=map.Dom.newGroup(this.objNode,"maptools_phantomPointGroup");
for(C=0;C<g.length;C++){l=g[C].x+(g[C<g.length-1?C+1:0].x-g[C].x)/2;r=g[C].y+(g[C<g.length-1?C+1:0].y-g[C].y)/2;var F=map.Dom.newShape("circle",h,l,r,map.Scale.normalX(10),"fill:white;stroke:none;opacity:0.1;");map.Dom.newShape("circle",h,l,r,map.Scale.normalX(2),this.szPolygonStyle+"pointer-events:none;");F.setAttributeNS(szMapNs,"tooltip","click to add point");F.setAttributeNS(null,"onmousedown","new MapTool(evt,'polygon',"+(C+1)+")")}(h=map.Dom.getObjectById("maptools_polygon_text"))?map.Dom.clearGroup(h):
h=map.Dom.newGroup(map.SVGToolsGroup,"maptools_polygon_text");C=__doGetPolygonCenter(g);f=Math.abs(__doGetPolygonSurface(g,!0));g=new e(a,h,"maptooltext_template",18);g.setText(map.Scale.formatSurfaceString(f));a=g.textGroup.fu.getBox();g.setPosition(C.x-a.width/2,C.y-a.height/2);break;case "polyline":l=map.SVGDocument.getElementById("maptools_polypath");if(l==null)break;g=[];f=this.mapToolList.toolsA;h="";r=f[0].objNode.firstChild;r.fu=new Methods(r);r=r.fu.getPosition();g[g.length]=r;h+="M"+r.x+
","+r.y;for(C=1;C<f.length;C++)r=f[C].objNode.firstChild,r.fu=new Methods(r),r=r.fu.getPosition(),h+=" "+r.x+","+r.y,g[g.length]=r;l.setAttributeNS(null,"d",h);(h=map.SVGDocument.getElementById("maptools_phantomPointGroup"))?map.Dom.clearGroup(h):h=map.Dom.newGroup(this.objNode,"maptools_phantomPointGroup");for(C=0;C<g.length-1;C++)l=g[C].x+(g[C+1].x-g[C].x)/2,r=g[C].y+(g[C+1].y-g[C].y)/2,F=map.Dom.newShape("circle",h,l,r,map.Scale.normalX(2),this.szPolygonStyle),F.setAttributeNS(szMapNs,"tooltip",
"click to add point"),F.setAttributeNS(null,"onmousedown","new MapTool(evt,'polyline',"+(C+1)+")");(h=map.SVGDocument.getElementById("maptools_polyline_textgroup"))?map.Dom.clearGroup(h):h=map.Dom.newGroup(this.objNode,"maptools_polyline_textgroup");l=0;for(C=1;C<f.length;C++){g=f[C].objNode.firstChild;r=f[C-1].objNode.firstChild.fu.getPosition();var v=g.fu.getPosition();l+=F=map.Scale.getDistanceInMeter(r.x,r.y,v.x,v.y);g=new e(a,h,"maptooltext_template",12);g.setText(map.Scale.formatDistanceString(F));
g.setPosition(r.x+(v.x-r.x)/2,r.y+(v.y-r.y)/2)}v=f[f.length-1].objNode.firstChild.fu.getPosition();g=new e(a,h,"maptooltext_template",18);g.setText(map.Scale.formatDistanceString(l));g.setPosition(v.x+map.Scale.normalX(5),v.y);g.textGroup.setAttributeNS(szMapNs,"menu","polylinemenu");break;case "coord":f=this.objNode.childNodes,C=0,a=f.item(C++),C=f.item(C++).fu.getPosition(),f=a.firstChild,g=f.nextSibling,h=g.nextSibling,l=map.Scale.getMapPosition(C.x,C.y),l=map.Scale.getMapCoordinate(l.x,l.y),l=
map.Scale.getGeoCoordinateOfPoint(l.x,l.y),r="Y="+String(l.y),g.firstChild.nodeValue="X="+String(l.x),h.firstChild.nodeValue=r,l=map.Dom.getBox(g),r=map.Dom.getBox(h),g.setAttributeNS(null,"y",Number(l.height)),h.setAttributeNS(null,"y",Number(l.y)+Number(l.height)+Number(r.height)+map.Scale.normalY(3)),f.setAttributeNS(null,"width",l.width+map.Scale.normalY(8)),f.setAttributeNS(null,"height",Number(l.height)+Number(r.height)+map.Scale.normalY(12)),C=new point(C.x,C.y),f=new point(map.Scale.normalX(5),
map.Scale.normalY(5)),C=map.Scale.clipWidgetObjectToMap(a,C,f),a.fu.setPosition(C.x,C.y)}};d.prototype.remove=function(a){this.objNode.parentNode.removeChild(this.objNode)};d.prototype.printPolygon=function(a){(a=map.SVGDocument.getElementById("maptools_polygon"))&&alert(printNode(a))};var c=function(a){a=="info"&&map.szMapToolType=="info"&&deactivateTheme(map._activeTheme);a=="pan"&&deactivateTheme(map._activeTheme);killTooltip();B();map.Dom.clearGroup(map.SVGMenuGroup);map.Dom.clearGroup(map.SVGToolsGroup);
va.clear();map.szMapToolType=a;map.fPDFEmbed&&map.fSetToolCursor&&setTimeout("setMapToolCursor('"+a+"')",100);try{map.HTMLWindow.ixmaps.htmlgui_setMapTool(a)}catch(f){}},e=function(a,f,g,l){(a=map.SVGDocument.getElementById(g))?(this.textGroup=f.appendChild(a.cloneNode(1E3)),this.textGroup.fu=new Methods(this.textGroup),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),this.textGroup.setAttributeNS(null,"id",g+String(Math.random())),f=this.textGroup.getElementsByTagName("rect"),g=
this.textGroup.getElementsByTagName("text"),f.length>1?(this.sdNode=f.item(0),this.bgNode=f.item(1)):this.bgNode=f.item(0),this.textNode=g.item(0),l&&this.textNode.style.setProperty("font-size",String(l)+"px",""),this.textNode.parentNode==this.textGroup?(this.workspaceNode=map.Dom.newGroup(this.textGroup,"workspace:"+String(Math.random())),this.textGroup.insertBefore(this.workspaceNode,this.textNode),this.workspaceNode.appendChild(this.textNode)):this.workspaceNode=this.textNode.parentNode):g=="flat"?
(this.textGroup=map.Dom.newGroup(f,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),map.fMapBorder3D&&map.SVGDocument.getElementById(map.szShadowFilterId)&&(this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#444444;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,"rx",map.nInfoRoundRect*l/6),this.sdNode.setAttributeNS(null,"ry",map.nInfoRoundRect*l/6)),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#ffffff;stroke:#888888;stroke-width:2;"),
this.bgNode.setAttributeNS(null,"rx",map.nInfoRoundRect*l/6),this.bgNode.setAttributeNS(null,"ry",map.nInfoRoundRect*l/6),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+l+"px;fill:#888888",""),this.workspaceNode=this.textNode.parentNode,this.textGroup.setAttributeNS(null,"opacity","0.7")):g=="light"?(this.textGroup=map.Dom.newGroup(f,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),map.fMapBorder3D&&map.SVGDocument.getElementById(map.szShadowFilterId)&&
(this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#444444;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,"rx",map.nInfoRoundRect*l/6),this.sdNode.setAttributeNS(null,"ry",map.nInfoRoundRect*l/6)),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#fdfdfd;stroke:#888888;stroke-width:0.1;opacity:1;"),this.bgNode.setAttributeNS(null,"rx",map.nInfoRoundRect*l/6),this.bgNode.setAttributeNS(null,"ry",map.nInfoRoundRect*l/6),this.textNode=map.Dom.newText(this.textGroup,
0,0,"font-family:arial;font-size:"+l+"px;fill:#888888",""),this.workspaceNode=this.textNode.parentNode,this.textGroup.setAttributeNS(null,"opacity","0.95")):g=="alert"?(this.textGroup=map.Dom.newGroup(f,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),map.SVGDocument.getElementById(map.szShadowFilterId)&&(this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#666666;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,"rx",map.Scale.normalY(.1)),
this.sdNode.setAttributeNS(null,"ry",map.Scale.normalY(.1))),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#F9EDB8;stroke:#EDC967;stroke-width:1;opacity:1"),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+l+"px;fill:black",""),this.workspaceNode=this.textNode.parentNode):(this.textGroup=map.Dom.newGroup(f,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),this.sdNode=map.Dom.newShape("rect",this.textGroup,
0,0,1,1,"fill:#444444;opacity:0.5;stroke:none"),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#ffffff;stroke:blue;stroke-width:0.1"),this.sdNode.setAttributeNS(null,"rx",map.nInfoRoundRect),this.sdNode.setAttributeNS(null,"ry",map.nInfoRoundRect),this.bgNode.setAttributeNS(null,"rx",map.nInfoRoundRect),this.bgNode.setAttributeNS(null,"ry",map.nInfoRoundRect),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+l+"px;fill:black",""),this.workspaceNode=
this.textNode.parentNode,g=="transparent"&&(this.textGroup.setAttributeNS(null,"opacity","0.4"),this.sdNode.setAttributeNS(null,"rx",map.nInfoRoundRect*5),this.sdNode.setAttributeNS(null,"ry",map.nInfoRoundRect*5),this.bgNode.setAttributeNS(null,"rx",map.nInfoRoundRect*5),this.bgNode.setAttributeNS(null,"ry",map.nInfoRoundRect*5)))};e.prototype.setText=function(a){try{return this.textNode.firstChild.nodeValue=a,this.resizeField(),!0}catch(f){return!1}};e.prototype.resizeField=function(){try{var a=
map.Dom.getBox(this.workspaceNode);this.bgNode&&(this.bgNode.setAttributeNS(null,"x",a.x-12),this.bgNode.setAttributeNS(null,"y",a.y-4),this.bgNode.setAttributeNS(null,"width",a.width+24),this.bgNode.setAttributeNS(null,"height",a.height+10));this.sdNode&&(this.sdNode.setAttributeNS(null,"x",a.x-6+1),this.sdNode.setAttributeNS(null,"y",a.y-3+2),this.sdNode.setAttributeNS(null,"width",a.width+12+1),this.sdNode.setAttributeNS(null,"height",a.height+6+1))}catch(f){}};e.prototype.setPosition=function(a,
f){this.textGroup.fu.setPosition(a,f)};var b=function(a,f,g,l,h,r){this.nMaxWidth=l?l:100;this.nMaxHeight=h?h:100;this.nScrollBarWidth=r?r:10;f!=null&&(a=":"+String(Math.random()),(l=map.SVGDocument.getElementById(g))?(this.areaGroup=f.appendChild(l.cloneNode(1E3)),this.areaGroup.fu=new Methods(this.areaGroup),this.areaGroup.fu.extendAllIds(this.areaGroup,a),this.workspaceNode=map.SVGDocument.getElementById(g+":workspace"+a),this.cliprectNode=map.SVGDocument.getElementById(g+":cliprect"+a)):(g="scrollarea",
this.areaGroup=map.Dom.newGroup(f,g+a),f=map.Dom.newNode("clipPath",this.areaGroup),f.setAttribute("id",g+":clippath"+a),f.setAttribute("style","pointer-events:all"),this.cliprectNode=map.Dom.newShape("rect",f,0,0,map.Scale.normalX(this.nMaxWidth),map.Scale.normalY(this.nMaxHeight),"fill:none;stroke:none"),this.cliprectNode.setAttribute("id",g+":cliprect"+a),this.areaGroup.setAttributeNS(null,"clip-path","url(#"+g+":clippath"+a+")"),this.workspaceNode=map.Dom.newGroup(this.areaGroup,g+":workspace"+
a)),this.szId=g)};b.prototype.setWidth=function(a){this.cliprectNode&&(this.nMaxWidth=Number(a),this.cliprectNode.setAttributeNS(null,"width",map.Scale.normalX(Math.max(this.nMaxWidth,0))))};b.prototype.setHeight=function(a){this.cliprectNode&&(this.nMaxHeight=Number(a),this.cliprectNode.setAttributeNS(null,"height",map.Scale.normalX(Math.max(this.nMaxHeight,0))))};b.prototype.setPosition=function(a,f){this.areaGroup&&this.areaGroup.fu.setPosition(a,f)};b.prototype.reformat=function(a){this.scrollObj&&
(this.scrollObj.remove(a),this.scrollObj=null);var f=new box(0,0,map.Scale.normalX(this.nMaxWidth),map.Scale.normalY(this.nMaxHeight)),g=getTranslate(this.workspaceNode);if(this.nMaxWidth<0||this.nMaxHeight<0){var l=map.Dom.getBox(this.workspaceNode);f.width=this.nMaxWidth>=0?f.width:l.width+map.Scale.normalX(this.nScrollBarWidth+5);f.height=this.nMaxHeight>=0?f.height:l.height+map.Scale.normalY(this.nScrollBarWidth+5);this.cliprectNode.setAttributeNS(null,"width",f.width);this.cliprectNode.setAttributeNS(null,
"height",f.height)}this.scrollObj=new Ta(this.workspaceNode,new point(g.x,g.y),f,map.Scale.normalX(this.nScrollBarWidth),map.Scale.normalY(this.nScrollBarWidth),map.Scale.normalX(1)),this.scrollObj.draw(a)};b.prototype.remove=function(a){this.scrollObj&&(this.scrollObj.remove(a),this.scrollObj=null);this.areaGroup&&(this.areaGroup.parentNode.removeChild(this.areaGroup),this.areaGroup=null)};b.prototype.hasScrollBars=function(a){return this.scrollObj?this.scrollObj.hasScrollBars():!1};b.prototype.getWidth=
function(){return this.cliprectNode?Number(this.cliprectNode.getAttributeNS(null,"width"))/map.Scale.normalX(1):0};b.prototype.getHeight=function(){return this.cliprectNode?Number(this.cliprectNode.getAttributeNS(null,"height"))/map.Scale.normalY(1):0};b.prototype.setScrollPosition=function(a){this.scrollObj&&this.scrollObj.vThumbObj&&this.scrollObj.vThumbObj.setValue(a);this.scrollObj&&this.scrollObj.hThumbObj&&this.scrollObj.hThumbObj.setValue(a)};var n=[];map.removeAllHighlights=function(){for(var a=
0;a<n.length;a++)n[a]&&(n[a].unlock(),n[a].removeAll());n.length=0};var m=function(){this.itemA=[];n[n.length]=this};m.prototype.addItem=function(a,f){for(var g=0;g<this.itemA.length;g++)if(this.itemA[g].node==a)return null;a=new K(a,f);this.itemA[this.itemA.length]=a;return a.node};m.prototype.checkItem=function(a){for(var f=0;f<this.itemA.length;f++)if(this.itemA[f].node==a)return!0;return!1};m.prototype.removeItem=function(a){a=map.Layer.getLayerItemNodeOfNode(a);for(var f=0;f<this.itemA.length;f++)if(this.itemA[f].node==
a){for(this.itemA[f].removeHighLight();f<this.itemA.length-1;f++)this.itemA[f]=this.itemA[f+1];--this.itemA.length}};m.prototype.offAll=function(){for(var a=0;a<this.itemA.length;a++)this.itemA[a].removeHighLight()};m.prototype.onAll=function(){for(var a=0;a<this.itemA.length;a++)this.itemA[a].doHighLight()};m.prototype.startToggle=function(){map.nHighlightToggle>0&&(this.toggleCount=map.nHighlightToggle*2,setTimeout("__highlightObject.toggleAll()",1E3))};m.prototype.toggleAll=function(){for(var a=
0;a<this.itemA.length;a++)this.itemA[a].highlighted?this.itemA[a].removeHighLight():this.itemA[a].doHighLight();--this.toggleCount>0&&setTimeout("__highlightObject.toggleAll()",500)};m.prototype.removeAll=function(){if(!this.fLock){for(var a=0;a<this.itemA.length;a++)this.itemA[a].removeHighLight();this.itemA.length=0}};m.prototype.lock=function(){this.fLock=!0};m.prototype.unlock=function(){this.fLock=!1};K.prototype.doHighLight=function(){var a=this.node;if(a){if(this.szMode&&this.szMode=="circle"&&
this.node.parentNode.fu&&this.node.parentNode.fu.getPosition){this.highlightGroup=this.highlightGroup||map.Dom.newGroup(map.Layer.objectGroup,":highlightgroup");this.itemNode=map.Dom.newGroup(this.highlightGroup);a=map.Scale.normalX(10)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale;var f=map.Scale.normalX(2)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,g=map.Scale.normalX(1)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale;map.Dom.newShape("circle",this.itemNode,0,0,a,"fill:none;fill-opacity:0.1;stroke:black;stroke-dasharray:"+
g+" "+g+";stroke-width:"+f*1.1+"px;pointer-events:none");map.Dom.newShape("circle",this.itemNode,0,0,a,"fill:none;fill-opacity:0.1;stroke:white;stroke-dasharray:"+g+" "+g+";stroke-width:"+f+"px;pointer-events:none");map.Dom.getBox(this.node);a=this.node.parentNode.fu.getScale();var l=this.node.fu.getPosition().x*a.x;a=this.node.fu.getPosition().y*a.y;l=this.node.parentNode.fu.getPosition().x+l;a=this.node.parentNode.fu.getPosition().y+a;this.itemNode.fu.setPosition(l,a);this.itemNode.fu.scaleBy(1,
1/map.Zoom.nZoomY*map.Zoom.nZoomX);return!0}if(this.szMode&&this.szMode=="isolate"&&this.node.parentNode.fu&&this.node.parentNode.fu.getPosition)return a=a.cloneNode(1E3),this.highlightGroup=this.highlightGroup||map.Dom.newGroup(map.Layer.objectGroup.parentNode,":highlightgroup"),this.itemNode=this.highlightGroup.appendChild(a),this.itemNode.setAttributeNS(null,"id",""),this.itemNode.style.removeProperty("fill"),this.itemNode.style.removeProperty("fill-opacity"),map.Dom.getBox(this.node),a=this.node.parentNode.fu.getScale(),
l=this.node.fu.getPosition().x*a.x,a=this.node.fu.getPosition().y*a.y,l=this.node.parentNode.fu.getPosition().x+l,a=this.node.parentNode.fu.getPosition().y+a,this.itemNode.fu=new Methods(this.itemNode),this.itemNode.fu.setPosition(l,a),l=this.node.fu.getScale(),a=this.node.parentNode.fu.getScale(),this.itemNode.fu.scale(l.x*a.x,l.y*a.y),this.objectGroupOpacity=map.Layer.objectGroup.style.getPropertyValue("opacity")||1,map.Layer.objectGroup.style.setProperty("opacity","0.3"),l=map.Dom.newGroup(this.itemNode),
a=map.Scale.normalX(50)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,f=map.Scale.normalX(10)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,g=map.Scale.normalX(5)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,map.Dom.newShape("circle",l,0,0,a,"fill:none;fill-opacity:0.1;stroke:black;stroke-dasharray:"+g+" "+g+";stroke-width:"+f*1.1+"px;pointer-events:none"),map.Dom.newShape("circle",l,0,0,a,"fill:none;fill-opacity:0.1;stroke:white;stroke-dasharray:"+g+" "+g+";stroke-width:"+f+
"px;pointer-events:none"),map.Dom.getBox(this.node),a=this.node.parentNode.fu.getScale(),this.node.fu.getPosition(),this.node.fu.getPosition(),this.node.parentNode.fu.getPosition(),this.node.parentNode.fu.getPosition(),l.fu.scale(1/a.x,1/a.y),l.fu.scaleBy(1,1/map.Zoom.nZoomY*map.Zoom.nZoomX),!0;if(this.szMode&&this.szMode=="scale"&&this.node.parentNode.fu&&this.node.parentNode.fu.getPosition)return a.nodeName=="g"&&(a=a.cloneNode(1E3),this.highlightGroup=this.highlightGroup||map.Dom.newGroup(map.Layer.objectGroup.parentNode,
":highlightgroup"),this.highlightGroup.style.setProperty("pointer-events","none"),this.itemNode=this.highlightGroup.appendChild(a),this.itemNode.setAttributeNS(null,"id",""),this.itemNode.style.removeProperty("fill"),this.itemNode.style.removeProperty("fill-opacity"),map.Dom.getBox(this.node),a=this.node.parentNode.fu.getScale(),l=this.node.fu.getPosition().x*a.x,a=this.node.fu.getPosition().y*a.y,l=this.node.parentNode.fu.getPosition().x+l,a=this.node.parentNode.fu.getPosition().y+a,this.itemNode.fu=
new Methods(this.itemNode),this.itemNode.fu.setPosition(l,a),l=this.node.fu.getScale(),a=this.node.parentNode.fu.getScale(),this.itemNode.fu.scale(l.x*a.x,l.y*a.y),l=map.Dom.newGroup(this.itemNode),a=map.Scale.normalX(10)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,f=map.Scale.normalX(2)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,g=map.Scale.normalX(1)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,map.Dom.newShape("circle",l,0,0,a,"fill:none;fill-opacity:0.1;stroke:black;stroke-dasharray:"+
g+" "+g+";stroke-width:"+f*1.1+"px;pointer-events:none"),map.Dom.newShape("circle",l,0,0,a,"fill:none;fill-opacity:0.1;stroke:white;stroke-dasharray:"+g+" "+g+";stroke-width:"+f+"px;pointer-events:none"),map.Dom.getBox(this.node),a=this.node.parentNode.fu.getScale(),this.node.fu.getPosition(),this.node.fu.getPosition(),this.node.parentNode.fu.getPosition(),this.node.parentNode.fu.getPosition(),l.fu.scale(1/a.x,1/a.y),l.fu.scaleBy(1,1/map.Zoom.nZoomY*map.Zoom.nZoomX)),!0;if(this.szMode&&this.szMode==
"scalex")return this.node.parentNode.fu&&this.node.parentNode.fu.getPosition&&(a=a.cloneNode(1E3),this.highlightGroup=this.highlightGroup||map.Dom.newGroup(map.Layer.objectGroup.parentNode,":highlightgroup"),this.itemNode=this.highlightGroup.appendChild(a),this.itemNode.setAttributeNS(null,"id",""),this.itemNode.fu=new Methods(this.itemNode),this.itemNode.fu.scaleBy(0,0)),!0;l=new MapObject(a);f=map.Layer.getLayerObj(l.szId);l=f.szHighlight;if(!l)switch(f.szType){case "point":l="filter:url(#Glow);scale:1.5";
break;case "line":l="fill:none;stroke:yellow;stroke-width:5;stroke-opacity:0.3";break;case "polygon":l="fill:yellow"}if(this.szMode&&this.szMode=="hint")switch(f.szType){case "point":l="filter:url(#Glow);scale:1.5";break;case "line":l="fill:none;stroke:yellow;stroke-width:5;stroke-opacity:0.3";break;case "polygon":l="fill:#eeeeff;fill-opacity:0.2;stroke-opacity:0.5;stroke:#eeeeff;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;"}if(l=__scaleStyleString(l,map.Scale.normalX(1/map.Zoom.nZoom))){g=
a.parentNode;var h=g.nextSibling;h&&h.nodeType==1&&h.getAttributeNS(null,"id").match(/highlightgroup/)?this.highlightGroup=h:(this.highlightGroup=map.Dom.newGroup(g.parentNode,f.szName+":highlightgroup"),this.highlightGroup=g.parentNode.insertBefore(this.highlightGroup,h),this.highlightGroup.setAttributeNS(null,"class",g.getAttributeNS(null,"class")));this.highlightGroup.setAttributeNS(null,"style",l+";display:inline;pointer-events:none");a=a.cloneNode(1E3);this.itemNode=this.highlightGroup.appendChild(a);
this.itemNode.setAttributeNS(null,"id","");if(l.match(/fill:/)&&(this.itemNode.style.removeProperty("fill"),this.itemNode.style.removeProperty("fill-opacity"),this.itemNode.hasChildNodes))for(a=this.itemNode.childNodes,f=0;f<a.length;f++)a.item(f).nodeType==1&&a.item(f).style.setProperty("fill","inherit","");if(l.match(/stroke:/)&&(this.itemNode.style.removeProperty("stroke"),this.itemNode.hasChildNodes))for(a=this.itemNode.childNodes,f=0;f<a.length;f++)a.item(f).nodeType==1&&(a.item(f).style.setProperty("stroke",
"none",""),a.item(f).style.removeProperty("stroke"));if(l.match(/scale:/)){this.itemNode.fu=new Methods(this.itemNode);l=parseFloat(l.split("scale:")[1]);if(isNaN(l)||l===0)l=1.5;this.itemNode.fu.scaleBy(l,l)}return this.highlighted=!0}return!1}};K.prototype.removeHighLight=function(){this.highlightGroup&&this.highlightGroup.parentNode&&this.highlightGroup.parentNode.removeChild(this.highlightGroup);this.highlighted=!1;this.objectGroupOpacity&&(map.Layer.objectGroup.style.setProperty("opacity",this.objectGroupOpacity),
this.objectGroupOpacity=null)};var u=null,z=null;ixMap.prototype.displayInfo=function(a,f,g){y(a,f,g)};var x=function(a,f,g){var l=null;g&&g.match(/add/)||map.SVGPopupGroup.fu.clear();var h=u?map.Event.popupContextObj=u:map.Event.popupContextObj;if(h==null)return null;var r=h.getAttributeNS(szMapNs,"info");r!=null&&r.length!==0||!h.parentNode||(h=h.parentNode,r=h.getAttributeNS(szMapNs,"info"));var C=map.Dom.getAttributeByNodeOrParents(h.parentNode,szMapNs,"info"),F=map.Dom.getAttributeByNodeOrParents(h.parentNode,
szMapNs,"show"),v=map.Dom.getAttributeByNodeOrParents(h.parentNode,szMapNs,"label");var E=map.Dom.getAttributeByNodeOrParents(h.parentNode,szMapNs,"units");var M=map.Dom.getAttributeByNodeOrParents(h,null,"id"),G=M+":info";map.Themes&&map.Themes.activeTheme&&(G+=":"+map.Themes.activeTheme.szId);if(map.SVGDocument.getElementById(G))return null;var I=null;if(M&&M.length){M=map.Tiles.getMasterId(M);var ea=M.split(":::")[0];I=map.SVGDocument.getElementById(ea+":image")}try{if(map.User.onInfoDisplay(null,
M))return null}catch(nb){}a=new point(a,f);ea=new point(map.Scale.normalX(map.nInfoOffsetX),map.Scale.normalY(map.nInfoOffsetY));f="info:"+String(Math.random());ea=new P(map.SVGDocument,map.SVGPopupGroup,f+(g.match(/pointer/)?"":":movable"),a,ea,g);var pa=ea.workspaceNode;pa=map.Dom.newGroup(pa,G);var R=new box(0,0,0,0);G=(new MapObject(h)).szId;if(G.match(/chartgroup/)){var ca=G.split(":")[1],aa=G.split(":")[3];G=ca+"::"+aa}else{var wa=map.Layer.getLayerItemNodeOfNode(h);wa&&(G=wa.getAttributeNS(null,
"id"))}aa=(map.Label.getLabel(G)||" ").replace(/<br>/g," ");map.Themes.activeTheme&&(aa=map.Themes.getTitle(G,map.Themes.activeTheme));try{var qa=map.Themes.getDataRow(G,map.Themes.activeTheme);aa=map.HTMLWindow.ixmaps.htmlgui_onInfoTitle(aa,qa)}catch(nb){}if(aa){if(!isNaN(aa)){var T=map.Layer.getLayerObj(ca);aa=(T?T.szLabel+" ":"")+aa}ea.setTitle(aa,map.Scale.tStyle.InfoContainerTitle)}if(g.match(/short/))return ea.reformat(),ea?ea.objectNode:null;if(map.Themes&&map.Themes.activeTheme){if((T=map.Layer.getLayerItemNodes(h))&&
T.length>0)for(var xa="",Ja=0;Ja<map.Themes.themesA.length;Ja++){var Da=map.Themes.themesA[Ja];if(Da.szFields!=xa&&(ca=map.Dom.newGroup(pa,"info:chart"),wa=map.Tiles.getMasterId(T[0].getAttributeNS(null,"id")),map.Themes.getChart(wa,ca,"VALUES|ZOOM|AXIS",Da),ca.hasChildNodes()||(wa=map.Tiles.getMasterId(T[0].parentNode.getAttributeNS(null,"id")))&&map.Themes.getChart(wa,ca,"VALUES|ZOOM|AXIS",Da),ca.hasChildNodes()||(wa=h.getAttributeNS(null,"id")||"",(wa=wa.split(":")[1])&&map.Themes.getChart(wa,
ca,"VALUES|ZOOM|AXIS",Da)),ca.hasChildNodes())){xa=Da.szFields;r="";killTooltip();ea.fClipped=!1;qa=map.Dom.getBox(ca);if(qa.width>0&&qa.height>0){aa=map.Scale.tStyle.Description.nFontHeight*.9;var Za=__scaleStyleString(map.Scale.tStyle.Description.szStyle,1),ib=(Da.szTitle||" ").replace(/<br>/g," ");map.Dom.newText(pa,map.Scale.normalX(6),R.height+aa,Za,ib);aa=Da.szFlag.match(/CHART/)?aa+map.Scale.normalY(6/1.3):aa+map.Scale.normalY(6*1.3);ib=map.Scale.normalX(Da.szFlag.match(/PLOT/)?200:100)/qa.width;
ca.fu.scale(ib,ib);qa=map.Dom.getBox(ca);ca.fu.setPosition(map.Scale.normalX(6)-qa.x*ib,R.height+aa-qa.y*ib);qa=map.Dom.getBox(ca);aa=qa.y+qa.height+map.Scale.normalY(6);if(R=map.Themes.getLabel(wa,Da))R=R.length<25?R:R.substr(0,25)+"...",aa+=map.Scale.normalY(6*1.3),Za=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,1),map.Dom.newText(ca,qa.x,aa,Za,R),aa+=map.Scale.tStyle.Description.nFontHeight;var Aa=map.Themes.getSummary(wa,Da);Aa&&(Za=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,1/
ib),map.Dom.newText(ca,qa.x,aa,Za,Aa));R=map.Dom.getBox(pa);R.height+=map.Scale.normalY(12)}Da.fShowData&&(l=Da.getDataGrid(wa,pa))&&(l.setPosition(map.Scale.normalX(5),R.height),l.hasScrollBars&&l.hasScrollBars()&&l.workspaceNode.style.setProperty("display","none",""))}}else{ca=map.Dom.newGroup(pa,"info:chart");wa=(new MapObject(h)).szId;Da=wa.split(":")[1];Ja=wa.split(":")[3];aa=(T=map.Layer.getLayerObj(Da))?T.szSelection+" ":"";(T=map.Themes.getTheme(wa.split(":")[0]))&&T.szInfoTitle&&(aa=T.szInfoTitle);
aa=(wa=map.Label.getLabel(Da+"::"+Ja))?wa:aa+Ja;wa=Da+"::"+Ja;if(T.szFlag.match(/PLOT/))for(Ja=0;Ja<map.Themes.themesA.length;Ja++)Da=map.Themes.themesA[Ja],Da.szFlag.match(/PLOT/)&&map.Themes.getChart(wa,ca,"VALUES|XAXIS|ZOOM|BOX|GRID",Da);else T.szFlag.match(/POINTER/)&&T.nOrigSumA.length>1&&T.partsA.length>1?map.Themes.getChart(wa,ca,"VALUES|ZOOM|AXIS|HORZ",T):(map.Themes.getChart(wa,ca,"VALUES|ZOOM|AXIS",T),T.szFlag.match(/COUNTS/)&&T.partsA.length>1&&(Da=map.Dom.newGroup(ca,"info:chart:x"),Ja=
T.nNormalSizeValue,T.nNormalSizeValue=map.Themes.getMaxValue(wa,T)*10,map.Themes.getChart(wa,Da,"CHART|BAR|HORZ|ZOOM|VALUES|AXIS|NOZERO|SORT",T),T.nNormalSizeValue=Ja,Da.fu.setPosition(0,Da.fu.getBox().height+ca.fu.getBox().height/2+map.Scale.normalX(5))));T&&T.itemA[wa]&&T.itemA[wa].szSelectionId&&(aa=T.itemA[wa].szSelectionId.split(":").pop());T&&T.itemA[wa]&&T.itemA[wa].szTitle&&(aa=T.itemA[wa].szTitle);T&&T.itemA[wa]&&T.itemA[wa].szSelectionId2&&T.itemA[wa].szSelectionId2!="undefined"&&(aa+=" ==> "+
T.itemA[wa].szSelectionId2);try{qa=map.Themes.getDataRow(G,map.Themes.activeTheme),aa=map.HTMLWindow.ixmaps.htmlgui_onInfoTitle(aa,qa)}catch(nb){}if(ca.hasChildNodes()){killTooltip();ea.fClipped=!1;ea.setTitle(aa,map.Scale.tStyle.InfoContainerTitle);qa=map.Dom.getBox(ca);if(qa.width>0&&qa.height>0){Da=T.szFlag.match(/PLOT/)?Math.min(map.Scale.normalX(300)/qa.height,map.Scale.normalX(400)/qa.width):Math.min(map.Scale.normalX(150)/qa.height,map.Scale.normalX(200)/qa.width);ca.fu.scale(Da,Da);ca.fu.setPosition(map.Scale.normalX(6)-
qa.x*Da,R.height+map.Scale.normalY(6)-qa.y*Da);aa=qa.y+qa.height+map.Scale.normalY(6)/Da;R=1.5/Da;ib=(T.szTitle||" ").replace(/<br>/," \n ");Za=__scaleStyleString(map.Scale.tStyle.Description.szStyle,R);aa+=map.Scale.tStyle.Description.nFontHeight*R+map.Scale.normalY(2*R);Da=map.Dom.newText(ca,qa.x,aa,Za,ib);aa+=map.Scale.tStyle.Description.nFontHeight*R+map.Scale.normalY(R);map.Dom.wrapText(Da,qa.width);if(Aa=map.Themes.getValueComment(wa,map.Themes.activeTheme))Za=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,
.5),map.Dom.newText(ca,qa.x,aa,Za,Aa),map.Scale.normalY(.5);map.Themes.getSummary(wa,map.Themes.activeTheme);R=map.Dom.getBox(pa);R.height+=map.Scale.normalY(12)}else if(Aa=map.Themes.getSummary(wa,T))Aa=Aa.split("Total:")[1],Za=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,2.5),map.Dom.newText(pa,100,500,Za,Aa+T.szUnits),R=map.Dom.getBox(pa);T.fShowData&&(l=T.getDataGrid(wa,pa))&&(l.setPosition(map.Scale.normalX(5),R.height),l.hasScrollBars&&l.hasScrollBars()&&l.workspaceNode.style.setProperty("display",
"none",""))}}R=map.Dom.getBox(pa)}I&&(I=I.cloneNode(1E3),I=pa.appendChild(I),I.fu=new Methods(I),I.fu.setPosition(map.Scale.normalX(5),R.height+map.Scale.normalY(5)),I.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),R=map.Dom.getBox(pa),R.height+=map.Scale.normalX(7));if(r&&r.length&&C.length&&!l){if(F&&F.length){if(qa=[],C=C.split("|"),r=r.split("|"),F=F.split("|"),ca=v.split("|"),v=E.split("|"),F&&F.length){for(E=0;E<F.length;E++)for(I=0;I<C.length;I++)F[E]==C[I]&&(qa[qa.length]=ca&&ca[E]?map.Dictionary.getLocalText(ca[E]):
map.Dictionary.getLocalText(C[I]));for(E=0;E<F.length;E++)for(I=0;I<C.length;I++)F[E]==C[I]&&(ca=map.Dictionary.getLocalText(r[I]),qa[qa.length]=w(ca),qa[qa.length-1]+=v[E]?" "+v[E]:"")}}else{qa=[];C=C.split("|");v=E.split("|");for(E=0;E<C.length;E++)qa[qa.length]=map.Dictionary.getLocalText(C[E]);r=r.split("|");for(E=0;E<r.length;E++)isNaN(r[E])?(ca=map.Dictionary.getLocalText(C[E]+":"+r[E]),qa[qa.length]=ca!=C[E]+":"+r[E]?ca:map.Dictionary.getLocalText(r[E])):(ca=map.Dictionary.getLocalText(C[E]+
":"+r[E]),qa[qa.length]=w(ca!=C[E]+":"+r[E]?ca:r[E])),qa[qa.length-1]+=v[E]?" "+v[E]:""}if(qa.length){var wb=O(map.SVGDocument,pa,f+":textgrid",qa,2,14);wb.fu.setPosition(map.Scale.normalX(5),R.height)}try{var eb;if(eb=map.User.onInfoDisplayExtend(null,M,wb.parentNode,a))eb=wb.appendChild(eb),eb.fu.setPosition(map.Scale.normalX(5),R.height)}catch(nb){}}try{if(eb=map.HTMLWindow.ixmaps.htmlgui_onInfoDisplayExtend(map.SVGDocument,G))eb=pa.appendChild(eb),eb.fu=new Methods(eb),eb.fu.setPosition(map.Scale.normalX(10),
R.height+map.Scale.normalX(10))}catch(nb){}pa.hasChildNodes()||map.Dom.newShape("rect",pa,0,0,1,1,"fill:none;stroke:none;");ea.reformat();l&&l.workspaceNode.style.setProperty("display","inline","");g.match(/fix/)&&(ea.objectNode.fu.scale(map.nFixedInfoScale,map.nFixedInfoScale),map.SVGFixedGroup.appendChild(ea.objectNode),ea.highLightList=new m,ea.highLightList.addItem(h),ea.highLightList.lock(),ea.setOnRemove("_doRemoveFixedInfo(map.Dom.popObj('"+map.Dom.pushObj(ea)+"'))"));return ea?ea.objectNode:
null};ixMap.prototype.removeInfo=function(){map.SVGFixedGroup.fu.clear()};var w=function(a){if(a.match(/E+/)){var f=a.split("E+"),g=parseFloat(f[0]);f=parseInt(f[1]);if(!isNaN(g)&&!isNaN(f))return g*=Math.pow(10,f),String(Math.round(g*100)/100)}g=Number(a);return isNaN(g)?a:String(g)},O=function(a,f,g,l,h,r,C,F){a=Math.ceil(l.length/h);r=r?r:12;for(var v=0;v<l.length&&l[v];v++);f=map.Dom.newGroup(f,g);var E=map.SVGDocument.getElementById("TextLinesBgPattern");F||map.szTextGridStyle.match(/background/);
g=[];var M=[],G=Array(a);for(v=0;v<a;v++)G[v]=Array(h);var I=map.Dom.newNode("g",f),ea=map.Scale.normalX(5);F=map.Scale.normalX(3);var pa=Math.min(map.Scale.normalX(250),map.Scale.bBox.width/7);for(T=0;T<h;T++){var R=map.Scale.normalY(r);for(v=0;v<a;v++){h>1&&T===0&&!E&&map.szTextGridStyle.match(/background/)&&map.szTextGridStyle.match(/alternate/);var ca=map.Dom.newText(I,0,R,"font-family:arial;font-size:"+map.Scale.normalY(r)+"px;fill:"+map.szInfoBodyColor,l[v+T*a]);map.Dom.wrapText(ca,pa);G[v][T]=
ca;M[v]=ca;h>1&&T===0&&!E&&(map.szTextGridStyle.match(/firstsmall/)&&ca.style.setProperty("font-size",String(map.Scale.normalY(r*.9))+"px",""),map.szTextGridStyle.match(/firstitalic/)&&ca.style.setProperty("font-style","italic",""),map.szTextGridStyle.match(/firstgray/)&&ca.style.setProperty("fill","#888888",""));if(C&&C[v+T*a])try{var aa=__getStyleArray(C[v+T*a]),wa;for(wa in aa)ca.style.setProperty(wa,aa[wa],"")}catch(xa){}ca.setAttribute("transform","matrix(1 0 0 1 "+ea+" "+F+")");ca.nodeName!=
"a"&&ca.style.setProperty("pointer-events","none","")}R=map.Dom.getBox(I).width;if(map.szTextGridStyle.match(/firstright/)&&T===0)for(v=0;v<a;v++)M[v].setAttribute("transform","matrix(1 0 0 1 "+(ea+R)+" "+F+")"),M[v].style.setProperty("text-anchor","end","");ea=R+map.Scale.normalX(r)+map.Scale.normalX(5);if(T===0)var qa=ea}l=map.Scale.normalY(r);for(v=0;v<a;v++){C=map.Scale.normalY(r);for(var T=0;T<h;T++)C=Math.max(C,map.Dom.getBox(G[v][T]).height);for(T=0;T<h;T++)aa=getMatrix(G[v][T]),aa[5]+=l,setMatrix(G[v][T],
aa);l+=C+map.Scale.normalY(2)}h=map.Dom.getBox(I);for(v=0;v<a;v++)g[v]&&(map.szTextGridStyle.match(/full/)?g[v].setAttributeNS(null,"width",h.width+map.Scale.normalX(r/2)):g[v].setAttributeNS(null,"width",qa-map.Scale.normalX(5)));(qa=map.SVGDocument.getElementById("TextLinesBgPattern:antizoomandpan"))&&qa.setAttributeNS(null,"patternTransform","matrix(1 0 0 1 0 "+String(F-map.Scale.normalY(r-1))+")");return f};ixMap.Toolbar=function(a){this.init(a)};ixMap.Toolbar.prototype=new Map;ixMap.Toolbar.prototype.init=
function(a){a=map.SVGDocument.getElementById("legend:toolbar");var f=map.SVGDocument.getElementById("toolbar");a&&f&&(f.setAttributeNS(null,"id","toolbar:movable"),map.Dom.clearGroup(a),a.appendChild(f),a.setAttributeNS(null,"cursor","pointer"),this.refresh())};ixMap.Toolbar.prototype.refresh=function(a){if((a=map.SVGDocument.getElementById("legend:toolbar"))&&!(map.Legend&&map.Legend.objNode&&map.Legend.objNode.fu.isContained(a))){var f=map.Scale.normalX(map.nMapBorderWidth);a.fu=new Methods(a);
var g=a.fu.getPosition(),l=a.getAttributeNS(szMapNs,"position");l.match(/NONE/)&&a.style.setProperty("display","none","");l.match(/INMAP/)&&(l.match(/RIGHT/)?(l=a.fu.getBox(),a.fu.setPosition(map.Scale.mapPosition.x+map.Scale.bBox.width-f-map.Scale.normalX(10)-l.width,g.y+f)):a.fu.setPosition(map.Scale.mapPosition.x+map.Scale.normalX(6)+f,g.y+f))}};ixMap.Legend=function(a){a=a?a.target.ownerDocument:map.SVGDocument;var f=a.getElementById("legend:group");if(!f||typeof f=="undefined")return null;this.fInitializing=
!0;this.lastItemObjectA=[];this.objNode=f;this.objNode.fu=new Methods(this.objNode);a=a.getElementById("legend_body");try{map.Dictionary.applyToNode(a)}catch(g){}this.objNode.style.setProperty("display","inline","");this.objNode.style.setProperty("opacity","0","");map.fAllIncluded||map.fPDFEmbed?this.init():setTimeout("map.Legend.init()",500)};ixMap.Legend.prototype=new Map;ixMap.Legend.prototype.init=function(a){if(this.blockRecursion!==!0){var f=map.Scale.mapPosition.x?map.Scale.normalY(10):map.Scale.normalY(60),
g=a?a.target.ownerDocument:map.SVGDocument,l=g.getElementById("legend:group");if(!l)return this.fInitializing=!1;this.objNode=l;this.objNode.fu=new Methods(this.objNode);var h=g.getElementById("legend_title");g.getElementById("legend_onoff_bg:sizeable");var r=g.getElementById("legend_body"),C=g.getElementById("legend:toolbar"),F=g.getElementById("legend_bg"),v=g.getElementById("legend_body_bg"),E=g.getElementById("legend_body_header"),M=g.getElementById("legend_body_footer"),G=g.getElementById("legend_body:frame"),
I=g.getElementById("legend:off:legend_body"),ea=g.getElementById("legend_body:workspace:movabley");try{var pa=map.Dom.getBox(ea?ea:r)}catch(qa){this.fHidden||(this.show(),setTimeout("map.Legend.init()",10));this.fInitializing=!1;return}var R=1E5,ca=1E5,aa=map.SVGDocument.getElementById("legend:param");aa&&(R=Number(aa.getAttributeNS(szMapNs,"maxwidth")),ca=Number(aa.getAttributeNS(szMapNs,"maxheight")),R=R?map.Scale.normalX(R):1E6,ca=ca?map.Scale.normalY(ca):1E6);(aa=map.SVGDocument.getElementById("test:markerrect"))&&
aa.parentNode.removeChild(aa);this.fInitializing&&(this.blockRecursion=!0,this.checkGroupCollapse(null),this.blockRecursion=!1);try{pa=map.Dom.getBox(ea?ea:r)}catch(qa){pa=new box(0,0,map.Scale.normalX(150),map.Scale.normalX(300))}var wa=J(a,h);aa=J(a,E);ea=J(a,M);C&&C.parentNode==r&&(C.fu=new Methods(C),C=C.fu.getBox(),C.y<=0&&C.width>0&&C.width<1E5&&(aa.y+=C.y+C.height,aa.width=Math.max(aa.width,C.width),E&&(E.fu=new Methods(E),E.fu.setPosition(aa.x,aa.y))));if(aa.y||aa.height)G.fu=new Methods(G),
G.fu.setPosition(G.fu.getPosition().x,aa.y+aa.height);pa.height+=map.Scale.normalY(0);(C=map.SVGDocument.getElementById("legend:show:button"))&&C.style.setProperty("display","none","");r&&v&&(map.Scale.legendWidth=Math.max(wa.x+wa.width+map.Scale.normalX(10),Math.max(pa.x+pa.width,Math.max(aa.x+aa.width,ea.x+ea.width)))+map.Scale.normalX(20),map.Scale.legendWidth=Math.min(map.Scale.legendWidth,R),R=this.objNode.fu.getPosition(),R.x<map.Scale.mapPosition.x&&map.Scale.viewBox.width-map.Scale.bBox.width>
0?(map.Scale.legendWidth=map.Scale.mapPosition.x-map.Scale.normalX(2),ca=1E5,this.fInMap=!1,map.fLegendToggleButtons&&(R=Number(v.getAttributeNS(null,"y")),v.setAttributeNS(null,"y",R+map.Scale.normalX(-100)),map.SVGDocument.getElementById("legend:hide:button")||(R=new ra(l,"legend:hide","BUTTON","#expand_left_button","map.Api.extendMap()","","expand map"),R.nodeObj.style.setProperty("opacity","0.9",""),R.scale(1.8,1.8),R.setPosition(map.Scale.legendWidth-map.Scale.normalX(6),map.Scale.mapPosition.y+
map.Scale.normalY(8))),map.SVGDocument.getElementById("legend:show:button")||(R=new ra(l.parentNode,"legend:show","BUTTON","#expand_right_button","map.Api.normalMap()","","show legend"),l.parentNode.insertBefore(R.nodeObj,l.parentNode.firstChild),R.scale(1.8,1.8),R.nodeObj.style.setProperty("opacity","0.8",""),R.nodeObj.style.setProperty("display","none",""),map.fMapBorder3D&&map.SVGDocument.getElementById(map.szShadowFilterId)&&R.nodeObj.style.setProperty("filter","url(#"+map.szShadowFilterId+")",
""),R.setPosition(map.Scale.normalX(9),map.Scale.mapOffset.y+map.Scale.normalY(14))))):R.x>=map.Scale.mapPosition.x+map.Scale.bBox.width?(map.Scale.legendWidth=map.Scale.viewBox.width-map.Scale.mapPosition.x-map.Scale.bBox.width-map.Scale.normalX(8),ca=1E5,this.fInMap=!1):(this.objNode.fu.setPosition(map.Scale.normalX(8+map.nMapBorderWidth),map.Scale.normalY(map.nMapBorderWidth)),ca+=ea.height,E&&E.setAttributeNS(null,"onmousedown","map.Legend.move(evt)"),I&&I.setAttributeNS(null,"onmousedown","map.Legend.move(evt)"),
this.fInMap=!0),map.Scale.legendHeight=Math.min(pa.y+pa.height+aa.y+aa.height+ea.height+map.Scale.normalY(6),Math.min(ca,map.Scale.normalY(map.Scale.getEmbedHeight()/map.Scale.getEmbedScale())-f)),v.setAttributeNS(null,"width",map.Scale.legendWidth),v.setAttributeNS(null,"height",map.Scale.legendHeight-Number(v.getAttributeNS(null,"y"))+map.Scale.normalY(5)),v.setAttributeNS(null,"rx",map.Scale.normalX(2)),v.setAttributeNS(null,"ry",map.Scale.normalX(2)),this.fInMap&&(map.fObjectPseudoShadow&&!this.shadowNode&&
(l=(f=v.style.getPropertyValue("opacity"))&&f.length?Number(f):1,f=v.style.getPropertyValue("fill-opacity"),f=l*(f&&f.length?Number(f):1),f=f==1?f*.5:f*.2,this.shadowNode=map.Dom.newShape("rect",r,map.Scale.normalX(3),map.Scale.normalY(-19),map.Scale.normalX(10),map.Scale.normalY(10),"fill:#444444;stroke:#888888;opacity:"+f+";"),this.shadowNode=r.insertBefore(this.shadowNode,v)),this.shadowNode.setAttributeNS(null,"width",map.Scale.legendWidth),this.shadowNode.setAttributeNS(null,"height",map.Scale.legendHeight-
Number(v.getAttributeNS(null,"y"))+map.Scale.normalY(5)),this.shadowNode.setAttributeNS(null,"rx",map.Scale.normalX(5)),this.shadowNode.setAttributeNS(null,"ry",map.Scale.normalX(5))),v.setAttributeNS(szMapNs,"menu","legendmenu"));r&&F&&F.setAttributeNS(null,"width",pa.x+pa.width-map.Scale.normalY(15));r&&I&&map.fInitLegendOff&&(r.style.setProperty("display","none",""),I.style.setProperty("display","none",""));if(G)if(r=map.Dom.setClipRect(G,new box(0,0,1,1)),F=map.Scale.legendHeight-aa.height-ea.height,
pa.height<=F?(r.setAttributeNS(null,"width",map.Scale.legendWidth),r.setAttributeNS(null,"height",pa.y+pa.height+map.Scale.normalY(10))):(r.setAttributeNS(null,"width",map.Scale.legendWidth),r.setAttributeNS(null,"height",F)),M&&(M.fu=new Methods(M),M.fu.setPosition(0,map.Scale.legendHeight-ea.height-map.Scale.normalY(2)),map.Dom.setClipRect(M,new box(0,0,map.Scale.legendWidth-map.Scale.normalX(1),map.Scale.viewBox.height))),E&&map.Dom.setClipRect(E,new box(0,0,map.Scale.legendWidth-map.Scale.normalX(1),
F)),h&&map.Dom.setClipRect(h,new box(map.Scale.normalX(-20),map.Scale.normalY(-20),map.Scale.legendWidth-map.Scale.normalX(0),F)),this.scrollObj)h=new box(r.getAttributeNS(null,"x"),r.getAttributeNS(null,"y"),r.getAttributeNS(null,"width"),r.getAttributeNS(null,"height")),this.scrollObj.setWidth(h.width/map.Scale.normalX(1)),this.scrollObj.setHeight(h.height/map.Scale.normalY(1)),this.scrollObj.reformat(a);else if(E=g.getElementById("legend_body:workspace:movabley"))h=new box(r.getAttributeNS(null,
"x"),r.getAttributeNS(null,"y"),r.getAttributeNS(null,"width"),r.getAttributeNS(null,"height")),this.scrollObj=new b(a,null,null,h.width/map.Scale.normalX(1),h.height/map.Scale.normalY(1),10),this.scrollObj.workspaceNode=E,this.scrollObj.cliprectNode=r,this.scrollObj&&this.scrollObj.reformat(a);map.fClipMapToLegend&&(a=g.getElementById("mapcliprect"))&&(g=map.Dom.getBox(a),g=g.x+g.width,h=map.Scale.normalX(5),a.setAttributeNS(null,"x",map.Scale.legendWidth+h),a.setAttributeNS(null,"width",g-map.Scale.legendWidth-
h));this.fInitializing=!1;this.objNode.parentNode.appendChild(this.objNode);this.fHidden||this.show();return!0}};ixMap.Legend.prototype.move=function(a){map.mouseObject=new fa(a,this.objNode)};ixMap.Legend.prototype.reformat=function(a){this.scrollObj&&this.scrollObj.reformat(a)};ixMap.Legend.prototype.hide=function(a){this.objNode.style.setProperty("display","none","");this.fHidden=!0;(a=map.SVGDocument.getElementById("legend:show:button"))&&a.style.setProperty("display","inline","")};ixMap.Legend.prototype.show=
function(a){this.objNode.style.setProperty("display","inline","");this.objNode.style.setProperty("opacity","1","");this.fHidden=!1;(a=map.SVGDocument.getElementById("legend:show:button"))&&a.style.setProperty("display","none","")};ixMap.Legend.prototype.getPosition=function(a){return(a=(a?a.target.ownerDocument:map.SVGDocument).getElementById("legend:group"))?(a=getMatrix(a),new point(a[4],a[5])):new point(0,0)};ixMap.Legend.prototype.checkGroupCollapse=function(a,f){var g=a?a.target.ownerDocument:
map.SVGDocument;f==null&&(f=g.getElementById("legend_body:workspace:movabley"));if(f&&f.nodeType==1){f=f.childNodes;for(var l=0;l<f.length;l++)if(f.item(l).nodeType==1){var h=f.item(l).getAttributeNS(szMapNs,"mode");h&&h.match(/HIDDEN/)&&(h=f.item(l).getAttributeNS(null,"id").split(":"),h[0]=="legend"&&h[1]=="item"&&(h=g.getElementById("legend:collapse:"+h[2]),this.legendMouseClick(a,h)));this.checkGroupCollapse(a,f.item(l))}}};ixMap.Legend.prototype.legendMouseClick=function(a,f){if(f==null||f.nodeType!=
1)return!1;var g=f.getAttributeNS(null,"id");if(g&&!g.match(/legend/))return!1;if(g&&g.match(/this:item/))return this.execLegendMouseClickOnItem(a,f,g),!0;g=g.split(":");for(var l=3;l<g.length;l++)g[2]+=":"+g[l];this.execLegendMouseClick(a,f,g[2],g[1])||this.execLegendMouseClickOnTiles(a,f,g[2],g[1])||(clearThemes(),c(""));g[2]&&!g[2].match(/:label/)&&map.Layer.isScaleDependentLayerOn(g[2]+":label")&&this.execLegendMouseClick(a,f,g[2]+":label",g[1]);return!0};ixMap.Legend.prototype.execLegendMouseClick=
function(a,f,g,l,h){if(g==null||l==null)return!1;if(l=="mapzoom"&&!g.match(/label/))return map.Zoom.doZoomMap(g,"byfactor"),!0;if(l=="textscale"&&!g.match(/label/))return map.Layer.changeLabelScaling(null,g,"byfactor"),!0;if(l=="backwards"&&!g.match(/label/))return map.zoomAndPanHistory.backwards(),!0;if(l=="activatetool"&&!g.match(/label/))return c(g),!0;var r=map.Dom.getAttributeByNodeOrParents(f,szMapNs,"classname");r.match(/legendgroup/)&&(r=null);switch(l){case "suboff":l="off";case "off":h&&
h.length?map.Layer.switchLayerByCSS(a,g,r,"none"):g.match(/'/)?map.Layer.switchLayer(a,g,r,!1):executeWithMessage("map.Layer.switchLayer(null,'"+g+"','"+r+"',false)","...");f.style.setProperty("display","none","");!g.match(/label/)&&map.fCheckSublayerCollapse&&L(f,"collapse");break;case "on":h&&h.length?map.Layer.switchLayerByCSS(a,g,r,"inline"):g.match(/'/)?map.Layer.switchLayer(a,g,r,!0):executeWithMessage("map.Layer.switchLayer(null,'"+g+"','"+r+"',true)","...");(h=map.SVGDocument.getElementById("legend:off:"+
g))&&h.style.setProperty("display","inline","");!g.match(/label/)&&map.fCheckSublayerCollapse&&L(f,"expand");map.Event.doDefaultZoom(a);break;case "collapse":f.style.setProperty("display","none","");L(f,"collapse");break;case "expand":(h=map.SVGDocument.getElementById("legend:collapse:"+g))&&h.style.setProperty("display","inline","");L(f,"expand");break;case "setactive":activateTheme(g);map.szMapToolType.match(/select/)||c("info");break;case "item":try{this.lastItemObjectA[g].redraw()}catch(C){}}a=
l;if(f=map.SVGDocument.getElementsByTagNameNS(szMapNs,"theme"))for(l=0;l<f.length;l++)f.item(l).getAttributeNS(null,"name")==map.Tiles.getMasterId(g)&&f.item(l).setAttributeNS(null,"state",a);return!0};ixMap.Legend.prototype.execLegendMouseClickOnItem=function(a,f,g){if((a=map.Dom.getAttributeByNodeOrParents(f,szMapNs,"onactivate"))&&a.length){var l=g.split(":"),h=l[l.length-1];switch(l[1]){case "off":f.style.setProperty("display","none","");try{this.lastItemObjectA[h]&&this.lastItemObjectA[h].remove()}catch(r){}this.lastItemObjectA[h]=
null;break;case "on":if(!this.lastItemObjectA[h]){g="legend:off:"+g.substr(10,g.length-10);(f=map.SVGDocument.getElementById(g))&&f.style.setProperty("display","inline","");try{this.lastItemObjectA[h]=eval(a),this.lastItemObjectA[h]&&(this.lastItemObjectA[h].onremove="map.Legend.setLegendCheckBox(null,'"+g+"','unchecked');map.Legend.lastItemObjectA['"+h+"']=null;deactivateTheme('"+h+"')",this.lastItemObjectA[h].szItem=h)}catch(r){alert("ERROR: "+r.description+" \nIN: "+a)}}}}return!0};ixMap.Legend.prototype.execLegendMouseClickOnTiles=
function(a,f,g,l){var h=!1;if(g&&map.Tiles&&map.Tiles.nCount>0)for(var r=map.Tiles.getTileNodeIds(g),C=0;C<r.length;C++)this.execLegendMouseClick(a,f,r[C],l)&&(h=!0);h||(r=map.Dom.getAttributeByNodeOrParents(f,szMapNs,"classname"))&&r.length&&(h=this.execLegendMouseClick(a,f,g,l,r));return h};ixMap.Legend.prototype.setLegendCheckBox=function(a,f,g){if(f.match(/legend/)){a=f.split(":");f="legend:off";for(var l=2;l<a.length;l++)f+=":"+a[l]}(f=map.SVGDocument.getElementById(f))&&f.style.setProperty("display",
g=="checked"?"inline":"none","")};ixMap.Legend.prototype.switchLegendCheckBox=function(a,f,g){a="legend:off:"+f;var l=map.SVGDocument.getElementById(a);l||=map.SVGDocument.getElementById(a+":byclassname");l&&l.style.setProperty("display",g,"");(l=map.SVGDocument.getElementById("legend:setactive:"+f))&&l.style.setProperty("opacity",g=="none"?"0.4":"1","")};map.zoomAndPanHistory=new Ea;map.highLightList=new m;window.InfoContainer=P;window.MapTool=d;window.TextField=e;window.ScrollArea=b;window.HighLight=
m;window.doDisplayInfo=x;window._removeInfo=function(a){map.Event.onoverShape!=null||map.Event.onoverPopup?setTimeout("_removeInfo()",250):map.SVGPopupGroup.fu.clear()};window._doRemoveFixedInfo=function(a){a.highLightList.unlock();a.highLightList.removeAll()};window.setMapTool=c;window.createTextGrid=O})();(function(){ixMap.Api=function(t){this.executeWithPush=!1;this.map=t};ixMap.Api.prototype=new Map;typeof thisversion=="string"&&map.checkVersion(thisversion)?map.Api=new ixMap.Api(map):alert("ixMap.Api incompatible !");ixMap.Api.prototype.setMapFeatures=function(t){this.map.setFeatures(t)};ixMap.Api.prototype.getMapFeatures=function(){return this.map.getFeatures()};ixMap.Api.prototype.setMapLocal=function(t,K){K=K.split("|");for(var y=0;y<K.length;y++)loadSVGIncludes(null,t,K[y])};ixMap.Api.prototype.setLocalString=
function(t,K){this.map.Dictionary.replace(t,K)};ixMap.Api.prototype.getLocalString=function(t){this.map.Dictionary.getLocalText(t)};ixMap.Api.prototype.setMapLayer=function(t){if(map.fInitializing||map.isLoading())this.map.pushAction('map.Api.setMapLayer("'+t+'"');else{t=JSON.parse(t);for(var K in t){t[K].display&&t[K].display=="none"&&this.switchLayer(String(K),!1);if(t[K].off)for(var y in t[K].off)this.switchLayer(K+"::"+t[K].off[y],!1);if(t[K].on){var B=this.getLayer()[K].categoryA;if(B){for(var A in B)this.switchLayer(K+
"::"+A,!1);for(y in t[K].on)t[K].on[y].length&&this.switchLayer(K+"::"+t[K].on[y],!0)}}}}};ixMap.Api.prototype.loadMap=function(t){map.fInitializing||map.isLoading()?this.map.pushAction(()=>{map.Api.loadMap(t)}):this.map.loadMap(t)};ixMap.Api.prototype.setBookmark=function(){try{var t=this.map.Zoom.getBox(),K=this.map.Scale.getMapCoordinate(t.x,t.y),y=this.map.Scale.getMapCoordinate(t.x+t.width,t.y+t.height);this.map.bookmarkList.createBookmark(null,"MinBoundX='"+K.x+"' MaxBoundX='"+y.x+"' MinBoundY='"+
y.y+"' MaxBoundY='"+K.y)}catch(B){alert("Bookmark could not be set !")}};ixMap.Api.prototype.gotoBookmark=function(t){try{this.map.bookmarkList.exec(t)}catch(K){alert("Bookmarks could not be found !")}};ixMap.Api.prototype.clearBookmarks=function(){try{this.map.bookmarkList.clear()}catch(t){alert("Bookmarks could not be deleted !")}};ixMap.Api.prototype.getMapBox=function(){return new box(this.map.Scale.mapPosition.x/this.map.Scale.normalX(1),this.map.Scale.mapPosition.y/this.map.Scale.normalX(1),
this.map.Scale.bBox.width/this.map.Scale.normalX(1),this.map.Scale.bBox.height/this.map.Scale.normalX(1))};ixMap.Api.prototype.resizeCanvas=function(t,K,y,B,A){return this.map.Scale.resizeCanvas(t,K,y,B,A)};ixMap.Api.prototype.doZoomMapToFullExtend=function(){this.map.Zoom.doZoomMapToLayer("maplayer")};ixMap.Api.prototype.doZoomMap=function(t,K){return this.map.Zoom.doZoomMap(t,K)};ixMap.Api.prototype.doPanMap=function(t,K){this.map.Zoom.setNewPan(t,K)};ixMap.Api.prototype.doZoomMapToWidgetRect=function(t){this.map.Zoom.doZoomMapToWidgetRect(t)};
ixMap.Api.prototype.doCenterMapToGeoPosition=function(t,K){this.map.Zoom.doCenterMapToGeoPosition(t,K)};ixMap.Api.prototype.doCenterMapToGeoBounds=function(t,K,y,B){this.map.Zoom.doCenterMapToGeoBounds(t,K,y,B)};ixMap.Api.prototype.doZoomMapToGeoBounds=function(t,K,y,B){this.map.Zoom.doZoomMapToGeoBounds(t,K,y,B)};ixMap.Api.prototype.doSetMapToGeoBounds=function(t,K,y,B){B-K<180&&(this.map.fPreserveMapRatio=!1);this.map.Zoom.doSetMapToGeoBounds(t,K,y,B);setTimeout("this.map.fPreserveMapRatio = true;",
5E3)};ixMap.Api.prototype.doZoomMapToView=function(t,K){this.map.Zoom.doZoomMapToView(t,K)};ixMap.Api.prototype.getCenterOfMapInGeoPosition=function(){return this.map.Zoom.getCenterOfMapInGeoPosition()};ixMap.Api.prototype.getBoundsOfMapInGeoBounds=function(){return this.map.Zoom.getBoundsOfMapInGeoBounds()};ixMap.Api.prototype.getMapScale=function(){return String(Math.floor(map.Scale.nTrueMapScale*map.Scale.nZoomScale))};ixMap.Api.prototype.pendingNewGeoBounds=function(){return this.map.fPendingNewGeoBounds};
ixMap.Api.prototype.setVisibility=function(t){var K=new MapTool(null,"nothing");t=="invisible"?K.hideLayer(null):K.showLayer(null)};ixMap.Api.prototype.hideOverviewMap=function(){};ixMap.Api.prototype.showOverviewMap=function(){};ixMap.Api.prototype.hideNorthArrow=function(){this.map.Viewport.hideNorthArrow()};ixMap.Api.prototype.showNorthArrow=function(){this.map.Viewport.showNorthArrow()};ixMap.Api.prototype.backwards=function(){this.map.zoomAndPanHistory.backwards()};ixMap.Api.prototype.forwards=
function(){this.map.zoomAndPanHistory.forwards()};ixMap.Api.prototype.toggleThemeValues=function(t){try{this.map.Themes.toggleThemeValues(null,t)}catch(K){}};ixMap.Api.prototype.toggleThemeLegends=function(t){try{this.map.Themes.toggleThemeLegends(null,t)}catch(K){}};ixMap.Api.prototype.minimizeThemeLegends=function(){try{this.map.Themes.minimizeThemeLegends(null)}catch(t){}};ixMap.Api.prototype.changeObjectScaling=function(t){this.map.Layer.changeObjectScaling(null,t)};ixMap.Api.prototype.changeLabelScaling=
function(t){this.map.Layer.changeLabelScaling(null,t)};ixMap.Api.prototype.changeLineScaling=function(t){this.map.Layer.changeLineScaling(null,t)};ixMap.Api.prototype.getScaleParam=function(){return this.map.Scale.getScaleParam()};ixMap.Api.prototype.setScaleParam=function(t){this.map.Scale.setScaleParam(t)};ixMap.Api.prototype.changeRotation=function(t){this.map.Scale.changeRotation(null,t)};ixMap.Api.prototype.setRotation=function(t){this.map.Scale.setRotation(null,t)};ixMap.Api.prototype.setMapBackgroundColor=
function(t){this.map.Viewport.setBackgroundColor(t)};ixMap.Api.prototype.togglePanBorder=function(){this.map.Viewport.togglePanBorder()};ixMap.Api.prototype.setPrintScaling=function(){this.map.Event.doPrintZoom()};ixMap.Api.prototype.froozeMap=function(t){this.map.fFroozeDynamicContent=t};ixMap.Api.prototype.freezeMap=function(t){this.map.Event.fFreezeDynamicContent=t};ixMap.Api.prototype.setMapClip=function(t){this.map.Viewport.clipMap(t)};ixMap.Api.prototype.setLayerClip=function(t,K){this.map.Viewport.clipLayer(t,
K)};ixMap.Api.prototype.switchLayer=function(t,K){this.map.Layer.switchLayer(null,t,null,K)};ixMap.Api.prototype.getLayer=function(){return this.map.Layer.listA};ixMap.Api.prototype.getLayerDependency=function(){return this.map.Layer.depListA};ixMap.Api.prototype.getTileInfo=function(){return this.map.Tiles};ixMap.Api.prototype.setMapTool=function(t){setMapTool(t)};ixMap.Api.prototype.getMapTool=function(){return this.map.szMapToolType};ixMap.Api.prototype.isMapTool=function(t){return this.map.szMapToolType==
t?"yes":"no"};ixMap.Api.prototype.isNotMapTool=function(t){return this.isMapTool(t)=="no"?"yes":"no"};ixMap.Api.prototype.switchMapTheme=function(t,K){if(t)if(K=K||(this.map.Layer.isLayerOn(t)?"off":"on"),map.Legend){var y=this.map.this.map.SVGDocument.getElementById("legend:"+K+":this:item:"+t);y?this.map.Legend.execLegendMouseClickOnItem(null,y,"legend:"+K+":this:item:"+t):K=="on"?(this.map.Layer.switchLayer(null,t,null,!0),map.Legend.switchLegendCheckBox(null,t,"inline")):(this.map.Layer.switchLayer(null,
t,null,!1),map.Legend.switchLegendCheckBox(null,t,"none"))}else K=="on"?this.map.Layer.switchLayer(null,t,null,!0):this.map.Layer.switchLayer(null,t,null,!1)};ixMap.Api.prototype.getMapTheme=function(t){var K=t.split("#")[0].split(":")[0];K=="legend"&&(K=t.split(":")[2]);return this.map.Layer.listA[K]};ixMap.Api.prototype.getMapThemeRendererField=function(t){return(t=this.getMapTheme(t))?t.szRenderer:null};ixMap.Api.prototype.getMapThemeDataRow=function(t,K){return(t=map.Themes.getTheme(t))?map.Themes.getDataRow(K,
t):null};ixMap.Api.prototype.getMapThemeItemPosition=function(t,K){return(t=map.Themes.getTheme(t))?(K=t.getItemNodes(K),map.Scale.getScreenPosition(K[0])):null};ixMap.Api.prototype.zoomMapToItem=function(t){this.map.Zoom.doZoomMapToItem(t)};ixMap.Api.prototype.getMapThemeChart=function(t,K,y,B){return(t=map.Themes.getTheme(t))?map.Themes.getChart(K,y,B,t):null};ixMap.Api.prototype.getMapThemeHistogram=function(t,K,y,B){return(K=map.Themes.getTheme(t))?map.Themes.getHistogram(t,y,B,K):null};ixMap.Api.prototype.executeJavascriptWithMessage=
function(t,K,y){t&&typeof(t!="undefined")&&this.map.pushAction(()=>{map.Api.executeWithPush=!0;executeWithMessage(t.replace(/\\/gi,"\\\\").replace(/"/gi,'\\"'),K,y);map.Api.executeWithPush=!1})};ixMap.Api.prototype.displayMessage=function(t,K,y){displayMessage(t,K,y)};ixMap.Api.prototype.flipLegend=function(){var t=getMatrix(this.map.Scale.offsetNode);t[4]=t[4]===0?this.map.Scale.viewBox.width-this.map.Scale.bBox.width:this.map.Scale.viewBox.width-(this.map.Scale.mapPosition.x+this.map.Scale.bBox.width);
setMatrix(this.map.Scale.offsetNode,t);this.map.Scale=new ixMap.Scale;this.map.Viewport=new ixMap.Viewport;var K=this.map.SVGDocument.getElementById("legend:group");K&&(t=getMatrix(K),t[4]===0?(this.map.Dom.getBox(K),t[4]=this.map.Scale.mapPosition.x+this.map.Scale.bBox.width):t[4]=0,setMatrix(K,t),displayScale(null,"bottom"),this.map.Toolbar.refresh())};var Ea=0;ixMap.Api.prototype.extendMap=function(){var t=getMatrix(this.map.Scale.offsetNode);if(Ea=t[4]){t[4]=0;setMatrix(this.map.Scale.offsetNode,
t);this.map.Zoom.doPanMap(Ea/this.map.Scale.normalX(1)/2,0);this.map.Scale.reset();this.map.Viewport.reformat();try{this.map.Legend.hide()}catch(K){}try{this.map.HTMLWindow.ixmaps.htmlgui_onMapResize(window)}catch(K){this.map.Viewport.reformat()}}else this.map.fInitLegendOff=!0};ixMap.Api.prototype.normalMap=function(){if(!(Ea<=0)){var t=getMatrix(this.map.Scale.offsetNode);t[4]=Ea;setMatrix(this.map.Scale.offsetNode,t);this.map.Zoom.doPanMap(-Ea/this.map.Scale.normalX(1)/2,0);this.map.Scale.reset();
this.map.Viewport.reformat();try{this.map.Legend.show()}catch(K){}try{this.map.HTMLWindow.ixmaps.htmlgui_onMapResize(window)}catch(K){this.map.Viewport.reformat()}}};ixMap.Api.prototype.hideLegend=function(){var t=this.map.SVGDocument.getElementById("legend:group");t&&t.style.setProperty("display","none","")};ixMap.Api.prototype.showLegend=function(){var t=this.map.SVGDocument.getElementById("legend:group");t&&t.style.setProperty("display","inline","")};ixMap.Api.prototype.clearAll=function(){this.map.clearAll()};
ixMap.Api.prototype.clearAllCharts=function(){this.map.Themes&&this.map.Themes.removeAllCharts()};ixMap.Api.prototype.clearAllChoropleth=function(){this.map.Themes&&this.map.Themes.removeAllChoropleth()};ixMap.Api.prototype.clearAllOverlays=function(){this.map.SVGPopupGroup&&this.map.SVGToolsGroup.fu.clear();this.map.SVGPopupGroup&&this.map.SVGFixedGroup.fu.clear();this.map.SVGPopupGroup&&this.map.SVGPopupGroup.fu.clear();this.map.SVGPopupGroup&&this.map.SVGMessageGroup.fu.clear();this.map.Themes&&
this.map.Themes.removeAllSelections()};ixMap.Api.prototype.getActualEnvelopeString=function(){return this.map.Zoom.getEnvelopeString()};ixMap.Api.prototype.getActualEnvelopeCoordinates=function(){return this.map.Zoom.getEnvelope()};ixMap.Api.prototype.printActualEnvelope=function(){var t=this.map.Zoom.getBox(),K=this.map.Scale.getMapCoordinate(t.x,t.y);t=this.map.Scale.getMapCoordinate(t.x+t.width,t.y+t.height);var y='<ENVELOPE minx="'+K.x+'"\n';y+='          maxx="'+t.x+'"\n';y+='          miny="'+
t.y+'"\n';y+='          maxy="'+K.y+'" name="Initial_Extent" />';try{htmlgui_prettyPrintXML("Actual zoom Envelope (for SVGGIS XML)",y+"\n")}catch(B){alert(y)}};ixMap.Api.prototype.createTextLink=function(t,K,y){t=this.map.Dom.newGroup(t);if(y.match(/javascript/)){var B=this.map.Dom.constructNode("a",t,{"xlink:href":""});K=this.map.Dom.newText(B,0,this.map.Scale.normalY(this.map.nNormalFontSize*.75),"font-family:arial;font-size:"+this.map.Scale.normalY(this.map.nNormalFontSize*.75)+"px;fill:blue;",
K);B=this.map.Dom.newShape("rect",B,0,0,this.map.Scale.normalX(this.map.nNormalFontSize*10),this.map.Scale.normalY(this.map.nNormalFontSize+3),"fill:#fffff0;stroke:#000000;opacity:0");K&&(B.setAttributeNS(null,"onclick",y),B.setAttributeNS(null,"onmousedown","this.map.Event.stopMouseEvent(evt)"),B.setAttributeNS(null,"onmouseup","this.map.Event.stopMouseEvent(evt)"))}else B=this.map.Dom.constructNode("a",t,{"xlink:href":y}),this.map.Dom.newText(B,0,this.map.Scale.normalY(this.map.nNormalFontSize*
.75),"font-family:arial;font-size:"+this.map.Scale.normalY(this.map.nNormalFontSize*.75)+"px;fill:blue;",K);return t};ixMap.Api.prototype.createInfoBubble=function(t,K,y){if(t&&K){y||=1;var B="bubble:"+String(Math.random()+":movable");K=createTextGrid(this.map.SVGDocument,this.map.SVGFixedGroup,B,K,y);y=new point(this.map.Scale.normalX(-10),this.map.Scale.normalY(15));var A=this.map.Scale.getScreenPosition(t),J=this.map.Scale.clipWidgetObjectToSVG(K,A,y);K.fu.setPosition(J.x,J.y);t=this.map.Dom.getBox(K);
(new Button(K,"xx","BUTTON","#delete_button","this.map.Dom.removeElementById('"+B+"')","","remove")).setPosition(t.width,this.map.Scale.normalY(9));t.width+=this.map.Scale.normalY(9);B=J.y==A.y+y.y?"top":"bottom";B=J.x==A.x+y.x?B+"left":B+"right";this.map.Scale.normalX(15);A=this.map.Scale.normalX(5);J=this.map.Scale.normalX(5);var L=this.map.Scale.normalX(5),da=y.y,V=this.map.Scale.normalX(15);y=-y.x-A-J;var U="M"+t.x+","+t.y+" ";U+="m"+J+",0 ";B=="topleft"?(U=U+("l"+A+",0 l")+(y+","+-da+" l")+(-y+
V+","+ +da+" "),U+="l"+(t.width-J*2-A-V)+",0 "):B=="topright"?(U+="l"+(t.width-J*2-A-V)+",0 ",U+="l"+(-y+V)+","+-da+" ",U+="l"+y+","+ +da+" ",U+="l"+A+",0 "):U+="l"+(t.width-J*2)+",0 ";U+="q"+J+",0 "+J+","+L+" ";U+="l0,"+(t.height-L*2)+" ";U+="q0,"+L+" "+-J+","+L+" ";B=="bottomright"?(U=U+("l"+-A+",0 l")+(-y+","+da+" l")+(+y-V+","+-da+" "),U+="l"+(-t.width+J*2+A+V)+",0 "):B=="bottomleft"?(U+="l"+(-t.width+J*2+A+V)+",0 ",U+="l"+(y-V)+","+da+" ",U+="l"+-y+","+-da+" ",U+="l"+-A+",0 "):U+="l"+(-t.width+
J*2)+",0 ";U+="q"+-J+",0 "+-J+","+-L+" ";U+="l0,"+(-t.height+L*2)+" ";U+="q0,"+-L+" "+J+","+-L+" ";U+="z";t=this.map.Dom.newShape("path",K,U,"fill:white;stroke:grey");K.style.setProperty("filter","url(#DropShadowFilterTools)","");t.parentNode.insertBefore(t,t.parentNode.firstChild)}};ixMap.Api.prototype.createInfoContainer=function(t,K,y,B,A,J){if(t&&K)return J||="fix",y=new point(B,A),B=new point(0,0),J=new InfoContainer(this.map.SVGDocument,this.map.SVGPopupGroup,t+":more"+(J.match(/pointer/)?"":
":movable"),y,B,J),t=createTextGrid(this.map.SVGDocument,J.workspaceNode,t+":more:textgrid",K,2),this.map.Dictionary.applyToNode(t),J.reformat(),this.map.Event.stopMouseEvent(),J};ixMap.Api.prototype.getContextMenuTarget=function(){return this.map.Event.contextMenuObj};ixMap.Api.prototype.getMapToolShape=function(){return mapToolList.toolShape};ixMap.Api.prototype.getShapePoints=function(t){if(t.nodeName=="path"){var K=[],y=null,B=new point(0,0);t=t.getAttributeNS(null,"d");t=t.substr(1,t.length-
2);t.replace("M","M ");t=t.split(" ");for(var A=0;A<t.length;A++)if(t[A]=="l"||t[A]=="L")y=t[A];else if(t[A]&&t[A].length){var J=t[A].split(",");K[K.length]=y=="l"?new point(B.x+Number(J[0]),B.y+Number(J[1])):new point(Number(J[0]),Number(J[1]));B=K[K.length-1]}return K}return null};ixMap.Api.prototype.getShapeCoordinates=function(t){if(t.nodeName=="path"&&(t=this.getShapePoints(t))){var K=[],y;for(y in t){var B=this.map.Scale.getMapPosition(t[y].x,t[y].y);B=this.map.Scale.getMapCoordinate(B.x,B.y);
K[K.length]=new point(B.x,B.y)}return K}return null};ixMap.Api.prototype.getShape=function(t,K,y){y=[];y.push(t);for(var B in y)if(t=this.map.SVGDocument.getElementById(y[B])){for(B=t;!(y=B.getAttribute("style"))&&B.parentNode;)B=B.parentNode;B=t.cloneNode(1E3);B.setAttribute("style",y);B.fu=new Methods(B);t.fu=new Methods(t);t=t.fu.getBox();y=Math.min(4E3/t.width,4E3/t.height);B.fu.setPosition(-t.x*y,-t.y*y-3E3);B.fu.scale(y,y);B.style.setProperty("stroke-width",20/y+"px");K.appendChild(B);break}};
ixMap.Api.prototype.getSurface=function(t){if(t){if(t.parentNode.nodeName=="g"){var K=t.parentNode.getAttributeNS(szMapNs,"area");if(K&&K.length)return Number(K)}if(t=this.getShapePoints(t))return __doGetPolygonSurface(t)}return null};ixMap.Api.prototype.printSurface=function(t){if(t){var K=this.getSurface(t);if(K)return K=this.map.Scale.formatSurfaceString(K)+"  ",this.createInfoBubble(t,Array(K),1)}};ixMap.Api.prototype.displayContextMenuTargetInfo=function(){var t=this.map.Event.contextMenuObj;
t&&displayInfoDelayed(null,t,10)};ixMap.Api.prototype.removeContextMenuTarget=function(){this.map.Event.contextMenuObj&&(this.map.Dom.clearGroup(map.SVGToolsGroup),mapToolList.clear())};ixMap.Api.prototype.removeContextMapTool=function(){var t=this.map.Event.contextMenuObj;if(t)for(;t;t=t.parentNode)if(t.getAttributeNS(null,"id").match(/maptoolnode/)){mapToolList.removeMapTool(t);break}};ixMap.Api.prototype.createContextMenuTargetBuffer=function(){var t=this.map.Event.contextMenuObj;if(t){t=new MapObject(t);
if(t.szId.match(/legend:setactive/)){var K=t.szId.split("legend:setactive:")[1],y=K.split("::")[0];K=K.split("::")[1];var B=this.map.Layer.getLayerObjOfNode(t.objNode)}this.map.Themes.newTheme(y,B.szRenderer,"","type:CHART|BUFFER;align:center;colorscheme:#aa4400;ranges:"+K+";buffersize:1000;opacity:0.3;label:Ripetitore","Buffer (1 km)","Ripetitore")}};ixMap.Api.prototype.createTheme=function(t,K,y,B,A,J,L){return this.map.Themes.newTheme(t,K,y,B,A,J,L)};ixMap.Api.prototype.newMapTheme=function(t,
K,y,B,A,J){if(this.map.Zoom.fExternalZoom)this.map.pushAction(()=>{map.Api.newMapTheme(t,K,y,szStyl,A,J)});else if(this.executeWithPush)this.map.pushAction(()=>{map.Themes.newTheme(t,K,y,B,A,J)});else return this.map.Themes.newTheme(t,K,y,B,A,J)};ixMap.Api.prototype.newMapThemeByObj=function(t,K){return this.map.Themes.newThemeByObj(t,K)};ixMap.Api.prototype.refreshTheme=function(t){this.map.Themes.refreshTheme(t)};ixMap.Api.prototype.resetTheme=function(t){this.map.Themes.resetTheme(t)};ixMap.Api.prototype.changeContextThemeStyle=
function(t,K){t=new MapObject(t);this.map.Themes.changeThemeStyle(null,t.szId,K)};ixMap.Api.prototype.changeThemeStyle=function(t,K,y){this.map.Themes.changeThemeStyle(null,t,K,y)};ixMap.Api.prototype.showThemeClass=function(t,K,y){this.map.Themes.showClass(null,t,K,y)};ixMap.Api.prototype.hideThemeClass=function(t,K,y){this.map.Themes.hideClass(null,t,K,y)};ixMap.Api.prototype.markThemeClass=function(t,K,y){this.map.Themes.markClass(null,t,K,y)};ixMap.Api.prototype.unmarkThemeClass=function(t,K,
y){this.map.Themes.unmarkClass(null,t,K,y)};ixMap.Api.prototype.setThemeTimeFrame=function(t,K,y){this.map.Themes.setTimeFrame(null,t,K,y)};ixMap.Api.prototype.filterThemeItems=function(t,K,y){this.map.Themes.filterItems(null,t,K,y)};ixMap.Api.prototype.selectFilterItems=function(t){this.map.Themes.selectFilterItems(null,t)};ixMap.Api.prototype.popupThemeStyleMenu=function(t){this.map.Themes.chartTypeMenu(null,t)};ixMap.Api.prototype.highlightThemeItems=function(t,K,y){this.map.Themes.doHighlightItems(t,
K,y)};ixMap.Api.prototype.clearHighlightThemeItems=function(t){this.map.Themes.clearHighlightItems(null,t)};ixMap.Api.prototype.zoomToTheme=function(t){this.map.Themes.zoomTo(null,t)};ixMap.Api.prototype.nextClipFrame=function(t){this.map.Themes.nextClipFrame(t)};ixMap.Api.prototype.setClipFrame=function(t,K){this.map.Themes.setClipFrame(t,K)};ixMap.Api.prototype.pauseClip=function(t){this.map.Themes.pauseClip(t)};ixMap.Api.prototype.startClip=function(t,K){this.map.Themes.startClip(t,K)};ixMap.Api.prototype.getTheme=
function(t){return this.map.Themes.getTheme(t)};ixMap.Api.prototype.getAllThemes=function(){return this.map.Themes.getAllThemes()};ixMap.Api.prototype.getMapThemeDefinitionStrings=function(){return this.map.Themes.getAllThemeDefinitionStrings()};ixMap.Api.prototype.getMapThemeStyleString=function(t){return this.map.Themes.getMapThemeStyleString(t)};ixMap.Api.prototype.getMapThemeDefinitionObj=function(t){return this.map.Themes.getMapThemeDefinitionObj(t)};ixMap.Api.prototype.showTheme=function(t){this.map.Themes.showTheme(null,
t)};ixMap.Api.prototype.hideTheme=function(t){this.map.Themes.hideTheme(null,t)};ixMap.Api.prototype.toggleTheme=function(t){this.map.Themes.toggleTheme(null,t)};ixMap.Api.prototype.removeTheme=function(t){this.map.Themes.removeTheme(null,t)};ixMap.Api.prototype.removeAllThemes=function(){this.map.Themes.removeAll()};ixMap.Api.prototype.getThemeId=function(t){return t?t.szId:null};ixMap.Api.prototype.setThemeExternalData=function(t,K,y){this.map.Themes.setExternalData(t,K,y)};ixMap.Api.prototype.removeElementById=
function(t){(t=this.map.SVGDocument.getElementById(t))&&t.parentNode&&t.parentNode.removeChild(t)};ixMap.Api.prototype.getShapeId=function(t){return t=new MapObject(t),t.szId};ixMap.Api.prototype.getShapeLayerObj=function(t){return(t=this.map.Layer.getLayerObjOfNode(t))?t:null};ixMap.Api.prototype.getShapeLayerName=function(t){return(t=this.map.Layer.getLayerObjOfNode(t))?t.szName:null};ixMap.Api.prototype.getShapeMetadataArray=function(t){var K=this.map.Dom.getAttributeByNodeOrParents(t,szMapNs,
"info");t=new MapObject(t);if((t=this.map.Dom.getAttributeByNodeOrParents(t.objNode.parentNode,szMapNs,"info"))&&K&&(t=t.split("|"),K=K.split("|"),t.length&&K.length)){for(var y=[],B=0;B<t.length;B++)y[t[B]]=K[B];return y}return null};ixMap.Api.prototype.highlightItem=function(t){var K=this.map.SVGDocument.getElementById(t);if(t.match(/:chart/))this.map.highLightList.unlock(),this.map.highLightList.removeAll(),this.map.highLightList.addItem(K,"circle");else{this.map.highLightList.unlock();this.map.highLightList.removeAll();
for(t=0;t<y.length;t++)this.map.highLightList.removeItem(y[t]),this.map.highLightList.addItem(y[t],"circle");this.map.highLightList.lock();var y=map.Layer.getLayerItemNodes(K);this.map.highLightList.unlock();this.map.highLightList.removeAll();for(t=0;t<y.length;t++)this.map.highLightList.removeItem(y[t]),this.map.highLightList.addItem(y[t])}this.map.highLightList.lock()};ixMap.Api.prototype.clearHighlight=function(){this.map.highLightList.unlock();this.map.highLightList.removeAll()};ixMap.Api.prototype.getLayerLegendSVG=
function(t){alert(t)};ixMap.Api.prototype.newMapSelection=function(t,K,y,B){map.Selections.newSelection(t,K,y,B)};ixMap.Api.prototype.selectItemByPosition=function(t,K){return map.Selections.selectItemByPosition(t,K)};ixMap.Api.prototype.selectItemByBoundingBox=function(t,K){return map.Selections.selectItemByBoundingBox(t,K)}})();(function(){ixMap.Query=function(y){this.themesA=[];this.infoThemesA=[];this.foundNodesA=[];this.searchRecursion=0;this.map=y};ixMap.Query.prototype=new Map;typeof thisversion=="string"&&map.checkVersion(thisversion)?map.Query=new ixMap.Query(map):alert("ixMap.Query incompatible !");ixMap.Query.prototype.xgetThemes=function(){if(this.themesA.length===0&&this.map.SVGDocument){var y=this.map.SVGDocument.getElementById("mapzoomandpan");if(y){y=y.childNodes;for(var B=0;B<y.length;B++)y.item(B).nodeName==
"g"&&(y.item(B).getAttributeNS(null,"id").match(/label/)||(this.themesA[this.themesA.length]=y.item(B).getAttributeNS(null,"id")))}}return this.themesA};ixMap.Query.prototype.getThemes=function(){if(this.themesA.length===0&&this.map.SVGDocument){var y=this.map.SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(y)for(var B=0;B<y.length;B++)this.themesA[this.themesA.length]=y.item(B).getAttributeNS(null,"name")}return this.themesA};ixMap.Query.prototype.getThemesWithInfo=function(){if(this.infoThemesA.length===
0&&this.map.SVGDocument){var y=this.map.SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(y)for(var B=0;B<y.length;B++)y.item(B).getAttributeNS(null,"flag").match(/info/)&&(this.infoThemesA[this.infoThemesA.length]=y.item(B).getAttributeNS(null,"name"))}return this.infoThemesA};ixMap.Query.prototype.getThemesWithSelection=function(){if(this.infoThemesA.length===0&&this.map.SVGDocument){var y=this.map.SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(y)for(var B=0;B<y.length;B++)y.item(B).getAttributeNS(null,
"selection").length&&(this.infoThemesA[this.infoThemesA.length]=y.item(B).getAttributeNS(null,"name"))}return this.infoThemesA};ixMap.Query.prototype.getActiveTheme=function(){return this.map._activeTheme};ixMap.Query.prototype.getFieldsOfTheme=function(y){var B=[];if(this.map.SVGDocument){var A=this.map.SVGDocument.getElementById(y);if(A==null&&map.Tiles&&map.Tiles.nCount>0)for(var J=0;J<map.Tiles.nCount&&A==null;J++)for(var L=0;L<map.Tiles.nCount&&A==null;L++)A=this.map.SVGDocument.getElementById(y+
"#00"+String(J)+"00"+String(L));A&&(B=A.getAttributeNS(szMapNs,"info").split("|"))}return B};ixMap.Query.prototype.getValuesOfFieldAndTheme=function(y,B,A){var J=[];if(y==null||B==null)return J;A||=1E5;if(this.map.SVGDocument){var L=this.map.SVGDocument.getElementById(y);if(L==null){L=map.Tiles.getTileNodes(y);for(y=0;y<L.length;y++){for(var da=this.getValuesOfFieldAndTheme(L[y].getAttributeNS(null,"id"),B,A),V=0;V<da.length;V++)J[J.length]=da[V];if((A-=da.length)<0)break}return J}if(L){V=L.getAttributeNS(szMapNs,
"info").split("|");da=-1;for(y=0;y<V.length;y++)V[y]==B&&(da=y);if(da>=0){V=L.getElementsByTagName("g");for(y=0;y<V.length;y++)if(V.item(y).nodeType==1&&(B=(V.item(y).getAttributeNS(szMapNs,"info")||"").split("|"),B.length>da&&B[da].length&&(J[J.length]=B[da],J.length>A)))return J;V=L.getElementsByTagName("path");for(y=0;y<V.length;y++)if(V.item(y).nodeType==1&&(B=(V.item(y).getAttributeNS(szMapNs,"info")||"").split("|"),B.length>da&&B[da].length&&(J[J.length]=B[da],J.length>A)))return J;V=L.getElementsByTagName("use");
for(y=0;y<V.length&&!(V.item(y).nodeType==1&&(B=(V.item(y).getAttributeNS(szMapNs,"info")||"").split("|"),B.length>da&&B[da].length&&(J[J.length]=B[da],J.length>A)));y++);}}}return J};ixMap.Query.prototype.getSelectionValuesOfTheme=function(y,B){var A=[];if(y==null)return A;B||=1E5;if(this.map.SVGDocument){var J=this.map.SVGDocument.getElementById(y);y=J==null?map.Tiles.getTileNodes(y):Array(J);for(J=0;J<y.length;J++)for(var L=y[J].getElementsByTagName("g"),da=0;da<L.length;da++){var V=map.Tiles.getMasterId(L.item(da).getAttributeNS(null,
"id")).split(":");A.push(V.pop());if(A.length>B)return A}}return A};ixMap.Query.prototype.getValueOfFieldAndItem=function(y,B){if(this.map.SVGDocument){var A=this.map.SVGDocument.getElementById(y);A==null&&(A=map.Tiles.getTileNodes(y)[0]);if(A){var J=A.getAttributeNS(szMapNs,"info");if(!J||J.length===0){var L=A.childNodes;for(y=0;y<L.length;y++)L.item(y).nodeType==1&&(J=L.item(y).getAttributeNS(szMapNs,"info"))}J=J.split("|");if((A=A.parentNode.getAttributeNS(szMapNs,"info"))&&A.length)for(A=A.split("|"),
y=0;y<A.length;y++)if(A[y]==B)return J[y]}}return"?"};ixMap.Query.prototype.getClassnameOfItem=function(y){var B=null;if(this.map.SVGDocument){var A=this.map.SVGDocument.getElementById(y);A==null&&(A=map.Tiles.getTileNodes(y)[0]);if(A){B=A.getAttributeNS(null,"class");if(!B||!B.length){y=A.childNodes();for(var J=0;J<y.length;J++){var L=y.item(J);if(L.nodeType==1&&(B=L.getAttributeNS(null,"class"))&&B.length)break}}if(!B||!B.length)for(y=A.childNodes(),J=0;J<y.length&&(L=y.item(J),L.nodeType!=1||!(B=
L.getAttributeNS(szMapNs,"value"))||!B.length);J++);}}return B};ixMap.Query.prototype.addFoundNode=function(y,B,A,J){var L=map.Tiles.getMasterId(y.parentNode.getAttributeNS(null,"id")),da=L.split(":")[0];if(da&&da.length&&L&&L.length){for(var V=0;V<this.foundNodesA.length;V++)if(this.foundNodesA[V].id==L&&this.foundNodesA[V].feature==B&&this.foundNodesA[V].item==A)return;this.foundNodesA[this.foundNodesA.length]={node:y,id:L,theme:da,feature:B,item:A,itemA:J}}};ixMap.Query.prototype.searchItem=function(y,
B,A){this.foundNodesA.length=0;if(y.length===0)return this.foundNodesA;this.szQuery=y;var J=y.toLowerCase(),L=y.toUpperCase(),da=y.substr(0,1).toUpperCase()+y.substr(1,y.length-1).toLowerCase();J=da!=y?[y,da,J,L]:[y,J];this.szThemesA=A.split("|");L=[];da=map.Scale.canvasNode.getElementsByTagName("path");for(A=0;A<da.length;A++)L[L.length]=da.item(A);da=map.Scale.canvasNode.getElementsByTagName("use");for(A=0;A<da.length;A++)L[L.length]=da.item(A);for(A=0;A<L.length;A++)if(L[A].nodeType==1){var V=
!1;if(this.szThemesA[0]=="all")V=!0;else if((da=map.Tiles.getMasterId(L[A].parentNode.getAttributeNS(null,"id")))&&da.length!==0){da=da.split(":")[0];for(var U=0;U<this.szThemesA.length;U++)da==this.szThemesA[U]&&(V=!0)}if(V){da=L[A].getAttributeNS(szMapNs,"info")||L[A].getAttributeNS(szMapNs,"tooltip");if(da==null||da.length===0)da=L[A].parentNode.getAttributeNS(szMapNs,"info")||L[A].parentNode.getAttributeNS(szMapNs,"tooltip");V=da.split("|");if(y=="*")this.addFoundNode(L[A],"*","*",V);else for(U=
0;U<V.length;U++)if(V[U].length&&this.isEqualA(J,B,V[U])){var P=map.Dom.getAttributeByNodeOrParents(L[A].parentNode,szMapNs,"info");P=P.split("|");da=map.Tiles.getMasterId(L[A].parentNode.getAttributeNS(null,"id"));da.split(":");this.addFoundNode(L[A],P[U],V[U],V)}}}return this.foundNodesA};ixMap.Query.prototype.isEqualA=function(y,B,A){for(var J=0;J<y.length;J++)if(this.isEqual(y[J],B,A))return!0;return!1};ixMap.Query.prototype.isEqual=function(y,B,A){switch(B){case "any":return A.indexOf(y)>=0;
case "begin":return A.indexOf(y)===0;case "whole":return A==y}return!1};ixMap.Query.prototype.searchItemAdvanced=function(y,B){var A;this.searchRecursion===0&&(this.foundNodesA.length=0,this.szThemesA=Array(B));if(y.length===0)return this.foundNodesA;this.szQuery=y;var J=[],L=y.split(" ");J[J.length]="";for(A=0;A<L.length;A++)L[A].length&&("< == > <= <> >= and or like".indexOf(L[A])!=-1?(J[J.length]=L[A],J[J.length]=""):(J[J.length-1].length&&(J[J.length-1]+=" "),J[J.length-1]+=L[A]));if(J.length<
3)return this.foundNodesA;for(A=1;A<J.length;A+=2)if("< == > <= <> >= and or like".indexOf(J[A])==-1)return alert(J[A]+" is not an operator"),this.foundNodesA;L=new Ea;L.newPart();for(A=0;A<J.length;A+=4)switch(L.actPart.addCondition(J[A],J[A+1],J[A+2]),J[A+3]){case "and":break;case "or":L.newPart();break;default:A=1E4}if(this.map.SVGDocument){var da=this.map.SVGDocument.getElementById(B);if(da==null){A=map.Tiles.getTileNodes(B);this.searchRecursion++;for(L=0;L<A.length;L++)this.searchItemAdvanced(y,
A[L].getAttributeNS(null,"id"));this.searchRecursion=0;return this.foundNodesA}if(da){y=da.getAttributeNS(szMapNs,"info").split("|");for(A=0;A<y.length;A++)y[y[A]]=A;J=null;(B=da.getElementsByTagName("path"))&&B.length&&(J=B.item(0).getAttributeNS(szMapNs,"info"));if(J==null||J.length===0)B=da.getElementsByTagName("use");B&&B.length&&(J=B.item(0).getAttributeNS(szMapNs,"info"));if(J==null||J.length===0)B=da.getElementsByTagName("g");for(A=0;A<B.length;A++)if(B.item(A).nodeType==1){J=B.item(A).getAttributeNS(szMapNs,
"info").split("|");da=L.partA.length;for(var V=0;V<da;V++){for(var U=!0,P=L.partA[V].conditionA.length,fa=0;fa<P;fa++){var ra=y[L.partA[V].conditionA[fa].szTopic];switch(L.partA[V].conditionA[fa].szOperator){case "<":U=Number(J[ra])<L.partA[V].conditionA[fa].szValue;break;case "==":U=J[ra]==L.partA[V].conditionA[fa].szValue;break;case ">":U=Number(J[ra])>L.partA[V].conditionA[fa].szValue;break;case "<=":U=Number(J[ra])<=L.partA[V].conditionA[fa].szValue;break;case "<>":U=Number(J[ra])!=L.partA[V].conditionA[fa].szValue;
break;case ">=":U=Number(J[ra])>=L.partA[V].conditionA[fa].szValue}if(U===!1)break}U&&(ra=L.partA[0].conditionA[0].szTopic,this.addFoundNode(B.item(A),ra,null,J))}}}}return this.foundNodesA};ixMap.Query.prototype.searchItemByAttribute=function(y,B){this.foundNodesA.length=0;for(var A=[],J=map.SVGRootElement.getElementsByTagName("path"),L=0;L<J.length;L++)A[A.length]=J.item(L);J=map.SVGRootElement.getElementsByTagName("use");for(L=0;L<J.length;L++)A[A.length]=J.item(L);J=map.SVGRootElement.getElementsByTagName("g");
for(L=0;L<J.length;L++)A[A.length]=J.item(L);for(L=0;L<A.length;L++){if(A[L].getAttributeNS(null,y)==B){J=A[L].getAttributeNS(szMapNs,"info");if(J==null||J.length===0)J=A[L].parentNode.getAttributeNS(szMapNs,"info");J=J.split("|");this.addFoundNode(A[L],null,null,J)}if(A[L].getAttributeNS(szMapNs,y)==B){J=A[L].getAttributeNS(szMapNs,"info");if(J==null||J.length===0)J=A[L].parentNode.getAttributeNS(szMapNs,"info");J=J.split("|");this.addFoundNode(A[L],null,null,J)}}return this.foundNodesA};ixMap.Query.prototype.gotoFoundItem=
function(y,B,A){map.Query&&(B=="0"?map.Query.execGotoFoundItem(y,B,A):(displayMessage("please wait ...",500),setTimeout("map.Query.execGotoFoundItem("+y+",'"+B+"',"+A+")",100)))};ixMap.Query.prototype.execGotoFoundItem=function(y,B,A){map.SVGPopupGroup&&map.SVGPopupGroup.fu.clear();if(B==null||B=="undefined")B="3";if(y<0)if(B=="select")map.Selections.newSelection(this.szThemesA[0],this.foundNodesA,"type:queryresult",this.szQuery);else if(B=="zoomto"){if(this.map.SVGDocument.getElementById("mapzoomandpan")){B=
new point(1E5,1E5);var J=new point(-1E5,-1E5);for(y=0;y<this.foundNodesA.length;y++){A=map.Dom.getBox(this.foundNodesA[y].node);if(A.width===0||A.height===0){var L=getMatrix(this.foundNodesA[y].node);A.x+=L[4];A.y+=L[5];A.width=map.Scale.viewBox.width/20;A.height=map.Scale.viewBox.height/20;A.x-=A.width/2;A.y-=A.height/2}L=map.Scale.getMapOffset(this.foundNodesA[y].node);A.x+=L.x;A.y+=L.y;B.x=Math.min(B.x,A.x);B.y=Math.min(B.y,A.y);J.x=Math.max(J.x,A.x+A.width);J.y=Math.max(J.y,A.y+A.height)}B=new box(B.x,
B.y,J.x-B.x,J.y-B.y);B.scale(1.2);B=map.Zoom.clipArea(B);map.Zoom.setNewArea(B);this.foundNodesA.length==1&&displayInfoDelayed(null,this.foundNodesA[0].node,1E3)}}else{clearThemes();map.highLightList.removeAll();for(y=0;y<this.foundNodesA.length;y++){if(!B.match(/info/)||!map.Themes.isNodePartOfAnyTheme(this.foundNodesA[y].node)){A=map.Layer.getLayerItemNodes(this.foundNodesA[y].node);for(L=0;L<A.length;L++)map.highLightList.addItem(A[L]);map.highLightList.startToggle()}B.match(/info/)&&displayInfo(null,
this.foundNodesA[y].node,"add|fix")}setMapTool("info")}else if(y<this.foundNodesA.length){y=this.foundNodesA[y].node;this.map._activeItem=y;this.map._activeTheme=null;clearThemes();map.highLightList.removeAll();if(!map.Themes.isNodePartOfAnyTheme(y)){A=map.Layer.getLayerItemNodes(y);for(L=0;L<A.length;L++)map.highLightList.addItem(A[L]);map.highLightList.startToggle()}if(B=="0"&&map.Scale.nZoomScale==1)displayInfo(null,y);else{A=map.Dom.getBox(y);A=new box(A.x,A.y,A.width,A.height);if(A.width===0||
A.height===0)J=map.Zoom.getBox(),L=getMatrix(y),A.x+=L[4],A.y+=L[5],A.width=Math.min(J.width,map.Scale.bBox.width/10),A.height=Math.min(J.height,map.Scale.bBox.height/10),A.x-=A.width/2,A.y-=A.height/2;L=map.Scale.getMapOffset(y);A.x+=L.x;A.y+=L.y;if(B=="0"){if(map.Zoom.isVisibleBox(A)){displayInfo(null,y);return}J=map.Zoom.getBox();A.scale(Math.min(J.width/A.width,J.height/A.height))}else A.scale(2);A=map.Zoom.clipArea(A);B=="0"?map.Zoom.setNewCenter(A):map.Zoom.setNewArea(A);displayInfoDelayed(null,
y,1E3)}}};var Ea=function(){this.partA=[]};Ea.prototype.newPart=function(){this.partA[this.partA.length]=this.actPart=new t};var t=function(){this.conditionA=[]};t.prototype.addCondition=function(y,B,A){this.conditionA[this.conditionA.length]=new K(y,B,A)};var K=function(y,B,A){this.szTopic=y;this.szOperator=B;this.szValue=A}})();(function(){function Ea(d){d=map.Themes.getMapThemeDefinitionObj(d.szId);for(var c="",e=0;e<U.length;e++){a:{var b=d.style[U[e].style];var n=U[e].style;var m=U[e].type,u=U[e].delimiter;u=u?u:",";if(typeof b!="undefined"&&b!=null)if(m&&typeof m!="undefined")if(m=="array"&&b&&b.length&&typeof b=="object"){b=b.join(u);n=n+":"+b+";";break a}else{if(m=="object"&&b){n=n+":"+JSON.stringify(b)+";";break a}}else{n=n+":"+String(b)+";";break a}n=""}c+=n}return c.replace(/"/gi,'\\"')}function t(d){return typeof d!==
"undefined"&&d!=null}function K(d,c,e){d=Number(d)||0;c=Number(c)||0;return e&&e.match(/pow/)?Math.pow(d,c):e&&e.match(/factor/)?d*c:e&&(e.match(/add/)||e.match(/delta/))?d+c:c}function y(d,c,e){d=d||0;c=c||0;return e&&e.match(/factor/)?c:e&&e.match(/add/)?(d+c)/d:c/d}function B(d,c,e,b,n){this.szName=d;this.coTable=e;this.szSelectionField=b;this.szItemField=n;this.nIndex=c;this.nFieldIndexA=[];this.nField100IndexA=[];this.nFieldSelectionIndex=-1;this.nFieldSelectionIndexA=[];this.nLabelFieldIndex=
this.nValueFieldIndex=this.nFieldItemIndex=-1;this.leadOffset=!1}function A(d,c,e,b,n,m,u){var z;this.fDone=!1;this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;this.nNoData=this.nCount=this.nSum=0;this.szThemes=d||"";this.szThemesA=this.szThemes.split("|");this.checkTheme();this.objThemesA=[];this.szFields=c||"$item$";this.szFieldsA=this.szFields.split("|");this.szField100=e||"";this.szField100A=e?e.split("|"):null;this.nFieldsA=[];this.nFields100A=[];this.nFieldsSelectionA=[];this.nMinA=[];
this.nMaxA=[];this.nSumA=[];this.nMeanA=[];this.nMedianA=[];this.nDeviationA=[];this.nOrigMinA=[];this.nOrigMaxA=[];this.nOrigSumA=[];for(z=0;z<this.szFieldsA.length;z++)this.nMinA[z]=Number.MAX_VALUE,this.nMaxA[z]=-Number.MAX_VALUE,this.nSumA[z]=0,this.nOrigMinA[z]=Number.MAX_VALUE,this.nOrigMaxA[z]=-Number.MAX_VALUE,this.nOrigSumA[z]=0,this.nMedianA[z]=0,this.nMeanA[z]=0;this.nMin100=Number.MAX_VALUE;this.nMax100=-Number.MAX_VALUE;this.nSum100=0;this.nMinSize=Number.MAX_VALUE;this.nMaxSize=-Number.MAX_VALUE;
this.nSumSize=0;this.nMinAlpha=Number.MAX_VALUE;this.nMaxAlpha=-Number.MAX_VALUE;this.nSumAlpha=0;this.nMinX=Number.MAX_VALUE;this.nMaxX=-Number.MAX_VALUE;this.nSumX=0;this.nMinY=Number.MAX_VALUE;this.nMaxY=-Number.MAX_VALUE;this.nSumY=0;this.nDominantDFilter=this.szDominantFilter=null;this.nFilterA=[];this.dbTableA=[];this.dbFieldsA=[];this.dbRecordsA=[];if(n)for(z in this.origColorScheme=[],n)this.origColorScheme[z]=n[z];else this.origColorScheme=null;this.defaultColorScheme=["#008888","#00aaaa",
"#00cccc","#00eeee","#00ffff"];this.szTitle=m?m:d+" ["+c+"]";this.szTitle=map.Dictionary.getLocalText(this.szTitle);this.szTitle=this.szTitle.length>60?this.szTitle.slice(0,50)+" ...":this.szTitle;this.szUnits="";this.szXaxisA=this.szAlphaValueUnits=this.szSizeValueUnits=null;this.szOrigLabelA=this.szLabelA=u;this.szLegendLabelA=[];this.szLegendStyle="";this.evidenceMode="isolate";this.szAggregation="sum";this.nValuesA=[];this.szExactA=this.szRangesA=this.szValuesA=null;this.itemA=[];this.fDataCache=
this.fVisible=!0;this.fEditor=!1;this.fUndefinedValuePossible=this.fNegativeValuePossible=this.fNullIsValue=!0;this.fCheckRecordLength=!1;this.nStringToValue=1;this.nStringToValueA=[];this.szOrigFlag=this.szFlag=b?b:"CHOROPLETH";this.nValueScale=this.nScale=1;this.nRefreshTimeout=0;this.szId="theme"+String(Math.random());this.szShapeType="polygon";if(d=map.Layer.getLayerObj(this.szThemesA[0]))this.szShapeType=d.szType,this.szShapeType=="line"&&this.szOrigFlag.match(/BUFFER/)&&(this.szShapeType+="+buffer");
this.hiddenLayerA=[];this.szFlag.match(/CHART/)||(this.szFlag.match(/PIE/)?this.szOverviewChart="PIE":this.szFlag.match(/DONUT/)&&(this.szOverviewChart="DONUT"));this.szFlag.match(/ZEROISNOTVALUE/)&&(this.fNullIsValue=!1);this.szFlag.match(/ZEROISVALUE/)&&(this.fNullIsValue=!0);this.szFlag.match(/NEGATIVEISNOTVALUE/)&&(this.fNegativeValuePossible=!1);this.szFlag.match(/NEGATIVEISVALUE/)&&(this.fNegativeValuePossible=!0);this.szFlag.match(/UNDEFINEDISVALUE/)&&(this.fUndefinedValuePossible=!0);this.szFlag.match(/UNDEFINEDISNOTVALUE/)&&
(this.fUndefinedValuePossible=!1);this.szFlag.match(/CHECKRECORDLENGTH/)&&(this.fCheckRecordLength=!0);this.szFlag.match(/SUM/)&&(this.szAggregation="sum");this.szFlag.match(/MEAN/)&&(this.szAggregation="mean");this.szFlag.match(/MAX/)&&(this.szAggregation="max");if(this.szFlag.match(/CHART/)){if(this.szFlag.match(/CATEGORICAL/)||this.szFieldsA.length>1)this.fNullIsValue=!0;this.szFlag.match(/BUFFER/)||(this.fShadow=this.fOrigShadow=!0)}this.szFlag.match(/CATEGORICAL/)&&!this.szFlag.match(/AGGREGATE/)&&
(this.fNegativeValuePossible=!1);this.szFlag.match(/CATEGORICAL/)&&!this.szLabelA&&(this.szLabelA=[]);this.fGrayNoMember=this.fSortBeforeDraw=this.fClipCharts=!0;this.nClipTimeout=1E3;this.paintedShapeNodesA=[];this.szChoroplethInfoStyle=map.Themes.szChoroplethInfoStyle;this.nMaxThemeCharts=map.Themes.nMaxThemeCharts;this.nMaxShadowCharts=map.Themes.nMaxShadowCharts;this.nflushPaintShape=map.Themes.nflushPaintShape;this.nflushChartDraw=map.Themes.nflushChartDraw;this.themeNodesPosA=this.szFlag.match(/AGGREGATE|GROUP/)?
[]:map.Themes.themeNodesPosA;this.style={theme:this};this.setProperties=function(x){this.szFields=x.field||x.fields||this.szFields;this.szField100=x.field100||this.szField100;this.szFieldsA=c.split("|");this.szField100A=e?e.split("|"):null;this.style.setProperties(x)};this.style.setProperties=function(x){map.Themes.parseStyle(this.theme,x)}}function J(d,c){return d.y>c.y?1:-1}function L(d){va[d]||(va[d]=new da(d));return va[d]}function da(d){typeof d!="string"&&(d="#ffffff");this.mainColor=d;this.lowColor=
ColorScheme.getDerivateColor(d,.7);this.highColor=ColorScheme.getDerivateColor(d,1.3);this.borderColor=ColorScheme.getBorderColor(d);this.textColor=ColorScheme.getTextColor(d)}function V(d){if(typeof d=="string"&&d.match(/&#x/)){d=d.split("&#x");var c=d[0];for(var e=1;e<d.length;e++){var b=String,n=b.fromCharCode;var m=d[e].substr(0,2);m=parseInt(m,16);c+=n.call(b,m);c+=d[e].substr(3,d[e].length-3)}return c}return d}var U=[{style:"opacity",obj:"nOpacity"},{style:"fillopacity",obj:"fillOpacity"},{style:"autoopacity",
obj:"autoOpacity"},{style:"shadow",obj:"fOrigShadow"},{style:"blur",obj:"nBlur"},{style:"filter",obj:"szFilter"},{style:"dfilter",obj:"nDeltaFilter"},{style:"filterfield",obj:"szFilterField"},{style:"visible",obj:"fVisible"},{style:"dbtable",obj:"coTable"},{style:"dbtableUrl",obj:"coTableUrl"},{style:"dbtableType",obj:"coTableType"},{style:"dbtableExt",obj:"coTableExt"},{style:"dbtableProcess",obj:"coTableProcess"},{style:"dbtableQuery",obj:"coTableQuery"},{style:"datacache",obj:"fDataCache"},{style:"itemfield",
obj:"szItemField"},{style:"lookupfield",obj:"szSelectionField"},{style:"lookuptoupper",obj:"fSelectionFieldToUpper"},{style:"lookupsuffix",obj:"szSelectionFieldSuffix"},{style:"lookupdigits",obj:"nSelectionFieldDigits"},{style:"lookuptonumber",obj:"fSelectionFieldToNumber"},{style:"lookupfield2",obj:"szSelectionField2"},{style:"showdata",obj:"fShowData"},{style:"datafields",obj:"szDataFieldsA",type:"array"},{style:"userdraw",obj:"userDraw"},{style:"child",obj:"fChild"},{style:"crsdatum",obj:"szCRSDatum"},
{style:"crsutmzone",obj:"szCRSUTMZone"},{style:"server",obj:"szServer"},{style:"ranges",obj:"szRangesA",type:"array"},{style:"rangecentervalue",obj:"nRangeCenterValue"},{style:"symbols",obj:"szSymbolsA",type:"array"},{style:"values",obj:"szValuesA",type:"array",delimiter:"|"},{style:"colorvalues",obj:"szColorValuesA",type:"array",delimiter:"|"},{style:"symbolvalues",obj:"szSymbolValuesA",type:"array",delimiter:"|"},{style:"label",obj:"szOrigLabelA",type:"array",delimiter:"|"},{style:"valuemap",obj:"valueMap",
type:"object"},{style:"xaxis",obj:"szXaxisA",type:"array"},{style:"units",obj:"szUnits"},{style:"labelunits",obj:"szLabelUnits"},{style:"titleunits",obj:"szTitleUnits"},{style:"units100",obj:"szUnits100"},{style:"sizevalueunits",obj:"szSizeValueUnits"},{style:"alphavalueunits",obj:"szAlphaValueUnits"},{style:"legendunits",obj:"szLegendUnits"},{style:"weights",obj:"szWeights"},{style:"align",obj:"szAlign"},{style:"offsetx",obj:"nOffsetX"},{style:"offsety",obj:"nOffsetY"},{style:"rotation",obj:"nRotation"},
{style:"refreshtimeout",obj:"nRefreshTimeout"},{style:"normalsizevalue",obj:"nNormalSizeValue"},{style:"normalsizescale",obj:"szNormalSizeScale"},{style:"scale",obj:"nScale"},{style:"rangescale",obj:"nRangeScale"},{style:"sizepow",obj:"nSizePow"},{style:"outlierscale",obj:"nOutlierScale"},{style:"colorfield",obj:"szColorField"},{style:"symbolfield",obj:"szSymbolField"},{style:"valuefield",obj:"szValueField"},{style:"labelfield",obj:"szLabelField"},{style:"sizefield",obj:"szSizeField"},{style:"timefield",
obj:"szTimeField"},{style:"alphafield",obj:"szAlphaField"},{style:"alphafield100",obj:"szAlphaField100"},{style:"xfield",obj:"szXField"},{style:"yfield",obj:"szYField"},{style:"dopacitypow",obj:"nDopacityPow"},{style:"dopacityramp",obj:"szDopacityRamp"},{style:"dopacityscale",obj:"nDopacityScale"},{style:"brightness",obj:"nBrightness"},{style:"buffersize",obj:"nBufferSize"},{style:"bufferstep",obj:"nBufferSizeStep"},{style:"field100min",obj:"nField100Min"},{style:"fractionscale",obj:"nFractionScale"},
{style:"minvalue",obj:"nMinValue"},{style:"maxvalue",obj:"nMaxValue"},{style:"lowvalue",obj:"nLowValue"},{style:"highvalue",obj:"nHighValue"},{style:"textfont",obj:"szTextFont"},{style:"textcolor",obj:"szTextColor"},{style:"textscale",obj:"nTextScale"},{style:"linecolor",obj:"szLineColor"},{style:"linecolor",obj:"szLineColorA",type:"array"},{style:"linewidth",obj:"nLineWidth"},{style:"markersize",obj:"nMarkerSize"},{style:"gapsize",obj:"nGapSize"},{style:"bordercolor",obj:"szBorderColor"},{style:"borderstyle",
obj:"szBorderStyle"},{style:"borderwidth",obj:"szBorderWidth"},{style:"borderradius",obj:"nBorderRadius"},{style:"boxcolor",obj:"szBoxColor"},{style:"boxopacity",obj:"nBoxOpacity"},{style:"boxmargin",obj:"nBoxMargin"},{style:"textplacement",obj:"szTextPlacement"},{style:"infotitle",obj:"szInfoTitle"},{style:"titlefield",obj:"szTitleField"},{style:"snippetfield",obj:"szSnippetField"},{style:"exclude",obj:"szExcludeA",type:"array"},{style:"nodatacolor",obj:"szNoDataColor"},{style:"titleupper",obj:"szTitleUpper"},
{style:"titlelower",obj:"szTitleLower"},{style:"labelupper",obj:"szLabelUpper"},{style:"labellower",obj:"szLabelLower"},{style:"valueupper",obj:"szValueUpper"},{style:"valuelower",obj:"szValueLower"},{style:"glowupper",obj:"szGlowUpper"},{style:"glowlower",obj:"szGlowLower"},{style:"chartupper",obj:"szChartUpper"},{style:"chartlower",obj:"szChartLower"},{style:"layerupper",obj:"szLayerUpper"},{style:"layerlower",obj:"szLayerLower"},{style:"featureupper",obj:"szFeatureUpper"},{style:"featurelower",
obj:"szFeatureLower"},{style:"boxupper",obj:"szBoxUpper"},{style:"boxlower",obj:"szBoxLower"},{style:"shadowupper",obj:"szShadowUpper"},{style:"shadowlower",obj:"szShadowLower"},{style:"declutterupper",obj:"szDeclutterUpper"},{style:"valuescale",obj:"nValueScale"},{style:"valuecolor",obj:"szValueColor"},{style:"minvaluesize",obj:"nValueSizeMin"},{style:"minvaluevalue",obj:"nValueValueMin"},{style:"valuedecimals",obj:"nValueDecimals"},{style:"fadevaluepow",obj:"szFadeValuePow"},{style:"fadenegative",
obj:"nFadeNegative"},{style:"centerpart",obj:"szCenterPart"},{style:"clipframes",obj:"nClipFrames"},{style:"clipframerate",obj:"nClipFrameRate"},{style:"cliplegend",obj:"nClipColorLegend"},{style:"clipparts",obj:"nClipParts"},{style:"minchartsize",obj:"nChartSizeMin"},{style:"maxcharts",obj:"nMaxCharts"},{style:"showparts",obj:"szShowParts"},{style:"gridx",obj:"nGridX"},{style:"gridwidth",obj:"nGridWidth"},{style:"gridmatrix",obj:"nGridMatrix"},{style:"gridwidthpx",obj:"nGridWidthPx"},{style:"gridoffsetx",
obj:"nGridOffsetX"},{style:"gridoffsety",obj:"nGridOffsetY"},{style:"aggregationfield",obj:"szAggregationField"},{style:"aggregationscale",obj:"szAggregationFieldA",type:"array"},{style:"aggregation",obj:"szAggregation"},{style:"minaggregation",obj:"szMinAggregation"},{style:"aggregationupper",obj:"szAggregationUpper"},{style:"aggregationlower",obj:"szAggregationLower"},{style:"clipupper",obj:"szClipUpper"},{style:"cliplower",obj:"szClipLower"},{style:"dominantfilter",obj:"szDominantFilter"},{style:"dominantdfilter",
obj:"nDominantDFilter"},{style:"overviewchart",obj:"szOverviewChart"},{style:"evidence",obj:"evidenceMode"},{style:"markclass",obj:"markedClass"},{style:"markclasses",obj:"markedClassesA",type:"array"},{style:"name",obj:"szName"},{style:"title",obj:"szTitle"},{style:"snippet",obj:"szSnippet"},{style:"splash",obj:"szSplash"},{style:"description",obj:"szDescription"},{style:"tooltip",obj:"szTooltip"}];ixMap.Themes=function(){this.themesA=[];this.themeNodesA=[];this.themeNodesPosA=[];this.themeNodesBoxA=
[];this.themeNodes=0;this.activeBuffer=this.activeTheme=null;this.switchedLayerA=[];this.enableMultiChoropleth=this.enableChartOffset=!1;this.enableSubThemes=!0;this.szChoroplethInfoStyle="histogram|";this.nMaxThemeCharts=1E6;this.nMaxShadowCharts=1E3;this.nflushPaintShape=5E3;this.nflushChartDraw=1E3;this.nColorSchemeMaxHeight=120;this.autoHideInfoTools=this.allwaysShowValues=!1;this.themeDataCacheA=[]};ixMap.Themes.prototype=new Map;if(typeof thisversion=="string"&&map.checkVersion(thisversion)){map.Themes=
new ixMap.Themes;try{map.HTMLWindow.ixmaps.htmlgui_onInitThemes()}catch(d){}}else alert("ixMap.Themes incompatible !");ixMap.Themes.prototype.addTheme=function(d){this.themesA[this.themesA.length]=d;if(!d.szFlag.match(/selection/i))try{map.HTMLWindow.ixmaps.htmlgui_onNewTheme(d.szId)}catch(c){}};ixMap.Themes.prototype.getThemeCount=function(){return this.themesA.length};ixMap.Themes.prototype.getAllThemes=function(){return this.themesA};ixMap.Themes.prototype.getThemes=function(){return this.themesA};
ixMap.Themes.prototype.isTheme=function(d){for(var c=0;c<this.themesA.length;c++)if(this.themesA[c].szIdStr&&this.themesA[c].szIdStr==d)return this.themesA[c];return!1};ixMap.Themes.prototype.isIdle=function(){for(var d=0;d<this.themesA.length;d++)if(!this.themesA[d].fRealizeDone)return!1;return!0};ixMap.Themes.prototype.isArray=function(d){return Object.prototype.toString.call(d)==="[object Array]"};ixMap.Themes.prototype.isObject=function(d){return Object.prototype.toString.call(d)==="[object Object]"};
ixMap.Themes.prototype.toArray=function(d){if(this.isObject(d)){var c=[],e;for(e in d)c.push(e),c.push(d[e]);return c}return this.isArray(d)?d:String(d).match(/\|/)||String(d).match(/RGB/)?String(d).split("|"):String(d).split(",")};ixMap.Themes.prototype.toString=function(d){return this.isArray(d)?d.join("|"):d};ixMap.Themes.prototype.newTheme=function(d,c,e,b,n,m){var u=b.split("style=");b=u&&u.length>1?__getStyleObj(u[1]):__getStyleObj(b);b.label=m&&m!="undefined"?m.split("|"):b.label||null;b.szTitle=
n;return this.newThemeByObj({layer:d,field:c,field100:e,style:b})};ixMap.Themes.prototype.newThemeByObj=function(d,c){if(map.isIdle()){if(this.newThemeObjA&&this.newThemeObjA.length&&(d&&this.newThemeObjA.push(d),d=this.newThemeObjA.shift()),d){var e=JSON.stringify(d);if(this.isTheme(e)&&d.style.type.match(/TOGGLE/))return this.removeTheme(null,this.isTheme(e).szId),null;var b=null,n=d.style;if(!n)return null;if(this.isArray(n.label)){b=n.label;var m=n.label.join("|")}else b=(m=n.label)&&m!="undefined"?
m.split("|"):null;m=[5,"white","blue"];n.colorscheme&&(m=this.toArray(n.colorscheme));d.layer=this.toString(d.layer);d.field=this.toString(d.field);n.type.match(/\bEXACT\b/)&&!n.type.match(/\bCATEGORICAL\b/)&&(n.type+="|CATEGORICAL");b=new A(d.layer,d.field,d.field100,n.type,m,n.title,b);b.nOrder=this.getThemeCount();b.szIdStr=e;b.origDef=d;this.parseStyle(b,n);this.allwaysShowValues&&(b.szFlag+="|VALUES");b.parent=this;this.addTheme(b);b.fRealize=!0;b.szFlag.match(/CHOROPLETH||BUFFER/)||b.createChartGroup(map.Layer.objectGroup);
map.Event.doDefaultZoom();c&&c.match(/fast|silent|direct/)?map.Themes.execute():executeWithMessage("map.Themes.execute()","... processing ...");return b}}else d&&(this.newThemeObjA=this.newThemeObjA||[],this.newThemeObjA.push(d)),setTimeout(function(){map.Themes.newThemeByObj()},100)};ixMap.Themes.prototype.parseStyle=function(d,c){if(d&&c){if(t(c.classes)){if(isNaN(Number(d.origColorScheme[0]))){var e=d.origColorScheme[d.origColorScheme.length-1];d.origColorScheme[1]=d.origColorScheme[0];d.origColorScheme[2]=
e}d.origColorScheme[0]=Number(c.classes)}t(c.colorstyle)&&d.origColorScheme[1]=="spectrum"&&(d.origColorScheme[2]=c.colorstyle);t(c.dominantdfilter)&&(d.nDominantDFilter=Number(c.dominantdfilter));t(c.dominantfilter)&&(d.szDominantFilter=String(c.dominantfilter));t(c.filter)&&(d.szFilter=String(c.filter));t(c.filterfield)&&(d.szFilterField=String(c.filterfield));t(c.filtervalue)&&(d.szFilterValue=String(c.filtervalue));t(c.overviewchart)&&(d.szOverviewChart=c.overviewchart);t(c.evidence)&&(d.evidenceMode=
c.evidence);t(c.markclass)&&(d.markedClass=c.markclass,d.markedClasses||(d.markedClasses=[],d.markedClasses[d.markedClass]=!0,d.markedClassesA=[d.markedClass]));t(c.markclasses)&&(d.markedClassesA=this.toArray(c.markclasses),d.markedClasses=[],d.markedClassesA.forEach(function(b,n){b.length&&(d.markedClasses[b]=!0,d.markedClass=b)}));t(c.fillopacity)&&(c.fillopacity=="auto"?(d.autoOpacity=!0,d.fillOpacity=0):d.fillOpacity=Number(c.fillopacity));t(c.opacity)&&(c.opacity=="auto"?(d.autoOpacity=!0,d.fillOpacity=
0):d.nOpacity=Number(c.opacity));t(c.autoopacity)&&(d.autoOpacity=!0,d.fillOpacity=0);t(c.shadow)?d.fShadow=d.fOrigShadow=JSON.parse(c.shadow):d.fShadow=d.fOrigShadow=!1;t(c.maxshadow)&&(d.nMaxShadowCharts=Number(c.maxshadow));t(c.blur)&&(d.nBlur=Number(c.blur));t(c.dbtable)&&(e=c.dbtable.split(" "),d.coTable=e[0],e.length==2&&(d.coTableType="jsonDB",d.coTableUrl=e[1].split("(")[1].split(")")[0]),e.length==3&&(d.coTableType=e[1],d.coTableUrl=e[2].split("(")[1].split(")")[0]),e.length==4&&(d.coTableType=
e[1],d.coTableUrl=e[2].split("(")[1].split(")")[0],d.coTableExt=e[3].split("(")[1].split(")")[0]));t(c.dbtableType)&&(d.coTableType=c.dbtableType);t(c.dbtableUrl)&&(d.coTableUrl=c.dbtableUrl);t(c.dbtableExt)&&(d.coTableExt=c.dbtableExt);t(c.dbtableProcess)&&(d.coTableProcess=c.dbtableProcess);t(c.dbtableQuery)&&(d.coTableQuery=c.dbtableQuery);t(c.lookupfield)&&(d.szSelectionField=d.szItemField=c.lookupfield);t(c.lookupfield2)&&(d.szSelectionField2=c.lookupfield2);t(c.lookuptoupper)&&(d.fSelectionFieldToUpper=
JSON.parse(c.lookuptoupper));t(c.lookupsuffix)&&(d.szSelectionFieldSuffix=c.lookupsuffix);t(c.lookupprefix)&&(d.szSelectionFieldPrefix=c.lookupprefix);t(c.lookupdigits)&&(d.nSelectionFieldDigits=Number(c.lookupdigits));t(c.lookuptonumber)&&(d.fSelectionFieldToNumber=JSON.parse(c.lookuptonumber));t(c.crsutmzone)&&(d.szCRSUTMZone=c.crsutmzone);t(c.crsdatum)&&(d.szCRSDatum=c.crsdatum);t(c.server)&&(d.szServer=c.server);t(c.itemfield)&&(d.szItemField=c.itemfield);t(c.ranges)&&(d.szRangesA=this.toArray(c.ranges),
d.szRanges=this.toString(c.ranges));t(c.symbols)&&(d.szSymbolsA=this.toArray(c.symbols));if(t(c.values)&&(d.szValuesA=this.toArray(c.values),c.type.match(/CATEGORICAL/)&&d.szValuesA.length))for(e=0;e<d.szValuesA.length;e++)d.getStringValueIndex(d.szValuesA[e],"set");t(c.colorvalues)&&(d.szColorValuesA=this.toArray(c.colorvalues));t(c.symbolvalues)&&(d.szSymbolValuesA=this.toArray(c.symbolvalues));t(c.align)&&(d.szAlign=c.align);t(c.offsetx)&&(d.nOffsetX=Number(c.offsetx)||0);t(c.offsety)&&(d.nOffsetY=
Number(c.offsety)||0);t(c.rotation)&&(d.nRotation=Number(c.rotation)||0);t(c.units)&&(d.szUnits=c.units);t(c.units100)&&(d.szUnits100=c.units100);t(c.sizevalueunits)&&(d.szSizeValueUnits=" "+c.sizevalueunits);t(c.alphavalueunits)&&(d.szAlphaValueUnits=" "+c.alphavalueunits);t(c.legendunits)&&(d.szLegendUnits=" "+c.legendunits);t(c.labelunits)&&(d.szLabelUnits=" "+c.labelunits);t(c.titleunits)&&(d.szTitleUnits=" "+c.titleunits);t(c.xaxis)&&(d.szXaxisA=this.toArray(c.xaxis));t(c.id)&&(d.szId=unescape(c.id));
t(c.name)&&(d.szId=d.szName=unescape(c.name));t(c.title)&&(d.szTitle=unescape(c.title));t(c.snippet)&&(d.szSnippet=unescape(c.snippet));t(c.splash)&&(d.szSplash=unescape(c.splash));t(c.description)&&(d.szDescription=unescape(c.description));t(c.tooltip)&&(d.szTooltip=unescape(c.tooltip));t(c.label)&&(d.szLabelA=d.szOrigLabelA=this.toArray(c.label));t(c.weights)&&(d.szWeightsA=this.toArray(c.weights),d.szWeights=this.toString(c.weights));t(c.weight)&&(d.szWeightsA=[c.weights],d.szWeights=c.weight);
t(c.scale)&&(d.nScale=Number(c.scale));t(c.colorfield)&&(d.szColorField=c.colorfield);t(c.symbolfield)&&(d.szSymbolField=c.symbolfield);t(c.valuefield)&&(d.szValueField=c.valuefield);t(c.labelfield)&&(d.szLabelField=c.labelfield);t(c.titlefield)&&(d.szTitleField=c.titlefield);t(c.snippetfield)&&(d.szSnippetField=c.snippetfield);t(c.sizefield)&&(d.szSizeField=c.sizefield);t(c.timefield)&&(d.szTimeField=c.timefield);t(c.alphafield)&&(d.szAlphaField=c.alphafield);t(c.alphafield100)&&(d.szAlphaField100=
c.alphafield100);t(c.xfield)&&(d.szXField=c.xfield);t(c.yfield)&&(d.szYField=c.yfield);t(c.refresh)&&(d.nRefreshTimeout=Number(c.refresh)*1E3);t(c.refreshtimeout)&&(d.nRefreshTimeout=Number(c.refreshtimeout));t(c.buffersize)&&(d.nBufferSize=c.buffersize);t(c.bufferstep)&&(d.nBufferSizeStep=c.bufferstep);t(c.field100min)&&(d.nField100Min=c.field100min);t(c.fractionscale)&&(d.nFractionScale=c.fractionscale);t(c.minvalue)&&(d.nMinValue=c.minvalue);t(c.maxvalue)&&(d.nMaxValue=c.maxvalue);t(c.lowvalue)&&
(d.nLowValue=c.lowvalue);t(c.highvalue)&&(d.nHighValue=c.highvalue);t(c.showdata)&&(d.fShowData=JSON.parse(c.showdata));t(c.datacache)&&(d.fDataCache=JSON.parse(c.datacache));t(c.editor)&&(d.fEditor=JSON.parse(c.editor));t(c.datafields)&&(d.szDataFieldsA=this.toArray(c.datafields));t(c.textcolor)&&(d.szTextColor=c.textcolor);t(c.textfont)&&(d.szTextFont=c.textfont);t(c.textscale)&&(d.nTextScale=Number(c.textscale));t(c.linecolor)&&(d.szLineColorA=this.toArray(c.linecolor),d.szLineColor=d.szLineColorA[d.szLineColorA.length-
1]);t(c.linewidth)&&(d.nLineWidth=c.linewidth);t(c.markersize)&&(d.nMarkerSize=c.markersize);t(c.gapsize)&&(d.nGapSize=c.gapsize);t(c.bordercolor)&&(d.szBorderColor=c.bordercolor);t(c.borderstyle)&&(d.szBorderStyle=c.borderstyle);t(c.borderwidth)&&(d.szBorderWidth=c.borderwidth);t(c.borderradius)&&(d.nBorderRadius=Number(c.borderradius));t(c.boxcolor)&&(d.szBoxColor=c.boxcolor);t(c.boxopacity)&&(d.nBoxOpacity=c.boxopacity);t(c.boxmargin)&&(d.nBoxMargin=c.boxmargin);t(c.textplacement)&&(d.szTextPlacement=
c.textplacement);t(c.infotitle)&&(d.szInfoTitle=c.infotitle);t(c.exclude)&&(d.szExcludeA=this.toArray(c.exclude));t(c.aggregation)&&(d.szAggregation=c.aggregation);t(c.rangecentervalue)&&(d.nRangeCenterValue=Number(c.rangecentervalue));t(c.rangescale)&&(d.nRangeScale=c.rangescale);t(c.normalsizevalue)&&(d.nNormalSizeValue=c.normalsizevalue);t(c.normalsizescale)&&(d.szNormalSizeScale=c.normalsizescale,d.nNormalSizeScale=fa(d.szNormalSizeScale));t(c.nodatacolor)&&(d.szNoDataColor=P(c.nodatacolor));
t(c.boxupper)&&(d.szBoxUpper=c.boxupper,d.nBoxUpper=fa(d.szBoxUpper));t(c.boxlower)&&(d.szBoxLower=c.boxlower,d.nBoxLower=fa(d.szBoxLower));t(c.titleupper)&&(d.szTitleUpper=c.titleupper,d.nTitleUpper=fa(d.szTitleUpper));t(c.titlelower)&&(d.szTitleLower=c.titlelower,d.nTitleLower=fa(d.szTitleLower));t(c.labelupper)&&(d.szLabelUpper=c.labelupper,d.nLabelUpper=fa(d.szLabelUpper));t(c.labellower)&&(d.szLabelLower=c.labelupper,d.nLabelLower=fa(d.szLabelLower));t(c.valueupper)&&(d.szValueUpper=c.valueupper,
d.nValueUpper=fa(d.szValueUpper));t(c.valuesupper)&&(d.szValueUpper=c.valuesupper,d.nValueUpper=fa(d.szValueUpper));t(c.valuelower)&&(d.szValueLower=c.valuelower,d.nValueLower=fa(d.szValueLower));t(c.valueslower)&&(d.szValueLower=c.valueslower,d.nValueLower=fa(d.szValueLower));t(c.glowupper)&&(d.szGlowUpper=c.glowupper,d.nGlowUpper=fa(d.szGlowUpper));t(c.glowlower)&&(d.szGlowLower=c.glowlower,d.nGlowLower=fa(d.szGlowLower));t(c.chartupper)&&(d.szChartUpper=c.chartupper,d.nChartUpper=fa(d.szChartUpper));
t(c.chartlower)&&(d.szChartLower=c.chartlower,d.nChartLower=fa(d.szChartLower));t(c.layerupper)&&(d.szLayerUpper=c.layerupper,d.nLayerUpper=fa(d.szLayerUpper));t(c.layerlower)&&(d.szLayerLower=c.layerlower,d.nLayerLower=fa(d.szLayerLower));t(c.featureupper)&&(d.szFeatureUpper=c.featureupper,d.nFeatureUpper=fa(d.szFeatureUpper));t(c.featurelower)&&(d.szFeatureLower=c.featurelower,d.nFeatureLower=fa(d.szFeatureLower));t(c.shadowupper)&&(d.szShadowUpper=c.shadowupper,d.nShadowUpper=fa(d.szShadowUpper));
t(c.shadowlower)&&(d.szShadowLower=c.shadowlower,d.nShadowLower=fa(d.szShadowLower));t(c.declutterupper)&&(d.szDeclutterUpper=c.declutterupper,d.nDeclutterUpper=fa(d.szDeclutterUpper));t(c.valuecolor)&&(d.szValueColor=c.valuecolor);t(c.valuescale)&&(d.nValueScale=Number(c.valuescale));t(c.clipframes)&&(d.nClipFrames=c.clipframes);t(c.clipframerate)&&(d.nClipFrameRate=c.clipframerate,d.nClipTimeout=1/Number(c.clipframerate)*1E3);t(c.cliplegend)&&(d.nClipColorLegend=Number(c.cliplegend));t(c.clipvaluesize)&&
(d.nValueSizeMin=Number(c.clipvaluesize));t(c.minvaluesize)&&(d.nValueSizeMin=Number(c.minvaluesize));t(c.minvaluevalue)&&(d.nValueValueMin=Number(c.minvaluevalue));t(c.valuedecimals)&&(d.nValueDecimals=c.valuedecimals);t(c.fadevaluepow)&&(d.szFadeValuePow=c.fadevaluepow);t(c.dopacityscale)&&(d.nDopacityScale=c.dopacityscale);t(c.dopacityramp)&&(d.szDopacityRamp=c.dopacityramp);t(c.dopacitypow)&&(d.nDopacityPow=c.dopacitypow);t(c.fadenegative)&&(d.nFadeNegative=Number(c.fadenegative)||.5);t(c.brightness)&&
(d.nBrightness=c.brightness);t(c.clipparts)&&(d.nClipParts=Number(c.clipparts)||0);t(c.minsize)&&(d.nChartSizeMin=Number(c.minsize)||0);t(c.minchartsize)&&(d.nChartSizeMin=Number(c.minchartsize)||0);t(c.maxcharts)&&(d.nMaxCharts=Math.round(Number(c.maxcharts))||0);t(c.clipsize)&&(d.nChartSizeMin=Number(c.clipsize)||0);t(c.sizepow)&&(d.nSizePow=c.sizepow);t(c.outlierscale)&&(d.nOutlierScale=c.outlierscale);t(c.showparts)&&(d.szShowParts=this.toString(c.showparts),d.szShowPartsA=this.toArray(c.showparts));
t(c.gridx)&&(d.nGridX=Number(c.gridx)||1);t(c.gridwidth)&&(String(c.gridwidth).match(/px/)&&(d.nGridWidthPx=parseFloat(c.gridwidth)||50,map.Themes.doChangeThemeStyle(d.szId,"AUTOGRID","add")),d.nGridWidth=Number(c.gridwidth)||0);t(c.gridmatrix)&&(d.nGridMatrix=Number(c.gridmatrix)||20,map.Themes.doChangeThemeStyle(d.szId,"AUTOGRID","add"));t(c.gridwidthpx)&&(d.nGridWidthPx=Number(c.gridwidthpx)||50,map.Themes.doChangeThemeStyle(d.szId,"AUTOGRID","add"));t(c.gridoffsetx)&&(d.nGridOffsetX=Number(c.gridoffsetx)||
0);t(c.gridoffsety)&&(d.nGridOffsetY=Number(c.gridoffsety)||0);t(c.aggregationfield)&&(d.szAggregationField=c.aggregationfield);t(c.aggregationscale)&&(d.szAggregationFieldA=this.toArray(c.aggregationscale));t(c.aggregation)&&(d.szAggregationFieldA=this.toArray(c.aggregation));t(c.minaggregation)&&(d.szMinAggregation=c.minaggregation,d.nMinAggregation=Number(c.minaggregation)||0);t(c.aggregationupper)&&(d.szAggregationUpper=c.aggregationupper,d.nAggregationUpper=fa(d.szAggregationUpper));t(c.aggregationlower)&&
(d.szAggregationLower=c.aggregationlower,d.nAggregationLower=fa(d.szAggregationLower));t(c.clipupper)&&(d.szClipUpper=c.clipupper,d.nClipUpper=fa(d.szClipUpper));t(c.cliplower)&&(d.szClipLower=c.cliplower,d.nClipLower=fa(d.szClipLower));t(c.userdraw)&&(d.userDraw=c.userdraw);t(c.centerpart)&&(d.szCenterPart=this.toString(c.centerpart));t(c.child)&&(d.fChild=!0);t(c.valuemap)&&(d.valueMap=c.valuemap);t(c.visible)&&(d.fVisible=JSON.parse(c.visible))}};ixMap.Themes.prototype.getAllThemeDefinitionStrings=
function(){for(var d=[],c=0;c<this.themesA.length;c++)d.push(this.getThemeDefinitionString(this.themesA[c]));return d};var P=function(d){try{if(d.charAt(0)=="#"){var c="0123456789abcdef";var e=parseInt(d.substr(1,2),16);var b=parseInt(d.substr(3,2),16);c=parseInt(d.substr(5,2),16);return"RGB("+e+","+b+","+c+")"}}catch(n){}return d},fa=function(d){return String(d).match(/:/)?Number(d.split(":")[1]):Number(d)};ixMap.Themes.prototype.cleanUpThemeObj=function(d,c){d.field=c.field;d.style.values=c.style.values;
d.style.label=c.style.label;d.style.xaxis=c.style.xaxis;c=d.style;if(c.colorscheme){var e=c.colorscheme[0];for(var b in c.colorscheme)if(c.colorscheme[b]!=e){e=null;break}e&&(c.colorscheme.length=1)}if(c.symbols){e=c.symbols[0];for(b in c.symbols)if(c.symbols[b]!=e){e=null;break}e&&(c.symbols.length=1)}c.aggregationscale?(c.aggregationfield=null,c.gridwidth=null,c.gridwidthpx=null):c.aggregationfield?(c.gridwidth=null,c.gridwidthpx=null):c.gridwidthpx&&(c.gridwidth=null);c.evidence&&c.evidence=="isolate"&&
(c.evidence=null);c.aggregation&&(c.aggregation=null);c.type.match(/DOMINANT/)||c.type.match(/PERCENTOFMEAN/)||c.type.match(/OFFSETMEAN/)||c.type.match(/PERCENTOFMEAN/)||c.type.match(/DEVIATION/)||(c.dominantfilter=null,c.dominantdfilter=null);c.itemfield&&c.lookupfield&&c.itemfield==c.lookupfield&&(c.itemfield=null);return d};ixMap.Themes.prototype.getThemeDefinitionString=function(d){var c='map.Api.newMapTheme("'+d.szThemes+'","'+(d.szFields||"")+'","'+(d.szField100||"")+'","type:'+d.szFlag+";colorscheme:";
var e=d.origColorScheme;for(var b=0;b<e.length;b++)e[b]=P(e[b]);e=e.join("|");return c+e+";"+Ea(d)+';child:true;");'};ixMap.Themes.prototype.getMapThemeStyleString=function(d){return(d=this.getTheme(d)||this.activeTheme)&&d.colorScheme?"type:"+d.szFlag+";colorscheme:"+d.colorScheme+";"+Ea(d):null};ixMap.Themes.prototype.getMapThemeDefinitionObj=function(d){d=this.getTheme(d)||this.activeTheme;var c={};c.layer=d.szThemes;c.field=d.szFields||"";c.field100=d.szField100||"";if(d.szFlag.match(/\bWMS|IMAGE\b/)){var e=
{type:d.szFlag,server:d.szServer,opacity:d.nOpacity,title:d.szTitle,name:d.szName};c.style=e;return c}d.szFlag.match(/\bCATEGORICAL\b/)&&d.colorScheme&&d.colorScheme.length>3&&(!d.szValuesA||!d.szValuesA.length)&&d.szLabelA&&d.szLabelA.length&&d.szLabelA.length<=100&&(d.szValuesA=d.szLabelA.slice(0));e={type:d.szFlag,colorscheme:d.origColorScheme};for(var b={},n=0;n<U.length;n++)d[U[n].obj]!=null&&d[U[n].obj]!="undefined"&&(b[U[n].style]=d[U[n].obj]);for(var m in b)e[m]=b[m];c.style=e;return this.cleanUpThemeObj(c,
d.origDef)};ixMap.Themes.prototype.getTheme=function(d){if(!d||typeof d!="string")return this.activeTheme;d=d.split(":")[0];for(var c=0;c<this.themesA.length;c++)if(this.themesA[c].szId==d||this.themesA[c].szName==d)return this.themesA[c];return!isNaN(Number(d))&&Number(d)<this.themesA.length?this.themesA[Number(d)]:this.activeTheme};ixMap.Themes.prototype.getThemeIndex=function(d){for(var c=0;c<this.themesA.length;c++)if(this.themesA[c].szId==d)return c};ixMap.Themes.prototype.refreshTheme=function(d){if(d=
this.getTheme(d))d.initValues(),d.szValuesA=null,d.szFlag.match(/RANGES/)||(d.szRangesA=null),d.szExactA=null,d.fRealize=!0,d.fRedraw=!0,!map.fAllIncluded&&d.coTable?this.loadExternalData(d.coTable,!0,d):(d.animateTimeout&&clearTimeout(d.animateTimeout),executeWithMessage("map.Themes.execute()","... processing ..."))};ixMap.Themes.prototype.resetTheme=function(d){var c=map.Themes.getTheme(d);if(c){var e=c.chartGroup;c=map.Themes.getMapThemeDefinitionObj(d);map.Themes.themesA.splice(map.Themes.getThemeIndex[d],
1);c.style.datacache=!1;c=map.Themes.newThemeByObj(c);c.chartGroup=e}};ixMap.Themes.prototype.nextClipFrame=function(d){(d=this.getTheme(d))&&d.realizeNextClipFrame()};ixMap.Themes.prototype.setClipFrame=function(d,c){(d=d?this.getTheme(d):this.activeTheme)&&d.setClipFrame(c)};ixMap.Themes.prototype.pauseClip=function(d){(d=this.getTheme(d))&&d.pauseClip()};ixMap.Themes.prototype.startClip=function(d){(d=this.getTheme(d))&&d.startClip()};ixMap.Themes.prototype.loadExternalData=function(d,c,e){this.coTableExt||
(this.coTableExt=[]);if(d){var b=map.Dictionary.getLocalText("... creating theme ...");c&&(eval("typeof("+d+")")!="undefined"&&eval(d+".table = null"),b=map.Dictionary.getLocalText("... refreshing theme ..."));this.__test=null;try{eval("this.__test = "+d+".table")}catch(n){try{eval("this.__test = "+d+"_table")}catch(m){}}c=e.fEditor||!(e.coTableUrl&&e.coTableExt)||!1;this.themeDataCacheA[d]&&((this.themeDataCacheA[d].coTableUrl||e.coTableUrl)&&this.themeDataCacheA[d].coTableUrl!=e.coTableUrl||(this.themeDataCacheA[d].coTableExt||
e.coTableExt)&&this.themeDataCacheA[d].coTableExt!=e.coTableExt||(c=!0));if(this.__test&&c&&e.fDataCache===!0)this.fWaitforData=!1,e.fWaitingforData=!1,executeWithMessage("map.Themes.execute()",b),e&&e.coTableExt&&(e.coTableExt=this.coTableExt[e.coTable]);else if(e&&(e.coTableUrl||e.coTableExt||e.coTableType=="ext"))try{this.themeDataCacheA[d]={coTableUrl:e.coTableUrl,coTableExt:e.coTableExt},this.fWaitforData=!0,e.fWaitingforData=!0,map.HTMLWindow.ixmaps.htmlgui_loadExternalData(e.coTableUrl,{theme:e,
type:e.coTableType,name:e.coTable,ext:e.coTableExt}),this.coTableExt[e.coTable]=e.coTableExt}catch(n){}}};ixMap.Themes.prototype.loadExternalDataZipped=function(d,c,e){this.fWaitforData=!0;displayMessage(map.Dictionary.getLocalText("... loading data ..."));var b=new JSLoader;b.finishedCallback="map.Themes.loadExternalDataFinish('"+e+"')";b.errorCallback="map.Themes.loadExternalDataDefault('"+d+"',"+c+",'"+e+"')";b.szMessage=map.Dictionary.getLocalText("... loading data ...");b.loadScript(map.mapRoot+
d+".js.gz",c)};ixMap.Themes.prototype.loadExternalDataDefault=function(d,c,e){this.fWaitforData=!0;displayMessage(map.Dictionary.getLocalText("... loading data ..."));var b=new JSLoader;b.finishedCallback="map.Themes.loadExternalDataFinish('"+e+"')";b.errorCallback="map.Themes.loadExternalDataFinish('"+e+"')";b.szMessage=map.Dictionary.getLocalText("... loading data ...");b.loadScript(map.mapRoot+d+".js",c)};ixMap.Themes.prototype.loadExternalDataFinish=function(d){this.fWaitforData=!1;executeWithMessage("map.Themes.execute()",
d)};ixMap.Themes.prototype.setExternalData=function(d,c,e){c&&(this._dataObj=c,eval("window."+e+" = this._dataObj"));this.fWaitforData=!1;d=this.getAllThemes();for(var b in d)d[b].coTable==e&&(d[b].fWaitingforData=!1);this.execute()};ixMap.Themes.prototype.activateTheme=function(d,c){if(c=this.getTheme(c))c.fRedraw=!0,executeWithMessage("map.Themes.execute()","... processing ...");d.stopPropagation();d.preventDefault()};ixMap.Themes.prototype.showTheme=function(d,c){if(c=this.getTheme(c))c.fShow=
!0,executeWithMessage("map.Themes.execute()","... processing ...");d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.hideTheme=function(d,c){if(c=this.getTheme(c))c.fHide=!0,executeWithMessage("map.Themes.execute()","... processing ...");d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.toggleTheme=function(d,c){if(c=this.getTheme(c))c.fToggle=!0,executeWithMessage("map.Themes.execute()","... processing ...");d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.removeTheme=
function(d,c){for(var e=0;e<this.themesA.length;e++)if(this.themesA[e].szId===c||this.themesA[e].szName===c){var b=this.themesA[e];b.szFlag.match(/LOCKED/)||(b.szFlag.match(/CHART/)&&(b.fToggle=!0),b.fRemove=!0,executeWithMessage("map.Themes.execute()","... processing ..."))}d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.removeAll=function(d){for(var c=0;c<this.themesA.length;c++)this.themesA[c].szFlag.match(/LOCKED/)||(this.themesA[c].fRemove=!this.themesA[c].fRealize||this.themesA[c].fOutOfScale);
setTimeout(function(){map.Themes.execute()},100);d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.removeAllCharts=function(d){for(var c=0;c<this.themesA.length;c++)this.themesA[c].szFlag.match(/CHART/)&&!this.themesA[c].szFlag.match(/LOCKED/)&&(this.themesA[c].fRemove=!0);this.fWaitforData=!0;map.Themes.execute();d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.removeAllChoropleth=function(d){for(var c=0;c<this.themesA.length;c++)this.themesA[c].szFlag.match(/CHOROPLETH/)&&
!this.themesA[c].szFlag.match(/LOCKED/)&&(this.themesA[c].fRemove=!this.themesA[c].fRealize);this.fWaitforData=!0;executeWithMessage("map.Themes.execute()","... processing ...");d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.removeAllSelections=function(d){for(var c=0;c<this.themesA.length;c++)this.themesA[c].szFlag.match(/SELECTION/)&&(this.themesA[c].fRemove=!0,executeWithMessage("map.Themes.execute()","... processing ..."));d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.redrawInfoAll=
function(d){for(var c=0;c<this.themesA.length;c++)this.themesA[c].fRedrawInfo=!0;map.Themes.execute();d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.reformat=function(d){for(var c=this.minY=this.minX=0;c<this.themesA.length;c++)this.themesA[c].fRepositionInfo=!0,this.themesA[c].fRedrawInfo=!0;map.Themes.execute();d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.execute=function(){var d=null,c=null,e=0;if(!map.isIdle())setTimeout(function(){map.Themes.execute()},
100);else if(!this.fWaitforData)if(map.Tiles.isLoading())setTimeout(function(){map.Themes.execute()},250),this.fExecuteDelayed=!0;else if(this.fExecuteDelayed)this.fExecuteDelayed=!1,executeWithMessage("map.Themes.execute()"," ... ");else{for(e=0;e<this.themesA.length;e++)(this.themesA[e].fRealize||this.themesA[e].fRedraw||this.themesA[e].fToFront)&&this.themesA[e].szFlag.match(/CHOROPLETH/)&&!this.themesA[e].szFlag.match(/SUBTHEME/)&&(d=this.themesA[e].szShapeType,c=this.themesA[e].szThemes);if(d&&
this.enableMultiChoropleth)for(e=0;e<this.themesA.length;e++)this.themesA[e].szFlag&&this.themesA[e].szFlag.match(/CHOROPLETH/)&&this.themesA[e].szShapeType==d&&(this.themesA[e].disable(),this.themesA[e].isVisible=!1,this.themesA[e].fRedrawInfo=!1);if(d&&!this.enableMultiChoropleth)for(e=0;e<this.themesA.length;e++)!this.themesA[e].szFlag||!this.themesA[e].szFlag.match(/CHOROPLETH/)||this.themesA[e].szShapeType!=d||this.themesA[e].szThemes!=c||this.themesA[e].fRealize||this.themesA[e].fRedraw||this.themesA[e].fToFront||
(this.themesA[e].fRemove=!0);for(e=0;e<this.themesA.length;e++){if(this.themesA[e].fWaitingforData)return;if(this.themesA[e].fShow&&this.themesA[e].fDone){this.themesA[e].toggle(!0);this.themesA[e].fShow=!1;break}if(this.themesA[e].fHide&&this.themesA[e].fDone){this.themesA[e].toggle(!1);this.themesA[e].fHide=!1;break}if(this.themesA[e].fToggle&&this.themesA[e].fDone){this.themesA[e].toggle();this.themesA[e].fToggle=!1;this.execute();break}if(this.themesA[e].fRemove){this.themesA.length>1&&!this.themesA[e].szFlag.match(/SELECTION/)&&
!this.themesA[e].szFlag.match(/CHART/)&&this.activateNextPaint(this.themesA[e]);this.themesA[e].removeElements();this.remove(this.themesA[e]);this.reformat();this.execute();break}if(this.themesA[e].fRealize)this.themesA[e].nChartUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.themesA[e].nChartUpper||this.themesA[e].nChartLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.themesA[e].nChartLower?(this.themesA[e].chartGroup&&this.themesA[e].chartGroup.style.setProperty("display","none",
""),this.themesA[e].fOutOfScale=!0):(this.themesA[e].fOutOfScale=!1,this.themesA[e].fEnableProgressBar=!0,this.themesA[e].fRealize=!1,this.themesA[e].realize());else if(this.themesA[e].fRedraw)this.themesA[e].fRedraw=!1,this.themesA[e].fActualize=!1,this.themesA[e].checkHiddenLayerState&&this.themesA[e].checkHiddenLayerState()?(this.themesA[e].fRealize=!0,this.themesA[e].fRedraw=!1,this.themesA[e].fReload=!1,this.themesA[e].unpaintMap(),map.Themes.execute()):(this.themesA[e].fEnableProgressBar=!0,
this.themesA[e].szFlag.match(/FEATURE/)||this.themesA[e].unpaintMap(),this.themesA[e].redraw(!1));else if(this.themesA[e].fActualize)this.themesA[e].fActualize=!1,this.themesA[e].checkHiddenLayerState&&this.themesA[e].checkHiddenLayerState()?(this.themesA[e].fRealize=!0,this.themesA[e].fRedraw=!1,this.themesA[e].fReload=!1,this.themesA[e].unpaintMap(),map.Themes.execute()):(this.themesA[e].fEnableProgressBar=!0,this.themesA[e].redraw(!1));else if(this.themesA[e].fToFront)this.themesA[e].fEnableProgressBar=
!1,this.themesA[e].toFront(),this.themesA[e].fToFront=!1;else if(this.themesA[e].fResize)this.themesA[e].resize(this.themesA[e].fResize),this.themesA[e].fResize=!1;else if(this.themesA[e].fOpacity)this.themesA[e].opacity(this.themesA[e].fOpacity),this.themesA[e].fOpacity=!1;else if(this.themesA[e].fBlur)this.themesA[e].blur(this.themesA[e].nBlur),this.themesA[e].fBlur=!1;else if(this.themesA[e].fOffset)this.themesA[e].offset(this.themesA[e].fOffset),this.themesA[e].fOffset=!1;else if(this.themesA[e].fRedrawInfo)this.themesA[e].widgetNode&&
this.themesA[e].showInfo(),this.themesA[e].fRedrawInfo=!1;else if(this.themesA[e].fResort){try{this.themesA[e].sortChartObjects()}catch(b){}this.themesA[e].fResort=!1}else if(this.themesA[e].fDeclutter){try{this.themesA[e].declutterCharts()}catch(b){}this.themesA[e].fDeclutter=!1}}this.executeCallback&&(eval(this.executeCallback),this.executeCallback=null);clearMessage();clearMessage(1E3)}};ixMap.Themes.prototype.executeContinue=function(){for(var d=0;d<this.themesA.length;d++)this.themesA[d].fAnalyze?
(this.themesA[d].fAnalyze=!1,this.themesA[d].realize_analyze()):this.themesA[d].fDraw?(this.themesA[d].fDraw=!1,this.themesA[d].realize_draw()):this.themesA[d].fContinue?(this.themesA[d].fContinue=!1,this.themesA[d].realizeContinue(this.themesA[d].continueIndex)):this.themesA[d].fContinueLoadAndAggregate&&(this.themesA[d].fContinueLoadAndAggregate=!1,this.themesA[d].loadAndAggregateValuesOfTheme(this.themesA[d].szThemeLayer,this.themesA[d].continueIndex))};ixMap.Themes.prototype.realizeDone=function(d){for(var c=
0;c<this.themesA.length;c++)this.themesA[c].szFlag.match(/SELECTION/)&&(this.themesA[c].fRealize=!0);d.fRealizeDone=!0;d.szFlag.match(/BUFFER/)?this.activeBuffer=d:this.activeTheme=d;try{map.HTMLWindow.ixmaps.htmlgui_setActualTheme(d.szId)}catch(e){}try{map.HTMLWindow.ixmaps.htmlgui_onDrawTheme(d.szId)}catch(e){}d.szFlag.match(/TEXTONLY/)&&setTimeout(function(){map.Layer.adaptLabel()},10);d.szFlag.match(/ANIMATEPOSITION/)&&(d.animateTimeout&&clearTimeout(d.animateTimeout),d.animateTimeout=setTimeout(function(){map.Themes.animateChartPosition(null,
d.szId)},100));d.userChartDrawError&&d.userChartDrawError==d.nDoneCount&&displayMessage("User draw function error! ",5E3);this.isIdle()&&clearMessage();setTimeout("map.Themes.execute()",100)};ixMap.Themes.prototype.showProgressBar=function(){for(var d=0;d<this.themesA.length;d++)(this.themesA[d].fRealize||this.themesA[d].fContinue||this.themesA[d].fAnalyze||this.themesA[d].fDraw)&&this.themesA[d].nCount/this.themesA[d].nDoneCount>2&&this.themesA[d].mapSleep?this.themesA[d].mapSleep.fShowProgressBar=
!0:(this.themesA[d].fRealize||this.themesA[d].fContinue||this.themesA[d].fAnalyze||this.themesA[d].fDraw)&&setTimeout(function(){map.Themes.showProgressBar()},1E3)};ixMap.Themes.prototype.remove=function(d){d==this.activeTheme&&(this.activeTheme=null);d==this.activeBuffer&&(this.activeBuffer=null);for(var c=0;c<this.themesA.length;c++)if(this.themesA[c]==d){for(;c<this.themesA.length-1;c++)this.themesA[c]=this.themesA[c+1];this.themesA.length--}d.removeValues()};ixMap.Themes.prototype.cancelExecute=
function(){this.activeTheme.fCancel=!0};ixMap.Themes.prototype.sequence=function(){this.sequenceNr=0;this.sequenceNext()};ixMap.Themes.prototype.sequenceNext=function(){this.sequenceNr<this.themesA.length&&(this.themesA[this.sequenceNr].fRedraw=!0,map.Themes.executeCallback="setTimeout('map.Themes.sequenceNext()',500)",map.Themes.execute(),this.sequenceNr++)};ixMap.Themes.prototype.activateNextPaint=function(d){d=this.getThemeIndex(d.szId);for(var c=d-1;c!=d;c--){c<0&&(c=this.themesA.length-1);if(c==
d)break;if(this.themesA[c].isChecked&&!this.themesA[c].szFlag.match(/CHART/))return this.themesA[c].fRedraw=!0,this.themesA[c].fRedrawInfo=!1,!0}return!1};ixMap.Themes.prototype.toggleThemeValues=function(d,c){this.toggleValueDisplay(d,this.activeTheme.szId,!this.activeTheme.szFlag.match(/VALUES/))};ixMap.Themes.prototype.toggleThemeLegends=function(d,c){map.SVGThemeGroup.style.setProperty("display",c?"inline":"none","")};ixMap.Themes.prototype.minimizeThemeLegends=function(d){this.fMinimizedLegends=
!0;for(var c=0;c<this.themesA.length;c++)this.minimizeInfo(d,this.themesA[c].szId)};ixMap.Themes.prototype.changeAllChartScaling=function(d,c){for(c=0;c<this.themesA.length;c++)this.themesA[c].fResize=999,executeWithMessage("map.Themes.execute()","... processing ...");d.stopPropagation();d.preventDefault()};ixMap.Themes.prototype.changeChartScaling=function(d,c,e){if(c=this.getTheme(c))c.fResize=e,executeWithMessage("map.Themes.execute()","... processing ...");d.stopPropagation();d.preventDefault()};
ixMap.Themes.prototype.changeChartOpacity=function(d,c,e){if(c=this.getTheme(c))c.fOpacity=e,executeWithMessage("map.Themes.execute()","... processing ...");d.stopPropagation();d.preventDefault()};ixMap.Themes.prototype.changeChartOffset=function(d,c,e){if((d=this.getTheme(c))&&d.leadOffset&&(e=map.SVGDocument.getElementById(e))){e.fu=new Methods(e);c=e.fu.getPosition();var b=e.fu.getGroupScale();d.fOffset=new point(c.x-d.leadOffset.x,c.y-d.leadOffset.y);e.fu.setPosition(d.leadOffset.x,d.leadOffset.y);
d.fOffset.x/=map.Zoom.nZoom/b.x;d.fOffset.y/=map.Zoom.nZoom/b.y;d.offset(d.fOffset);d.fOffset=!1;d.leadOffset=!1}};ixMap.Themes.prototype.tellChartOffset=function(d,c,e){(d=this.getTheme(c))&&!d.leadOffset&&this.enableChartOffset&&(e=map.SVGDocument.getElementById(e))&&(e.fu=new Methods(e),d.leadOffset=e.fu.getPosition())};ixMap.Themes.prototype.initChartOffset=function(d,c,e){if(this.getTheme(c)){var b=map.SVGDocument.getElementById(e);b&&(b.origPosition||(b.origPosition=b.fu.getPosition()),b.onMouseMove=
function(n){b.actualPosition=b.fu.getPosition();map.Themes.makeChartOffsetPointer(b)},b.widgetObj=new Widget(b,b))}};ixMap.Themes.prototype.endChartOffset=function(d,c,e){this.getTheme(c)&&(d=map.SVGDocument.getElementById(e))&&d.widgetObj.remove()};ixMap.Themes.prototype.makeChartOffsetPointer=function(d,c){c=c||1;d.pointerObj?(map.Dom.clearGroup(d.pointerObj),map.Dom.clearGroup(d.pointShObj)):(d.pointerObj=map.Dom.newGroup(d),d.pointShObj=map.Dom.newGroup(d),d.pointerObj.parentNode.insertBefore(d.pointerObj,
d.pointerObj.parentNode.firstChild),d.pointShObj.parentNode.insertBefore(d.pointShObj,d.pointShObj.parentNode.firstChild));if(d.origPosition||d.actualPosition){var e=new box(0,0,100,75),b=new point(d.actualPosition.x-d.origPosition.x,d.actualPosition.y-d.origPosition.y);map.Scale.normalX(15);map.Scale.normalX(5);var n=map.Scale.normalX(10);map.Scale.normalX(5);var m=b.y+e.height/2;var u=b.x+e.width/2;Math.abs(m)+e.width/2-e.height/2>Math.abs(u)?(e.width/3>n&&(b.x>-e.width/3&&(u-=e.width/3),b.x<-e.width/
3*2&&(u+=e.width/3)),m>0?(map.Dom.newShape("path",d.pointShObj,"M"+-b.x+","+-b.y+" l "+(u-map.Scale.normalX(5/c))+","+(b.y+map.Scale.normalX(1/c))+" "+map.Scale.normalX(4/c)+",0 z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",d.pointerObj,"M"+-b.x+","+-b.y+" l "+(u-map.Scale.normalX(5/c))+","+(b.y+map.Scale.normalX(1/c))+" "+map.Scale.normalX(3/c)+",0 z","fill:white")):(map.Dom.newShape("path",d.pointShObj,"M"+-b.x+","+-b.y+" l "+(u-map.Scale.normalX(4/c))+","+(b.y+e.height)+" "+map.Scale.normalX(4/
c)+",0 z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",d.pointerObj,"M"+-b.x+","+-b.y+" l "+(u-map.Scale.normalX(4/c))+","+(b.y+e.height)+" "+map.Scale.normalX(3/c)+",0 z","fill:white"))):(e.height/5>n&&(b.y>-e.height/3&&(m-=e.height/3),b.y<-e.height/3*2&&(m+=e.height/3)),u>0?(map.Dom.newShape("path",d.pointShObj,"M"+-b.x+","+-b.y+" l "+(b.x-e.width)+","+(m-map.Scale.normalX(4/c))+" 0,"+map.Scale.normalX(4/c)+" z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",d.pointerObj,"M"+-b.x+
","+-b.y+" l "+(b.x-e.width)+","+(m-map.Scale.normalX(4/c))+" 0,"+map.Scale.normalX(3/c)+" z","fill:white")):(map.Dom.newShape("path",d.pointShObj,"M"+-b.x+","+-b.y+" l "+(b.x+e.width)+","+(m-map.Scale.normalX(4/c))+" 0,"+map.Scale.normalX(4/c)+" z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",d.pointerObj,"M"+-b.x+","+-b.y+" l "+(b.x+e.width)+","+(m-map.Scale.normalX(4/c))+" 0,"+map.Scale.normalX(3/c)+" z","fill:white")))}};ixMap.Themes.prototype.animateChartPosition=function(d,c){var e=
this.getTheme(c);if(e){d=e.chartGroup.childNodes;for(let m=0;m<d.length;m++){c=d[m].fu.getPosition();var b=new point(d[m].getAttributeNS(szMapNs,"xEnd"),d[m].getAttributeNS(szMapNs,"yEnd")),n=d[m].getAttributeNS(szMapNs,"dur");d[m].fu.setPosition(c.x+(b.x-c.x)/n,c.y+(b.y-c.y)/n);d[m].setAttributeNS(szMapNs,"dur",--n)}e.animateTimeout&&clearTimeout(e.animateTimeout);e.animateTimeout=setTimeout(function(){map.Themes.animateChartPosition(null,e.szId)},100)}};A.prototype.declutterCharts=function(){if(!(this.szDeclutterUpper&&
map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nDeclutterUpper)){var d=this.chartGroup.childNodes;for(b=0;b<d.length;b++)d[b].actualPosition&&(d[b].fu.setPosition(d[b].origPosition.x,d[b].origPosition.y),d[b].origPosition=null,d[b].actualPosition=null,d[b].pointerObj&&(map.Dom.clearGroup(d[b].pointerObj),map.Dom.clearGroup(d[b].pointShObj)),d[b].pointerObj=null,d[b].pointShObj=null);if(!d[0].actualPosition){var c=d[0].fu.getBox();map.Zoom.getBox();for(var e=[],b=0;b<d.length;b++){var n=!1,m=d[b].fu.getPosition(),
u=d[b].fu.getBox();u.x+=m.x;u.y+=m.y;for(var z in e)for(var x in e[z])if(!(u.y+u.height<e[z][x].box.y-e[z][x].box.height*.3||u.y>e[z][x].box.y+e[z][x].box.height*1.3||u.x+u.width<e[z][x].box.x-e[z][x].box.width||u.x>e[z][x].box.x+e[z][x].box.width*2)){e[z].push({node:d[b],y:d[b].fu.getPosition().x,box:u});n=!0;break}n||e.push([{node:d[b],y:d[b].fu.getPosition().x,box:u}])}for(z=0;z<e.length;z++)if(d=e[z],d.sort(this.sortUpChartObjectsCompare),d.length>1&&d.length<5){n=d[0].node.fu.getPosition();for(b=
0;b<d.length;b++)m=d[b].node.fu.getPosition(),m.y<n.y&&(n.x=m.x,n.y=m.y);n.y-=map.Scale.normalX(50)*map.Scale.nZoomScale;m=d[0].node.fu.getPosition();for(b=0;b<d.length;b++)d[b].node.origPosition=d[b].node.fu.getPosition(),d[b].node.fu.setPosition(m.x+c.width*1.2*b,n.y),d[b].node.actualPosition=new point(m.x+c.width*1.2*b,n.y),u=d[b].node.fu.getScale().x,d[b].node.actualPosition.x=d[b].node.origPosition.x-(d[b].node.origPosition.x-d[b].node.actualPosition.x)/u,d[b].node.actualPosition.y=d[b].node.origPosition.y-
(d[b].node.origPosition.y-d[b].node.actualPosition.y)/u,map.Themes.makeChartOffsetPointer(d[b].node,this.nScale)}}}};A.prototype.animateCharts=function(d){var c=this.chartGroup.childNodes;if(d=="scale")for(i=0;i<c.length;i++){var e=c[i].firstChild;e.setAttributeNS(null,"transform","scale(1 1)");map.Dom.constructNode("animateTransform",e,{attributeName:"transform",type:"scale",from:"0 0",to:"1 1",begin:String(Math.random()*.2)+"s",dur:"2s",repeatCount:"1"})}if(d=="fire")for(i=0;i<c.length;i++)e=c[i].firstChild,
e.setAttributeNS(null,"transform","scale(1 1)"),map.Dom.constructNode("animateTransform",e,{attributeName:"transform",type:"scale",from:"0 0",to:"1 1",begin:String(Math.random()*1)+"s",dur:"0.5s",repeatCount:"3"})};ixMap.Themes.prototype.toggleValueDisplay=function(d,c,e){if(c=this.getTheme(c)){for(var b="",n=c.szFlag.split("|"),m=0;m<n.length;m++)n[m]!="VALUES"&&(b+=(b.length?"|":"")+n[m]);e&&(b+="|VALUES");executeWithMessage("map.Themes.doChangeThemeStyle('"+c.szId+"','type:"+b+"')","... processing ...")}d&&
(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.toggleDopacity=function(d,c,e){if(c=this.getTheme(c)){for(var b="",n=c.szFlag.split("|"),m=0;m<n.length;m++)n[m].match(/DOPACITY/)||(b+=(b.length?"|":"")+n[m]);e&&(b+="|DOPACITYMAX");executeWithMessage("map.Themes.doChangeThemeStyle('"+c.szId+"','type:"+b+"')","... processing ...")}d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.changeDopacityAlphaRamp=function(d,c,e){if(c=this.getTheme(c)){var b=c.szFlag;c.nDopacityScale=
c.nDopacityScale||1;c.nDopacityScale*=e;executeWithMessage("map.Themes.doChangeThemeStyle('"+c.szId+"','type:"+b+"')","... processing ...")}d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.toggleChartDisplay=function(d,c,e){if(c=this.getTheme(c))c.fToggle=!0,executeWithMessage("map.Themes.execute()","... processing ...");d.stopPropagation();d.preventDefault()};ixMap.Themes.prototype.zoomTo=function(d,c){(d=this.getTheme(c)||this.activeTheme)&&d.zoomTo()};ixMap.Themes.prototype.zoomToClass=
function(d,c,e,b){setTimeout(function(){map.Themes.doZoomToClass(c,e,b)},100)};ixMap.Themes.prototype.markClass=function(d,c,e,b){var n=this.getTheme(c);n&&n.isVisible&&!n.showInfoMore&&(typeof n.markedClass!="undefined"&&n.markedClass==e||typeof n.markedClasses!="undefined"&&n.markedClasses[e]?this.unmarkClass(d,c,e):(n.fMarkEnable=!0,n.fUnmarkEnable=!1,this.markTimeout&&clearTimeout(this.markTimeout),this.unmarkTimeout&&clearTimeout(this.unmarkTimeout),displayMessage("...",500,!0),this.markTimeout=
setTimeout(function(){map.Themes.doMarkClass(c,e,b)},50)))};ixMap.Themes.prototype.unmarkClass=function(d,c,e){(d=this.getTheme(c))&&d.isVisible&&!d.showInfoMore&&(displayMessage("...",500,!0),this.unmarkTimeout=setTimeout(function(){map.Themes.doUnmarkClass(c,e)},50),d.fUnmarkEnable=!0,d.fMarkEnable=!1)};ixMap.Themes.prototype.doZoomToClass=function(d,c,e){(d=this.getTheme(d))&&d.zoomToClass(Number(c),Number(e))};ixMap.Themes.prototype.doMarkClass=function(d,c,e){if(d=this.getTheme(d)){d.markedClass=
c;d.markedClasses=d.markedClasses||[];d.markedClasses[c]=!0;d.markedClassesA=[];for(var b in d.markedClasses)d.markedClasses[b]===!0&&d.markedClassesA.push(b);d.markClass(Number(c),Number(e));try{map.HTMLWindow.ixmaps.htmlgui_onDrawTheme(d.szId)}catch(n){}}};ixMap.Themes.prototype.doUnmarkClass=function(d,c){if(d=this.getTheme(d)){d.markedClass=null;if(d.markedClasses){d.markedClasses[c]=!1;d.markedClassesA=[];for(var e in d.markedClasses)d.markedClasses[e]===!0&&d.markedClassesA.push(e);if(d.markedClassesA.length){displayMessage("...",
500,!0);d.fMarkEnable=!0;d.markClass(d.markedClassesA[0],1);d.fMarkEnable=!1;try{map.HTMLWindow.ixmaps.htmlgui_onDrawTheme(d.szId)}catch(b){}return}delete d.markedClassesA;delete d.markedClasses}d.unmarkClass();try{map.HTMLWindow.ixmaps.htmlgui_onDrawTheme(d.szId)}catch(b){}}};ixMap.Themes.prototype.hideClass=function(d,c,e,b){(d=this.getTheme(c))&&d.isVisible&&d.showClass(Number(e),Number(b),!1)};ixMap.Themes.prototype.showClass=function(d,c,e,b){(d=this.getTheme(c))&&d.isVisible&&d.showClass(Number(e),
Number(b),!0)};ixMap.Themes.prototype.classesToRanges=function(d,c){(d=this.getTheme(c))&&d.isVisible&&d.classesToRanges()};ixMap.Themes.prototype.filterItems=function(d,c,e,b){(d=c?this.getTheme(c):this.activeTheme)&&d.isVisible&&!d.showInfoMore&&(d.fMarkEnable=!0,d.fUnmarkEnable=!1,this.markTimeout&&clearTimeout(this.markTimeout),this.unmarkTimeout&&clearTimeout(this.unmarkTimeout),this.opt=b,this.markTimeout=setTimeout(function(){map.Themes.doFilterItems(c,e)},500))};ixMap.Themes.prototype.doFilterItems=
function(d,c){executeWithMessage("map.Themes.doFilterItemsGo('"+d+"','"+c+"')","applying filter ...")};ixMap.Themes.prototype.doFilterItemsGo=function(d,c){clearMessage();if(d=this.getTheme(d?d:null))d.filterItems(c,this.opt),this.activeTheme=d};ixMap.Themes.prototype.selectFilterItems=function(d,c){(d=this.getTheme(c))&&d.selectFilterItems()};ixMap.Themes.prototype.highlightItems=function(d,c,e,b){(d=c?this.getTheme(c):this.activeTheme)&&d.isVisible&&(this.highlightTimeout&&clearTimeout(this.highlightTimeout),
this.highlightTimeout=setTimeout(function(){map.Themes.doHighlightItems(c,e,b)},500))};ixMap.Themes.prototype.doHighlightItems=function(d,c,e){(d=d?this.getTheme(d):this.activeTheme)&&d.highlightItems(c,e)};ixMap.Themes.prototype.clearHighlightItems=function(d,c){(d=c?this.getTheme(c):this.activeTheme)&&d.isVisible&&(this.highlightTimeout&&clearTimeout(this.highlightTimeout),d.clearHighlightItems())};ixMap.Themes.prototype.setTimeFrame=function(d,c,e,b){(d=this.getTheme(c))&&d.isVisible&&!d.showInfoMore&&
(this.markTimeout&&clearTimeout(this.markTimeout),this.unmarkTimeout&&clearTimeout(this.unmarkTimeout),this.markTimeout=setTimeout(function(){map.Themes.doSetTimeFrame(c,e,b)},1))};ixMap.Themes.prototype.doSetTimeFrame=function(d,c,e){if(d==null){d=this.getThemes();for(var b in d)d[b].setTimeFrame(c,e)}else(b=this.getTheme(d))&&b.setTimeFrame(c,e)};ixMap.Themes.prototype.changeThemeStyle=function(d,c,e,b){if(c==null){themesA=this.getThemes();for(var n in themesA)themesA[n].szFlag.match(/FEATURE/)||
this.changeThemeStyle(d,themesA[n].szId,e,b)}else b&&b.match(/fast|silent|direct/)?map.Themes.doChangeThemeStyle(c,e.replace(/'/g,"\\'"),b):executeWithMessage("map.Themes.doChangeThemeStyle('"+c+"','"+e.replace(/'/g,"\\'")+"','"+b+"')","... processing ..."),d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.doChangeThemeStyle=function(d,c,e){var b=this.getTheme(d);if(b){if(c=__getStyleObj(c)){if(c.type){c.origType=c.type;if(e&&e.match(/add/)){var n=c.type.split("|");this.szTempStyle=
b.szFlag;for(var m=0;m<n.length;m++)eval("this.szTempStyle.match(/"+n[m]+"/)")||(this.szTempStyle+="|"+n[m]);c.type=this.szTempStyle}else if(e&&e.match(/remove/)){n=b.szFlag.split("|");var u="";for(m=0;m<n.length;m++)n[m]!=c.type&&(u+=(u.length?"|":"")+n[m]);c.type=u}else if(e&&e.match(/toggle/)){n=b.szFlag.split("|");u="";var z=!1;for(m=0;m<n.length;m++)n[m]!=c.type?u+=(u.length?"|":"")+n[m]:z=!0;c.type=u+(z?"":"|"+c.type)}else b.szFlag.match(/FRACTION/)&&(c.type+="|FRACTION"),b.szFlag.match(/PERMILLE/)&&
(c.type+="|PERMILLE"),b.szFlag.match(/CALCVAL/)&&(c.type+="|CALCVAL"),b.szFlag.match(/CALC100/)&&(c.type+="|CALC100"),b.szFlag.match(/PRODUCT/)&&(c.type+="|PRODUCT"),b.szFlag.match(/RELATIVE/)&&(c.type+="|RELATIVE"),b.szFlag.match(/INVERT/)&&(c.type+="|INVERT"),b.szFlag.match(/INVERTSIZE/)&&(c.type+="|INVERTSIZE"),b.szFlag.match(/DENSITY/)&&(c.type+="|DENSITY"),b.szFlag.match(/SUM/)&&(c.type+="|SUM"),b.szFlag.match(/CALCMEAN/)&&(c.type+="|CALCMEAN"),b.szFlag.match(/AUTO100/)&&(c.type+="|AUTO100");
c.type.match(/LOCKED/)&&(b.fRedrawInfo=!0,map.Themes.execute());if(c.type.match(/CHART/)&&!b.szFlag.match(/CHART/)||c.type.match(/CHOROPLETH/)&&!b.szFlag.match(/CHOROPLETH/))b.unpaintMap(),this.activateNextPaint(b);!c.type.match(/CATEGORICAL/)&&(c.type.match(/EQUIDISTANT/)||c.type.match(/POW2/)||c.type.match(/POW3/)||c.type.match(/LOG/)||c.type.match(/QUANTILE/))&&(b.szOldRanges=b.szRanges?b.szRanges:b.szOldRanges,b.szRanges=null,b.szOldLabelA=b.szLabelA?b.szLabelA:b.szOldLabelA,b.szLabelA=null,b.fRealize=
!0);c.type.match(/RANGES/)&&c.ranges&&(b.szRanges=b.szOldRanges?b.szOldRanges:b.szRanges,b.szRangesA=c.ranges.split(c.ranges.match(/\|/)?"|":","),b.szLabelA=b.szOldLabelA?b.szOldLabelA:b.szLabelA,Number(b.origColorScheme[0])&&b.szRanges&&(b.origColorScheme[0]=b.szRangesA.length-1),b.fRealize=!0);if(c.type.match(/RANGES/)&&!c.ranges){b.szRangesA=[b.partsA[0].min];for(var x in b.partsA)b.szRangesA.push(b.partsA[x].max)}x=b.szFlag;b.szFlag=c.type;!b.szFlag.match(/CHART/)||b.szFlag.match(/BUFFER/)||x.match(/CHART/)||
(b.fShadow=b.fOrigShadow=!0);c.origType.match(/AGGREGATE/)||c.origType.match(/GROUP/)||c.origType.match(/\bRECT\b/)||c.origType.match(/RELOCATE/)?(b.fRealize=!0,b.fRedraw=!1,b.unpaintMap(),b.themeNodesPosA=[]):(b.fRedraw=!0,b.fRedrawInfo=!0);c.type.match(/VALUES/)!=x.match(/VALUES/)&&(b.fRedraw=!0);c.type.match(/DTEXT/)!=x.match(/DTEXT/)&&b.unlabelMap();c.type.match(/AUTO100/)!=x.match(/AUTO100/)&&(b.fRealize=!0,b.fRedraw=!1,b.unpaintMap());c.type.match(/DIFFERENCE/)!=x.match(/DIFFERENCE/)&&(b.fRealize=
!0,b.fRedraw=!1,b.unpaintMap());c.type.match(/NOOUTLIER/)!=x.match(/NOOUTLIER/)&&(b.fRealize=!0,b.fRedraw=!1,b.unpaintMap());c.type.match(/OUTLIER/)!=x.match(/OUTLIER/)&&(b.fRealize=!0,b.fRedraw=!1,b.unpaintMap());c.type.match(/NEGATIVEISNOTVALUE/)!=x.match(/NEGATIVEISNOTVALUE/)&&(b.fNegativeValuePossible=!c.type.match(/NEGATIVEISNOTVALUE/),b.fRealize=!0,b.fRedraw=!0,b.unpaintMap())}else if(e&&e.match(/remove/)){for(n in c)for(u in U)U[u].style==n&&(b[U[u].obj]=null);b.fReload=!0;b.fRealize=!0;b.unpaintMap();
executeWithMessage("map.Themes.execute()","... processing ...");return}t(c.field)&&(b.szFields=c.field,b.szFieldsA=b.szFields.split("|"),b.fRealize=!0);t(c.classes)&&(isNaN(Number(b.origColorScheme[0]))&&(b.origColorScheme[3]=b.origColorScheme[b.origColorScheme.length/2],b.origColorScheme[4]="2colors",x=b.origColorScheme[b.origColorScheme.length-1],b.origColorScheme[1]=b.origColorScheme[0],b.origColorScheme[2]=x),b.origColorScheme[0]=Number(c.classes),b.szFlag.match(/CHART/)&&b.unpaintMap(),b.szOldRanges=
b.szRanges,b.szRanges=null,b.fRealize=!0);t(c.ranges)&&(b.szRanges=c.ranges,b.szRangesA=c.ranges.split(c.ranges.match(/\|/)?"|":","),b.fRealize=!0);t(c.colorstyle)&&b.origColorScheme[1]=="spectrum"&&(b.origColorScheme[2]=c.colorstyle,b.szFlag.match(/CHART/)&&b.unpaintMap(),b.fRealize=!0);t(c.colordef)&&(b.origColorScheme=c.colordef.match(/\|/)?c.colordef.split("|"):c.colordef.split(","),b.colorScheme=b.origColorScheme,b.fRedraw=!0,b.szFlag.match(/CHART/)||(b.fRealize=!0),b.fRedrawInfo=!0,b.showInfo());
if(t(c.colorscheme)&&(x=c.colorscheme.match(/\|/)?c.colorscheme.split("|"):c.colorscheme.split(","))&&x.length){isNaN(Number(b.origColorScheme[0]))&&(b.origColorScheme[0]=b.origColorScheme.length);b.origColorScheme.length=1;for(m=0;m<5;m++)b.origColorScheme[m+1]=m<x.length?x[m]:null;try{b.colorScheme=ColorScheme.createColorScheme(b.origColorScheme[1],b.origColorScheme[2],b.origColorScheme[0],b.origColorScheme[3],b.origColorScheme[4])}catch(w){b.colorScheme=b.defaultColorScheme}b.fRealize=!0;b.szFlag.match(/CHART/);
b.unpaintMap();b.fRedrawInfo=!0;b.showInfo()}if(t(c.colorschemegeneration)&&!isNaN(Number(b.origColorScheme[0]))){switch(c.colorschemegeneration){case "warm":b.origColorScheme[4]="#FFFDD8";break;case "cold":b.origColorScheme[4]="#FFFFFF";break;default:b.origColorScheme[4]=c.colorschemegeneration}b.szFlag.match(/CHART/)&&b.unpaintMap();try{b.colorScheme=ColorScheme.createColorScheme(b.origColorScheme[1],b.origColorScheme[2],b.origColorScheme[0],b.origColorScheme[3],b.origColorScheme[4])}catch(w){b.colorScheme=
b.defaultColorScheme}b.fRedraw=!0;b.fRedrawInfo=!0}t(c.symbols)&&(b.szSymbolsA=c.symbols.split(c.symbols.match(/\|/)?"|":","),b.fRealize=!0);if(t(c.values)){x=this.toArray(c.values);if(x.length)for(m=0;m<x.length;m++)b.getStringValueIndex(x[m],"set");b.szValuesA=[];b.szLabelA=[];for(m in b.nStringToValueA)b.szValuesA.push(m),b.szLabelA.push(m);b.fRealize=!0}t(c.dominantdfilter)&&(b.nDominantDFilter=Number(c.dominantdfilter),b.fRealize=!0);t(c.dominantfilter)&&(b.szDominantFilter=String(c.dominantfilter),
b.fRealize=!0);t(c.filter)&&(e&&e.match(/remove/)?b.szFilter="":b.szFilter=String(c.filter),b.fRealize=!0,b.unpaintMap(),b.szFlag.match(/FEATURE/)&&map.Dom.clearGroup(b.chartGroup));t(c.filterfield)&&(b.szFilterField=String(c.filterfield),b.fRealize=!0);t(c.markclasses)&&(b.markedClassesA=this.toArray(c.markclasses),b.markedClasses=[],b.unmarkClass(),b.markedClassesA.forEach(function(w,O){w>=0&&(b.markedClasses[w]=!0)}),b.markClass());t(c.field100min)&&(b.nField100Min=c.field100min,b.fRealize=!0);
t(c.overviewchart)&&!b.szFlag.match(/CHART/)&&(b.szOverviewChart=c.overviewchart,b.fRedrawInfo=!0);t(c.evidence)&&(b.evidenceMode=c.evidence);t(c.aggregation)&&(b.szAggregation=c.aggregation);t(c.opacity)&&(b.fOpacity=K(b.fOpacity,Number(c.opacity),e),b.autoOpacity=!1,b.fRedraw=!0);t(c.fillopacity)&&(b.fillOpacity=K(b.fillOpacity||(Number(c.fillopacity)<1?1:0),Number(c.fillopacity),e),b.autoOpacity=!1,b.fillOpacity=Math.min(Math.max(b.fillOpacity,.001),1),b.unpaintMap(),b.fRedraw=!0);t(c.shadow)&&
(b.fShadow=c.shadow=="toggle"?b.fOrigShadow=!b.fOrigShadow:b.fOrigShadow=c.shadow,b.fRedraw=!0);t(c.showdata)&&(b.fShowData=c.showdata=="toggle"?!b.fShowData:JSON.parse(c.showdata),b.fRedraw=!0);t(c.blur)&&(c.blur=="toggle"?b.nBlur?(b.nOldBlur=b.nBlur,b.nBlur=0):b.nBlur=b.nOldBlur||1:b.nBlur=K(b.nBlur,Number(c.blur),e),b.fBlur=!0);t(c.scale)&&(b.fResize=y(b.nScale,Number(c.scale),e));t(c.dopacityscale)&&(b.nDopacityScale=K(b.nDopacityScale,Number(c.dopacityscale),e),b.fRedraw=!0);t(c.d_dopacityscale)&&
(b.nDopacityScale*=Number(c.d_dopacityscale),b.fRedraw=!0);t(c.alphafield)&&(b.szAlphaField=String(c.alphafield),b.fRealize=!0);t(c.alphafield100)&&(b.szAlphaField100=String(c.alphafield100),b.fRealize=!0);t(c.dopacityramp)&&(b.szDopacityRamp=c.dopacityramp,b.fRealize=!0);t(c.dopacitypow)&&(b.nDopacityPow=K(b.nDopacityPow,Number(c.dopacitypow),e),b.fRealize=!0);t(c.brightness)&&(b.nBrightness=K(b.nBrightness||1,Number(c.brightness),e),b.fRealize=!0);t(c.rangescale)&&(b.nRangeScale=K(b.nRangeScale||
1,Number(c.rangescale),e),b.fRedraw=!0);t(c.sizefield)&&(b.szSizeField=String(c.sizefield),b.fRealize=!0);t(c.timefield)&&(b.szTimeField=String(c.timefield),b.fRealize=!0);t(c.xfield)&&(b.szXField=String(c.xfield),b.fRealize=!0);t(c.yfield)&&(b.szYField=String(c.yfield),b.fRealize=!0);t(c.labelfield)&&(b.szLabelField=String(c.labelfield),b.fRealize=!0);t(c.colorfield)&&(b.szColorField=String(c.colorfield),b.fRealize=!0);t(c.symbolfield)&&(b.szSymbolField=String(c.symbolfield),b.fRealize=!0);t(c.valuefield)&&
(b.szValueField=String(c.valuefield),b.fRealize=!0);t(c.normalsizevalue)&&(b.nNormalSizeValue||(b.nNormalSizeValue=b.szSizeField?b.nMaxSize:b.nMax),b.nNormalSizeValue=K(b.nNormalSizeValue,Number(c.normalsizevalue),e),b.fRedraw=!0);t(c.minvalue)&&(b.nMinValue=K(b.nMinValue||1,Number(c.minvalue),e),b.fRedraw=!0);t(c.maxvalue)&&(b.nMaxValue=K(b.nMaxValue||1,Number(c.maxvalue),e),b.fRedraw=!0);t(c.valuedecimals)&&(b.nValueDecimals=c.valuedecimals,b.fRedraw=!0);t(c.valuescale)&&(b.nValueScale=K(b.nValueScale,
Number(c.valuescale),e),b.fRedraw=!0);t(c.linewidth)&&(b.nLineWidth=K(b.nLineWidth,Number(c.linewidth),e),b.fRedraw=!0);t(c.markersize)&&(b.nMarkerSize=K(b.nMarkerSize,Number(c.markersize),e),b.fRedraw=!0);t(c.gapsize)&&(b.nGapSize=K(b.nGapSize,Number(c.gapsize),e),b.fRedraw=!0);t(c.offsetx)&&(b.nOffsetX=K(b.nOffsetX,Number(c.offsetx),e),b.fRedraw=!0);t(c.offsety)&&(b.nOffsetY=K(b.nOffsetY,Number(c.offsety),e),b.fRedraw=!0);t(c.rotation)&&(b.nRotation=K(b.nRotation,Number(c.rotation),e),b.fRedraw=
!0);t(c.align)&&(b.szAlign=String(c.align),b.fRedraw=!0);t(c.linecolor)&&(b.szLineColor=String(c.linecolor),b.fRedraw=!0);t(c.valueupper)&&(b.szValueUpper=c.valueupper,b.nValueUpper=fa(b.szValueUpper),b.fRedraw=!0);t(c.valuelower)&&(b.szValueLower=c.valuelower,b.nValueLower=fa(b.szValueLower),b.fRedraw=!0);t(c.titleupper)&&(b.szTitleUpper=c.titleupper,b.nTitleUpper=fa(b.szTitleUpper),b.fRedraw=!0);t(c.titlelower)&&(b.szTitleLower=c.titlelower,b.nTitleLower=fa(b.szTitleLower),b.fRedraw=!0);t(c.boxupper)&&
(b.szBoxUpper=c.boxupper,b.nBoxUpper=fa(b.szBoxUpper),b.fRedraw=!0);t(c.boxlower)&&(b.szBoxLower=c.boxlower,b.nBoxLower=fa(b.szBoxLower),b.fRedraw=!0);t(c.shadowupper)&&(b.szShadowUpper=c.shadowupper,b.nShadowUpper=fa(b.szShadowUpper),b.fRedraw=!0);t(c.shadowlower)&&(b.szShadowLower=c.shadowlower,b.nShadowLower=fa(b.szShadowLower),b.fRedraw=!0);t(c.declutterupper)&&(b.szDeclutterUpper=c.declutterupper,b.nDeclutterUpper=fa(b.szdeclutterUpper),b.fRedraw=!0);t(c.aggregationupper)&&(b.szAggregationUpper=
c.aggregationupper,b.nAggregationUpper=fa(b.szAggregationUpper),b.fRedraw=!0);t(c.aggregationlower)&&(b.szAggregationLower=c.aggregationlower,b.nAggregationLower=fa(b.szAggregationLower),b.fRedraw=!0);t(c.clipupper)&&(b.szClipUpper=c.clipupper,b.nClipUpper=fa(b.szClipUpper),b.fRedraw=!0);t(c.cliplower)&&(b.szClipLower=c.cliplower,b.nClipLower=fa(b.szClipLower),b.fRedraw=!0);t(c.minvaluesize)&&(b.nValueSizeMin=K(b.nValueSizeMin,Number(c.minvaluesize),e),b.fRedraw=!0);t(c.minvaluevalue)&&(b.nValueValueMin=
K(b.nValuevalueMin,Number(c.minvaluevalue),e),b.fRedraw=!0);t(c.clipvaluesize)&&(b.nValueSizeMin=K(b.nValueSizeMin,Number(c.clipvaluesize),e),b.fRedraw=!0);t(c.minsize)&&(b.nChartSizeMin=K(b.nChartSizeMin,Number(c.minsize),e),b.fRedraw=!0);t(c.minchartsize)&&(b.nChartSizeMin=K(b.nChartSizeMin,Number(c.minchartsize),e),b.fRedraw=!0);t(c.maxcharts)&&(b.nMaxCharts=K(b.nMaxCharts,Number(c.maxcharts),e),b.nMaxCharts=Math.max(1,Math.round(b.nMaxCharts)),b.unpaintMap(),b.fRedraw=!0);t(c.sizepow)&&(b.nSizePow=
K(b.nSizePow,Number(c.sizepow),e),b.fRedraw=!0);t(c.outlierscale)&&(b.nOutlierScale=K(b.nOutlierScale,Number(c.outlierscale),e),b.fRedraw=!0);t(c.clipsize)&&(b.nChartSizeMin=K(b.nChartSizeMin,Number(c.clipsize),e),b.fRedraw=!0);t(c.clipparts)&&(b.nClipParts=Number(c.clipparts),b.fRedraw=!0);t(c.showparts)&&(b.szShowParts=c.showparts,b.szShowPartsA=c.showparts.split(c.showparts.match(/\|/)?"|":","),map.Themes.unmarkClass(null,d),b.fRedraw=!0);t(c.clipframerate)&&(b.nClipFrameRate=K(b.nClipFrameRate||
1,Number(c.clipframerate),e),b.nClipTimeout=1/b.nClipFrameRate*1E3,b.fRedraw=!0);t(c.refresh)&&(b.nRefreshTimeout=Number(c.refresh)*1E3,b.fRealize=!0);t(c.refreshtimeout)&&(b.nRefreshTimeout=Number(c.refreshtimeout),b.fRealize=!0);t(c.gridx)&&(b.nGridX=Number(c.gridx)||7,b.fRedraw=!0);t(c.gridwidth)&&(b.szAggregationField=null,c.gridwidth=="auto"?b.nGridWidthPx=b.nGridWidthPx||50:String(c.gridwidth).match(/px/)?b.nGridWidthPx=K(b.nGridWidthPx||1,Number(c.gridwidth),e):e=="factor"?t(b.nGridWidthPx)?
b.nGridWidthPx=K(b.nGridWidthPx||1,Number(c.gridwidth),e):b.nGridWidth=K(b.nGridWidth||1E3,Number(c.gridwidth),e):(b.nGridWidthPx=null,b.nGridWidth=K(b.nGridWidth||1,Number(c.gridwidth),e)),b.fRealize=!0,b.fRedraw=!0,b.fSuppressAggregationScale=!0,b.themeNodesPosA=[],b.unpaintMap());t(c.gridmatrix)&&(b.szAggregationField=null,b.nGridMatrix=K(b.nGridMatrix||1,Number(c.gridmatrix),e),b.fRealize=!0,b.fRedraw=!0,b.fSuppressAggregationScale=!0,b.unpaintMap(),b.themeNodesPosA=[]);t(c.gridwidthpx)&&(b.szAggregationField=
null,b.nGridWidthPx=K(b.nGridWidthPx||50,Number(c.gridwidthpx),e),b.fRealize=!0,b.fRedraw=!0,b.fSuppressAggregationScale=!0,b.unpaintMap(),b.themeNodesPosA=[]);t(c.gridoffsetx)&&(b.nGridOffsetX=K(b.nGridOffsetX||0,Number(c.gridoffsetx),e),b.fRealize=!0,b.fRedraw=!0,b.fSuppressAggregationScale=!0,b.unpaintMap(),b.themeNodesPosA=[]);t(c.gridoffsety)&&(b.nGridOffsetY=K(b.nGridOffsetY||0,Number(c.gridoffsety),e),b.fRealize=!0,b.fRedraw=!0,b.fSuppressAggregationScale=!0,b.unpaintMap(),b.themeNodesPosA=
[]);t(c.aggregationfield)&&(b.szAggregationField=c.aggregationfield,b.fRealize=!0,b.fRedraw=!0,b.fSuppressAggregationScale=!0,b.unpaintMap(),b.themeNodesPosA=[]);t(c.snippet)&&(b.szSnippet=unescape(c.snippet),b.fRealize=!0);t(c.title)&&(b.szTitle=unescape(c.title),b.fRealize=!0);t(c.units)&&(b.szUnits=unescape(c.units),b.fRealize=!0);t(c.child)&&(b.fChild=!0)}b.fRedrawInfo=!0;map.Themes.execute()}};ixMap.Themes.prototype.getThemeLayerList=function(){for(var d=[],c,e=0;e<this.themesA.length;e++)if(this.themesA[e].objThemesA&&
!this.themesA[e].fRemove)for(c in this.themesA[e].objThemesA)d[d.length]=c;return d};ixMap.Themes.prototype.isThemeLayerUsed=function(d){for(var c=this.getThemeLayerList(),e=0;e<c.length;e++)if(d==c[e])return!0;return!1};ixMap.Themes.prototype.isNodePartOfAnyTheme=function(d){if(d=map.Layer.getLayerObjOfNode(d))for(var c=map.Themes.getThemeLayerList(),e=0;e<c.length;e++)if(d.szName==c[e])return!0;return!1};ixMap.Themes.prototype.resetThemeNodesCache=function(){this.themeNodesA=[];this.themeNodes=
0};ixMap.Themes.prototype.addToThemeNodesCache=function(d){var c=0;d=d.getElementsByTagName("g");for(var e=0;e<d.length;e++){var b=String(map.Tiles.getMasterId(d.item(e).getAttributeNS(null,"id")));b&&(map.Themes.themeNodesA[b]||(map.Themes.themeNodesA[b]=[]),map.Themes.themeNodesA[b].push(d.item(e)),map.Themes.themeNodes++,c++)}};ixMap.Themes.prototype.removeFromThemeNodesCache=function(d){var c=0;d=d.getElementsByTagName("g");for(var e=0;e<d.length;e++){var b=String(map.Tiles.getMasterId(d.item(e).getAttributeNS(null,
"id")));if(b&&map.Themes.themeNodesA[b]){var n=map.Themes.themeNodesA[b].indexOf(d.item(e));n>-1&&(map.Themes.themeNodesA[b].splice(n,1),c++)}}};ixMap.Themes.prototype.setActive=function(d){this.activeTheme=d};ixMap.Themes.prototype.minimizeInfo=function(d,c){if(d=this.getTheme(c)){var e=d.widgetNode.firstChild;if(e){c=Number(e.getAttributeNS(szMapNs,"titleheight"));c<=0&&(c=420);e=e.childNodes;for(var b=0;b<e.length;b++){var n=e.item(b),m=n.getAttributeNS(null,"id");m.match(/body/)&&n.style.setProperty("display",
"none","");m.match(/footer/)&&n.style.setProperty("display","none","");m.match(/backgroundrect/)&&(n.setAttributeNS(szMapNs,"maxheight",n.getAttributeNS(null,"height")),n.setAttributeNS(null,"height",c));m.match(/shadowrect/)&&(n.setAttributeNS(szMapNs,"maxheight",n.getAttributeNS(null,"height")),n.setAttributeNS(null,"height",String(c-100)));m.match(/minimizebutton/)&&n.style.setProperty("display","none","")}d.minimizebutton.nodeObj.style.setProperty("display","none","");d.morebutton.nodeObj.style.setProperty("display",
"none","");d.addDefinitionToFlag("MINIMIZED")}}};ixMap.Themes.prototype.maximizeInfo=function(d,c){if(d=this.getTheme(c))if(c=d.widgetNode.firstChild){c=c.childNodes;for(var e=0;e<c.length;e++){var b=c.item(e),n=b.getAttributeNS(null,"id");n.match(/body/)&&b.style.setProperty("display","inline","");n.match(/footer/)&&b.style.setProperty("display","inline","");n.match(/backgroundrect/)&&b.setAttributeNS(null,"height",b.getAttributeNS(szMapNs,"maxheight"));n.match(/shadowrect/)&&b.setAttributeNS(null,
"height",b.getAttributeNS(szMapNs,"maxheight"));n.match(/minimizebutton/)&&b.style.setProperty("display","inline","")}d.minimizebutton.nodeObj.style.setProperty("display","inline","");d.morebutton.nodeObj.style.setProperty("display","inline","");d.removeDefinitionFromFlag("MINIMIZED")}};ixMap.Themes.prototype.getChartAll=function(d,c,e){for(var b=c.getAttributeNS(null,"id"),n=0,m=0;m<this.themesA.length;m++){var u=map.Dom.newGroup(c,b+":C1");this.getChart(d,u,e,this.themesA[m]);var z=map.Dom.getBox(u);
z.width<0&&(z=new box(0,0,0,0));u.fu.setPosition(0,n);n+=z.height+map.Scale.normalY(10);this.themesA[m].szFlag.match(/AGGREGATE/)&&(z=d.split("::")[0]+"::"+this.themesA[m].getNodePosition(d).x+","+this.themesA[m].getNodePosition(d).y,this.getChart(z,u,e,this.themesA[m]),z=map.Dom.getBox(u),z.width<0&&(z=new box(0,0,0,0)),u.fu.setPosition(0,n),n+=z.height+map.Scale.normalY(10))}};ixMap.Themes.prototype.getChart=function(d,c,e,b){b||(b=this.activeTheme);if(!b)return null;d&&d.substr(d.length-6,6)==
":paint"&&(d=d.substr(0,d.length-6));if(b.szFlag.match(/CHOROPLETH/)&&b.szFlag.match(/DOMINANT|COMPOSE/)){var n=30;b.nOrigSumA.length>2&&(n=15*b.nOrigSumA.length/Math.log(b.nOrigSumA.length));e=map.Dom.newGroup(c,c.getAttributeNS(null,"id")+":1");if(b.szFlag.match(/PERCENTOFMEAN/)||b.szFlag.match(/PERCENTOFMEDIAN/)||b.szFlag.match(/DEVIATION/)){b.drawChart(e,d,n,"CHART|BAR|VALUES|ZOOM",d&&b.itemA[d]?b.itemA[d].nDominant:null);var m=map.Dom.getBox(e);m.width<0&&(m=new box(0,0,0,0));e=map.Dom.newGroup(c,
c.getAttributeNS(null,"id")+":2");c=b.szUnit;b.szUnit="";b.drawChart(e,d,n,"VALUES|ZOOM|XAXIS");b.szUnit=c;d=map.Dom.getBox(e);c=b.nOrigSumA.length>1?m.width/d.width*1.015:d.width/d.height;e.fu.setPosition(d.x-m.x,m.height+m.y+Math.min(map.Scale.normalY(200),Math.max(map.Scale.normalY(10),-d.y+map.Scale.normalY(6))));e.fu.scale(c,1);b=b.szFlag.match(/PERCENTOFMEDIAN/)?"median":"mean";d=d.width;map.Dom.newText(e,d,map.Scale.normalY(.9),"font-family:arial;font-size:"+map.Scale.normalY(4)+"px;fill:#808080",
map.Dictionary.getLocalText(b));map.Dom.newText(e,d,map.Scale.normalY(5.5),"font-family:arial;font-size:"+map.Scale.normalY(4)+"px;fill:#808080",map.Dictionary.getLocalText("-"));map.Dom.newText(e,d,map.Scale.normalY(-3.7),"font-family:arial;font-size:"+map.Scale.normalY(4)+"px;fill:#808080",map.Dictionary.getLocalText("+"))}else c="CHART|BAR|SPACED|VALUES|ZOOM",b.szFlag.match(/3D/)&&(c+="|3D"),b.szFlag.match(/\bSORT\b/)&&(c+="|SORT"),b.szFlag.match(/HORZ/)&&(c+="|HORZ|AXIS"),b.drawChart(e,d,n,c,
null);return new point(0,map.Scale.normalY(30))}if(b.szFlag.match(/BUFFER/)&&b.szFlag.match(/CHART/))return null;if(b.szFlag.match(/CHOROPLETH/)&&b.itemA[d])return n=b.itemA[d].nValuesA[b.nActualFrame||0],e=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,1),b.szFlag.match(/CATEGORICAL/)&&b.szLabelA&&b.szLabelA.length?n=b.szLabelA[n-1]:(m=b.nMax-b.nMin<10?2:0,n=b.formatValue(n,b.nValueDecimals||m)+b.szUnit),b.szFlag.match(/\bCLIP\b/)&&b.szXaxisA&&map.Dom.newText(c,-40,-280,__scaleStyleString(map.Scale.tStyle.Summary.szStyle,
.8)+";font-weight:normal;fill:#888888",b.szXaxisA[b.nActualFrame]),map.Dom.newText(c,-40,0,e+";font-weight:normal;stroke:#ffffff;stroke-width:20;stroke-opacity:0.3",n),map.Dom.newText(c,-40,0,e+";font-weight:normal;fill:#444444",n),__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.8),!b.szFlag.match(/CATEGORICAL/)&&(b.szChoroplethInfoStyle.match(/HISTOGRAM/)||b.szChoroplethInfoStyle.match(/histogram/)||b.szChoroplethInfoStyle.match(/CLASSES/)||b.szChoroplethInfoStyle.match(/classes/))&&(n=b.szChoroplethInfoStyle.match(/HISTOGRAM/)||
b.szChoroplethInfoStyle.match(/histogram/),e=map.Dom.newGroup(c,c.getAttributeNS(null,"id")+":histogram"),this.getHistogram(d,e,n?"DISTRIBUTION":"CLASSES",b),e.fu.setPosition(0,map.Scale.normalY(4))),new point(0,0);if(b.szFlag.match(/INFOSIZE/))return b.drawChart(c,d,30,e);n=30;b.szFlag.match(/SEQUENCE/)&&(n=25);b.szFlag.match(/BAR/)&&(b.szFlag.match(/STACKED/)?n=300:b.nOrigSumA.length<=2?n=30:(b.szFlag.match(/\bUP\b/)||b.szFlag.match(/CENTER/)||b.szFlag.match(/SEQUENCE/),n=15*b.nOrigSumA.length/
Math.log(b.nOrigSumA.length)));return b.drawChart(c,d,n,e)};ixMap.Themes.prototype.getSummary=function(d,c){c||(c=this.activeTheme);if(!c||!d)return null;if(!c.itemA[d]){var e=d.split("::");e.length>1&&(d=e[0]+"::"+String(e[1]).toUpperCase())}if(!c.itemA[d])return null;e=c.itemA[d].nOrigValuesA;for(var b=0,n=0;n<e.length;n++)isNaN(e[n])&&(e[n]=0),b+=e[n];c.szFlag.match(/DIFFERENCE/)&&(b=e[e.length-1]);if(c.itemA[d].nValue100A[0]){c.szUnits100=c.szUnits100||"";if(c.szFlag.match(/RELATIVE/)||c.szFlag.match(/DIFFERENCE/))return map.Dictionary.getLocalText("Relative to")+
": "+String(c.formatValue(c.itemA[d].nValue100A[0],c.nValueDecimals||0))+" "+(c.szUnits100||"");if(c.itemA[d].nSize){if(c.szAggregation.match(/sum/))return map.Dictionary.getLocalText("Counted")+": "+String(c.formatValue(c.itemA[d].nSize,c.nValueDecimals||0))+" "+(c.szUnits100||"")}else if(b!=c.itemA[d].nValue100A[0])return String(__formatValue(b,2))+" / "+String(c.formatValue(c.itemA[d].nValue100A[0],c.nValueDecimals||0))+" "+(c.szUnits100||"")}else if(c.itemA[d].nSize){if(c.szFlag.match(/CATEGORICAL/)&&
c.itemA[d].nValuesA.length==1&&c.szValueField)return c.szLabelA[c.itemA[d].nValuesA[0]-1]}else{if(c.itemA[d].nAlpha)return map.Dictionary.getLocalText("Alpha value")+": "+String(c.formatValue(c.itemA[d].nAlpha,c.nValueDecimals||0))+" "+(c.szAlphaValueUnits||"");!c.szFlag.match(/SUM/)||c.szFlag.match(/SEQUENCE/)||c.szFlag.match(/\bCLIP\b/)}return null};ixMap.Themes.prototype.getValueComment=function(d,c){c||(c=this.activeTheme);if(!c||!d)return null;if(!c.itemA[d]){var e=d.split("::");e.length>1&&
(d=e[0]+"::"+String(e[1]).toUpperCase())}if(!c.itemA[d])return null;e=c.itemA[d].nOrigValuesA;for(var b=0;b<e.length;b++)isNaN(e[b])&&(e[b]=0);c.szFlag.match(/DIFFERENCE/);return c.szFlag.match(/OFFSETMEAN/)?map.Dictionary.getLocalText("value")+": "+String(__formatValue(c.itemA[d].nValuesA[0],2))+" "+map.Dictionary.getLocalText("mean")+": "+String(__formatValue(c.nMeanA[0],2)):null};ixMap.Themes.prototype.getTitle=function(d,c){c||(c=this.activeTheme);if(!c||!d)return null;d=String(map.Tiles.getMasterId(d));
if(!c.itemA[d]){var e=d.split("::");e.length>1&&(d=e[0]+"::"+String(e[1]).toUpperCase())}return c.itemA[d]?c.itemA[d].szTitle||null:null};ixMap.Themes.prototype.getLabel=function(d,c){c||(c=this.activeTheme);if(!c||!d)return null;if(!c.itemA[d]){var e=d.split("::");e.length>1&&(d=e[0]+"::"+String(e[1]).toUpperCase())}return c.itemA[d]?c.itemA[d].szLabel||null:null};ixMap.Themes.prototype.getTextObjects=function(){for(var d=[],c=0;c<this.themesA.length;c++)if(this.themesA[c].szFlag.match(/TEXTONLY/)&&
this.themesA[c].chartGroup)if(typeof this.themesA[c].markedClass!="undefined"&&this.themesA[c].markedClass!=null)for(var e=this.themesA[c].markedClass,b=this.themesA[c].chartGroup.getElementsByTagName("text"),n=0;n<b.length;n++)b.item(n).firstChild.nodeValue.length>0&&Number(b.item(n).getAttributeNS(szMapNs,"class"))==e&&d.push(b.item(n));else for(b=this.themesA[c].chartGroup.getElementsByTagName("text"),n=0;n<b.length;n++)b.item(n).firstChild.nodeValue.length>0&&d.push(b.item(n));return d};ixMap.Themes.prototype.getMaxValue=
function(d,c){c||(c=this.activeTheme);if(!c||!d)return null;var e=0;d=c.itemA[d].nValuesA;for(c=0;c<d.length;c++)isNaN(d[c])&&(d[c]=0),e=Math.max(e,d[c]);return e};ixMap.Themes.prototype.getDataRow=function(d,c){c||(c=this.activeTheme);if(!c||!d)return null;if(!c.itemA[d]){var e=d.split("::");e&&e.length>1&&(d=e[0]+"::"+String(e[1]).toUpperCase())}if(!c.itemA[d])return null;e=c.objThemesA[c.szThemesA[0]];var b=[];if(c.szDataFieldsA)for(var n=0;n<c.szDataFieldsA.length;n++)for(var m=0;m<e.dbFields.length;m++)c.szDataFieldsA[n]==
e.dbFields[m].id&&b.push(m);else for(m=0;m<e.dbFields.length;m++)b.push(m);var u=[];if(e.dbRecords){if(typeof c.itemA[d].dbIndexA!="undefined"&&c.itemA[d].dbIndexA.length){for(var z in c.itemA[d].dbIndexA)for(z>0&&u.push("--------------------"),m=0;m<b.length;m++)u.push(e.dbFields[b[m]].id);for(z in c.itemA[d].dbIndexA)for(z>0&&u.push("--------------------"),n=c.itemA[d].dbIndexA[z],m=0;m<b.length;m++)u.push(e.dbRecords[n][b[m]]);return u}if(typeof c.itemA[d].dbIndex!="undefined"){n=c.itemA[d].dbIndex;
for(m=0;m<b.length;m++)u.push(e.dbFields[b[m]].id);for(m=0;m<b.length;m++)u.push(e.dbRecords[n][b[m]]);return u}d=d.split("::")[1];for(n=0;n<e.dbRecords.length;n++)if(e.dbRecords[n]&&e.dbRecords[n][e.nFieldSelectionIndex]&&String(e.dbRecords[n][e.nFieldSelectionIndex]).toUpperCase()==String(d).toUpperCase()){for(m=0;m<e.dbFields.length;m++)u.push(e.dbFields[m].id);for(m=0;m<e.dbFields.length;m++)u.push(e.dbRecords[n][m]);break}}return u};ixMap.Themes.prototype.getFieldIndexArray=function(d){d||(d=
this.activeTheme);if(!d||d.szDataFieldsA)return[];d.fieldIndexArray=[];for(var c=0;c<d.objThemesA[d.szThemesA[0]].nFieldIndexA.length;c++)d.fieldIndexArray.push(d.objThemesA[d.szThemesA[0]].nFieldIndexA[c]);for(c=0;c<d.objThemesA[d.szThemesA[0]].nField100IndexA.length;c++)d.fieldIndexArray.push(d.objThemesA[d.szThemesA[0]].nField100IndexA[c]);return d.fieldIndexArray};ixMap.Themes.prototype.getScatterArray=function(d,c,e){d||(d=this.activeTheme);var b=d.nMin,n=d.nMax,m=0,u;e.match(/LOG/)?(m=1-b,b=
Math.log(b+m),n=Math.log(n+m)):e.match(/POW2/)&&(m=1-b,b=Math.pow(b+m,.5),n=Math.pow(n+m,.5));e.match(/POW3/)&&(m=1-b,b=Math.pow(b+m,1/3),n=Math.pow(n+m,1/3));n=(n-b)/c;for(var z=[],x=0;x<c+1;x++)z[x]=0;for(u in d.itemA)x=d.itemA[u].nValuesA[0],typeof x=="number"&&(e.match(/LOG/)?x=Math.log(x+m):e.match(/POW2/)?x=Math.pow(x+m,.5):e.match(/POW3/)&&(x=Math.pow(x+m,1/3)),z[Math.max(0,Math.min(c-1,Math.floor((x-b)/n)))]++);return z};ixMap.Themes.prototype.getResolutionQualityOfArray=function(d){for(var c=
d.length,e=-1E6,b=0;b<c;b++)e=Math.max(e,d[b]);var n=0;for(b=0;b<c;b++)d[b]>e/10&&n++;return n/c*100};ixMap.Themes.prototype.getDeviationOfArray=function(d){for(var c=d.length,e=0,b=0,n=0;n<c;n++)e+=d[n];e/=c;for(n=0;n<c;n++)b+=(d[n]-e)*(d[n]-e);return Math.sqrt(b/c)};ixMap.Themes.prototype.getHistogram=function(d,c,e,b){if(!c)return null;b||(b=this.activeTheme);if(!b||b.nMin==b.nMax)return null;if(d){if(!b.itemA[d]){var n=d.split("::");n.length>1&&(d=n[0]+"::"+String(n[1]).toUpperCase())}if(!b.itemA[d])return null}this.histGroup=
map.Dom.newGroup(c,c.getAttributeNS(null,"id")+":group");this.histFlag=e;this.histTheme=b;c=map.Scale.normalX(70);e=map.Scale.normalY(20);map.Dom.newShape("rect",this.histGroup,0,0,c-map.Scale.normalX(.5),e,"fill:none;stroke:none;");d?(map.Themes.makeHistogram(d),setTimeout(function(){map.Themes.makeHistogram(d)},100)):setTimeout(function(){map.Themes.makeHistogram()},100)};ixMap.Themes.prototype.makeHistogram=function(d){var c=this.histGroup,e=this.histFlag,b=this.histTheme;if(e.match("CLASSES")){for(var n=
map.Scale.normalX(50),m=map.Scale.normalY(5),u,z=0,x=0,w=d?b.itemA[d].nValuesA[0]:0,O=0,a=0;a<b.partsA.length;a++){u=n/b.nCount*b.partsA[a].nCount;var f=map.Dom.newShape("rect",c,z,x,u,m,"fill:"+b.colorScheme[a]+";stroke:black;stroke-width:1;");f&&f.setAttributeNS(szMapNs,"tooltip",b.szLegendLabelA[a]+" ("+b.formatValue(b.partsA[a].nCount)+" "+map.Dictionary.getLocalText("members")+")");z+=u;w>b.partsA[a].max?O+=u:w>b.partsA[a].min&&(O+=u/(b.partsA[a].max-b.partsA[a].min)*(w-b.partsA[a].min))}map.Dom.newShape("circle",
c,O,-map.Scale.normalX(.1),map.Scale.normalX(1),"fill:#444444;stroke:none;")}else if(e.match("DISTRIBUTION")){if(!isFinite(b.nMin)||!isFinite(b.nMax))return c;O=Math.min(500,Math.max(20,b.nCount/5));n=map.Scale.normalX(70);m=map.Scale.normalY(12);e.match("INTERACTIVE")&&(m=map.Scale.normalY(20));var g=n/O;w=d?b.itemA[d].nValuesA[0]:0;var l=0,h=b.nMin,r=b.nMax,C=0,F=this.getScatterArray(b,O,"");a=this.getDeviationOfArray(F);z=this.getScatterArray(b,O,"LOG");x=this.getDeviationOfArray(z);var v=!1,E=
(r-h)/O;x&&x<a&&(F=z,C=1-h,h=Math.log(h+C),r=Math.log(r+C),w=Math.log(w+C),E=(r-h)/O,v=!0);for(a=0;a<O;a++)l=Math.max(l,F[a]);z=-20;x=0;b.histogram=new ixMap.Histogram(b);b.histogram.fDoLog=v;b.histogram.dValue=C;b.histogram.nWidth=n;b.histogram.nMin=h;b.histogram.nMax=r;var M=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.4),G=0;for(a=0;a<b.partsA.length;a++){u=(v?n/(r-h)*(Math.min(r,Math.log(b.partsA[a].max+C))-h):n/(r-h)*(Math.min(r,b.partsA[a].max)-h))-z;f=1;if(b.szFlag.match(/DOPACITY/)){f=
b.partsA[a].min+(b.partsA[a].max-b.partsA[a].min)/2;var I=1/(b.nDopacityPow||1);f=b.szFlag.match(/DOPACITYMINMAX/)?f>=b.nMedianA[0]?Math.pow(Math.abs(f-b.nMedianA[0]),I)/Math.pow(b.nMax-b.nMedianA[0],I)*(b.fillOpacity||1)*(b.nDopacityScale||1):Math.pow(Math.abs(f-b.nMedianA[0]),I)/Math.pow(b.nMedianA[0]-b.nMin,I)*(b.fillOpacity||1)*(b.nDopacityScale||1):b.szFlag.match(/DOPACITYMIN/)?Math.pow(b.nMax-f,I)/Math.pow(b.nMax-b.nMin,I)*(b.fillOpacity||1)*(b.nDopacityScale||1):b.szFlag.match(/DOPACITYMAX/)?
Math.pow(f-b.nMin,I)/Math.pow(b.nMax-b.nMin,I)*(b.fillOpacity||1)*(b.nDopacityScale||1):b.szFlag.match(/DOPACITYLOG/)?Math.log(f-b.nMin)/Math.log(b.nMedianA[0]-b.nMin)*.5*(b.fillOpacity||1)*(b.nDopacityScale||1):b.szFlag.match(/DOPACITY/)?(f-b.nMin)/(b.nMedianA[0]-b.nMin)*.5*(b.fillOpacity||1)*(b.nDopacityScale||1):(a+O/10)/O}if(f=map.Dom.newShape("rect",c,z,x,u,m,"fill:"+b.colorScheme[a]+";fill-opacity:"+f+";stroke:black;stroke-width:"+map.Scale.normalX(.2)+";stroke-opacity:0.1"))f.setAttributeNS(szMapNs,
"tooltip",b.szLegendLabelA[a]+" ("+b.formatValue(b.partsA[a].nCount)+" "+map.Dictionary.getLocalText("members")+")"),f.setAttributeNS(szMapNs,"onoverstyle","fill:"+b.colorScheme[a]+";stroke:black;stroke-width:"+map.Scale.normalX(.5)+";"),f.setAttributeNS(null,"onmouseover","map.Themes.markClass(evt,'"+b.szId+"','"+a+"','1')"),f.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+b.szId+"')");b.histogram.classRectA[a]=f;b.histogram.classRectXA[a]=z;b.histogram.classRectWidthA[a]=u;b.histogram.classRectMaxA[a]=
b.partsA[a].max;if(e.match("INTERACTIVE")){f=map.Dom.newGroup(c,"");I=null;if(a>0){map.Dom.newShape("line",f,z,x-map.Scale.normalY(2),z,x+m,"stroke:black;stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.5");if(I=map.Dom.newShape("rect",f,z-map.Scale.normalY(1.5),x-map.Scale.normalY(6),map.Scale.normalX(3),map.Scale.normalY(5),"fill:"+b.colorScheme[a]+";stroke:black;styroke-width(1);"))I.setAttributeNS(null,"rx",map.Scale.normalX(2)),I.setAttributeNS(null,"ry",map.Scale.normalY(1.5));I=map.Dom.newText(f,
z,x-map.Scale.normalY(7),M+"display:none;font-weight:normal;text-anchor:middle",b.formatValue(b.partsA[a-1].max,1))}f=new Slider(f,new box(-G,0,G+u,0));f.setId(String(a));f.parent=b.histogram;f.textObj=I;G=u}z+=u}z=g/3;x=0;u=.9;a=this.getResolutionQualityOfArray(F);a<10&&(u=10-a);for(a=0;a<O;a++){r=F[a]/l*m*u;f=v?Math.exp(h+a*E)-C:h+a*E;G=v?Math.exp(h+(a+1)*E)-C:h+(a+1)*E;M="black";r=r&&!isNaN(r)?Math.min(m,Math.max(map.Scale.normalY(.5),r)):0;if(M=map.Dom.newShape("line",c,z,x+m,z,x+m-r,"stroke:"+
M+";stroke-width:"+g+";"))M.setAttributeNS(szMapNs,"tooltip",b.formatValue(f,2)+" ... "+b.formatValue(G,2)+b.szUnit+" ("+F[a]+" members)"),M.setAttributeNS(szMapNs,"onoverstyle","stroke:yellow;stroke-width:"+Math.max(map.Scale.normalX(1),g)+";");z+=g}map.Dom.newShape("line",c,-map.Scale.normalX(.5),m+1,n-map.Scale.normalX(.5),m+1,"stroke:black;stroke-width:"+map.Scale.normalX(.1)+";");O=-map.Scale.normalX(.5);n-=map.Scale.normalX(.5);z=map.Scale.normalX(2);map.Dom.newShape("line",c,O,m,O,m+z,"stroke:black;stroke-width:"+
map.Scale.normalX(.2)+";");map.Dom.newShape("line",c,n,m,n,m+z,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";");u=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.4);x=map.Scale.tStyle.Summary.nFontHeight*.4;F=m+z+x*.8;a=b.formatValue(b.nMin,0);l=b.formatValue(b.nMax,0);map.Dom.newText(c,O-10,F,u+";font-weight:normal;text-anchor:start",a);b.nMin<0&&b.nMax>0&&(O=(0-h)/E*g,map.Dom.newShape("line",c,O,m,O,m+z,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";"),map.Dom.newText(c,O,F,u+
";font-weight:normal;text-anchor:start","0"));r=0;for(a=10;a<b.nMax;a*=10)for(M=1;M<9&&!(a*M>b.nMax||a*M<b.nMin);M++)O=((v?Math.log(a*M+C):a*M)-h)/E*g,f=b.formatValue(a*M,0),O>r+f.length*x*3/8?(map.Dom.newShape("line",c,O,m,O,m+z,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";"),map.Dom.newText(c,O,F,u+";font-weight:normal;text-anchor:middle",f),r=O+f.length*x*3/8):map.Dom.newShape("line",c,O,m,O,m+z/2,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";");n>r+l.length*x*3/8&&map.Dom.newText(c,
n,F,u+";font-weight:normal;text-anchor:middle;",l);d&&!e.match("INTERACTIVE")&&(O=(w-h)/E*g,map.Dom.newShape("circle",c,O,-map.Scale.normalX(.1),map.Scale.normalX(1),"fill:#dd0000;stroke:none;"),map.Dom.newShape("line",c,-10,-5,O-10,-5,"stroke:#000000;stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.3"))}else{n=map.Scale.normalX(70);m=map.Scale.normalY(12);u=n/700;x=z=0;r=b.nMax;d=m/r;g=Math.max(1,Math.ceil(b.nCount/700));e=[];h=0;C=[];for(w in b.itemA)C.push(b.itemA[w].nValuesA[0]);C.sort(b.sortUp);
for(w in C)h%g?e[e.length-1]+=C[w]/g:e[e.length]=C[w]/g,h++;e.sort(b.sortUp);for(a=0;a<e.length;a++){f=e[a];r=e[a]*d*.9;M="black";for(w=0;w<b.partsA.length;w++)if(e[a]<b.partsA[w].max){M=b.colorScheme[w];break}M=map.Dom.newShape("line",c,z,x,z,m,"stroke:"+M+";stroke-width:"+u+";");M.setAttributeNS(szMapNs,"tooltip",b.formatValue(f,2)+b.szUnit);isNaN(r)&&(r=0);M=map.Dom.newShape("line",c,z,x+m,z,x+m-r,"stroke:#000000;stroke-width:"+u+";");M.setAttributeNS(szMapNs,"tooltip",b.formatValue(f,2)+b.szUnit);
z+=u}a=b.formatValue(b.nMin,0);l=b.formatValue(b.nMax,0);u=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.4);map.Dom.newText(c,z+map.Scale.normalX(1),x+m,u+";font-weight:normal;text-anchor:start;stroke-opacity:0.8;",a);map.Dom.newText(c,z+map.Scale.normalX(1),x+map.Scale.normalY(3.5),u+";font-weight:normal;text-anchor:start;stroke-opacity:0.8;",l);c&&c.fu.scale(n/z,1)}return c};ixMap.Histogram=function(d){this.mapTheme=d;this.fDoLog=!1;this.dValue=0;this.classRectA=[];this.classRectXA=[];this.classRectWidthA=
[];this.classRectMaxA=[]};ixMap.Histogram.prototype=new Map;ixMap.Histogram.prototype.onMouseOver=function(d,c,e){e.textObj&&e.textObj.style.setProperty("display","inline","")};ixMap.Histogram.prototype.onMouseOut=function(d,c,e){e.textObj&&e.textObj.style.setProperty("display","none","")};ixMap.Histogram.prototype.onMouseMove=function(d,c,e){if(d=this.classRectA[Number(c)])d.setAttributeNS(null,"x",this.classRectXA[Number(c)]+e.value.x),d.setAttributeNS(null,"width",this.classRectWidthA[Number(c)]-
e.value.x);if(d=this.classRectA[Number(c)-1]){d.setAttributeNS(null,"width",this.classRectWidthA[Number(c)-1]+e.value.x);var b=this.nMin+(this.nMax-this.nMin)/this.nWidth*(this.classRectXA[Number(c)]+e.value.x);b=this.fDoLog?Math.exp(b)-this.dValue:b;this.classRectMaxA[Number(c)-1]=b}e.textObj&&(e.textObj.firstChild.nodeValue=__formatValue(b,1))};ixMap.Histogram.prototype.onMouseUp=function(d,c,e){(e=this.classRectA[Number(c)-1])&&(this.classRectWidthA[Number(c)-1]=e.getAttributeNS(null,"width"));
c="ranges:"+String(this.nMin);for(e=0;e<this.classRectMaxA.length;e++)c+=","+String(this.classRectMaxA[e]);map.Themes.changeThemeStyle(d,this.mapTheme.szId,c)};ixMap.Themes.prototype.showErrorInfo=function(d,c){(d=this.getTheme(c))&&d.showErrorInfo()};ixMap.Themes.prototype.redraw=function(d){return this.actualize(d)};ixMap.Themes.prototype.actualizeActiveTheme=function(d){return this.actualize(d)};ixMap.Themes.prototype.actualize=function(d){for(var c=0;c<this.themesA.length;c++)if(d&&d!=1&&this.themesA[c].szFlag.match(/FEATURE/)&&
(this.themesA[c].nFeatureUpper||this.themesA[c].nFeatureLower)&&(this.themesA[c].fDone||(this.themesA[c].fRealize=!this.themesA[c].fDone),setTimeout("map.Themes.execute()",100)),this.themesA[c].fDone)if(this.themesA[c].szFlag.match(/WMS/))this.themesA[c].fRealize=!0,executeWithMessage("map.Themes.execute()","...",100);else if(this.themesA[c].szFlag.match(/FEATURE/)&&this.themesA[c].szFlag.match(/CLIPTOGEOBOUNDS|CLIPTOVIEW/))this.themesA[c].fRealize=!0,executeWithMessage("map.Themes.execute()","...",
100);else{if(this.themesA[c].szFlag.match(/CHART/)&&(this.themesA[c].__fClipToGeoBounds&&(this.themesA[c].fRealize=!0),d&&d!=1&&this.themesA[c].szFlag.match(/DYNAMICSCALE/)&&(this.themesA[c].nScale*=Math.sqrt(d),this.themesA[c].fRealize=!0),d&&d!=1&&this.themesA[c].szFlag.match(/BEZIER/)&&(this.themesA[c].fRedraw=!0),this.themesA[c].szFlag.match(/DECLUTTER/)&&(this.themesA[c].fDeclutter=!0,map.Themes.execute()),d&&d!=1)){if(this.themesA[c].fRealizeDone){if(this.themesA[c].szAggregationFieldA){for(var e=
this.themesA[c].nGridWidth,b=this.themesA[c].szAggregationField,n=0;n<this.themesA[c].szAggregationFieldA.length;n++){var m=Number(this.themesA[c].szAggregationFieldA[n].split(":")[1]);m&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>m&&(isNaN(parseFloat(this.themesA[c].szAggregationFieldA[n+1]))?this.themesA[c].szAggregationField=this.themesA[c].szAggregationFieldA[n+1]:(this.themesA[c].szAggregationFieldA[n+1].match(/px/)?this.themesA[c].nGridWidthPx=parseFloat(this.themesA[c].szAggregationFieldA[n+
1]):(this.themesA[c].nGridWidth=parseFloat(this.themesA[c].szAggregationFieldA[n+1]),this.themesA[c].nGridWidthPx=0),this.themesA[c].szAggregationField=null));n++}this.themesA[c].szAggregationField!=b||this.themesA[c].nGridWidth!=e?(this.themesA[c].fRealize=!0,this.themesA[c].themeNodesPosA=[]):this.themesA[c].fRedraw=!0}this.themesA[c].nGridWidthPx?(e=map.Scale.getDistanceInMeter(1E3,1E3,1E3+map.Scale.normalX(this.themesA[c].nGridWidthPx),1E3),this.themesA[c].nGridWidth=e/map.Scale.nZoomScale,this.themesA[c].fRealize=
!0,this.themesA[c].themeNodesPosA=[]):this.themesA[c].nGridMatrix&&(e=map.Zoom.getBox(),e=map.Scale.getDistanceInMeter(1E3,1E3,1E3+e.width,1E3),this.themesA[c].nGridWidth=e/(this.themesA[c].nGridMatrix||20)/map.Scale.nZoomScale,this.themesA[c].fRealize=!0,this.themesA[c].themeNodesPosA=[]);if(this.themesA[c].szAggregationUpper||this.themesA[c].szAggregationLower)this.themesA[c].fRealize=this.themesA[c].szAggregationUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.themesA[c].nAggregationUpper||
this.themesA[c].szAggregationLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.themesA[c].nAggregationLower?this.themesA[c].__fAggregate!=0:this.themesA[c].__fAggregate==0}this.themesA[c].autoOpacity&&(this.themesA[c].fRedraw=!0);if(this.themesA[c].nValueUpper||this.themesA[c].nValueLower||this.themesA[c].nChartUpper||this.themesA[c].nChartLower||this.themesA[c].nBoxUpper||this.themesA[c].nBoxLower||this.themesA[c].nTitleUpper||this.themesA[c].nTitleLower||this.themesA[c].nLabelUpper||this.themesA[c].nLabelLower||
this.themesA[c].nMaxCharts)this.themesA[c].fRedraw=!0}this.themesA[c].fRealize?(this.themesA[c].fRedraw=!1,this.themesA[c].fActualize=!1):this.themesA[c].fActualize=this.themesA[c].fRedraw?!1:!0}executeWithMessage("map.Themes.execute()","working ...",100);return null};ixMap.Themes.prototype.resortCharts=function(d){var c=!1;if(this.themesA.length){for(var e=0;e<this.themesA.length;e++)this.themesA[e].fDone&&(c=this.themesA[e].fResort=!0);c&&map.Themes.execute()}d&&(d.stopPropagation(),d.preventDefault())};
ixMap.Themes.prototype.clear=function(){this.themesA.length=0};B.prototype.getFields=function(){this.szFields=this.theme.szFields;this.szFieldsA=this.theme.szFields.split("|");for(var d in this.szFieldsA)this.szFieldsA[d]=this.szFieldsA[d].trim();this.theme.szFieldsA=this.szFieldsA;this.szField100A=this.theme.szField100A;this.szColorField=this.theme.szColorField;this.szSymbolField=this.theme.szSymbolField;this.szValueField=this.theme.szValueField;this.szLabelField=this.theme.szLabelField;this.szTitleField=
this.theme.szTitleField;this.szSnippetField=this.theme.szSnippetField;this.szSizeField=this.theme.szSizeField;this.szAlphaField=this.theme.szAlphaField;this.szAlphaField100=this.theme.szAlphaField100;this.szXField=this.theme.szXField;this.szYField=this.theme.szYField;this.szTimeField=this.theme.szTimeField;this.szFilterField=this.theme.szFilterField;this.szAggregationField=this.theme.szAggregationField;this.szSelectionFieldsA=(this.theme.szSelectionField||"").split("|");this.nFieldIndexA[0]=-1;this.nFieldSelectionIndexA[0]=
-1;this.theme.szSelectionField2&&(this.szSelectionField2=this.theme.szSelectionField2||null,this.szSelectionFields2A=(this.theme.szSelectionField2||"").split("|"),this.nFieldSelection2IndexA=[-1]);var c=this.coTable?this.coTable:this.szName;if(!this.szFields||this.szFields==="")return!0;try{eval("this.dbTable = "+c+".table")}catch(b){try{eval("this.dbTable = "+c+"_table")}catch(n){}}if(this.coTable&&!this.dbTable)return displayMessage("Data not loaded!",1E3,!0),!1;if(this.dbTable){try{eval("this.dbFields = "+
c+".fields")}catch(b){try{eval("this.dbFields = "+c+"_fields")}catch(n){}}this.dbTable.fields=this.dbFields.length;if(this.dbTable.fields==0||this.dbTable.records==0)return!1;try{this.szSelectionField||(this.szSelectionField=map.Layer.getLayerObj(this.szName).szSelection)}catch(b){return alert("no selection field found !!"),!1}for(d=0;d<this.dbTable.fields;d++)if(!this.dbFields||this.dbFields.length===0||!this.dbFields[d])return alert("ERROR: theme '"+this.szName+"' - table '"+c+"' - object 'fields' incorrect !"),
!1;if(this.szFields=="$table$"){this.szFieldsA=[];for(d=0;d<this.dbFields.length;d++)this.dbFields[d].id!=this.szSelectionField&&this.dbFields[d].id!="Total"&&this.szFieldsA.push(this.dbFields[d].id);this.theme.szFields=this.szFieldsA.join("|");this.theme.szFieldsA=this.szFieldsA;this.theme.szLabelA=this.szFieldsA}for(d=0;d<this.dbFields.length;d++){typeof this.szItemField!="undefined"&&String(this.dbFields[d].id).toLowerCase()==String(this.szItemField).toLowerCase()&&(this.nFieldItemIndex=d);typeof this.szSelectionField!=
"undefined"&&String(this.dbFields[d].id).toLowerCase()==String(this.szSelectionField).toLowerCase()&&(this.nFieldSelectionIndex=d);if(typeof this.szSelectionField2!="undefined")for(String(this.dbFields[d].id).toLowerCase()==String(this.szSelectionField2).toLowerCase()&&(this.nFieldSelection2Index=d),c=0;c<this.szSelectionFields2A.length;c++)this.dbFields[d].id==this.szSelectionFields2A[c]&&(this.nFieldSelection2IndexA[c]=d);for(c=0;c<this.szSelectionFieldsA.length;c++)this.dbFields[d].id==this.szSelectionFieldsA[c]&&
(this.nFieldSelectionIndexA[c]=d);for(c=0;c<this.szFieldsA.length;c++)this.szFieldsA[c].substr(0,1)=="!"?this.dbFields[d].id==this.szFieldsA[c].substr(1,this.szFieldsA[c].length-1)&&(this.nFieldIndexA[c]=d):this.dbFields[d].id==this.szFieldsA[c]&&(this.nFieldIndexA[c]=d);if(this.szField100A)for(c=0;c<this.szField100A.length;c++)this.dbFields[d].id==this.szField100A[c]&&(this.nField100IndexA[c]=d);this.szColorField&&this.dbFields[d].id==this.szColorField&&(this.nColorFieldIndex=d);this.szSymbolField&&
this.dbFields[d].id==this.szSymbolField&&(this.nSymbolFieldIndex=d);this.szValueField&&this.dbFields[d].id==this.szValueField&&(this.nValueFieldIndex=d);this.szLabelField&&this.dbFields[d].id==this.szLabelField&&(this.nLabelFieldIndex=d);this.szTitleField&&this.dbFields[d].id==this.szTitleField&&(this.nTitleFieldIndex=d);this.szSnippetField&&this.dbFields[d].id==this.szSnippetField&&(this.nSnippetFieldIndex=d);this.szSizeField&&this.dbFields[d].id==this.szSizeField&&(this.nSizeFieldIndex=d);this.szTimeField&&
this.dbFields[d].id==this.szTimeField&&(this.nTimeFieldIndex=d);this.szXField&&this.dbFields[d].id==this.szXField&&(this.nXFieldIndex=d);this.szYField&&this.dbFields[d].id==this.szYField&&(this.nYFieldIndex=d);this.szAlphaField&&this.dbFields[d].id==this.szAlphaField&&(this.nAlphaFieldIndex=d);this.szAlphaField100&&this.dbFields[d].id==this.szAlphaField100&&(this.nAlphaField100Index=d);this.szFilterField&&this.dbFields[d].id==this.szFilterField&&(this.nFilterFieldIndex=d);this.szAggregationField&&
this.dbFields[d].id==this.szAggregationField&&(this.nAggregationFieldIndex=d)}this.nFieldSelectionIndex==-1&&this.nFieldSelectionIndexA[0]==-1&&(this.szSelectionField&&this.szSelectionField.length?_ERROR("ERROR on load theme data: selection field '"+this.szSelectionField+"' not found !"):_ERROR("ERROR on load theme data: selection not defined !"));for(c=0;c<this.szFieldsA.length;c++)if(typeof this.nFieldIndexA[c]=="undefined")return _ERROR("ERROR on load theme data: value field '"+this.szFieldsA[c]+
"' not found !"),!1;if(this.szField100A)for(c=0;c<this.szField100A.length;c++)if(typeof this.nField100IndexA[c]=="undefined")return _ERROR("ERROR on load theme data: value 100 field '"+this.szFieldsA[c]+"' not found !"),!1;this.szColorField&&!this.szColorField.match(/\$/)&&typeof this.nColorFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: colorfield: '"+this.szColorField+"' not found !");this.szSymbolField&&!this.szSymbolField.match(/\$/)&&typeof this.nSymbolFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: symbolfield: '"+
this.szSymbolField+"' not found !");this.szValueField&&!this.szValueField.match(/\$/)&&typeof this.nValueFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: valuefield: '"+this.szValueField+"' not found !");this.szLabelField&&!this.szLabelField.match(/\$/)&&typeof this.nLabelFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: labelfield '"+this.szLabelField+"' not found !");this.szTitleField&&!this.szTitleField.match(/\$/)&&typeof this.nTitleFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: titlefield '"+
this.szTitleField+"' not found !");this.szSnippetField&&!this.szSnippetField.match(/\$/)&&typeof this.nSnippetFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: snippetfield '"+this.szSnippetField+"' not found !");this.szSizeField&&!this.szSizeField.match(/\$/)&&typeof this.nSizeFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: sizefield '"+this.szSizeField+"' not found !");this.szTimeField&&!this.szTimeField.match(/\$/)&&typeof this.nTimeFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: timefield '"+
this.szTimeField+"' not found !");this.szXField&&!this.szXField.match(/\$/)&&typeof this.nXFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: xfield '"+this.szXField+"' not found !");this.szYField&&!this.szYField.match(/\$/)&&typeof this.nYFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: yfield '"+this.szYField+"' not found !");this.szAlphaField&&!this.szAlphaField.match(/\$/)&&typeof this.nAlphaFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: alphafield '"+this.szAlphaField+
"' not found !");this.szAlphaField100&&!this.szAlphaField100.match(/\$/)&&typeof this.nAlphaField100Index=="undefined"&&_ERROR("ERROR on load theme data: alpha100field '"+this.szAlphaField100+"' not found !");this.szFilterField&&!this.szFilterField.match(/\$/)&&typeof this.nFilterFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: filterfield '"+this.szFilterField+"' not found !");this.szAggregationField&&!this.szAggregationField.match(/\$/)&&typeof this.nAggregationFieldIndex=="undefined"&&
_ERROR("ERROR on load theme data: aggregationfield '"+this.szAggregationField+"' not found !");!this.szItemField||this.szItemField==this.szSelectionField||this.szItemField.match(/\$/)||typeof this.nFieldItemIndex!="undefined"&&this.nFieldItemIndex!=-1||alert("ERROR on load theme data: itemfield '"+this.szItemField+"' not found !")}else{d=map.SVGDocument.getElementById(this.szName);d==null&&(c=map.Tiles.getTileNodes(this.szName))&&(d=c[0]);if(!d)return this.szName="",!1;d=d.getAttributeNS(szMapNs,
"info");if(d==null||d==="")return this.szName="",!1;var e=d.split("|");for(d=0;d<e.length;d++){for(c=0;c<this.szFieldsA.length;c++)this.szFieldsA[c].substr(0,1)=="!"?e[d]==this.szFieldsA[c].substr(1,this.szFieldsA[c].length-1)&&(this.nFieldIndexA[c]=d):e[d]==this.szFieldsA[c]&&(this.nFieldIndexA[c]=d);for(c=0;c<this.szField100A.length;c++)e[d]==this.szField100A[c]&&(this.nField100IndexA[c]=d);this.szColorField&&e[d]==this.szColorField&&(this.nColorFieldIndex=d);this.szSymbolField&&e[d]==this.szSymbolField&&
(this.nSymbolFieldIndex=d);this.szValueField&&e[d]==this.szValueField&&(this.nValueFieldIndex=d);this.szLabelField&&e[d]==this.szLabelField&&(this.nLabelFieldIndex=d);this.szTimeField&&e[d]==this.szTimeField&&(this.nTimeFieldIndex=d);this.szSizeField&&e[d]==this.szSizeField&&(this.nSizeFieldIndex=d);this.szXField&&e[d]==this.szXField&&(this.nXFieldIndex=d);this.szYField&&e[d]==this.szXField&&(this.nYFieldIndex=d);this.szAlphaField&&e[d]==this.szAlphaField&&(this.nAlphaFieldIndex=d);this.szAlphaField100&&
e[d]==this.szAlphaField100&&(this.nAlphaField100Index=d)}}for(c=0;c<this.szFieldsA.length;c++)this.nFieldIndexA[c]<0&&(this.szFieldsA[c]!="$item$"&&this.szFieldsA[c]!="$index$"&&_ERROR("ERROR on load theme data: '"+this.szFieldsA[c]+"' not found !"),this.szName="");return!0};A.prototype.checkTheme=function(){if(!this.szThemesA)return!1;for(var d=0;d<this.szThemesA.length;d++)if(this.szThemesA[d]=="generic"||map.Layer.isLoaded(this.szThemesA[d]))return!0;this.ErrorMessage="theme layer not loaded ! zoom in ?";
return!1};A.prototype.def=function(){return map.Themes.getMapThemeDefinitionObj(this.szId)};A.prototype.getDefinitionObject=function(){return map.Themes.getMapThemeDefinitionObj(this.szId)};A.prototype.set=function(d){map.Themes.parseStyle(this,d)};A.prototype.setDefinitionObject=function(d){map.Themes.parseStyle(this,d)};A.prototype.initValues=function(){this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;for(var d=this.nNoData=this.nCount=this.nSum=0;d<this.szFieldsA.length;d++)this.nMinA[d]=
Number.MAX_VALUE,this.nMaxA[d]=-Number.MAX_VALUE,this.nSumA[d]=0,this.nOrigMinA[d]=Number.MAX_VALUE,this.nOrigMaxA[d]=-Number.MAX_VALUE,this.nOrigSumA[d]=0,this.nMedianA[d]=0,this.nMeanA[d]=0,this.nDeviationA[d]=0;this.nMin100=Number.MAX_VALUE;this.nMax100=-Number.MAX_VALUE;this.nSum100=0;this.itemA=[];this.posItemA=[];this.chartPosA=[];this.exactCountA=[];this.exactSizeA=[];this.quantileA=[];this.szAggregation||(this.szAggregation=this.szField100?"mean":"sum");if(this.szAggregationFieldA&&!this.fSuppressAggregationScale)for(d=
0;d<this.szAggregationFieldA.length;d++){var c=Number(this.szAggregationFieldA[d].split(":")[1]);c&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>c&&(isNaN(parseFloat(this.szAggregationFieldA[d+1]))?this.szAggregationField=this.szAggregationFieldA[d+1]:(this.szAggregationFieldA[d+1].match(/px/)?this.nGridWidthPx=parseFloat(this.szAggregationFieldA[d+1]):(this.nGridWidth=parseFloat(this.szAggregationFieldA[d+1]),this.nGridWidthPx=0),this.szAggregationField=null));d++}this.fSuppressAggregationScale=
!1;this.nWrongRecordLengthCount=0;this.missedA=[];this.coTable&&this.coTable!="genericTable"||!this.loadTableFromMap()||(this.coTable="genericTable")};A.prototype.removeValues=function(){this.missedA=this.quantileA=this.exactSizeA=this.exactCountA=this.chartPosA=this.posItemA=this.itemA=null};A.prototype.getMeanMedianQuantile=function(){if(!this.quantileA||!this.quantileA.length)for(var d=0;d<this.nMaxA.length;d++){var c=[],e=0,b;for(b in this.itemA)c.push(this.itemA[b].nValuesA[d]),e+=this.itemA[b].nValuesA[d];
this.szFieldsA[d]&&this.szFieldsA[d]!="$item$"&&c.sort(this.sortUp);this.nMedianA[d]=c[Math.round(c.length/2)];this.nMeanA[d]=e/c.length;this.quantileA[d]=c}};A.prototype.getHeadTail=function(){var d=[],c;for(c in this.itemA)d.push(this.itemA[c].nValuesA[0]);return{mean:function(e){var b=e.length;return e.reduce(function(n,m){return n+m},0)/b},headTail:function(e){var b=Math.min.apply(null,e),n=this.mean(e);b=[b];for(b.push(n);e.length>1;)e=e.filter(function(m){return m>n}),n=this.mean(e),b.push(n);
return b}}.headTail(d)};A.prototype.realize=function(){_LOG("theme realize start - "+this.szId+this.szFlag);if(this.szFlag.match(/WMS/)){this.chartGroup||(this.chartGroup=map.Dom.newGroup(map.Layer.layerNode,this.szThemesA[0]),map.Layer.listA[this.szThemesA[0]]=new ixMap.Layer.Item(null),map.Layer.listA[this.szThemesA[0]].szName=this.szThemesA[0],this.isChecked=this.fDone=!0);var d=map.Zoom.getBoundsOfMapInGeoBounds(),c=map.Scale.viewBox.width/map.Zoom.nZoomX,e=map.Scale.viewBox.height/map.Zoom.nZoomY,
b=map.Scale.bBox.width/20,n=map.Scale.bBox.height/20;this.nLayerLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nLayerLower?this.clearWMS():this.nLayerUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nLayerUpper?this.clearWMS():(map.Dom.constructNode("image",this.chartGroup,{"xlink:href":this.szServer+"?f=image&transparent=true&bbox="+d[0].x+","+d[0].y+","+d[1].x+","+d[1].y+"&bboxSR=4326&size="+b+","+n,x:-map.Scale.mapCenter.x/map.Zoom.nZoomX-c/2,y:-map.Scale.mapCenter.y/map.Zoom.nZoomY-
e/2,style:"width:"+c+";height:"+e+";opacity:"+(this.nOpacity||.8)+";pointer-events:none;",onload:'map.Themes.getTheme("'+this.szId+'").cleanWMS();'}),this.fDone=!0)}else if(!this.szFlag.match(/FEATURE/)||!(this.nFeatureLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nFeatureLower||this.nFeatureUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nFeatureUpper)){if(this.szFlag.match(/CHART|CHOROPLETH/)&&(!this.nChartLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nChartLower)&&
(!this.nChartUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nChartUpper))for(d in c=map.Themes.getAllThemes(),c)if(c[d]!=this&&c[d].szFlag.match(/FEATURE/)&&c[d].szThemesA[0]==this.szThemesA[0]&&!c[d].fDone){this.fRealize=!0;setTimeout("map.Themes.execute()",500);return}if(this.coTable){this.__test=null;try{eval("this.__test = "+this.coTable+".table")}catch(u){try{eval("this.__test = "+this.coTable+"_table")}catch(z){}}if(!this.__test){map.Themes.loadExternalData(this.coTable,this.nRefreshTimeout,
this);this.fRealize=!0;return}}c=new Date;this.fShowProgressBar=!0;this.initValues();if(this.getFields())if(this.loadValues())if(this.szFlag.match(/\bPOSITION\b/)){_LOG("start");c=this.szThemesA[0];e=this.objThemesA[c];b=e.nFieldItemIndex;n=e.nFieldSelectionIndexA[0];var m=e.nFieldSelectionIndexA[1];for(d in e.dbRecords)map.Themes.themeNodesPosA[c+"::"+e.dbRecords[d][b]]=map.Scale.getMapPositionOfLatLon(Number(e.dbRecords[d][n].replace(",",".")),Number(e.dbRecords[d][m].replace(",",".")));_LOG("stop");
this.fDraw=this.fAnalyze=!1;this.fDone=!0}else this.fDone=!1,this.timeLoading=new Date-c,(this.timeLoading>1E3||this.szFlag.match(/VERBOSE/))&&!this.szFlag.match(/SILENT/)?executeWithMessage("map.Themes.executeContinue();",this.szFlag.match(/AGGREGATE/)?"aggregating":"parsing data"):map.Themes.executeContinue();else this.fRemove=!0;else this.fRemove=!0}};A.prototype.cleanWMS=function(){this.chartGroup.childNodes.length>1&&this.chartGroup.removeChild(this.chartGroup.firstChild)};A.prototype.clearWMS=
function(){map.Dom.clearGroup(this.chartGroup)};A.prototype.realize_analyze=function(){var d=new Date;(this.fDraw=this.distributeValues())||this.realizeDone();this.timeAggregating=new Date-d;(this.timeLoading>1E3||this.szFlag.match(/VERBOSE/))&&!this.szFlag.match(/SILENT/)?executeWithMessage("map.Themes.executeContinue();","drawing"):map.Themes.executeContinue()};A.prototype.realize_draw=function(){var d=map.Layer.getLayerObj(this.szThemesA[0]);d&&(this.szShapeType=d.szType,this.szShapeType=="line"&&
this.szOrigFlag.match(/BUFFER/)&&(this.szShapeType+="+buffer"));this.szOrigFlag.match(/FEATURE/)&&this.szOrigFlag.match(/LINES/)&&(this.szShapeType="line");_LOG("theme draw start - "+this.szId);this.timeStart=new Date;this.nActualFrame=this.nMissingRangeCount=this.nZeroValueCount=this.nRealizedCount=this.nSkipCount=this.nDoneCount=0;d=this.szFlag.match(/VERBOSE/)?"drawing":"";this.mapSleep=new ixMap.Sleep("map.Themes.executeContinue",this.nflushPaintShape,map.Dictionary.getLocalText(d));this.mapSleep.nCount=
this.nCount;this.mapSleep.szCancel="map.Themes.cancelExecute()";this.szFlag.match(/\bCLIP\b/)&&(this.mapSleep=null,this.nClipIncr=1);this.szFlag.match(/FEATURE/)?(this.mapSleep=null,this.unpaintMap(),this.chartMap()):this.szFlag.match(/CHART/)?(this.mapSleep&&(this.mapSleep.initCheckSleep(this.nflushChartDraw,d),this.mapSleep.fShowProgressBar=!0),this.chartMap()):(this.unlabelMap(),this.paintMap(),this.makeVisible());this.isChecked=!0;!this.szFlag.match(/CHART/)||this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||
this.szFlag.match(/SYMBOL/)||this.szFlag.match(/BAR/)&&this.colorScheme&&this.nOrigSumA&&this.nOrigSumA.length!=this.colorScheme.length?this.isMarkable=!0:this.isMarkable=!1};A.prototype.realizeContinue=function(d){this.fMakeLabel?this.labelMap(d):this.szFlag.match(/CHART/)?this.chartMap(d):this.paintMap(d)};A.prototype.realizeNextClipFrame=function(){if(this.szFlag.match(/\bCLIP\b/)&&!this.fClipPause){var d=this.szId;this.nActualFrame+=this.nClipIncr;this.nActualFrame>=this.nClipFrames?this.szFlag.match(/BACK/)?
(this.nClipIncr=-this.nClipIncr,this.clipTimeout=setTimeout(function(){map.Themes.nextClipFrame(d)},1E3)):this.szFlag.match(/LOOP/)?(this.nActualFrame=-1,this.clipTimeout=setTimeout(function(){map.Themes.nextClipFrame(d)},1E3)):(this.nActualFrame=this.nClipFrames-1,this.pauseClip()):this.nActualFrame<0?this.szFlag.match(/BACK/)?(this.nClipIncr=-this.nClipIncr,this.clipTimeout=setTimeout(function(){map.Themes.nextClipFrame(d)},10)):(this.nActualFrame=0,this.pauseClip()):(this.mapSleep=null,this.szFlag.match(/CHART/)?
(this.chartPosA=[],this.posItemA=[],this.fDone=!1,this.fRedraw=!0,this.chartMap()):this.paintMap(),this.fRedrawInfo=!0)}};A.prototype.setClipFrame=function(d){this.fClipPause=!0;this.nActualFrame=Math.min(d,this.nClipFrames);this.mapSleep=null;this.szFlag.match(/CHART/)?(this.chartPosA=[],this.posItemA=[],this.fDone=!1,this.chartMap()):this.paintMap();this.fRedrawInfo=!0};A.prototype.startClip=function(d){var c=map.SVGDocument.getElementById(this.szId+":display:widget:clippausebutton:button");c&&
c.style.setProperty("display","inline","");(c=map.SVGDocument.getElementById(this.szId+":display:widget:clipstartbutton:button"))&&c.style.setProperty("display","none","");this.fClipPause=!1;this.nActualFrame=d||this.nActualFrame;this.realizeNextClipFrame()};A.prototype.pauseClip=function(){var d=map.SVGDocument.getElementById(this.szId+":display:widget:clippausebutton:button");d&&d.style.setProperty("display","none","");(d=map.SVGDocument.getElementById(this.szId+":display:widget:clipstartbutton:button"))&&
d.style.setProperty("display","inline","");this.clipTimeout&&clearTimeout(this.clipTimeout);this.fClipPause=!0};A.prototype.realizeDone=function(){var d=this.szId;this.nRefreshTimeout&&(this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(function(){map.Themes.refreshTheme(d)},this.nRefreshTimeout));if(this.szFlag.match(/\bCLIP\b/)){this.szFlag.match(/\bPAUSE\b/)&&(this.removeDefinitionFromFlag("PAUSE"),this.fClipPause=!0);if(this.szFlag.match(/\bLAST\b/)){this.removeDefinitionFromFlag("LAST");
var c=this.nClipFrames-1;setTimeout(function(){map.Themes.setClipFrame(d,c)},10)}this.clipTimeout&&clearTimeout(this.clipTimeout);this.clipTimeout=setTimeout(function(){map.Themes.nextClipFrame(d)},this.nActualFrame?this.nClipTimeout:1E3)}this.nWrongRecordLengthCount&&map.fDebug&&displayMessage("Data Error:  "+this.nWrongRecordLengthCount+" items have wrong record length",1E4,"notify");this.fRealize=this.fRedraw=!1;this.fDone=!0;this.timeRealizing=new Date-this.timeStart;_LOG("theme done - "+this.szId);
this.szFlag.match(/SHOW/)&&(this.removeDefinitionFromFlag("SHOW"),this.zoomTo());this.szFlag.match(/ZOOMTO/)&&(this.removeDefinitionFromFlag("ZOOMTO"),this.zoomTo());map.Themes.realizeDone(this)};A.prototype.beginDraw=function(){};A.prototype.endDraw=function(){};A.prototype.redraw=function(d){if(!this.szFlag.match(/FEATURE/)){this.clipTimeout&&clearTimeout(this.clipTimeout);this.fDataIncomplete&&this.__themeNodes!=map.Themes.themeNodes&&(this.fDataIncomplete=!1,this.initValues(),this.loadValues(),
this.distributeValues());if(this.szFlag.match(/CHART/)){if(this.fClipCharts||this.fRedraw)this.nMissingPositionCount=this.nMissingRangeCount=this.nZeroValueCount=this.nRealizedCount=this.nDoneCount=this.nSkipCount=0,this.chartMap()}else if(this.isChecked){if(this.partsA)for(var c=0;c<this.partsA.length;c++)this.partsA[c].nCount=0,this.partsA[c].nSum=0;this.mapSleep&&this.mapSleep.initCheckSleep(this.nflushPaintShape,"painting map");this.makeVisible();this.paintMap()}d&&this.enable()}};A.prototype.toFront=
function(){if(this.szFlag.match(/CHART/)){this.chartGroup.parentNode.appendChild(this.chartGroup);var d=getMatrix(this.chartGroup);d&&setMatrix(this.chartGroup,d);this.enable()}else if(this.isChecked){for(d=0;d<this.partsA.length;d++)this.partsA[d].nCount=0,this.partsA[d].nSum=0;this.mapSleep&&this.mapSleep.initCheckSleep(this.nflushPaintShape,"painting map");this.paintMap()}else this.enable()};A.prototype.getFields=function(){for(var d=0;d<this.szThemesA.length;d++){var c=this.szThemesA[d];this.objThemesA[c]=
new B(c,d,this.coTable,this.szSelectionField,this.szItemField);this.objThemesA[c].theme=this;if(!this.objThemesA[c].getFields()){try{map.HTMLWindow.ixmaps.htmlgui_onErrorTheme(c)}catch(e){}return!1}}return!0};A.prototype.addItemValues=function(d,c,e,b,n){if(!this.szFlag.match(/RAW/)||e|b|n){var m;if(this.szExcludeA)for(m=0;m<this.szExcludeA.length;m++)if(d.split("::")[1]==this.szExcludeA[m])return;if(!(this.nField100Min&&e&&e[0]&&e[0]<this.nField100Min)){if(this.nMinValue&&c&&!e){var u=!1;for(m=c.length-
1;m>=0;m--)c[m]>=this.nMinValue&&(u=!0);if(!u)return}u=1;if(this.__fDensity||this.__fDensityAlpha)if(u=this.getNodeArea(d),!u&&this.__fTiledLayer){this.fDataIncomplete=!0;return}if(this.szWeights)for(m=0;m<c.length;m++)c[m]*=this.szWeightsA[m]||this.szWeightsA[0];if(this.__fAuto100){var z=0;for(m=0;m<c.length;m++)z+=c[m]||0;for(m=0;m<c.length;m++)e[m]=z;this.fField100=!0}this.itemA[d]={nOrigValuesA:[],nValuesA:c,nValue100A:e,nValueSum:0};for(m=0;m<c.length;m++)this.itemA[d].nOrigValuesA[m]=isNaN(c[m])?
0:c[m],this.itemA[d].nValueSum+=c[m]||0,this.fField100&&(e?(z=c[m],z!==0||this.szFlag.match(/ZEROISVALUE/)?this.szFieldsA[m].substr(0,1)=="!"?(z=e[m]-z,this.itemA[d].nOrigValuesA[m]=z):this.szFlag.match(/CALCVAL/)||this.szFlag.match(/CALC100/)?(z=e[m]?Math.round(z*e[m]/100):z,this.itemA[d].nOrigValuesA[m]=z):this.szFlag.match(/PRODUCT/)?z=e[m]?z*e[m]:z:this.szFlag.match(/DIFFERENCE/)&&c.length==1&&!this.szFlag.match(/RELATIVE/)?(e[m]=m>0?c[m-1]:this.itemA[d].nValue100A[m],z-=e[m]):(z=e[m]?z/e[m]:
1,this.szFlag.match(/FRACTION/)?z*=this.nFractionScale||1:this.szFlag.match(/PERMILLE/)?z*=1E3:(z*=100,z>0&&this.szFlag.match(/RELATIVE/)?z-=100:z>0&&this.szFlag.match(/INVERT/)&&(z=100-z))):z=0,c[m]=z):c[m]=0),this.__fDensity&&(c[m]=u?c[m]/u:null);if(this.__fDifference&&c.length>1){for(m=0;m<c.length;m++)m<c.length-1?(z=c[m],c[m]=c[m+1]-c[m],this.szFlag.match(/RELATIVE/)&&(c[m]=z?100/z*c[m]:c[m]?100:0)):this.szFlag.match(/STACKED/)||(c[m]=0);c.pop()}for(m=0;m<c.length;m++){if(!this.nSumA)return;
!isNaN(c[m])&&isFinite(c[m])&&(this.nMin=Math.min(this.nMin,c[m]),this.nMax=Math.max(this.nMax,c[m]),this.nSum+=c[m],this.nMinA[m]=Math.min(this.nMinA[m],c[m]),this.nMaxA[m]=Math.max(this.nMaxA[m],c[m]),this.nSumA[m]+=c[m],this.nOrigMinA[m]=Math.min(this.nOrigMinA[m],this.itemA[d].nOrigValuesA[m]),this.nOrigMaxA[m]=Math.max(this.nOrigMaxA[m],this.itemA[d].nOrigValuesA[m]),this.nOrigSumA[m]+=this.itemA[d].nOrigValuesA[m]);c[m]<0&&(this.fNegativeValues=!0)}!isNaN(e[0])&&isFinite(e[0])&&(this.nMin100=
Math.min(this.nMin100,e[0]),this.nMax100=Math.max(this.nMax100,e[0]),this.nSum100+=e[0]);this.szSizeField&&(!isNaN(b)&&isFinite(b)?(this.itemA[d].nSize=b,this.nMinSize=Math.min(this.nMinSize,b),this.nMaxSize=Math.max(this.nMaxSize,b),this.nSumSize+=b):this.itemA[d].nSize=0);this.szAlphaField&&n!=null&&!isNaN(n)&&isFinite(n)&&(this.__fDensityAlpha&&(n=u?n/u:0),this.itemA[d].nAlpha=n,this.nMinAlpha=Math.min(this.nMinAlpha,n),this.nMaxAlpha=Math.max(this.nMaxAlpha,n),this.nSumAlpha+=n);if(this.__fExact&&
this.exactCountA)for(m=0;m<c.length;m++)c[m]&&(this.exactCountA[c[m]-1]?(this.exactCountA[c[m]-1]++,this.exactSizeA[c[m]-1]+=this.itemA[d].nSize||1):(this.exactCountA[c[m]-1]=1,this.exactSizeA[c[m]-1]=this.itemA[d].nSize||1));this.nCount++}}else{this.itemA[d]={nOrigValuesA:[],nValuesA:c,nValue100A:e,nValueSum:0};for(m=0;m<c.length;m++){if(!this.nSumA)return;isNaN(c[m])||(this.nMin=Math.min(this.nMin,c[m]),this.nMax=Math.max(this.nMax,c[m]),this.nSum+=c[m]);c[m]<0&&(this.fNegativeValues=!0);this.__fExact&&
this.exactCountA&&c[m]&&(this.exactCountA[c[m]-1]?(this.exactCountA[c[m]-1]++,this.exactSizeA[c[m]-1]+=this.itemA[d].nSize||1):(this.exactCountA[c[m]-1]=1,this.exactSizeA[c[m]-1]=this.itemA[d].nSize||1))}this.nCount++}};A.prototype.getStringValueIndex=function(d,c){if(d.length===0||d==" ")if(this.szFlag.match(/UNDEFINEDISVALUE/))d="undefined";else return-1;this.szFlag.match(/IGNORECASE/)&&(d=d.toUpperCase());d=d.trim();typeof this.nStringToValueA[d]!="undefined"||this.szValuesA&&this.szValuesA.length&&
c!="set"||(this.szLabelA=this.szLabelA||[],this.szExactA=this.szExactA||[],this.nStringToValueA[d]=this.nStringToValue,this.szLabelA[this.nStringToValue-1]=this.szLabelA[this.nStringToValue-1]||d,this.szExactA.push(this.nStringToValue),this.nStringToValue++);return this.nStringToValueA[d]};A.prototype.checkHiddenLayerState=function(){for(var d=0;d<this.szThemesA.length;d++)if(map.Layer.isScaleDependentLayer(this.szThemesA[d])&&(this.hiddenLayerA[this.szThemesA[d]]&&map.Layer.isScaleDependentLayerOn(this.szThemesA[d])||
!this.hiddenLayerA[this.szThemesA[d]]&&!map.Layer.isScaleDependentLayerOn(this.szThemesA[d])))return!0;return!1};var ra=function(d){return String(d).match(/,/)?parseFloat(String(d).replace(/\./gi,"").replace(/,/gi,".")):parseFloat(String(d).replace(/ /gi,""))};A.prototype.loadValues=function(){this.nMissingLookupCount=0;this.__fExact=this.szFlag.match(/CATEGORICAL/);this.__fMax=this.szFlag.match(/\bMAX\b/);this.__fMin=this.szFlag.match(/\bMin\b/);this.__fFirst=this.szFlag.match(/\bFIRST\b/);this.__fLast=
this.szFlag.match(/\bLAST\b/);this.__fDifference=this.szFlag.match(/DIFFERENCE/);this.__fFilter=this.szFilter&&this.szFilter.length;this.__fDensity=this.szFlag.match(/DENSITY/);this.__fDensityAlpha=!this.szFlag.match(/CHART/)&&this.szAlphaField100&&this.szAlphaField100.match(/\$density\$/i);this.__fAggregate=this.szFlag.match(/AGGREGATE/);this.__fAuto100=this.szFlag.match(/AUTO100/)&&!this.szFlag.match(/AGGREGATE/);this.__fTiledLayer=map.Layer.getLayerObj(this.szThemesA[0])?map.Layer.getLayerObj(this.szThemesA[0]).szFlag.match(/tiled/):
!1;this.__themeNodes=map.Themes.themeNodes;for(var d=0;d<this.szThemesA.length;d++)if(map.Layer.isScaleDependentLayer(this.szThemesA[d])&&!map.Layer.isScaleDependentLayerOn(this.szThemesA[d]))this.fRealize=this.hiddenLayerA[this.szThemesA[d]]=!0;else if(this.hiddenLayerA[this.szThemesA[d]]=!1,!this.loadValuesOfTheme(this.szThemesA[d]))return!1;return!0};A.prototype.filterValues=function(d){if(this.szFilter.match(/WHERE/)){if(!this.objTheme.filterQueryA){for(var c=this.szFilter.split("WHERE ")[1].split(" "),
e=0;e<c.length;e++)if(c[e].length){if(c[e][0]=='"'&&c[e][c[e].length-1]!='"'){do c[e]=c[e]+" "+c[e+1],c.splice(e+1,1);while(c[e][c[e].length-1]!='"')}if(c[e][0]=="("&&c[e][c[e].length-1]!=")"){do c[e]=c[e]+" "+c[e+1],c.splice(e+1,1);while(c[e][c[e].length-1]!=")")}}else c.splice(e,1),e--;this.objTheme.filterQueryA=[];var b={};do{var n=0;c.length>=3&&(b={},b.szFilterField=c[0].replace(/("|)/g,""),b.szFilterOp=c[1],b.szFilterValue=c[2].replace(/("|)/g,""),n=3);b.szFilterOp=="BETWEEN"&&c.length>=5&&
c[3]=="AND"&&(b.szFilterValue2=c[4].replace(/("|)/g,""),n=5);if(n){if(b.szFilterField=="*")b.nFilterFieldIndex=-1;else for(e=0;e<this.objTheme.dbFields.length;e++)this.objTheme.dbFields[e].id==b.szFilterField&&(b.nFilterFieldIndex=e),"$"+this.objTheme.dbFields[e].id+"$"==b.szFilterValue&&(b.nFilterValueIndex=e);this.objTheme.filterQueryA.push(b);c.splice(0,n)}else{alert("ixmaps - filter error - incomplete query!\nquery: "+this.szFilter);break}if(c.length&&c[0]=="AND")c.splice(0,1);else break}while(c.length)}for(var m in this.objTheme.filterQueryA)if(this.__szValue=
this.objTheme.filterQueryA[m].nFilterFieldIndex==-1?this.objTheme.dbRecords[d].join("|"):String(this.objTheme.dbRecords[d][this.objTheme.filterQueryA[m].nFilterFieldIndex]),this.__szFilterOp=this.objTheme.filterQueryA[m].szFilterOp.toUpperCase(),this.__szFilterValue=this.objTheme.filterQueryA[m].szFilterValue,this.__szFilterValue2=this.objTheme.filterQueryA[m].szFilterValue2,this.objTheme.filterQueryA[m].nFilterValueIndex!=null&&(this.__szFilterValue=String(this.objTheme.dbRecords[d][this.objTheme.filterQueryA[m].nFilterValueIndex])),
c=ra(this.__szValue),!(this.__szFilterOp=="="?this.__szValue==this.__szFilterValue||c==Number(this.__szFilterValue):this.__szFilterOp=="!="?this.__szValue!=this.__szFilterValue&&c!=Number(this.__szFilterValue):this.__szFilterOp=="<>"?this.__szValue!=this.__szFilterValue&&c!=Number(this.__szFilterValue):this.__szFilterOp==">"?c>Number(this.__szFilterValue):this.__szFilterOp=="<"?c<Number(this.__szFilterValue):this.__szFilterOp==">="?c>=Number(this.__szFilterValue):this.__szFilterOp=="<="?c<=Number(this.__szFilterValue):
this.__szFilterOp=="LIKE"?this.__szFilterValue=="*"?this.__szValue.length:eval("this.__szValue.match(/"+this.__szFilterValue.replace(/\//gi,"\\/")+"/i)"):this.__szFilterOp=="NOT"?eval("!this.__szValue.match(/"+this.__szFilterValue.replace(/\//gi,"\\/")+"/i)"):this.__szFilterOp=="IN"?eval("this.__szFilterValue.match(/\\("+this.__szValue.replace(/\//gi,"\\/")+"\\)/)")||eval("this.__szFilterValue.match(/\\("+this.__szValue.replace(/\//gi,"\\/")+"\\,/)")||eval("this.__szFilterValue.match(/\\,"+this.__szValue.replace(/\//gi,
"\\/")+"\\,/)")||eval("this.__szFilterValue.match(/\\,"+this.__szValue.replace(/\//gi,"\\/")+"\\)/)"):this.__szFilterOp=="BETWEEN"?c>=Number(this.__szFilterValue)&&c<=Number(this.__szFilterValue2):eval("this.__szValue.match(/"+this.__szFilterValue.replace(/\//gi,"\\/")+"/i)")))return!1}else if(this.__szValue=this.objTheme.dbRecords[d].join(" "),!eval("this.__szValue.match(/"+this.szFilter+"/i)"))return!1;return!0};A.prototype.getSelectionId=function(d,c){if(!this.fSelection){this.fSelection="lookup";
if(this.objTheme.nFieldSelectionIndexA&&this.objTheme.nFieldSelectionIndexA.length>1)this.fSelection=this.szCRSDatum?"UTM":"LatLon",this.nSelection_0=this.objTheme.nFieldSelectionIndexA[0],this.nSelection_1=this.objTheme.nFieldSelectionIndexA[1];else if(this.objTheme.nFieldSelectionIndex>=0){var e=V(String(this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndex]));e.match(/MultiPoint/)?this.fSelection="MultiPoint":e.match(/Point/i)?this.fSelection="MultiPoint":e.match(/LineString/)?this.fSelection=
"LineString":e.match(/MultiLineString/)?this.fSelection="MultiLineString":e.match(/Polygon/)?this.fSelection="MultiPolygon":e.match(/MultiPolygon/)&&(this.fSelection="MultiPolygon")}this.objTheme.nFieldSelection2IndexA&&this.objTheme.nFieldSelection2IndexA.length>1?(this.fSelection2=this.szCRSDatum?"UTM":"LatLon",this.nSelection2_0=this.objTheme.nFieldSelection2IndexA[0],this.nSelection2_1=this.objTheme.nFieldSelection2IndexA[1]):typeof this.objTheme.nFieldSelection2Index!="undefined"&&(e=V(String(this.objTheme.dbRecords[c][this.objTheme.nFieldSelection2Index])),
e.match(/MultiPoint/)?this.fSelection2="MultiPoint":e.match(/Point/)?this.fSelection2="MultiPoint":this.fSelection2="mapshape")}if(this.fSelection=="LatLon"||this.fSelection=="UTM")return d+"::"+(String(this.objTheme.dbRecords[c][this.nSelection_0]).replace(/,/g,".")+","+String(this.objTheme.dbRecords[c][this.nSelection_1]).replace(/,/g,"."))+(this.szSelectionFieldSuffix||"").replace(/,/g,".");if(this.fSelection=="Point"||this.fSelection=="MultiPoint"){e=this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndex];
var b;return(b=e.match(ma))?d+"::"+(b[2]+","+b[1])+(this.szSelectionFieldSuffix||""):null}return this.fSelection=="LineString"||this.fSelection=="MultiLineString"||this.fSelection=="Polygon"||this.fSelection=="MultiPolygon"?d+"::"+String(c)+(this.szSelectionFieldSuffix||""):this.objTheme.nFieldSelectionIndex>=0?(e=V(String(this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndex])),this.nSelectionFieldDigits&&(e=("000000000000000"+e).slice(-this.nSelectionFieldDigits)),this.fSelectionFieldToNumber&&
(e=String(Number(e))),this.fSelectionFieldToUpper&&(e=String(e).toUpperCase()),d+"::"+e+(this.szSelectionFieldSuffix||"")):null};A.prototype.loadValuesOfTheme=function(d){if(this.szFlag.match(/FAST/)||this.szFlag.match(/VECTOR/)||this.szFlag.match(/BEZIER/)||typeof this.szSelectionField2!="undefined"||this.szFlag.match(/AGGREGATE/)&&!this.szFlag.match(/COMPATIBLE|PERCENTOFMEAN/))return this.__fAggregateOnLoad=!0,_LOG("loadAndAggregateValuesOfTheme ===>"),this.loadAndAggregateValuesOfTheme(d);var c,
e;this.fNegativeValues=this.fField100=!1;this.szUnit=(this.szUnits?this.szUnits.substr(0,1)=="."?"":" ":"")+(this.szUnits||"");var b=!0;this.objTheme=this.objThemesA[d];this.objTheme.nField100IndexA[0]&&this.objTheme.nField100IndexA[0]>0&&(this.fField100=!0);if(this.objTheme.dbTable&&d&&d.length){if(this.coTable){try{eval("this.objTheme.dbRecords = "+this.coTable+".records")}catch(w){eval("this.objTheme.dbRecords = "+this.coTable+"_records")}if(!this.objTheme.dbRecords)return displayMessage("Data "+
this.coTable+" could not be loaded!",2E3,!0),!1}else try{eval("this.objTheme.dbRecords = "+d+".records")}catch(w){eval("this.objTheme.dbRecords = "+d+"_records")}this.objTheme.nFieldSelectionIndexA.length||delete this.objTheme.nFieldSelectionIndexA;if(this.szFieldsA[0]!="$item$"&&!this.szFlag.match(/CATEGORICAL/)){var n=Math.min(40,this.objTheme.dbRecords.length);for(c=0;c<n;c++)if(this.objTheme.dbRecords[c])for(e=0;e<this.szFieldsA.length;e++){var m=this.objTheme.dbRecords[c][this.objTheme.nFieldIndexA[e]];
if(ra(m)!=parseFloat(m)){this.__fScanValue=!0;c=n;break}}}for(c=0;c<this.objTheme.dbRecords.length;c++)if(!this.objTheme.dbRecords[c]||this.fCheckRecordLength&&this.objTheme.dbRecords[c].length<this.objTheme.dbFields.length)this.nWrongRecordLengthCount++;else if(!this.__fFilter||this.filterValues(c)){n=[];if(this.szFieldsA[0]=="$item$")n[0]=1;else if(this.szFieldsA[0]=="$index$")n[0]=c+1;else for(e=0;e<this.szFieldsA.length;e++){m=this.objTheme.dbRecords[c][this.objTheme.nFieldIndexA[e]];this.__fExact?
(m=this.valueMap?this.valueMap[String(m)]:m,m=this.getStringValueIndex(String(m))):m=this.__fScanValue?ra(m):parseFloat(m);if(isNaN(m))if(this.fUndefinedValuePossible)m=0;else continue;if(m!==0||this.fNullIsValue)m<0&&!this.fNegativeValuePossible||(n[e]=m)}n.length=this.szFieldsA.length;var u=[];if(this.szField100A&&this.szField100A.length){if(this.szField100A[0]=="$item$")u[0]=1;else for(e=0;e<this.szField100A.length;e++)if(m=ra(this.objTheme.dbRecords[c][this.objTheme.nField100IndexA[e]]),m!==0||
this.fNullIsValue)m<0&&!this.fNegativeValuePossible||(u[e]=m);if(u.length>0)for(e=u[u.length-1];u.length<this.szFieldsA.length;)u.push(e)}if(this.szSizeField&&this.szSizeField!="$item$"){var z=this.objTheme.dbRecords[c][this.objTheme.nSizeFieldIndex];z=this.valueMap?this.valueMap[String(z)]||ra(z):ra(z);z=isFinite(z)&&!isNaN(z)?z:0;if(z===0)continue;if(z<0)continue}else z=1;var x=null;this.szAlphaField&&(x=ra(this.objTheme.dbRecords[c][this.objTheme.nAlphaFieldIndex]),isNaN(x)&&(x=0));this.szAlphaField100&&
this.objTheme.nAlphaField100Index&&(x*=100/ra(this.objTheme.dbRecords[c][this.objTheme.nAlphaField100Index]),isNaN(x)&&(x=0));if(m=e=this.getSelectionId(d,c)){this.objTheme.nFieldItemIndex>=0&&this.objTheme.nFieldItemIndex!=this.objTheme.nFieldSelectionIndex&&(e=V(String(this.objTheme.dbRecords[c][this.objTheme.nFieldItemIndex])),this.fSelectionFieldToUpper&&(e=String(e).toUpperCase()),e=d+"::"+e);if(this.itemA[e]){if(this.szFlag.match(/\bDOT\b/))continue;e+="*"+Math.random();if(this.itemA[e])continue}this.addItemValues(e,
n,u,z,x);this.itemA[e]&&(this.szColorField&&(this.itemA[e].szColor=this.szColorField=="$index$"?c+1:V(this.objTheme.dbRecords[c][this.objTheme.nColorFieldIndex])),this.szSymbolField&&(this.itemA[e].szSymbol=this.szSymbolField=="$index$"?c+1:V(this.objTheme.dbRecords[c][this.objTheme.nSymbolFieldIndex])),this.szValueField&&(this.itemA[e].szValue=this.szValueField=="$index$"?c+1:V(this.objTheme.dbRecords[c][this.objTheme.nValueFieldIndex])),this.szTimeField&&(this.itemA[e].szTime=this.szTimeField==
"$index$"?c+1:V(this.objTheme.dbRecords[c][this.objTheme.nTimeFieldIndex]),isNaN(this.itemA[e].szTime)&&(this.itemA[e].szTime=this.itemA[e].szTime.replace(/ - /g,""))),this.szLabelField&&(this.itemA[e].szLabel=this.szLabelField=="$index$"?c+1:V(this.objTheme.dbRecords[c][this.objTheme.nLabelFieldIndex])),this.szTitleField&&(this.itemA[e].szTitle=V(this.objTheme.dbRecords[c][this.objTheme.nTitleFieldIndex])),this.szSnippetField&&(this.itemA[e].szSnippet=V(this.objTheme.dbRecords[c][this.objTheme.nSnippetFieldIndex])),
this.itemA[e].szSelectionId=m?m:e,this.szAggregationField&&(this.itemA[e].szAggregation=V(this.objTheme.dbRecords[c][this.objTheme.nAggregationFieldIndex])),this.szXField&&(this.itemA[e].nX=ra(this.objTheme.dbRecords[c][this.objTheme.nXFieldIndex]),isNaN(this.itemA[e].nX)||(this.nMinX=Math.min(this.nMinX,this.itemA[e].nX),this.nMaxX=Math.max(this.nMaxX,this.itemA[e].nX),this.nSumX+=this.itemA[e].nXField)),this.szYField&&(this.itemA[e].nY=ra(this.objTheme.dbRecords[c][this.objTheme.nYFieldIndex]),
isNaN(this.itemA[e].nY)||(this.nMinY=Math.min(this.nMinY,this.itemA[e].nY),this.nMaxY=Math.max(this.nMaxY,this.itemA[e].nY),this.nSumY+=this.itemA[e].nYField)),this.itemA[e].dbIndex=c)}else this.nMissingLookupCount++}}else b=!1;if(b)return this.fAnalyze=!0};A.prototype.loadAndAggregateValuesOfTheme=function(d,c){var e,b,n;if(!c){console.log("*** F A S T ***");this.fNegativeValues=this.fField100=!1;this.__fMultiParts=this.szFlag.match(/CATEGORICAL/)&&!(this.szFlag.match(/PIE/)||this.szFlag.match(/BAR/)||
this.szFlag.match(/SEQUENCE/)||this.szFlag.match(/PLOT/)||this.szFlag.match(/DOMINANT/)||this.szFlag.match(/COMPOSECOLOR/)||this.szFlag.match(/\bUSER\b/)||this.szFlag.match(/WAFFLE/));this.__fClipToGeoBounds=!1;this.szFlag.match(/CLIPTOGEOBOUNDS/)&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<(this.nClipUpper||1E9)&&(this.__fClipToGeoBounds=!0);this.szUnit=(this.szUnits?this.szUnits.substr(0,1)=="."?"":" ":"")+(this.szUnits||"");this.objTheme=this.objThemesA[d];this.objTheme.nField100IndexA[0]&&this.objTheme.nField100IndexA[0]>
0&&(this.fField100=!0);if(!(this.objTheme.dbTable&&d&&d.length))return!1;if(this.coTable){try{eval("this.objTheme.dbRecords = "+this.coTable+".records")}catch(R){eval("this.objTheme.dbRecords = "+this.coTable+"_records")}if(!this.objTheme.dbRecords)return displayMessage("Data "+this.coTable+" could not be loaded!",2E3,!0),!1}else try{eval("this.objTheme.dbRecords = "+d+".records")}catch(R){eval("this.objTheme.dbRecords = "+d+"_records")}this.objTheme.nFieldSelectionIndexA.length||delete this.objTheme.nFieldSelectionIndexA;
if(this.szFlag.match(/ZOOMTO/)||this.szFlag.match(/SHOW/)){this.getSelectionId(d,0);for(b=0;b<this.objTheme.dbRecords.length;b++){if(this.fSelection=="UTM")f=map.Scale.getMapPositionOfUTM(parseFloat(String(this.objTheme.dbRecords[b][this.nSelection_0]).replace(/,/g,".")),parseFloat(String(this.objTheme.dbRecords[b][this.nSelection_1]).replace(/,/g,".")),this.szCRSDatum,this.szCRSUTMZone);else if(this.fSelection=="LatLon")f=map.Scale.getMapPositionOfLatLon(parseFloat(String(this.objTheme.dbRecords[b][this.nSelection_0]).replace(/,/g,
".")),parseFloat(String(this.objTheme.dbRecords[b][this.nSelection_1]).replace(/,/g,".")));else if(this.fSelection=="Point"||this.fSelection=="MultiPoint"||this.fSelection=="LineString"||this.fSelection=="MultiLineString"){var m=this.objTheme.dbRecords[b][this.objTheme.nFieldSelectionIndex];var u=m.match(ma);f=map.Scale.getMapPositionOfLatLon(parseFloat(u[2]),parseFloat(u[1]))}else m=this.objTheme.dbRecords[b][this.objTheme.nFieldSelectionIndex],this.fSelectionFieldToUpper&&(m=String(m).toUpperCase()),
f=this.getNodePosition(d+"::"+m);f&&(this.itemA[d+"::"+String(f.x)+","+String(f.y)]={ptPos:f})}this.zoomTo();this.itemA=[];this.removeDefinitionFromFlag("ZOOMTO");this.removeDefinitionFromFlag("SHOW")}this.createChartGroup(map.Layer.objectGroup);if(this.szFieldsA[0]!="$item$"&&!this.szFlag.match(/CATEGORICAL/)){var z=Math.min(40,this.objTheme.dbRecords.length);for(b=0;b<z;b++)if(this.objTheme.dbRecords[b])for(n=0;n<this.szFieldsA.length;n++){var x=this.objTheme.dbRecords[b][this.objTheme.nFieldIndexA[n]];
if(ra(x)!=parseFloat(x)){this.__fScanValue=!0;b=z;break}}}this.szSizeField=="$item$"&&(this.oldSizefield=this.szSizeField,this.szSizeField=null);this.nGridWidthPx&&(this.nGridWidth=b=map.Scale.getDistanceInMeter(1E3,1E3,1E3+map.Scale.normalX(this.nGridWidthPx),1E3));this.nGridMatrix&&(b=map.Zoom.getBox(),b=map.Scale.getDistanceInMeter(1E3,1E3,1E3+b.width,1E3),this.nGridWidth=b/(this.nGridMatrix||20)/map.Scale.nZoomScale);this.nGridWidthMap=this.nGridWidth?Math.round(map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/
20)*map.Scale.nZoomScale*20:0;this.nGridWidth&&!this.nGridWidthMap&&(this.nGridWidthMap=this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)*map.Scale.nZoomScale:0);this.nGridWidthPx||(this.nGridWidthMap=this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)*map.Scale.nZoomScale:0,b=Math.pow(10,Math.floor(Math.log10(1/map.Scale.nZoomScale))),this.nGridWidthMap=Math.round(this.nGridWidthMap*b)/b);this.dY=this.dX=0;this.szFlag.match(/FIXGRID/)&&(this.dX=map.Scale.mapCenter.x*
map.Scale.nZoomScale,this.dY=map.Scale.mapCenter.y*map.Scale.nZoomScale);this.nGridOffsetX&&(this.dX-=this.nGridWidthMap/100*this.nGridOffsetX);this.nGridOffsetY&&(this.dY+=this.nGridWidthMap/100*this.nGridOffsetY);this.nHexaWidth=this.nGridWidthMap*1.15;this.nHexaHalf=this.nGridWidthMap*1.15/2;this.nHexa4th=this.nGridWidthMap/4;this.getSelectionId(d,0);this.aggregationCount=0;this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;this.nMinSize=Number.MAX_VALUE;this.nMaxSize=-Number.MAX_VALUE;this.nSumSize=
0;this.nMinAlpha=Number.MAX_VALUE;this.nMaxAlpha=-Number.MAX_VALUE;this.nSumAlpha=0;if(this.__fExact)this.nMinA=[],this.nMaxA=[],this.nSumA=[],this.nOrigMinA=[],this.nOrigMaxA=[],this.nOrigSumA=[],this.nMedianA=[],this.nMeanA=[],this.nCountA=[];else for(u=0;u<this.szFieldsA.length;u++)this.nMinA[u]=Number.MAX_VALUE,this.nMaxA[u]=-Number.MAX_VALUE,this.nSumA[u]=0,this.nOrigMinA[u]=Number.MAX_VALUE,this.nOrigMaxA[u]=-Number.MAX_VALUE,this.nOrigSumA[u]=0,this.nMedianA[u]=0,this.nMeanA[u]=0;this.nEmptyValuesA=
[];for(var w in this.szValuesA)this.nEmptyValuesA.push(0);this.szFlag.match(/DUMP/)&&(this.nChartGroupScale=map.fObjectScaling?(this.nAutoScale||this.nScale)*map.Layer.nObjectScale*map.Scale.nObjectScaling:(this.nAutoScale||this.nScale)*map.Scale.nFeatureScaling*map.Scale.nObjectScaling,this.chartGroup=map.Dom.newGroup(map.Layer.objectGroup,this.szId+":chartgroup"));if(!this.szWeightsA)for(this.szWeightsA=[],u=0;u<this.szFieldsA.length;u++)this.szWeightsA.push(1);else if(this.szWeightsA.length&&this.szWeightsA.length!=
this.szFieldsA.length)for(b=this.szWeightsA[this.szWeightsA.length-1],u=this.szWeightsA.length;u<this.szFieldsA.length;u++)this.szWeightsA.push(b)}if(this.szAggregationUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nAggregationUpper||this.szAggregationLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nAggregationLower)this.__fAggregate=!1;w=map.Zoom.getBoundsOfMapInGeoBounds();z=map.Zoom.getBox();var O=this.objTheme.dbRecords.length>2E5;for(b=c||0;b<this.objTheme.dbRecords.length;b++){if(this.fCancel){displayMessage("Canceled by user",
1E3,!0);return}if(O&&b>(c||0)&&b%5E4===0)return this.fContinueLoadAndAggregate=!0,this.continueIndex=b,this.szThemeLayer=d,displayMessage(__formatValue(b/this.objTheme.dbRecords.length*100,0)+"% "+map.Dictionary.getLocalText("aggregated")),displayProgressBar(b,this.objTheme.dbRecords.length,""),setTimeout(function(){map.Themes.executeContinue()},10),!0;if(!this.objTheme.dbRecords[b]||this.fCheckRecordLength&&this.objTheme.dbRecords[b].length<this.objTheme.dbFields.length){this.nWrongRecordLengthCount++;
continue}if(this.__fFilter&&!this.filterValues(b))continue;if(this.__fClipToGeoBounds&&this.fSelection=="LatLon"){var a=parseFloat(String(this.objTheme.dbRecords[b][this.nSelection_0]).replace(/,/g,"."));m=parseFloat(String(this.objTheme.dbRecords[b][this.nSelection_1]).replace(/,/g,"."));if(m<w[0].x||m>w[1].x||a<w[0].y||a>w[1].y)continue}var f=null,g=null;this.fSelection=="UTM"?m=(f=map.Scale.getMapPositionOfUTM(parseFloat(String(this.objTheme.dbRecords[b][this.nSelection_0]).replace(/,/g,".")),
parseFloat(String(this.objTheme.dbRecords[b][this.nSelection_1]).replace(/,/g,".")),this.szCRSDatum,this.szCRSUTMZone))?String(f.x)+","+String(f.y):"":this.fSelection=="LatLon"?(m=String(this.objTheme.dbRecords[b][this.nSelection_0]).replace(/,/g,".")+","+String(this.objTheme.dbRecords[b][this.nSelection_1]).replace(/,/g,"."),f=this.getNodePosition(d+"::"+m)):this.fSelection=="Point"||this.fSelection=="MultiPoint"||this.fSelection=="LineString"||this.fSelection=="MultiLineString"?(m=this.objTheme.dbRecords[b][this.objTheme.nFieldSelectionIndex],
(u=String(m).match(ma))&&(f=map.Scale.getMapPositionOfLatLon(parseFloat(u[2]),parseFloat(u[1])))):(m=this.objTheme.dbRecords[b][this.objTheme.nFieldSelectionIndex],this.fSelectionFieldToUpper&&(m=String(m).toUpperCase()),this.nSelectionFieldDigits&&(m=("000000000000000"+m).slice(-this.nSelectionFieldDigits)),this.fSelectionFieldToNumber&&(m=String(Number(m))),f=this.getNodePosition(d+"::"+m));this.szFlag.match(/DUMP/)&&(a=map.Dom.newGroup(this.chartGroup,this.szId+":"+m+":chart"),a.fu.setMatrix([this.nChartGroupScale,
0,0,this.nChartGroupScale,f.x,f.y]),map.Dom.newShape("circle",a,0,0,map.Scale.normalX(3),"fill:blue;fill-opacity:0.2;stroke:none;"));if(!f||isNaN(f.x)||isNaN(f.y)){this.fDataIncomplete=!0;continue}a=f;var l=null;var h=null;if(this.fSelection2){if(this.fSelection2=="UTM")h=(l=map.Scale.getMapPositionOfUTM(parseFloat(String(this.objTheme.dbRecords[b][this.nSelection2_0]).replace(/,/g,".")),parseFloat(String(this.objTheme.dbRecords[b][this.nSelection2_1]).replace(/,/g,".")),this.szCRSDatum,this.szCRSUTMZone))?
String(l.x)+","+String(l.y):"";else if(this.fSelection2=="LatLon")l=map.Scale.getMapPositionOfLatLon(parseFloat(String(this.objTheme.dbRecords[b][this.nSelection2_0]).replace(/,/g,".")),parseFloat(String(this.objTheme.dbRecords[b][this.nSelection2_1]).replace(/,/g,"."))),h=f?String(f.x)+","+String(f.y):"";else if(this.fSelection=="Point"||this.fSelection=="MultiPoint"||this.fSelection=="LineString"||this.fSelection=="MultiLineString")h=this.objTheme.dbRecords[b][this.objTheme.nFieldSelection2Index],
u=m.match(ma),l=map.Scale.getMapPositionOfLatLon(parseFloat(u[2]),parseFloat(u[1]));else for(h=this.objTheme.dbRecords[b][this.objTheme.nFieldSelection2Index],this.nSelectionFieldDigits&&(h=("000000000000000"+m).slice(-this.nSelectionFieldDigits)),this.fSelectionFieldToUpper&&(h=String(h).toUpperCase()),u=0;u<this.szThemesA.length;u++)l=l||this.getNodePosition(this.szThemesA[u]+"::"+h);h=V(String(this.objTheme.dbRecords[b][this.objTheme.nFieldSelection2Index]));this.fSelectionFieldToUpper&&(h=String(h).toUpperCase());
var r=h;h=d+"::"+h;this.themeNodesPosA[h]=l}if(this.__fClipToGeoBounds&&(f.x<z.x||f.x>z.x+z.width||f.y<z.y||f.y>z.y+z.height))continue;var C=(qa,T,xa,Ja)=>isNaN(qa)?T?0:!1:qa===0&&!Ja||qa<0&&!xa?!1:!0,F=!1;u=Array(this.szFieldsA.length).fill(null);if(this.szFieldsA[0]==="$item$")u[0]=1;else if(this.szFieldsA[0]==="$index$")u[0]=b+1;else for(n=0;n<this.szFieldsA.length;n++){x=this.objTheme.dbRecords[b][this.objTheme.nFieldIndexA[n]];x=this.valueMap?this.valueMap[String(x)]||x:x;this.__fExact?(x=this.getStringValueIndex(String(x)),
this.exactCountA[x-1]=(this.exactCountA[x-1]||0)+1):x=this.__fScanValue?ra(x)*(this.szWeightsA[n]||1):parseFloat(x)*(this.szWeightsA[n]||1);if(isNaN(x))if(this.fUndefinedValuePossible)x=0;else{F=!0;continue}x!==0||this.fNullIsValue?x<0&&!this.fNegativeValuePossible?F=!0:u[n]=x:F=!0}n=this.szField100A?Array(this.szField100A.length).fill(null):[];if(this.szField100A&&this.szField100A.length)if(this.szField100A[0]==="$item$")n[0]=1;else if(this.szField100A[0]==="$index$")n[0]=b+1;else{for(var v=0;v<
this.szField100A.length;v++){var E=ra(this.objTheme.dbRecords[b][this.objTheme.nField100IndexA[v]]);if(!C(E,!1,!1,!1)){F=!0;break}n[v]=E}if(n.length>0)for(v=n[n.length-1];n.length<this.szFieldsA.length;)n.push(v)}v=this.szSizeField&&this.szSizeField!=="$item$"?ra(this.objTheme.dbRecords[b][this.objTheme.nSizeFieldIndex]):1;C(v,!1,this.fNegativeValuePossible,this.fNullIsValue)||(F=!0);C=this.szAlphaField?ra(this.objTheme.dbRecords[b][this.objTheme.nAlphaFieldIndex]):null;E=this.szTitleField?this.objTheme.dbRecords[b][this.objTheme.nTitleFieldIndex]:
null;const R=this.szColorField?this.szColorField==="$index$"?b+1:V(this.objTheme.dbRecords[b][this.objTheme.nColorFieldIndex]):null,ca=this.szTimeField?this.szTimeField==="$index$"?b+1:V(this.objTheme.dbRecords[b][this.objTheme.nTimeFieldIndex]).replace(/ - /g," "):null;var M=this.szXField?ra(this.objTheme.dbRecords[b][this.objTheme.nXFieldIndex]):null;const aa=this.szYField?ra(this.objTheme.dbRecords[b][this.objTheme.nYFieldIndex]):null,wa=this.szValueField?this.objTheme.dbRecords[b][this.objTheme.nValueFieldIndex]:
null;if(this.__fAggregate&&this.nGridWidthMap){g=this.szFlag.match(/\bRECT\b/);var G=this.dX||this.dY;if(g)f=new point(Math.round((f.x+(G?this.dX:0))/this.nGridWidthMap)*this.nGridWidthMap-(G?this.dX:0),Math.round((f.y+(G?this.dY:0))/this.nGridWidthMap)*this.nGridWidthMap-(G?this.dY:0));else{if(this.szFlag.match(/PLOTY/))g=Math.round(f.y/this.nGridWidthMap),G=g%2?this.nHexaHalf:0,g=new point(Math.round((f.x+G)/this.nHexaWidth)*this.nHexaWidth-G,g*this.nGridWidthMap);else{g=Math.round(f.x/this.nGridWidthMap);
var I=g%2?this.nHexaHalf:0;g=new point(g*this.nGridWidthMap,Math.round((f.y+I)/this.nHexaWidth)*this.nHexaWidth-I)}if(Math.abs(g.x-f.x)>this.nHexa4th){G=[];var ea=[];I=I===0?this.nHexaHalf:0;g.x>f.x?(G[0]=new point(g.x-this.nGridWidthMap,g.y-this.nHexaHalf),G[1]=new point(g.x-this.nGridWidthMap,g.y+this.nHexaHalf)):(G[0]=new point(g.x+this.nGridWidthMap,g.y-this.nHexaHalf),G[1]=new point(g.x+this.nGridWidthMap,g.y+this.nHexaHalf));ea[0]=Math.sqrt(Math.pow(G[0].x-f.x,2)+Math.pow(G[0].y-f.y,2));ea[1]=
Math.sqrt(Math.pow(G[1].x-f.x,2)+Math.pow(G[1].y-f.y,2));ea[3]=Math.sqrt(Math.pow(g.x-f.x,2)+Math.pow(g.y-f.y,2));ea[0]<ea[3]?g=new point(Math.round(G[0].x/this.nGridWidthMap)*this.nGridWidthMap,Math.round((G[0].y+I)/this.nHexaWidth)*this.nHexaWidth-I):ea[1]<ea[3]&&(g=new point(Math.round(G[1].x/this.nGridWidthMap)*this.nGridWidthMap,Math.round((G[1].y+I)/this.nHexaWidth)*this.nHexaWidth-I))}f=g}}this.__fAggregate&&this.nGridWidthMap&&l&&!this.szFlag.match(/\bORIGIN\b/)&&(this.szFlag.match(/\bRECT\b/)?
l=this.dX||this.dY?new point(Math.round((l.x+this.dX)/this.nGridWidthMap)*this.nGridWidthMap-this.dX,Math.round((l.y+this.dY)/this.nGridWidthMap)*this.nGridWidthMap-this.dY):new point(Math.round(l.x/this.nGridWidthMap)*this.nGridWidthMap,Math.round(l.y/this.nGridWidthMap)*this.nGridWidthMap):(this.szFlag.match(/PLOTY/)?(g=Math.round(l.y/this.nGridWidthMap),G=g%2?this.nHexaHalf:0,g=new point(Math.round((l.x+G)/this.nHexaWidth)*this.nHexaWidth-G,g*this.nGridWidthMap)):(g=Math.round(l.x/this.nGridWidthMap),
I=g%2?this.nHexaHalf:0,g=new point(g*this.nGridWidthMap,Math.round((l.y+I)/this.nHexaWidth)*this.nHexaWidth-I)),Math.abs(g.x-l.x)>this.nHexa4th&&(G=[],ea=[],I=I===0?this.nHexaHalf:0,g.x>l.x?(G[0]=new point(g.x-this.nGridWidthMap,g.y-this.nHexaHalf),G[1]=new point(g.x-this.nGridWidthMap,g.y+this.nHexaHalf)):(G[0]=new point(g.x+this.nGridWidthMap,g.y-this.nHexaHalf),G[1]=new point(g.x+this.nGridWidthMap,g.y+this.nHexaHalf)),ea[0]=Math.sqrt(Math.pow(G[0].x-l.x,2)+Math.pow(G[0].y-l.y,2)),ea[1]=Math.sqrt(Math.pow(G[1].x-
l.x,2)+Math.pow(G[1].y-l.y,2)),ea[3]=Math.sqrt(Math.pow(g.x-l.x,2)+Math.pow(g.y-l.y,2)),ea[0]<ea[3]?g=new point(Math.round(G[0].x/this.nGridWidthMap)*this.nGridWidthMap,Math.round((G[0].y+I)/this.nHexaWidth)*this.nHexaWidth-I):ea[1]<ea[3]&&(g=new point(Math.round(G[1].x/this.nGridWidthMap)*this.nGridWidthMap,Math.round((G[1].y+I)/this.nHexaWidth)*this.nHexaWidth-I))),l=g),this.themeNodesPosA[h]=l);h=m;this.szAggregationField?(g=V(this.objTheme.dbRecords[b][this.objTheme.nAggregationFieldIndex]),m=
d+"::"+g,this.szTitleField=="$aggregation$"&&(E=g)):(m=d+"::"+String(f.x)+","+String(f.y)+(this.__fMultiParts?","+String(x):""),this.themeNodesPosA[m]=f);l&&this.szFlag.match(/VECTOR/)&&(m+="&"+String(l.x)+","+String(l.y),this.themeNodesPosA[m]=l);if(this.__fAggregate)if(M=this.itemA[m],!M||this.__fLast){if(!F){this.aggregationCount++;F=0;if(this.__fMultiParts)F=v;else if(this.__fExact)if(M=u[0]-1,isNaN(M))continue;else{u=this.nEmptyValuesA.slice(0);F=u[M]=v;var pa=this.nEmptyValuesA.slice(0);pa[M]=
1}else for(M=0;M<this.szFieldsA.length;M++)F=Math.max(F,u[M]||0);this.itemA[m]={nOrigValuesA:[],nValuesA:u,nValue100A:n,nValueSum:0,nCount:1,nCountA:pa,szTitle:E,szSelectionId:String(h),szSelectionId2:String(r),nSize:Math.abs(v||(this.objTheme.nSizeFieldIndex?0:F)),nAlpha:C||1,szColor:R,szTime:ca,szValue:wa,dbIndexA:[b],ptPos:f,ptPos2:l,ptPosA:[a]};this.nCount++}}else{if(!F&&!this.__fFirst){m=0;if(this.__fMultiParts)m=v;else if(this.__fExact)if(m=u[0]-1,isNaN(m))continue;else M.nValuesA[m]=this.__fMax?
Math.max(M.nValuesA[m]||0,v):(M.nValuesA[m]||0)+v,M.nCountA[m]=(M.nCountA[m]||0)+1,m=v;else for(f=this.szFieldsA.length,l=0;l<f;l++)F=u[l]||0,M.nValuesA[l]=this.__fMax?Math.max(M.nValuesA[l],F):M.nValuesA[l]+F,M.nValue100A[l]=this.__fMax?Math.max(M.nValue100A[l],n[l]):M.nValue100A[l]+n[l],m=Math.max(m,F);this.__fMax?(M.nSize=Math.max(M.nSize,v||(this.objTheme.nSizeFieldIndex?0:m)),M.nAlpha=Math.max(M.nAlpha,C||1),M.ptPosA=[a],M.szTitle=E,M.dbIndexA.push(b)):(M.nSize+=Math.abs(v||(this.objTheme.nSizeFieldIndex?
0:m)),M.nAlpha+=C||1,M.ptPosA.push(a),M.nCount++,M.dbIndexA.push(b),E&&E===M.szTitle||(M.szTitle=this.szAggregation+" of "+M.nCount+" items"))}}else this.itemA[m]&&(m+="*"+Math.random()),this.aggregationCount++,this.itemA[m]={nOrigValuesA:[],nValuesA:u,nValue100A:n,nValueSum:0},this.itemA[m].szSelectionId=String(d+"::"+h),this.itemA[m].szSelectionId2=String(d+"::"+r),this.itemA[m].nSize=v||0,this.itemA[m].ptPos=f,this.itemA[m].ptPos2=l,this.itemA[m].dbIndexA=[b],this.itemA[m].nX=M,this.itemA[m].nY=
aa,this.itemA[m].szColor=R,this.itemA[m].szTime=ca,this.itemA[m].szValue=wa,this.itemA[m].szTitle=E,this.nCount++}if(this.objTheme.nField100IndexA.length>0)if(this.fField100=!0,this.szFlag.match(/DIFFERENCE/)&&this.itemA[e]&&this.itemA[e].nValuesA&&this.itemA[e].nValuesA.length==1&&!this.szFlag.match(/RELATIVE/))for(e in this.itemA)for(n=0;n<this.itemA[e].nValuesA.length;n++)this.itemA[e].nValuesA[n]-=this.itemA[e].nValue100A[n];else if(this.szFlag.match(/FRACTION/))for(e in this.itemA)for(n=0;n<
this.itemA[e].nValuesA.length;n++)this.itemA[e].nValuesA[n]=this.itemA[e].nValuesA[n]/this.itemA[e].nValue100A[n]*(this.nFractionScale||1);else if(this.szFlag.match(/PRODUCT/))for(e in this.itemA)for(n=0;n<this.itemA[e].nValuesA.length;n++)this.itemA[e].nValuesA[n]*=this.itemA[e].nValue100A[n];else if(this.szFlag.match(/CALCVAL/))for(e in this.itemA)for(n=0;n<this.itemA[e].nValuesA.length;n++)this.itemA[e].nValuesA[n]=Math.round(this.itemA[e].nValuesA[n]*this.itemA[e].nValue100A[n]/100);else if(this.szFlag.match(/PERMILLE/))for(e in this.itemA)for(n=
0;n<this.itemA[e].nValuesA.length;n++)this.itemA[e].nValuesA[n]*=1E3/this.itemA[e].nValue100A[n];else for(e in this.itemA)for(n=0;n<this.itemA[e].nValuesA.length;n++)this.itemA[e].nValue100A[n]>(this.nField100Min||0)?(this.itemA[e].nValuesA[n]*=100/this.itemA[e].nValue100A[n],this.itemA[e].nValuesA[n]>0&&this.szFlag.match(/RELATIVE/)?this.itemA[e].nValuesA[n]-=100:this.itemA[e].nValuesA[n]>0&&this.szFlag.match(/INVERT/)&&(this.itemA[e].nValuesA[n]=100-this.itemA[e].nValuesA[n])):this.itemA[e].nValuesA[n]=
0;else if(this.__fAggregate&&this.szFlag.match(/MEAN/))if(this.__fMultiParts)for(e in this.itemA)this.itemA[e].nSize/=this.itemA[e].nCount;else for(e in this.itemA){if(this.itemA[e].nCountA)for(n=0;n<this.itemA[e].nValuesA.length;n++)this.itemA[e].nValuesA[n]/=this.itemA[e].nCountA[n]||1;else for(n=0;n<this.itemA[e].nValuesA.length;n++)this.itemA[e].nValuesA[n]/=this.itemA[e].nCount;this.szFlag.match(/SIZESUM/)||(this.itemA[e].nSize/=this.itemA[e].nCount)}if(this.szFlag.match(/DIFFERENCE/))for(e in this.itemA){for(u=
0;u<this.itemA[e].nValuesA.length;u++)u<this.itemA[e].nValuesA.length-1?(d=this.itemA[e].nValuesA[u],this.itemA[e].nValuesA[u]=this.itemA[e].nValuesA[u+1]-this.itemA[e].nValuesA[u],this.szFlag.match(/RELATIVE/)&&(this.itemA[e].nValuesA[u]=d>(this.nField100Min||0)?100/d*this.itemA[e].nValuesA[u]:0)):this.szFlag.match(/STACKED/)||(this.itemA[e].nValuesA[u]=0);this.itemA[e].nValuesA.pop()}if(this.szFlag.match(/AUTO100/))if(this.nGridX)for(e in this.itemA){u=0;do{for(c=d=0;c<this.nGridX;c++)d+=this.itemA[e].nValuesA[u+
c]||0;for(c=0;c<this.nGridX;c++)this.itemA[e].nValuesA[u+c]/=d/100;u+=this.nGridX}while(u<this.itemA[e].nValuesA.length)}else for(e in this.itemA){for(u=d=0;u<this.itemA[e].nValuesA.length;u++)d+=this.itemA[e].nValuesA[u]||0;for(u=0;u<this.itemA[e].nValuesA.length;u++)this.itemA[e].nValue100A[u]=d;this.fField100=!0;for(u=0;u<this.itemA[e].nValuesA.length;u++)this.itemA[e].nValuesA[u]/=this.itemA[e].nValue100A[u]/100}if(this.szFlag.match(/RELOCATE/)||this.szAggregationField)for(e in this.itemA)if(this.itemA[e].ptPosA){for(d=
a=m=0;d<this.itemA[e].ptPosA.length;d++)m+=this.itemA[e].ptPosA[d].x,a+=this.itemA[e].ptPosA[d].y;this.itemA[e].ptPos={x:m/this.itemA[e].nCount,y:a/this.itemA[e].nCount}}if(this.szMinAggregation){c=d=0;for(e in this.itemA)c+=this.itemA[e].nCount,d++;c/=d;for(e in this.itemA)this.itemA[e].nCount&&this.itemA[e].nCount<(this.nMinAggregation||Math.sqrt(c)-1)&&delete this.itemA[e]}this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;this.nMinA=[];this.nMaxA=[];if(this.__fExact||this.szSizeField)for(e in this.itemA)isFinite(this.itemA[e].nSize)&&
!isNaN(this.itemA[e].nSize)&&(this.nMin=this.nMinSize=Math.min(this.nMinSize,this.itemA[e].nSize),this.nMax=this.nMaxSize=Math.max(this.nMaxSize,this.itemA[e].nSize),this.nSumSize+=this.itemA[e].nSize);else for(e in this.itemA)for(w=0;w<this.itemA[e].nValuesA.length;w++)isFinite(this.itemA[e].nValuesA[w])&&!isNaN(this.itemA[e].nValuesA[w])&&(this.nMin=Math.min(this.itemA[e].nValuesA[w],this.nMin),this.nMax=Math.max(this.itemA[e].nValuesA[w],this.nMax));for(e in this.itemA)for(w=0;w<this.itemA[e].nValuesA.length;w++)isFinite(this.itemA[e].nValuesA[w])&&
!isNaN(this.itemA[e].nValuesA[w])?(this.nMinA[w]=Math.min(this.itemA[e].nValuesA[w],this.nMinA[w]||Number.MAX_VALUE),this.nMaxA[w]=Math.max(this.itemA[e].nValuesA[w],this.nMaxA[w]||-Number.MAX_VALUE),this.nSumA[w]+=this.itemA[e].nValuesA[w]):(this.nMinA[w]=this.nMinA[w]||Number.MAX_VALUE,this.nMaxA[w]=this.nMaxA[w]||-Number.MAX_VALUE);if(this.szAlphaField)for(e in this.itemA)isFinite(this.itemA[e].nAlpha)&&!isNaN(this.itemA[e].nAlpha)&&(this.nMinAlpha=Math.min(this.nMinAlpha,this.itemA[e].nAlpha),
this.nMaxAlpha=Math.max(this.nMaxAlpha,this.itemA[e].nAlpha),this.nSumAlpha+=this.itemA[e].nAlpha);if(this.szSizeField)for(e in this.itemA)isFinite(this.itemA[e].nSize)&&!isNaN(this.itemA[e].nSize)&&(this.nMinSize=Math.min(this.nMinSize,this.itemA[e].nSize),this.nMaxSize=Math.max(this.nMaxSize,this.itemA[e].nSize),this.nSumSize+=this.itemA[e].nSize);if(this.szXField)for(e in this.itemA)isNaN(this.itemA[e].nX)||(this.nMinX=Math.min(this.nMinX,this.itemA[e].nX),this.nMaxX=Math.max(this.nMaxX,this.itemA[e].nX),
this.nSumX+=this.itemA[e].nX);if(this.szYField)for(e in this.itemA)isNaN(this.itemA[e].nY)||(this.nMinY=Math.min(this.nMinY,this.itemA[e].nY),this.nMaxY=Math.max(this.nMaxY,this.itemA[e].nY),this.nSumY+=this.itemA[e].nY);if(this.szValueField&&this.szSizeField==this.szValueField)for(e in this.itemA)this.itemA[e].szValue=String(this.itemA[e].nSize);this.oldSizefield&&(this.szSizeField=this.oldSizefield,this.oldSizeField=null);_LOG("loadAndAggregateValuesOfTheme === E N D");return this.fAnalyze=!0};
A.prototype.loadTableFromMap=function(){var d,c,e={table:{fields:0,records:0},fields:[],records:[]},b=map.SVGDocument.getElementById(this.szThemesA[0]);if(b==null){var n=map.Tiles.getTileNodes(this.szThemesA[0]);n&&(b=n[0])}if(!b)return this.szThemes="",null;b=b.getAttributeNS(szMapNs,"info");if(b==null||b==="")return this.szThemes="",null;b=b.split("|");b.push("FeatureId");for(d in b)e.fields.push({id:b[d]}),e.table.fields++;b=[];var m=[];for(d=0;d<this.szThemesA.length;d++){this.objTheme=this.objThemesA[this.szThemesA[d]];
n=map.Layer.getLayerObj(this.szThemesA[d]);if(n==null)return alert("MapTheme error: no layer like '"+this.szThemesA[d]+"'"),!1;if(n.szFlag.match(/tiled/)){m[0]=map.Scale.canvasNode;m.length=1;this.fDataIncomplete=!map.Tiles.allTilesLoaded();break}else m[m.length]=map.SVGDocument.getElementById(n.szName)}n=!0;for(c=0;c<m.length;c++){var u=m[c].getElementsByTagName("path");var z=m[c].getElementsByTagName("use"),x=m[c].getElementsByTagName("circle");for(d=0;d<u.length;d++)b[b.length]=u.item(d);for(d=
0;d<z.length;d++)b[b.length]=z.item(d);for(d=0;d<x.length;d++)b[b.length]=x.item(d)}if(b.length===0)for(n=!1,c=0;c<m.length;c++)for(u=m[c].getElementsByTagName("g"),d=0;d<u.length;d++)b[b.length]=u.item(d);for(d=0;d<b.length;d++)if(b[d].nodeType==1&&b[d].hasAttributeNS(szMapNs,"info")){u=n?b[d].parentNode.getAttributeNS(null,"id"):b[d].getAttributeNS(null,"id");m=-1;if(u&&u.length!==0)for(z=map.Tiles.getMasterId(u).split(":")[0],c=0;c<this.szThemesA.length;c++)z==this.szThemesA[c]&&(m=c);c=map.Tiles.getMasterId(u);
!this.itemA[c]&&m>=0&&(m=b[d].getAttributeNS(szMapNs,"info").split("|"),m.push(c.split("::")[1]),e.records.push(m),e.table.records++,this.itemA[c]=1)}this.itemA=[];return e};A.prototype.aggregateValues=function(){if(!(this.__fAggregateOnLoad||!this.szFlag.match(/AGGREGATE/)&&!this.szFlag.match(/GROUP/)||this.szAggregationUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nAggregationUpper||this.szAggregationLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nAggregationLower)){var d=[],
c=[],e=[],b=[],n=[],m=null,u=0;this.nTopicsSkipedByZeroExclusion=0;this.nGridWidthPx&&(this.nGridWidth=m=map.Scale.getDistanceInMeter(1E3,1E3,1E3+map.Scale.normalX(this.nGridWidthPx),1E3));this.nGridMatrix&&(m=map.Zoom.getBox(),m=map.Scale.getDistanceInMeter(1E3,1E3,1E3+m.width,1E3),this.nGridWidth=m/(this.nGridMatrix||20)/map.Scale.nZoomScale);var z=this.nGridWidth?Math.round(map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/20)*map.Scale.nZoomScale*20:0;m=function(ea){for(var pa in ea)return pa}(this.itemA);
var x="undefined",w=this.itemA[m].szSelectionId.split("::")[0],O=null,a=z*1.15,f=z*1.15/2,g=z/4;if(this.szAggregationField)for(var l in this.itemA){x="undefined";m=m||l;x=this.itemA[l].szAggregation;d[x]||(d[x]=[],b[x]=new point(0,0),c[x]=0,e[x]=0,u++);d[x][l]=this.itemA[l];d[x][l].nSize=this.itemA[l].nSize||1;d[x][l].szTitle=this.itemA[l].szTitle||x;e[x]+=d[x][l].nSize;var h=this.getNodePosition(this.itemA[l].szSelectionId);h&&(b[x].x+=h.x,b[x].y+=h.y,c[x]++)}else if(this.nGridWidth)for(l in this.itemA)if(h=
this.getNodePosition(this.itemA[l].szSelectionId)){if(this.szFlag.match(/\bRECT\b/))this.szFlag.match(/FIXGRID/)?(O=map.Scale.mapCenter.x*map.Scale.nZoomScale,x=map.Scale.mapCenter.y*map.Scale.nZoomScale,O=new point(Math.round((h.x+O)/z)*z-O,Math.round((h.y+x)/z)*z-x)):O=new point(Math.round(h.x/z)*z,Math.round(h.y/z)*z);else{if(this.szFlag.match(/PLOTY/))O=Math.round(h.y/z),x=O%2?f:0,O=new point(Math.round((h.x+x)/a)*a-x,O*z);else{O=Math.round(h.x/z);var r=O%2?f:0;O=new point(O*z,Math.round((h.y+
r)/a)*a-r)}if(Math.abs(G-h.x)>g){x=[];var C=[];r=r===0?f:0;G>h.x?(x[0]=new point(O.x-z,O.y-f),x[1]=new point(O.x-z,O.y+f)):(x[0]=new point(O.x+z,O.y-f),x[1]=new point(O.x+z,O.y+f));C[0]=Math.sqrt(Math.pow(x[0].x-h.x,2)+Math.pow(x[0].y-h.y,2));C[1]=Math.sqrt(Math.pow(x[1].x-h.x,2)+Math.pow(x[1].y-h.y,2));C[3]=Math.sqrt(Math.pow(O.x-h.x,2)+Math.pow(O.y-h.y,2));C[0]<C[3]?O=new point(Math.round(x[0].x/z)*z,Math.round((x[0].y+r)/a)*a-r):C[1]<C[3]&&(O=new point(Math.round(x[1].x/z)*z,Math.round((x[1].y+
r)/a)*a-r))}}x=w+"::"+String(O.x)+","+String(O.y);this.themeNodesPosA[l]=O;this.themeNodesPosA[x]=O;d[x]||(d[x]=[],b[x]=new point(0,0),c[x]=0,u++);d[x][l]=this.itemA[l];d[x][l].nSize=this.itemA[l].nSize||1;b[x].x+=h.x;b[x].y+=h.y;c[x]++}else d[x]||(d[x]=[],b[x]=new point(0,0),c[x]=0,this.fDataIncomplete=map.fTilesLoaded,u++),d[x][l]=this.itemA[l],d[x][l].nSize=this.itemA[l].nSize||1,c[x]++,this.fDataIncomplete=!0;else for(l in this.itemA)(h=this.getNodePosition(this.itemA[l].szSelectionId))?(x=this.itemA[l].szSelectionId,
d[x]||(d[x]=[],b[x]=new point(0,0),c[x]=0,u++),d[x][l]=this.itemA[l],d[x][l].nSize=this.itemA[l].nSize||1,b[x].x+=h.x,b[x].y+=h.y,c[x]++):(d[x]||(d[x]=[],b[x]=new point(0,0),c[x]=0,this.fDataIncomplete=map.fTilesLoaded,u++),d[x][l]=this.itemA[l],d[x][l].nSize=this.itemA[l].nSize||1,c[x]++,this.fDataIncomplete=!0);if(this.szFlag.match(/GROUP/)){this.itemA=[];for(var F in d){u=d[F];this.indexA=[];for(l in u)this.indexA.push(l);c=[];for(var v=0;v<this.indexA.length;v++)c.push({a:this.indexA[v],y:u[this.indexA[v]].nValuesA[0]});
this.szFlag.match(/\bUP\b/)?c.sort(this.sortDownChartObjectsCompare):c.sort(this.sortUpChartObjectsCompare);for(v in c)u[c[v].a].szSelectionId=F,this.itemA[F+"*"+Math.random()]=u[c[v].a]}}else{if(this.szFlag.match(/CATEGORICAL/))for(F in this.szSizeField||(this.szSizeField="$aggregation$"),d){u=d[F];n[F]=0;r=[];for(l in u)n[F]++,r[u[l].nValuesA[0]]||(r[u[l].nValuesA[0]]={itemA:[]}),r[u[l].nValuesA[0]].itemA[l]=u[l];d[F]=[];for(v in r)for(l in w=r[v].itemA,a=null,w)if(a==null)a=d[F][l]=w[l],a.nCount=
1,a.dbIndexA=a.dbIndexA||[],a.nSize=a.nSize||1,a.nAlpha=a.nAlpha||1;else{a.nCount+=1;for(v=0;v<u[l].nValue100A.length;v++)a.nValue100A[v]+=u[l].nValue100A[v]||0;a.nSize+=w[l].nSize||1;a.nAlpha+=w[l].nAlpha||1;a.szValue=String(a.nSize);z&&!this.szAggregationField&&(!a.szTitle||a.nCount>3)&&(a.szTitle="("+a.nCount+")");a.dbIndexA.push(w[l].dbIndex)}}else for(F in d){u=d[F];if(!this.szFlag.match(/SUM/)&&!this.szFlag.match(/ZEROISVALUE/)){z=[];r=0;for(l in u)if(r++,u[l])for(v=0;v<u[l].nValuesA.length;v++)if(u[l].nOrigValuesA[v]===
0){z[l]=l;break}if(r>1)for(l in z)delete u[l],this.nTopicsSkipedByZeroExclusion++}d[F]=[];a=null;for(l in u)if(a==null)a=d[F][l]=u[l],a.nCount=1,a.dbIndexA=a.dbIndexA||[],a.nSize=a.nSize||1,a.nAlpha=a.nAlpha||1;else{for(v=0;v<u[l].nValuesA.length;v++)a.nValuesA[v]+=u[l].nValuesA[v]||0,a.nOrigValuesA[v]+=u[l].nOrigValuesA[v]||0;a.nCount+=1;for(v=0;v<u[l].nValue100A.length;v++)a.nValue100A[v]+=u[l].nValue100A[v]||0;a.nSize+=u[l].nSize||1;a.nAlpha+=u[l].nAlpha||1;a.szValue=String(a.nSize);a.szTitle=
"("+this.formatValue(a.nCount,0)+")";a.dbIndexA.push(u[l].dbIndex)}}if(this.szAggregationField||this.szFlag.match(/RELOCATE/)){var E=new point(0,0),M=0;v=1E6;z=0;for(F in d)v=Math.min(v,b[F].x/c[F]),M=Math.max(M,b[F].y/c[F]),E.x+=b[F].x*(e[F]||1),E.y+=b[F].y*(e[F]||1),z+=c[F]*(e[F]||1);E.x/=z;E.y/=z;new point(v,E.y);M=new point(E.x,M)}this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;this.nMinSize=Number.MAX_VALUE;this.nSumSize=this.nMaxSize=0;this.nMinAlpha=Number.MAX_VALUE;this.nSumAlpha=this.nMaxAlpha=
0;this.szFlag.match(/CATEGORICAL/)&&(this.nMinA=[],this.nMaxA=[],this.nSumA=[],this.nOrigMinA=[],this.nOrigMaxA=[],this.nOrigSumA=[],this.nMedianA=[],this.nMeanA=[],this.nCountA=[]);e="[";z=this.nStringToValue-1;for(v=0;v<z;v++)e+="0,";e+="]";this.itemA=[];z=0;r=Math.max(this.szRangesA?this.szRangesA.length:0,this.szExactA?this.szExactA.length:0)-(this.szFlag.match(/CATEGORICAL/)?0:1);w=this.szFlag.match(/CATEGORICAL/)&&(this.szFlag.match(/PIE/)||this.szFlag.match(/BAR/)||this.szFlag.match(/SEQUENCE/)||
this.szFlag.match(/PLOT/)||this.szFlag.match(/DOMINANT/)||this.szFlag.match(/\bUSER\b/)||this.szFlag.match(/WAFFLE/));for(F in d)if(z++,F!="undefined")if(u=d[F],w){for(l in u){var G=l;break}this.itemA[G]={};v=[];eval("nValuesA = "+e+";");this.itemA[G].szSelectionId=G;this.itemA[G].szTitle=u[G].szTitle;if(this.szAggregationField||this.szFlag.match(/RELOCATE/))this.szFlag.match(/ALIGN/)?(this.itemA[G].szSelectionId=m,this.szFlag.match(/\bUP\b/)?this.themeNodesPosA[G]=new point(M.x,M.y):this.themeNodesPosA[G]=
new point(E.x,E.y)):this.themeNodesPosA[G]=new point(b[F].x/c[F],b[F].y/c[F]);this.itemA[G].dbIndexA=[];f=a=0;for(l in u){v[u[l].nValuesA[0]-1]=u[l].nSize/(this.szFlag.match(/SUM/)?1:u[l].nCount);a+=u[l].nSize;f+=u[l].nCount;this.itemA[G].dbIndexA.push(u[l].dbIndex);for(var I in u[l].dbIndexA)this.itemA[G].dbIndexA.push(u[l].dbIndexA[I]);delete this.itemA[G].dbIndex}this.itemA[G].nValuesA=this.itemA[G].nOrigValuesA=v;this.itemA[G].nMinA=[];this.itemA[G].nMaxA=[];this.itemA[G].nSize=a/(this.szFlag.match(/SUM/)?
1:f);this.itemA[G].nCount=f;this.itemA[G].nAlpha=u[l].nAlpha;this.itemA[G].szTitle=this.nGridWidth&&!this.szAggregationField&&n[F]>1?__formatValue(n[F],0)+" item(s) aggregated":this.itemA[G].szTitle||F;this.itemA[G].szValue=this.itemA[G].szTitle;this.itemA[G].szLabel=this.itemA[G].szTitle;this.nMin=this.nMinSize=Math.min(this.nMinSize,this.itemA[G].nSize);this.nMax=this.nMaxSize=Math.max(this.nMaxSize,this.itemA[G].nSize);this.nSumSize+=a/(this.szFlag.match(/SUM/)?1:f);this.nMinAlpha=Math.min(this.nMinAlpha,
this.itemA[G].nAlpha);this.nMaxAlpha=Math.max(this.nMaxAlpha,this.itemA[G].nAlpha);this.nSumAlpha+=this.itemA[G].nAlpha;if(this.szFlag.match(/AUTO100/)){for(v=f=0;v<this.itemA[G].nValuesA.length;v++)f+=this.itemA[G].nValuesA[v]||0;for(v=0;v<this.itemA[G].nValuesA.length;v++)this.itemA[v].nValue100A[0]=f;this.fField100=!0;for(v=0;v<this.itemA[G].nValuesA.length;v++)this.itemA[G].nValuesA[v]=this.itemA[G].nOrigValuesA[v]/this.itemA[G].nValue100[v]*100}if(this.szFlag.match(/CATEGORICAL/)&&(this.szFlag.match(/CATEGORICAL/)||
!this.nNormalSizeValue)){if(!this.nMinA.length)for(v=0;v<this.itemA[G].nValuesA.length;v++)this.nMinA[v]=null,this.nMaxA[v]=null,this.nSumA[v]=0,this.nOrigMinA[v]=null,this.nOrigMaxA[v]=null,this.nOrigSumA[v]=0,this.nMedianA[v]=0,this.nMeanA[v]=0,this.nCountA[v]=0;for(v=0;v<this.itemA[G].nValuesA.length;v++)this.nMinA[v]=Math.min(this.nMinA[v]||this.itemA[G].nValuesA[v],this.itemA[G].nValuesA[v]),this.nMaxA[v]=Math.max(this.nMaxA[v]||this.itemA[G].nValuesA[v],this.itemA[G].nValuesA[v]),this.nSumA[v]+=
this.itemA[G].nValuesA[v],this.nOrigMinA[v]=Math.min(this.nOrigMinA[v]||this.itemA[G].nOrigValuesA[v],this.itemA[G].nOrigValuesA[v]),this.nOrigMaxA[v]=Math.max(this.nOrigMaxA[v]||this.itemA[G].nOrigValuesA[v],this.itemA[G].nOrigValuesA[v]),this.nOrigSumA[v]+=this.itemA[G].nOrigValuesA[v],this.itemA[G].nValuesA[v]&&this.nCountA[v]++}this.nCount=z*r}else for(l in u)if(u[l]){a=l;this.szAggregationField||(a=F,this.itemA[a]&&(a=a.split("*")[0]+"*"+Math.random()));this.itemA[a]=u[l];u[l].szValue=u[l].szValue||
1;this.nMinSize=Math.min(this.nMinSize,this.itemA[a].nSize);this.nMaxSize=Math.max(this.nMaxSize,this.itemA[a].nSize);this.nSumSize+=this.itemA[a].nSize;this.nMinAlpha=Math.min(this.nMinAlpha,this.itemA[a].nAlpha);this.nMaxAlpha=Math.max(this.nMaxAlpha,this.itemA[a].nAlpha);this.nSumAlpha+=this.itemA[a].nAlpha;this.szFlag.match(/SUM/)||(f=this.szFlag.match(/SUM/)?1:u[l].nCount,this.itemA[a].nSize/=f,this.itemA[a].szValue/=f,this.itemA[a].nValue100A[0]/=f);if(this.nGridWidth||this.szAggregationField)for(f=
this.szFlag.match(/SUM/)||this.szFlag.match(/CATEGORICAL/)?1:u[l].nCount,this.itemA[a].szSelectionId=l,v=0;v<this.itemA[a].nValuesA.length;v++)this.itemA[a].nValuesA[v]/=f,this.itemA[a].nOrigValuesA[v]/=f,this.itemA[a].nValue100A[v]&&(this.itemA[a].nValuesA[v]=this.itemA[a].nOrigValuesA[v]/this.itemA[a].nValue100A[v],this.szFlag.match(/FRACTION/)||(this.itemA[a].nValuesA[v]*=this.szFlag.match(/PERMILLE/)?1E3:100),this.szFlag.match(/INVERT/)&&(this.itemA[a].nValuesA[v]=100-this.itemA[a].nValuesA[v])),
this.nMin=Math.min(this.itemA[a].nValuesA[v]||Number.MAX_VALUE,this.nMin||Number.MAX_VALUE),this.nMax=Math.max(this.itemA[a].nValuesA[v]||-Number.MAX_VALUE,this.nMax||-Number.MAX_VALUE);else this.nMin=Math.min(this.itemA[a].nSize,this.nMin||Number.MAX_VALUE),this.nMax=Math.max(this.itemA[a].nSize,this.nMax||-Number.MAX_VALUE);if(this.szFlag.match(/AUTO100/)){for(v=f=0;v<this.itemA[a].nValuesA.length;v++)f+=this.itemA[a].nValuesA[v]||0;for(v=0;v<this.itemA[a].nValuesA.length;v++)this.itemA[a].nValue100A[v]=
f;this.fField100=!0;for(v=0;v<this.itemA[a].nValuesA.length;v++)this.itemA[a].nValuesA[v]=this.itemA[a].nOrigValuesA[v]/this.itemA[a].nValue100A[v]*100}if(this.szAggregationField||this.szFlag.match(/RELOCATE/))this.szFlag.match(/ALIGN/)?this.szFlag.match(/\bUP\b/)?this.themeNodesPosA[a]=new point(M.x,M.y):this.themeNodesPosA[a]=new point(E.x,E.y):(this.themeNodesPosA[l]=new point(b[F].x/c[F],b[F].y/c[F]),this.themeNodesPosA[a]=new point(b[F].x/c[F],b[F].y/c[F]))}if(this.szMinAggregation){d=f=0;for(l in this.itemA)d+=
this.itemA[l].nCount,f++;d/=f;for(l in this.itemA)this.itemA[l].nCount&&this.itemA[l].nCount<(this.nMinAggregation||d/2)&&delete this.itemA[l];this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;for(l in this.itemA)for(v=0;v<this.itemA[l].nValuesA.length;v++)this.nMin=Math.min(this.itemA[l].nValuesA[v],this.nMin),this.nMax=Math.max(this.itemA[l].nValuesA[v],this.nMax)}this.fSorted=!0}}};A.prototype.distributeValues=function(){if(this.nCount===0)return this.szFlag.match(/CATEGORICAL/)&&displayMessage("theme: no matching values !",
3E3),!1;if(this.szFlag.match(/OUTLIER/)){var d=this.szFieldsA.length;this.getMeanMedianQuantile();if(this.szFlag.match(/PLOT/)){for(var c in this.itemA){for(var e=[],b=0;b<d;b++)this.itemA[c].nValuesA[b]&&e.push(this.itemA[c].nValuesA[b]);this.nDeviationA[c]=this.parent.getDeviationOfArray(e)}for(c in this.itemA)for(b=0;b<d;b++)Math.abs(this.itemA[c].nValuesA[b]-this.itemA[c].nValuesA[b-1])>this.nDeviationA[c]*(this.nOutlierScale||2)&&this.szFlag.match(/NOOUTLIER/)&&(this.itemA[c].nValuesA[b]=this.itemA[c].nValuesA[b-
1])}else{for(b=0;b<d;b++){e=[];for(c in this.itemA)this.itemA[c].nValuesA[b]&&e.push(this.itemA[c].nValuesA[b]);this.nDeviationA[b]=this.parent.getDeviationOfArray(e)}for(b=0;b<d;b++)for(c in this.itemA)Math.abs(this.itemA[c].nValuesA[b]-this.nMeanA[b])>this.nDeviationA[b]*(this.nOutlierScale||3)?this.szFlag.match(/NOOUTLIER/)&&delete this.itemA[c]:this.szFlag.match(/NOOUTLIER/)||delete this.itemA[c]}this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;for(c in this.itemA)for(var n=0;n<this.itemA[c].nValuesA.length;n++)isNaN(this.itemA[c].nValuesA[n])||
(this.nMin=Math.min(this.itemA[c].nValuesA[n],this.nMin),this.nMax=Math.max(this.itemA[c].nValuesA[n],this.nMax))}(this.szFlag.match(/AGGREGATE/)||this.szFlag.match(/GROUP/))&&this.aggregateValues();this.szSizeField=="$aggregation$"&&(this.szSizeField=null);if(this.szFlag.match(/CATEGORICAL/)&&(!this.szExactA||!this.szExactA.length)&&(this.szExactA=this.szExactA||[],this.nStringToValueA))for(c in this.nStringToValueA)this.szExactA.push(this.nStringToValueA[c]);!this.szFlag.match(/CATEGORICAL/)||this.szLabelA&&
this.szLabelA.length||!this.szValuesA||(this.szLabelA=this.szValuesA);if(this.szColorField)if(this.colorFieldA=[],this.colorClassA=[],this.colorClassUsedA=[],this.szColorValuesA)for(b in this.szColorValuesA)this.colorFieldA[this.szColorValuesA[b]]=!0;else if(this.szValuesA)for(b in this.szValuesA)this.colorFieldA[this.szValuesA[b]]=!0;else for(c in this.itemA)this.colorFieldA[this.itemA[c].szColor]=!0;if(this.szSymbolField)if(this.symbolFieldA=[],this.szSymbolValuesA)for(b in this.szSymbolValuesA)this.symbolFieldA[this.szSymbolValuesA[b]]=
this.szSymbolsA[b];else for(c in this.itemA)this.symbolFieldA[this.itemA[c].szSymbol]=this.szSymbolsA[b];this.origColorScheme||(this.origColorScheme=this.colorScheme=this.defaultColorScheme);if(isNaN(Number(this.origColorScheme[0])))this.colorScheme=this.origColorScheme.slice(0);else{this.szFlag.match(/SEQUENCE/)&&this.szFieldsA.length>this.origColorScheme[0]&&(this.origColorScheme[0]=this.szFieldsA.length);this.szFlag.match(/CATEGORICAL/)&&(this.origColorScheme[0]=this.szExactA.length||1);if(this.szColorField){b=
0;for(c in this.colorFieldA)b++;this.origColorScheme[0]=b}try{this.colorScheme=ColorScheme.createColorScheme(this.origColorScheme[1],this.origColorScheme[2],this.origColorScheme[0],this.origColorScheme[3],this.origColorScheme[4])}catch(z){this.colorScheme=this.defaultColorScheme}if(this.szFlag.match(/CATEGORICAL/)&&this.szFlag.match(/ORDER/)){d=this.colorScheme.slice();e=this.szValuesA?this.szValuesA.slice():this.szLabelA.slice();if(this.szColorField)for(c in e=[],this.colorFieldA)e.push(c),this.getStringValueIndex(c,
"set");if(e.length&&d.length&&e.length==d.length)for(e.sort(),this.colorScheme=[],b=0;b<e.length;b++)this.colorScheme[this.nStringToValueA[e[b]]-1]=d[b]}}if(this.szColorField){b=0;for(c in this.colorFieldA)this.colorClassA[c]=b,this.colorFieldA[c]=this.colorScheme[b++];for(c in this.itemA)this.itemA[c].nClass=this.colorClassA[this.itemA[c].szColor],this.itemA[c].szColor=this.colorFieldA[this.itemA[c].szColor]}if(this.szSymbolField)for(c in this.itemA)this.itemA[c].szSymbol=this.symbolFieldA[this.itemA[c].szSymbol];
try{eval("window.__defineColorScheme = map.HTMLWindow."+this.colorScheme[0]),window.__defineColorScheme(this),eval("window.__defineColorScheme = null")}catch(z){}if(this.colorScheme[0].match(/function||=>/))try{eval("var __defineColorScheme = "+this.colorScheme),__defineColorScheme(this)}catch(z){}try{map.HTMLWindow.ixmaps.htmlgui_colorScheme(this)}catch(z){}if(this.szFlag.match(/DOMINANT/))for(;this.colorScheme.length<this.szFieldsA.length;)this.colorScheme[this.colorScheme.length]="#dddddd";if(this.szFieldsA)if(this.colorScheme.length<
this.szFieldsA.length&&this.nGridX)for(;this.colorScheme.length<this.nGridX;)this.colorScheme[this.colorScheme.length]=this.colorScheme[this.colorScheme.length-1]||"#dddddd";else if(!this.szFlag.match(/\bCLIP\b|\bDIFFERENCE\b/))for(;this.colorScheme.length<this.szFieldsA.length;)this.colorScheme[this.colorScheme.length]=this.colorScheme[this.colorScheme.length-1]||"#dddddd";if(this.szFlag.match(/NORMALIZE/)&&this.nMax){var m=this.nMax-this.nMin;for(c in this.itemA)this.itemA[c].nValuesA[0]=(this.itemA[c].nValuesA[0]-
this.nMin)/m;this.nMin=0;this.nMax=1}if(this.szFlag.match(/HARMONIZE/)&&this.nMax){if(this.nMaxA){this.nRangeA=[];for(n in this.nMaxA)this.nRangeA.push(this.nMaxA[n]-this.nMinA[n]);for(c in this.itemA)for(n in this.itemA[c].nValuesA)this.itemA[c].nValuesA[n]=(this.itemA[c].nValuesA[n]-this.nMinA[n])/this.nRangeA[n];for(n in this.nMaxA)this.nMinA[n]=0,this.nMaxA[n]=1}else{for(c in this.itemA)this.itemA[c].nValuesA[0]/=this.nMax;this.nMin/=this.nMax;this.nMax/=this.nMax}this.nMin=0;this.nMax=1}if(this.szFlag.match(/INVERTSIZE/)&&
this.szSizeField){for(c in this.itemA)this.itemA[c].nSize=this.nMaxSize-this.itemA[c].nSize;this.nNormalSizeValue=this.nNormalSizeValue||this.nMaxSize}this.szFlag.match(/CATEGORICAL/)||this.szFlag.match(/SEQUENCE/)||this.getMeanMedianQuantile();d=this.colorScheme.length;m=this.nMax-this.nMin;e=this.nMin;n=this.nMax;this.nRangeCenterValue==null||isNaN(this.nRangeCenterValue)||(b=Math.max(Math.abs(this.nRangeCenterValue-e),Math.abs(n-this.nRangeCenterValue)),e=this.nRangeCenterValue-b,n=this.nRangeCenterValue+
b,m=n-e);if(this.szFlag.match(/INTEGER/))d>m?d=m:d>m/2?d=Math.floor(m/2):m+=d-m%d;else{var u=1;for(this.szField100&&(u=.01);m>u*1E3;)u*=10;u>1?(e=Math.floor(e/u)*u,n=Math.ceil(n/u)*u):n+=n/1E5;m=n-e}if(this.szFlag.match(/CHART|CHOROPLETH/)&&(isNaN(m)||!isFinite(m)))return _ERROR("ERROR on distributeValues: infinite range !"),displayMessage("ERROR: infinite value range !",3E3),!1;if(this.szColorField)for(c in this.nRangesA=[],b=0,this.colorFieldA)this.nRangesA.push(b++);else this.nRangesA=this.szRangesA||
this.szExactA;if(this.nRangesA&&this.nRangesA.length){u=this.szFlag.match(/CATEGORICAL/)?0:1;this.szFlag.match(/BAR/)&&this.szFlag.match(/SEQUENCE/)&&(u=1);d=this.nRangesA.length-u;if(this.szSymbolsA&&this.szSymbolsA.length)for(;this.szSymbolsA.length<d;)this.szSymbolsA[this.szSymbolsA.length]=this.szSymbolsA[this.szSymbolsA.length-1];if(this.colorScheme&&this.colorScheme.length)for(;this.colorScheme.length<d;)this.colorScheme[this.colorScheme.length]=this.colorScheme[this.colorScheme.length-1]||
"#dddddd";this.partsA=[];for(b=0;b<d;b++)e=Number(this.nRangesA[b]),n=Number(this.nRangesA[b+u])+1E-9,this.partsA[this.partsA.length]={min:e,max:n,color:this.colorScheme[b],nCount:0,nSum:0};if(this.szFlag.match(/CATEGORICAL/)&&this.exactCountA)for(b=0;b<d;b++)this.partsA[b].nCount=this.exactCountA[b];if(this.szFlag.match(/PLOTVAR/)||this.szFlag.match(/DOMINANT/))for(this.getMeanMedianQuantile(),b=0;b<d;b++){e=[];for(c in this.itemA)this.itemA[c].nValuesA[b]&&e.push(this.itemA[c].nValuesA[b]);this.nDeviationA[b]=
this.parent.getDeviationOfArray(e);this.szDominantFilter=this.szDominantFilter||"min";this.nDominantDFilter=this.nDominantDFilter||0;this.szDominantFilter.match(/min/)?this.nFilterA[b]=this.nMinA[b]+(this.nMaxA[b]-this.nMinA[b])/100*this.nDominantDFilter:this.szDominantFilter.match(/max/)?this.nFilterA[b]=this.nMinA[b]+(this.nMaxA[b]-this.nMinA[b])/100*this.nDominantDFilter:this.szDominantFilter.match(/mean/)?this.nFilterA[b]=this.nMeanA[b]+(this.nMaxA[b]-this.nMeanA[b])/100*this.nDominantDFilter:
this.szDominantFilter.match(/median/)&&(this.nFilterA[b]=this.nMedianA[b]+(this.nMaxA[b]-this.nMedianA[b])/100*this.nDominantDFilter)}}else{m/=d;m>u&&(m=Math.floor(m/u)*u);this.nMin==this.nMax&&(d=1);this.partsA=[];for(b=0;b<d;b++)this.partsA[this.partsA.length]={min:e+b*m,max:e+(b+1)*m,color:this.colorScheme[b],nCount:0,nSum:0};this.partsA[this.partsA.length-1].max=n;if(this.szFlag.match(/HEADTAIL/)){u=this.getHeadTail();for(b=0;b<this.partsA.length;b++)this.partsA[b].min=u[b],this.partsA[b].max=
u[b+1]-1E-6;this.partsA[this.partsA.length-1].max=n}if(this.szFlag.match(/QUANTILE/)){this.getMeanMedianQuantile();u=Math.round(this.quantileA[0].length/d);for(b=0;b<this.partsA.length;b++)this.partsA[b].min=this.quantileA[0][b*u],this.partsA[b].max=this.quantileA[0][(b+1)*u];this.partsA[this.partsA.length-1].max=n}if(this.szFlag.match(/LOG/)){e=Math.log(this.nMin?this.nMin:Math.min(.1,this.nMax/10));m=Math.log(this.nMax?this.nMax:.1)-e;m/=d;this.partsA=[];for(b=0;b<d;b++)this.partsA[this.partsA.length]=
{min:Math.exp(e+b*m),max:Math.exp(e+(b+1)*m),color:this.colorScheme[b],nCount:0,nSum:0};this.partsA[this.partsA.length-1].max=this.nMax}else if(this.szFlag.match(/POW2/)){e=Math.pow(this.nMin?this.nMin:1,.5);m=Math.pow(this.nMax?this.nMax:1,.5)-Math.pow(this.nMin?this.nMin:1,.5);m/=d;this.partsA=[];for(b=0;b<d;b++)this.partsA[this.partsA.length]={min:Math.pow(e+b*m,2),max:Math.pow(e+(b+1)*m,2),color:this.colorScheme[b],nCount:0,nSum:0};this.partsA[this.partsA.length-1].max=this.nMax}else if(this.szFlag.match(/POW3/)){e=
Math.pow(this.nMin?this.nMin:1,1/3);m=Math.pow(this.nMax?this.nMax:1,1/3)-Math.pow(this.nMin?this.nMin:1,1/3);m/=d;this.partsA=[];for(b=0;b<d;b++)this.partsA[this.partsA.length]={min:Math.pow(e+b*m,3),max:Math.pow(e+(b+1)*m,3),color:this.colorScheme[b],nCount:0,nSum:0};this.partsA[this.partsA.length-1].max=this.nMax}if(this.szFlag.match(/DOMINANT/)||this.szFlag.match(/OFFSETMEAN/)||this.szFlag.match(/OFFSETMEDIAN/)||this.szFlag.match(/DEVIATION/)||this.szFlag.match(/PLOTVAR/)){this.getMeanMedianQuantile();
for(b=0;b<this.szFieldsA.length;b++){d=[];for(c in this.itemA)this.itemA[c].nValuesA[b]&&d.push(this.itemA[c].nValuesA[b]);this.szFieldsA[b]!="$item$"&&d.sort(this.sortUp);this.nMedianA[b]=d[Math.round(d.length/2)];this.nSum100?this.szFlag.match(/DIFFERENCE/)?this.nMeanA[b]=this.nSumA[b]/this.nCount:(this.nMeanA[b]=this.nOrigSumA[b]/this.nSum100,this.szFlag.match(/FRACTION/)?this.nMeanA[b]*=this.nFractionScale||1:this.szFlag.match(/PERMILLE/)?this.nMeanA[b]*=1E3:(this.nMeanA[b]*=100,this.szFlag.match(/RELATIVE/)?
this.nMeanA[b]-=100:this.szFlag.match(/INVERT/)&&(this.nMeanA[b]=100-this.nMeanA[b]))):this.nMeanA[b]=this.nSumA[b]/this.nCount}for(b=0;b<this.partsA.length;b++)this.szDominantFilter=this.szDominantFilter||"min",this.nDominantDFilter=this.nDominantDFilter||0,this.szDominantFilter.match(/min/)?this.nFilterA[b]=this.nMinA[b]+(this.nMaxA[b]-this.nMinA[b])/100*this.nDominantDFilter:this.szDominantFilter.match(/max/)?this.nFilterA[b]=this.nMinA[b]+(this.nMaxA[b]-this.nMinA[b])/100*this.nDominantDFilter:
this.szDominantFilter.match(/mean/)?this.nFilterA[b]=this.nMeanA[b]+(this.nMaxA[b]-this.nMeanA[b])/100*this.nDominantDFilter:this.szDominantFilter.match(/median/)&&(this.nFilterA[b]=this.nMedianA[b]+(this.nMaxA[b]-this.nMedianA[b])/100*this.nDominantDFilter);if(this.szFlag.match(/DEVIATION/)||this.szFlag.match(/PLOTVAR/))for(b=0;b<this.szFieldsA.length;b++){e=[];for(c in this.itemA)this.itemA[c].nValuesA[b]&&e.push(this.itemA[c].nValuesA[b]);this.nDeviationA[b]=this.parent.getDeviationOfArray(e)}}}this.partsA[this.partsA.length-
1]&&(this.partsA[this.partsA.length-1].max+=.001);this.szColorField&&(this.nRangesA=this.szRangesA||this.szExactA);this.szFlag.match(/COMPOSECOLOR/)&&X(this.colorScheme.slice(0));this.nAllMaxValue=-Number.MAX_VALUE;this.nAllMinValue=Number.MAX_VALUE;for(b in this.nMaxA)this.nAllMaxValue=Math.max(this.nAllMaxValue,this.nMaxA[b]),this.nAllMinValue=Math.min(this.nAllMinValue,this.nMinA[b]);return!0};A.prototype.sortUp=function(d,c){return d-c};A.prototype.sortIndexUp=function(d,c){return d.value-c.value};
A.prototype.sortIndexDown=function(d,c){return c.value-d.value};A.prototype.sortPartsUp=function(d,c){return d.nCount-c.nCount};A.prototype.sortMeanUp=function(d,c){return d.mean-c.mean};A.prototype.shuffleArray=function(d,c){for(var e=d.length-1;e>0;e--){var b=Math.floor((c&&c[e]?c[e]:Math.random())*e+1),n=d[e];d[e]=d[b];d[b]=n}};A.prototype.getRandomNumberArray=function(d){for(var c=[],e=0;e<d;e++)c.push(Math.random());return c};var Ta=0,W=0,X=function(d){for(var c=W=Ta=0;c<d.length;c++){var e=
ColorScheme.getHexaColor(d[c]);W+=Math.max(Math.max(parseInt(e.substr(1,2),16),parseInt(e.substr(3,2),16)),parseInt(e.substr(5,2),16));Ta+=parseInt(e.substr(1,2),16)+parseInt(e.substr(3,2),16)+parseInt(e.substr(5,2),16)}Ta/=d.length;W/=d.length},Z=function(d,c,e,b){for(var n=0,m=0,u=0,z=0;z<d.length;z++){var x=ColorScheme.getHexaColor(c[z]);n+=parseInt(x.substr(1,2),16)*((d[z]||0)/(e||1));m+=parseInt(x.substr(3,2),16)*((d[z]||0)/(e||1));u+=parseInt(x.substr(5,2),16)*((d[z]||0)/(e||1))}d=Math.max(Math.max(n,
m),u);n=Math.floor(n/d*(b||W));m=Math.floor(m/d*(b||W));u=Math.floor(u/d*(b||W));return ColorScheme.getHexaColor("rgb("+n+","+m+","+u+")")},ia=function(d,c,e,b){b=b||Math.min(Math.floor(Ta),300)||255;for(var n=0,m=0,u=0,z=0;z<d.length;z++){var x=ColorScheme.getHexaColor(c[z]);n+=(255-parseInt(x.substr(1,2),16))*((d[z]||0)/(e||1));m+=(255-parseInt(x.substr(3,2),16))*((d[z]||0)/(e||1));u+=(255-parseInt(x.substr(5,2),16))*((d[z]||0)/(e||1))}d=Math.max(Math.max(n,m),u);n=Math.min(255,b-Math.floor(n/d*
W));m=Math.min(255,b-Math.floor(m/d*W));u=Math.min(255,b-Math.floor(u/d*W));return ColorScheme.getHexaColor("rgb("+n+","+m+","+u+")")};A.prototype.paintMap=function(d){if(this.nChartUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nChartUpper)this.unpaintMap(),this.fVisible=!1,this.realizeDone();else if(this.nChartLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nChartLower)this.unpaintMap(),this.fVisible=!1,this.realizeDone();else{this.beginDraw();this.mapSleep&&(this.mapSleep.checkSleepMessage=
"painting map");var c=0,e=0,b=0,n=0,m=0,u=0,z="",x="";map.Dictionary.getLocalText("of mean");map.Dictionary.getLocalText("of median");var w=!1,O=0,a=b=z=0;n=null;this.fillOpacity=this.fillOpacity?this.fillOpacity:this.nOpacity;this.szStyle="fill-opacity:"+String(this.fillOpacity?this.fillOpacity:map.fTransparentMap?.6:1);this.autoOpacity&&(O=map.Scale.nTrueMapScale*map.Scale.nZoomScale/map.Scale.nNormalSizeScale,this.szStyle="fill-opacity:"+String(Math.max(.3,Math.min(1,.3+.7/Math.max(1,Math.log(map.Zoom.nZoom/
O))))));this.szShapeType.match(/line/)&&(this.szStyle=this.fillOpacity?"stroke-opacity:"+this.fillOpacity+";":"stroke-opacity:1");if(!d||d===0){d=0;this.indexA=[];for(a in this.itemA)this.indexA[this.indexA.length]=a,this.itemA[a].todo=!0;for(z=0;z<this.partsA.length;z++)this.partsA[z].nCount=0,this.partsA[z].nSum=0;this.nDoneCount=0;this.szFlag.match(/COMPOSECOLOR/)&&X(this.colorScheme.slice(0));if(this.parentTheme)for(b=0;b<this.parentTheme.paintedShapeNodesA.length;b++)this.parentTheme.unPaintShape(this.parentTheme.paintedShapeNodesA[b])}for(;d<
this.indexA.length;d++){if(this.mapSleep&&(this.mapSleep.nDoneCount=this.nDoneCount,this.mapSleep.checkSleep(d,10))){this.fContinue=!0;this.continueIndex=d;this.szItemFilter&&this.szItemFilter.length&&this.filterItems(this.szItemFilter,this.itemFilterOpt);return}a=this.indexA[d];this.nDoneCount++;w=!1;O=0;if(this.szFlag.match(/COMPOSECOLOR/)){c=this.szFlag.match(/SUBTRACTIVE/)?ia(this.itemA[a].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255)):Z(this.itemA[a].nValuesA,this.colorScheme,
this.nMax,Math.floor(this.nBrightness*255));n=this.getItemNodes(a);for(b=0;b<n.length;b++)if(m=this.paintShape(n[b],c,-1,-1),this.szFlag.match(/DOPACITY/)){if(this.szAlphaField)u=0,typeof this.itemA[a].nAlpha!="undefined"&&(u=1/(this.nDopacityPow||1),u=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,u)*Math.pow(this.itemA[a].nAlpha,u));else{u=1/(this.nDopacityPow||1);O=(isNaN(this.itemA[a].nValueSum)?0:this.itemA[a].nValueSum)/(this.itemA[a].nValue100A[0]/100||1);var f=isNaN(this.nMax)?0:this.nMax;
u=(this.nDopacityScale||1)*Math.pow(O,u)/Math.pow(f,u)}m.style.setProperty(this.szShapeType.match(/line/)?"stroke-opacity":"fill-opacity",String(u),"")}w=!0}else if(this.szFlag.match(/DOMINANT/)){w=!0;var g=-1;for(z=0;z<this.itemA[a].nValuesA.length;z++)c=this.itemA[a].nValuesA[z],e=100/this.nMeanA[z]*c,b=100/this.nMedianA[z]*c,n=(c-this.nMeanA[z])/this.nDeviationA[z],m=c,this.szFlag.match(/PERCENTOFMEAN/)&&(m=e),this.szFlag.match(/PERCENTOFMEDIAN/)&&(m=b),this.szFlag.match(/DEVIATION/)&&(m=n),c>
this.nFilterA[z]&&m>O&&(this.itemA[a].nClass=z,O=m,g=z);if(g>=0){this.itemA[a].nDominant=g;c=this.itemA[a].nValuesA[g];z=" "+this.szFieldsA[g]+" ";this.szLabelA&&this.szLabelA[g]&&(z=" "+this.szLabelA[g]+" ");if(this.szFlag.match(/PERCENTOFMEAN/)||this.szFlag.match(/DEVIATION/))x=map.Dictionary.getLocalText(" ( mean: ")+this.formatValue(this.nMeanA[g],1)+this.szUnit+")";this.szFlag.match(/PERCENTOFMEDIAN/)&&(x=map.Dictionary.getLocalText(" ( median: ")+this.formatValue(this.nMedianA[g],1)+this.szUnit+
")");this.itemA[a].nValue=this.itemA[a].nValuesA[g];this.itemA[a].szLabel=z;this.itemA[a].szColor=this.colorScheme[g];this.itemA[a].nClass=g;n=this.getItemNodes(a);for(b=0;b<n.length;b++)m=this.paintShape(n[b],this.colorScheme[g],this.itemA[a].nValue,g),m.setAttributeNS(szMapNs,"tooltip",this.formatValue(c,2)+this.szUnit+z+x),this.szFlag.match(/DOPACITY/)&&(u=f=O=0,O=isNaN(this.itemA[a].nValuesA[g])?0:this.itemA[a].nValuesA[g],f=isNaN(this.nMaxA[g])?0:this.nMaxA[g],this.szAlphaField?(u=0,typeof this.itemA[a].nAlpha!=
"undefined"&&(u=1/(this.nDopacityPow||1),u=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,u)*Math.pow(this.itemA[a].nAlpha,u))):this.szFlag.match(/DOPACITYLOGMEAN/)?u=Math.log((this.nDopacityScale||1)*(e-100))/Math.log(100):this.szFlag.match(/DOPACITYPOWMEAN/)?(u=1/(this.nDopacityPow||1),u=Math.pow((this.nDopacityScale||1)*(e-100),u)/Math.pow(100,u)):this.szFlag.match(/DOPACITYMEAN/)?(u=1/(this.nDopacityPow||1),u=Math.pow((this.nDopacityScale||1)*(e-100),u)/Math.pow(100,u)):this.szFlag.match(/DOPACITYLOGMAX/)?
u=Math.log(O)/Math.log(f):this.szFlag.match(/DOPACITYPOWMAX/)?(u=1/(this.nDopacityPow||1),u=(this.nDopacityScale||1)*Math.pow(O,u)/Math.pow(f,u)):this.szFlag.match(/DOPACITYMAX/)?(u=1/(this.nDopacityPow||1),u=(this.nDopacityScale||1)*Math.pow(O,u)/Math.pow(f,u)):u=Math.log((this.nDopacityScale||1)*O)/Math.log(f),u=u<1E-4?0:u,u=Math.min(this.nOpacity||.9,u),this.autoOpacity&&(O=map.Scale.nTrueMapScale*map.Scale.nZoomScale/map.Scale.nNormalSizeScale,u*=Math.max(.3,Math.min(1,.3+.7/Math.max(1,Math.log(map.Zoom.nZoom/
O))))),m.style.setProperty(this.szShapeType.match(/line/)?"stroke-opacity":"fill-opacity",String(u),""));this.partsA[g].nCount++}else for(n=this.getItemNodes(a),b=0;b<n.length;b++)this.unPaintShape(n[b]),n[b].removeAttributeNS(szMapNs,"tooltip")}else for(c=this.szFlag.match(/\bCLIP\b/)&&this.nClipFrames?this.nClipFrames==this.itemA[a].nValuesA.length?Number(this.itemA[a].nValuesA[this.nActualFrame]):this.itemA[a].nValuesA[0]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.itemA[a].nValuesA[1]*
this.nActualFrame/(this.nClipFrames-1):this.itemA[a].nValuesA[0],z=0;z<this.partsA.length;z++)if(c<this.partsA[z].max){this.itemA[a].nValue=c;this.itemA[a].szColor=this.partsA[z].color;this.itemA[a].nClass=z;if(this.itemA[a].todo){n=this.getItemNodes(a);for(b=0;b<n.length;b++)m=this.paintShape(n[b],this.partsA[z].color,c,z),this.szLabelA&&this.szLabelA[z]&&this.szFlag.match(/CATEGORICAL/)?m.setAttributeNS(szMapNs,"tooltip",this.szLabelA[z]):this.itemA[a].nValue100A[0]?m.setAttributeNS(szMapNs,"tooltip",
this.formatValue(c,2)+this.szUnit):(m.setAttributeNS(szMapNs,"tooltip",this.formatValue(c,2)+this.szUnit),m.setAttributeNS(szMapNs,"tooltip",(this.itemA[a].szTitle?this.itemA[a].szTitle:"")+" "+this.formatValue(c,2)+this.szUnit)),this.szFlag.match(/DOPACITY/)&&(this.szAlphaField?(u=0,typeof this.itemA[a].nAlpha!="undefined"&&(u=1/(this.nDopacityPow||1),u=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,u)*Math.pow(this.itemA[a].nAlpha,u))):this.nMin<0&&this.nMax>0?(u=0,this.szFlag.match(/DOPACITYMAX/)?
(u=1/(this.nDopacityPow||1),u=Math.pow(Math.abs(c),u)/Math.pow(this.nMedianA[0]-this.nMin,u)*(this.fillOpacity||1)*(this.nDopacityScale||1)):u=this.szFlag.match(/DOPACITYLOG/)?Math.log(Math.abs(c))/Math.log(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.abs(c)/(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/BIPOLAR/)||this.szFlag.match(/DOPACITYMINMAX/)?(u=0,this.szFlag.match(/DOPACITYMAX/)?(u=1/(this.nDopacityPow||
1),u=c>=this.nMeanA[0]?Math.pow(Math.abs(c-this.nMeanA[0]),u)/Math.pow(Math.abs(this.nMax-this.nMeanA[0]),u)*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.pow(Math.abs(this.nMeanA[0]-c),u)/Math.pow(Math.abs(this.nMeanA[0]-this.nMin),u)*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/DOPACITYLOG/)?u=c>=this.nMedianA[0]?Math.log(Math.abs(c-this.nMedianA[0]))/Math.log(this.nMax-this.nMedianA[0])*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.log(Math.abs(c-this.nMedianA[0]))/
Math.log(this.nMedianA[0]-this.nMin)*(this.fillOpacity||1)*(this.nDopacityScale||1):(u=1/(this.nDopacityPow||1),u=c>=this.nMedianA[0]?Math.pow(Math.abs(c-this.nMedianA[0]),u)/Math.pow(this.nMax-this.nMedianA[0],u)*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.pow(Math.abs(c-this.nMedianA[0]),u)/Math.pow(this.nMedianA[0]-this.nMin,u)*(this.fillOpacity||1)*(this.nDopacityScale||1))):this.szFlag.match(/DOPACITYMIN/)?(u=1/(this.nDopacityPow||1),u=Math.pow(this.nMax-c,u)/Math.pow(this.nMax-this.nMin,
u)*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/DOPACITYMAX/)?(u=1/(this.nDopacityPow||1),u=Math.pow(c-this.nMin,u)/Math.pow(this.nMax-this.nMin,u)*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/DOPACITYLOG/)?u=Math.log(c-this.nMin)/Math.log(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1):this.szFlag.match(/DOPACITY/)&&(u=(c-this.nMin)/(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1)),u=u<1E-4?0:
u,u=Math.min(this.nOpacity||.9,u),this.autoOpacity&&(O=map.Scale.nTrueMapScale*map.Scale.nZoomScale/map.Scale.nNormalSizeScale,u*=Math.max(.3,Math.min(1,.3+.7/Math.max(1,Math.log(map.Zoom.nZoom/O))))),m.style.setProperty("fill-opacity",String(u),""));this.itemA[a].todo=!1}this.partsA[z].nCount++;this.partsA[z].nSum+=c;w=!0;break}if(!w)for(this.itemA[a].szColor=this.szNoDataColor?this.szNoDataColor:"white",n=this.getItemNodes(a),b=0;b<n.length;b++)m=this.paintShape(n[b],this.szNoDataColor?this.szNoDataColor:
"white",-1,-1),m.setAttributeNS(szMapNs,"tooltip","no value"),this.szFlag.match(/DOPACITY/),this.nNoData++}this.isVisible=!0;this.realizeDone();this.fShowProgressBar=!1;this.showInfo();this.endDraw();this.szItemFilter&&this.szItemFilter.length&&this.filterItems(this.szItemFilter,this.itemFilterOpt);this.szFlag.match(/\bCLIP\b/)?this.nClipFrames==this.itemA[a].nValuesA.length?this.szXaxisA&&this.szXaxisA[this.nActualFrame]?displayMessage(this.szXaxisA[this.nActualFrame],3E3,"big"):this.szLabelA&&this.szLabelA[this.nActualFrame]&&
displayMessage(this.szLabelA[this.nActualFrame],3E3,"big"):(e=this.szXaxisA||this.szLabelA)&&(this.nActualFrame===0?displayMessage(e[0],3E3,"big"):this.nActualFrame==this.nClipFrames-1?displayMessage(e[1],3E3,"big"):displayMessage(" ... ",3E3,"big")):this.ErrorMessage?(displayMessage(this.ErrorMessage,1E4,"notify"),this.ErrorMessage=null):clearMessage();this.szFlag.match(/VALUES/)&&(!this.szValueUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nValueUpper)&&(!this.szValueLower||map.Scale.nTrueMapScale*
map.Scale.nZoomScale>=this.nValueLower)?(this.mapSleep&&this.mapSleep.initCheckSleep(25),this.fContinue=this.fMakeLabel=!0,this.nActualFrame=this.nMissingPositionCount=this.nMissingRangeCount=this.nZeroValueCount=this.nRealizedCount=this.nSkipCount=this.nDoneCount=this.continueIndex=0,setTimeout(function(){map.Themes.executeContinue()},1E3)):this.unlabelMap()}};A.prototype.unpaintMap=function(){if(!this.szFlag.match(/FEATURE/))if(this.szFlag.match(/CHART/)){if(this.chartGroup){if(this.chartGroup.childNodes.length===
0&&this.itemA){var d=null,c;for(c in this.itemA)(d=map.SVGDocument.getElementById(this.szId+":"+c+":chartgroup"))&&d.parentNode.removeChild(d)}this.fAutoScaleLeader&&(map.Themes.autoScale=null);map.Dom.clearGroup(this.chartGroup)}}else if(!this.szFlag.match(/LOCKED/)){this.beginDraw();for(d=0;d<this.paintedShapeNodesA.length;d++)this.unPaintShape(this.paintedShapeNodesA[d]),this.paintedShapeNodesA[d].removeAttributeNS(szMapNs,"tooltip");this.paintedShapeNodesA.length=0;this.unlabelMap();this.endDraw();
this.isVisible=!1;this.checkVisible();setTimeout(function(){map.Layer.adaptLabel(null)},10)}};A.prototype.paintShape=function(d,c,e,b){this.paintedShapeNodesA.push(d);switch(this.szShapeType){case "line":d.setAttributeNS(null,"style","fill:none;stroke:"+c+";"+this.szStyle);break;case "line+buffer":var n=d.getAttributeNS(null,"id");if(!n.match(":paint")){var m=map.SVGDocument.getElementById(n+":paint");m||(m=d.cloneNode(1E3),d.parentNode.insertBefore(m,d),m.setAttributeNS(null,"id",n+":paint"));d=
m}n=4;if(this.nBufferSize)if(this.nBufferSize.match(/\$value\$/)){e=this.nBufferSize.split("$value$");n="";for(m=0;m<e.length;m++)n+=e[m],m<e.length-1&&(n+="nValue");n=eval(n)}else n=this.nBufferSize.match(/value/)?100/(this.nMin+1E-9)*(this.nMax-this.nMin)>1E3?6+Math.log(e/this.nMax):10*e/(this.nMax-this.nMin):this.nBufferSize;n*=Math.log(1+1/__featureScaling_lastScale);d.setAttributeNS(null,"style","stroke:"+c+";stroke-width:"+map.Scale.normalX(n)*map.Scale.nZoomScale+";"+this.szStyle+";stroke-linecap:butt;");
break;default:d.setAttributeNS(null,"style","fill:"+c+";"+this.szStyle)}d.setAttributeNS(szMapNs,"class",b);return d};A.prototype.unPaintShape=function(d){if(this.szShapeType=="line+buffer"){var c=d.getAttributeNS(null,"id");(c=map.SVGDocument.getElementById(c+":paint"))&&c.parentNode.removeChild(c)}d.removeAttributeNS(null,"style");d.removeAttributeNS(szMapNs,"class")};A.prototype.zoomToClass=function(d,c){var e=0;if(this.szFlag.match(/DOMINANT/))for(var b in this.itemA)this.itemA[b].nClass==d&&
e++;else e=this.partsA[d].nCount;if(e===0)displayMessage("No members !");else{var n;if(this.szFlag.match(/CHART/))for(b=this.chartGroup.childNodes,n=0;n<b.length;n++)if(e=b.item(n),e.getAttributeNS(szMapNs,"class")==null||e.getAttributeNS(szMapNs,"class")===""){e=e.firstChild.childNodes;for(var m=0;m<e.length;m++)e.item(m).getAttributeNS(szMapNs,"class")}else e.getAttributeNS(szMapNs,"class");else if(this.szFlag.match(/DOMINANT/))for(b in this.itemA)if(this.itemA[b].nClass==d&&this.evidenceMode==
"highlight")for(c=this.getItemNodes(b),n=0;n<c.length;n++);else{if(this.itemA[b].nClass!=d&&this.evidenceMode!="highlight")for(c=this.getItemNodes(b),n=0;n<c.length;n++);}else{e=new point(1E5,1E5);m=new point(-1E5,-1E5);var u=this.partsA[d].min,z=this.partsA[d].max;for(n=1;n<c;n++)u=Math.min(u,this.partsA[d+n].min),z=Math.max(z,this.partsA[d+n].max);this.szFlag.match(/CATEGORICAL/)&&(u++,z++);for(b in this.itemA)if(this.itemA[b].nValuesA[0]>u&&this.itemA[b].nValuesA[0]<z)for(c=this.getItemNodes(b),
n=0;n<c.length;n++){d=map.Dom.getBox(c[n]);if(d.width===0||d.height===0){var x=getMatrix(c[n]);d.x+=x[4];d.y+=x[5];d.width=map.Scale.viewBox.width/20;d.height=map.Scale.viewBox.height/20;d.x-=d.width/2;d.y-=d.height/2}x=map.Scale.getMapOffset(c[n]);d.x+=x.x;d.y+=x.y;e.x=Math.min(e.x,d.x);e.y=Math.min(e.y,d.y);m.x=Math.max(m.x,d.x+d.width);m.y=Math.max(m.y,d.y+d.height)}b=new box(e.x,e.y,m.x-e.x,m.y-e.y);b.scale(1.2);b=map.Zoom.clipArea(b);map.Zoom.setNewArea(b)}}};A.prototype.markClass=function(d,
c){if(this.fMarkEnable!==!1)if(map.Themes.enableSubThemes&&this.szFlag.match(/DOMINANT|COMPOSE/)&&!this.szFlag.match(/CHART/))this.szFlag.match(/SUBTHEME/)||this.createSubTheme(d);else if(isNaN(d))displayMessage("no class!");else{var e=this.szItemFilter&&this.szItemFilter.length;if(!this.szFlag.match(/CHART/)||e)this.fUnmarkEnable=!0,this.unmarkClass(),this.fUnmarkEnable=!1;if(this.fMarkEnable!==!1){var b=0;if(this.szFlag.match(/DOMINANT/)&&!this.szFlag.match(/CHART/))for(var n in this.itemA)this.itemA[n].nClass==
d&&b++;else b=this.partsA.length==1&&this.szFlag.match(/DOPACITY/)?99:this.partsA[d]?this.partsA[d].nCount:0;if(b>500&&this.evidenceMode=="highlight")displayMessage("Sorry ! to many members");else if(b===0)displayMessage("class has no members !",3E3);else if(clearMessage(),map.highLightList.removeAll(),b=null,b=(this.fShadow?5:10)/this.nScale,this.szFlag.match(/CHART/)){n=this.chartGroup.childNodes;c=[];for(d=0;d<n.length;d++){var m=n.item(d);if(m.getAttributeNS(szMapNs,"class")==null||m.getAttributeNS(szMapNs,
"class")==="")for(var u=m.getElementsByTagName("g"),z=0;z<u.length;z++)for(var x=u.item(z).childNodes,w=0;w<x.length;w++){var O=x.item(w);if(O.getAttributeNS&&O.getAttributeNS(szMapNs,"class")){if(this.szFlag.match(/SEQUENCE/)&&!this.szFlag.match(/PLOT/)&&this.evidenceMode!="isolate_gray"){var a=O.getAttributeNS(null,"transform");a&&a.length&&(O.setAttributeNS(szMapNs,"orig-transform",a),O.setAttributeNS(null,"transform",""))}a=Number(O.getAttributeNS(szMapNs,"class"));this.szFlag.match(/BAR/)&&this.szFlag.match(/3D/)&&
!this.szFlag.match(/STACKED/)&&(this.szFieldsA.length>1||this.szFlag.match(/AGGREGATE/)&&this.szFlag.match(/CATEGORICAL/))?this.markedClasses[a]===!0?(O.setAttributeNS(null,"transform","matrix(1 0 0 1 -10 6.6)"),O.style.setProperty("fill-opacity","1","")):(O.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)"),O.style.setProperty("fill-opacity","0.85","")):this.markedClasses[a]===!0?e||(O.style.setProperty("display","inline",""),O.getAttributeNS(szMapNs,"save-style")&&O.setAttributeNS(null,"style",
O.getAttributeNS(szMapNs,"save-style")),c.push(m)):this.evidenceMode=="isolate_gray"?(O.getAttributeNS(szMapNs,"save-style")||O.setAttributeNS(szMapNs,"save-style",O.getAttributeNS(null,"style")),O.style.setProperty("fill","#bbbbbb",""),O.style.getPropertyValue("stroke")!="none"&&O.style.setProperty("stroke","#888888",""),a=O.style.getPropertyValue("fill-opacity"),this.szFlag.match(/SEQUENCE/)||this.szFlag.match(/WAFFLE/)?(O.style.setProperty("fill-opacity","0",""),O.style.setProperty("stroke-opacity",
String(a*.9),""),O.style.setProperty("stroke-width",String(b),"")):O.style.setProperty("fill-opacity","0","")):O.style.setProperty("display","none","")}}else a=Number(m.getAttributeNS(szMapNs,"class")),this.markedClasses[a]===!0?e||(this.szFlag.match(/VECTOR/)?(m.firstChild.style.setProperty("stroke","",""),m.firstChild.style.setProperty("stroke-opacity","",""),m.firstChild.style.setProperty("marker-end","",""),m.style.setProperty("display","inline","")):(m.style.setProperty("display","inline",""),
(a=m.getAttributeNS(szMapNs,"fill"))&&m.style.setProperty("fill",a,"")),c.push(m)):this.evidenceMode=="isolate_gray"?this.szFlag.match(/VECTOR/)?(m.firstChild.style.setProperty("stroke","#888888",""),m.firstChild.style.setProperty("stroke-opacity","0.5",""),m.firstChild.style.setProperty("marker-end","none","")):(m.setAttributeNS(szMapNs,"fill",m.style.getPropertyValue("fill")),m.style.setProperty("fill","#bbbbbb",""),m.setAttributeNS(szMapNs,"stroke",m.style.getPropertyValue("fill")),m.style.setProperty("stroke",
"#888888",""),m.setAttributeNS(szMapNs,"fill-opacity",m.style.getPropertyValue("fill-opacity")),m.style.setProperty("fill-opacity","0.05","")):m.style.setProperty("display","none","")}c.forEach(function(f){f.parentNode.appendChild(f)})}else{this.beginDraw();if(this.szFlag.match(/DOMINANT/))for(n in this.itemA)if(this.itemA[n].nClass==d&&this.evidenceMode=="highlight")for(b=this.getItemNodes(n),e=0;e<b.length;e++)map.highLightList.addItem(b[e]);else{if(this.itemA[n].nClass!=d&&this.evidenceMode!="highlight")for(b=
this.getItemNodes(n),e=0;e<b.length;e++)b[e].setAttributeNS(szMapNs,"themestyle",b[e].getAttributeNS(null,"style")),b[e].style.setProperty("display","none","")}else{for(d=1;d<c;d++);for(n in this.itemA)if(e=!1,this.markedClasses&&this.markedClasses[this.itemA[n].nClass]&&(e=!0),e){if(this.evidenceMode=="highlight")for(b=this.getItemNodes(n),e=0;e<b.length;e++)map.highLightList.addItem(b[e])}else if(this.evidenceMode!="highlight")for(b=this.getItemNodes(n),e=0;e<b.length;e++)if(this.szFlag.match(/BUFFER/))(d=
map.SVGDocument.getElementById(b[e].getAttributeNS(null,"id")+":paint"))&&d.style.setProperty("display","none","");else{b[e].setAttributeNS(szMapNs,"themestyle",b[e].getAttributeNS(null,"style"));b[e].setAttributeNS(null,"style",b[e].getAttributeNS(szMapNs,"origthemestyle"));c=b[e].getAttribute("id");b[e].firstChild&&b[e].firstChild.nextSibling&&(c=b[e].firstChild.nextSibling.getAttribute("id")||c);if(d=map.SVGDocument.getElementById(c+"L"))d.setAttributeNS(szMapNs,"display",d.style.getPropertyValue("display")),
d.style.setProperty("display","none","");if(d=map.SVGDocument.getElementById(c+"L:bg"))d.setAttributeNS(szMapNs,"display",d.style.getPropertyValue("display")),d.style.setProperty("display","none","");if(d=map.SVGDocument.getElementById(c+":::value"))d.setAttributeNS(szMapNs,"display",d.style.getPropertyValue("display")),d.style.setProperty("display","none","");if(d=map.SVGDocument.getElementById(c+":::value:bg"))d.setAttributeNS(szMapNs,"display",d.style.getPropertyValue("display")),d.style.setProperty("display",
"none","")}}this.endDraw();this.fMarkClass=!0}}}};A.prototype.unmarkClass=function(d){if(this.fUnmarkEnable!==!1)if(this.subTheme)this.removeSubTheme();else if(this.szItemFilter&&this.szItemFilter.length)this.fMarkEnable=!0,this.filterItems(this.szItemFilter,this.itemFilterOpt);else if(clearMessage(),this.szFlag.match(/CHART/)){var c=this.chartGroup.childNodes;for(d=0;d<c.length;d++){var e=c.item(d);if(e.getAttributeNS(szMapNs,"class")==null||e.getAttributeNS(szMapNs,"class")===""){e=e.getElementsByTagName("g");
for(var b=0;b<e.length;b++)for(var n=e.item(b).childNodes,m=0;m<n.length;m++){var u=n.item(m);if(u.getAttributeNS&&u.getAttributeNS(szMapNs,"class")){if(this.szFlag.match(/SEQUENCE/)){var z=u.getAttributeNS(szMapNs,"orig-transform");z&&z.length&&(u.removeAttributeNS(szMapNs,"orig-transform"),u.setAttributeNS(null,"transform",z))}this.szFlag.match(/BAR/)&&this.szFlag.match(/3D/)&&!this.szFlag.match(/STACKED/)&&(u.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)"),u.style.setProperty("fill-opacity",
"1",""));u.style&&(u.style.setProperty("display","inline",""),u.getAttributeNS(szMapNs,"save-style")&&u.setAttributeNS(null,"style",u.getAttributeNS(szMapNs,"save-style")))}}}else this.szFlag.match(/VECTOR/)&&(e.firstChild.style.setProperty("stroke","",""),e.firstChild.style.setProperty("stroke-opacity","",""),e.firstChild.style.setProperty("marker-end","","")),e.style.setProperty("display","inline","")}this.szFlag.match(/TEXTONLY/)&&setTimeout(function(){map.Layer.adaptLabel()},10)}else{this.beginDraw();
if(this.evidenceMode!="highlight")for(c in this.itemA)for(d=this.getItemNodes(c),e=0;e<d.length;e++)this.szFlag.match(/BUFFER/)?(b=map.SVGDocument.getElementById(d[e].getAttributeNS(null,"id")+":paint"))&&b.style.setProperty("display","inline",""):(b=d[e].getAttributeNS(szMapNs,"themestyle"))&&b.length&&b!="null"&&(d[e].setAttributeNS(null,"style",b),d[e].removeAttributeNS(szMapNs,"themestyle"),n=d[e].getAttribute("id"),d[e].firstChild&&d[e].firstChild.nextSibling&&(n=d[e].firstChild.nextSibling.getAttribute("id")||
n),(b=map.SVGDocument.getElementById(n+"L"))&&b.style.setProperty("display",b.getAttributeNS(szMapNs,"display"),""),(b=map.SVGDocument.getElementById(n+"L:bg"))&&b.style.setProperty("display",b.getAttributeNS(szMapNs,"display"),""),(b=map.SVGDocument.getElementById(n+":::value"))&&b.style.setProperty("display",b.getAttributeNS(szMapNs,"display"),""),(b=map.SVGDocument.getElementById(n+":::value:bg"))&&b.style.setProperty("display",b.getAttributeNS(szMapNs,"display"),""));else map.highLightList.removeAll();
this.endDraw();this.fMarkClass=!1}};A.prototype.showClass=function(d,c,e){var b=0;if(this.szFlag.match(/DOMINANT/))for(var n in this.itemA)this.itemA[n].nClass==d&&b++;clearMessage();var m;b=e?"inline":"none";if(this.szFlag.match(/CHART/))for(e=this.chartGroup.childNodes,m=0;m<e.length;m++){var u=e.item(m);if(u.getAttributeNS(szMapNs,"class")==null||u.getAttributeNS(szMapNs,"class")===""){u=u.firstChild.childNodes;for(var z=0;z<u.length;z++)c=u.item(z),n=Number(c.getAttributeNS(szMapNs,"class")),
n==d&&c.style.setProperty("display",b,"")}else n=Number(u.getAttributeNS(szMapNs,"class")),n==d&&u.style.setProperty("display",b,"")}else{this.beginDraw();if(this.szFlag.match(/DOMINANT/))for(n in this.itemA){if(this.itemA[n].nClass==d)for(c=this.getItemNodes(n),m=0;m<c.length;m++)c[m].setAttributeNS(szMapNs,"themestyle",c[m].getAttributeNS(null,"style")),c[m].style.setProperty("display",b,"")}else{u=this.partsA[d].min;z=this.partsA[d].max;for(m=1;m<c;m++)u=Math.min(u,this.partsA[d+m].min),z=Math.max(z,
this.partsA[d+m].max);this.szFlag.match(/CATEGORICAL/)&&(u++,z++);for(n in this.itemA)if(this.szFlag.match(/CATEGORICAL/)&&this.itemA[n].nValuesA[0]==u||this.itemA[n].nValuesA[0]>u&&this.itemA[n].nValuesA[0]<z)for(c=this.getItemNodes(n),m=0;m<c.length;m++)this.szFlag.match(/BUFFER/)?(d=map.SVGDocument.getElementById(c[m].getAttributeNS(null,"id")+":paint"))&&d.style.setProperty("display",b,""):e?(d=c[m].getAttributeNS(szMapNs,"themestyle"))&&d.length&&d!="null"&&(c[m].setAttributeNS(null,"style",
d),c[m].removeAttributeNS(szMapNs,"themestyle")):(c[m].setAttributeNS(szMapNs,"themestyle",c[m].getAttributeNS(null,"style")),c[m].setAttributeNS(null,"style",c[m].getAttributeNS(szMapNs,"origthemestyle")))}this.endDraw()}};A.prototype.setTimeFrame=function(d,c){clearMessage();map.highLightList.removeAll();var e=this.szItemFilter&&this.szItemFilter.length,b=(this.fShadow?5:10)/this.nScale,n=this.chartGroup.childNodes;this.szFlag.match(/CHART/)&&(n=this.chartGroup.parentNode.childNodes);for(var m=
[],u=0;u<n.length;u++){var z=n.item(u);if(z.getAttributeNS(szMapNs,"time")==null||z.getAttributeNS(szMapNs,"time")==="")for(var x=z.getElementsByTagName("g"),w=0;w<x.length;w++)for(var O=x.item(w).childNodes,a=0;a<O.length;a++){var f=O.item(a);if(f.getAttributeNS&&f.getAttributeNS(szMapNs,"time")){var g=Number(f.getAttributeNS(szMapNs,"time"));this.szFlag.match(/BAR/)&&this.szFlag.match(/3D/)&&!this.szFlag.match(/STACKED/)&&(this.szFieldsA.length>1||this.szFlag.match(/AGGREGATE/)&&this.szFlag.match(/CATEGORICAL/))?
g>=d&&g<=c?(f.setAttributeNS(null,"transform","matrix(1 0 0 1 -10 6.6)"),f.style.setProperty("fill-opacity","1","")):(f.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)"),f.style.setProperty("fill-opacity","0.85","")):g>=d&&g<=c?e||(f.style.setProperty("display","inline",""),f.getAttributeNS(szMapNs,"save-style")&&f.setAttributeNS(null,"style",f.getAttributeNS(szMapNs,"save-style")),m.push(z)):this.evidenceMode=="isolate_gray"?(f.getAttributeNS(szMapNs,"save-style")||f.setAttributeNS(szMapNs,
"save-style",f.getAttributeNS(null,"style")),f.style.setProperty("fill","#bbbbbb",""),f.style.getPropertyValue("stroke")!="none"&&f.style.setProperty("stroke","#888888",""),g=f.style.getPropertyValue("fill-opacity"),this.szFlag.match(/SEQUENCE/)||this.szFlag.match(/WAFFLE/)?(f.style.setProperty("fill-opacity","0",""),f.style.setProperty("stroke-opacity",String(g*.9),""),f.style.setProperty("stroke-width",String(b),"")):f.style.setProperty("fill-opacity","0","")):f.style.setProperty("display","none",
"")}}else if(g=Number(z.getAttributeNS(szMapNs,"time")),g>=d&&g<=c){if(!e){if(this.szFlag.match(/VECTOR/))z.firstChild.style.setProperty("stroke","",""),z.firstChild.style.setProperty("stroke-opacity","",""),z.firstChild.style.setProperty("marker-end","",""),z.style.setProperty("display","inline","");else{z.style.setProperty("display","inline","");var l;(l=z.getAttributeNS(szMapNs,"fill"))&&z.style.setProperty("fill",l,"")}m.push(z)}}else this.evidenceMode=="isolate_gray"?this.szFlag.match(/VECTOR/)?
(z.firstChild.style.setProperty("stroke","#888888",""),z.firstChild.style.setProperty("stroke-opacity","0.5",""),z.firstChild.style.setProperty("marker-end","none","")):(z.setAttributeNS(szMapNs,"fill",z.style.getPropertyValue("fill")),z.style.setProperty("fill","#bbbbbb",""),z.setAttributeNS(szMapNs,"stroke",z.style.getPropertyValue("fill")),z.style.setProperty("stroke","#888888",""),z.setAttributeNS(szMapNs,"fill-opacity",z.style.getPropertyValue("fill-opacity")),z.style.setProperty("fill-opacity",
"0.05","")):z.style.setProperty("display","none","")}m.forEach(function(h){h.parentNode.appendChild(h)})};A.prototype.createSubTheme=function(d){this.subTheme&&this.removeSubTheme();if(d!=null||this.markedClasses&&this.markedClasses.length){var c="";this.coTable&&typeof this.coTable!="undefined"&&(c+="dbtable:"+this.coTable+";");this.szSelectionField&&typeof this.szSelectionField!="undefined"&&(c+="lookupfield:"+this.szSelectionField+";");this.szAlphaField&&typeof this.szAlphaField!="undefined"&&
(c+="alphafield:"+this.szAlphaField+";");this.szAlphaField100&&typeof this.szAlphaField100!="undefined"&&(c+="alphafield100:"+this.szAlphaField100+";");this.szTitleField&&typeof this.szTitleField!="undefined"&&(c+="titlefield:"+this.szTitleField+";");this.nDopacityScale&&typeof this.nDopacityScale!="undefined"&&(c+="dopacityscale:"+this.nDopacityScale+";");this.nDopacityPow&&typeof this.nDopacityPow!="undefined"&&(c+="dopacitypow:"+this.nDopacityPow+";");var e="lookuptoupper:"+(this.fSelectionFieldToUpper||
null)+";";e+="lookupsuffix:"+(this.szSelectionFieldSuffix||null)+";";e+="lookupprefix:"+(this.szSelectionFieldPrefix||null)+";";e+="lookupdigits:"+(Number(this.nSelectionFieldDigits)||null)+";";e+="lookuptonumber:"+(this.fSelectionFieldToNumber||null)+";";e+="lookuptoupper:"+(this.fSelectionFieldToUpper||null)+";";c+=e;this.szAggregationField&&typeof this.szAggregationField!="undefined"&&(c+="aggregationfield:"+this.szAggregationField+";");this.szUnits&&typeof this.szUnits!="undefined"&&(c+="units:"+
this.szUnits+";");var b="";this.szFlag.match(/DOPACITY/)&&(b+="DOPACITYMAX|");this.szFlag.match(/AGGREGATE/)&&(b+="AGGREGATE|");this.szFlag.match(/GROUP/)&&(b+="GROUP|");this.szFlag.match(/SUM/)&&(b+="SUM|");this.szFlag.match(/ZEROISVALUE/)&&(b+="ZEROISVALUE|");this.szFlag.match(/VALUES/)&&(b+="VALUES|");map.Themes.enableMultiChoropleth=!0;if(this.szFlag.match(/CATEGORICAL/)&&this.szFlag.match(/AGGREGATE/)&&this.szLabelA){var n=[],m=[];for(e=0;e<this.markedClassesA.length;e++)n.push(this.szLabelA[this.markedClassesA[e]]),
m.push(this.colorScheme[this.markedClassesA[e]]);this.markedClassesA&&this.markedClassesA.length>1?(c=this.getDefinitionObject(),c.style.type+="|NOINFO",c.style.values=n,c.style.colorscheme=m,this.subTheme=map.Themes.newThemeByObj(c)):(c+='filter:WHERE "'+this.szFields+'" IN "('+n.join(",")+')";',this.subTheme=map.Themes.newTheme(this.szThemes,this.szFields,this.szField100,"type:CHOROPLETH|CATEGORICAL|NOINFO|NOLEGEND|SUBTHEME|"+b+";colorscheme:7|white|"+this.colorScheme[d]+";"+c,this.szLabelA[d],
""),this.subTheme.parentTheme=this)}else if(this.markedClassesA&&this.markedClassesA.length>1){d=this.szFields.split("|");b=m=n="";for(e=0;e<this.markedClassesA.length;e++)n+=(n.length?"|":"")+d[this.markedClassesA[e]],m+=(m.length?"|":"")+this.colorScheme[this.markedClassesA[e]],b+=(b.length?"|":"")+this.szLabelA[this.markedClassesA[e]];this.subTheme=map.Themes.newTheme(this.szThemes,n,this.szField100,"type:"+this.szFlag+"|SUBTHEME|NOINFO;colorscheme:"+m+";label:"+b+";"+c)}else d=this.markedClassesA[0]||
d,this.subTheme=map.Themes.newTheme(this.szThemes,this.szFields.split("|")[d],this.szField100,"type:CHOROPLETH|LOG|DOPACITY|NOINFO|NOLEGEND|SUBTHEME|"+b+";colorscheme:7|white|"+this.colorScheme[d]+";"+c+";alphafield:null;alphafield100:null;dopacitypow:1;dopacityscale:2;",this.szLabelA?this.szLabelA[d]:"","");this.subTheme.szTitle=map.Dictionary.getLocalText("actual selection");map.Themes.subTheme=this}};A.prototype.removeSubTheme=function(){map.Themes.enableMultiChoropleth=!1;this.subTheme&&(map.Themes.subTheme=
!1,map.Themes.removeTheme(null,this.subTheme.szId),this.subTheme=null,map.Themes.realizeDone(this))};A.prototype.isItemInFilter=function(d,c,e,b){if(e.length===0&&(typeof b=="undefined"||!b.field))return!0;if(typeof c.dbIndex!="undefined"||typeof c.dbIndexA!="undefined")if(c=c.dbIndex||c.dbIndexA[0],e.length){if(this.__szValue=d.dbRecords[c].join(" "),eval("this.__szValue.match(/"+e.replace(/\//gi,"\\/")+"/i)"))return!0}else if(b&&b.field){for(e=0;e<d.dbFields.length;e++)if(d.dbFields[e].id==b.field&&
(b.min&&d.dbRecords[c][e]<b.min||b.max&&d.dbRecords[c][e]>b.max||b.txt&&d.dbRecords[c][e]!=b.txt))return!1;return!0}return!1};A.prototype.filterItems=function(d,c){if(this.fMarkEnable!==!1){this.szItemFilter=d;this.itemFilterOpt=c;this.filterNodesA=d.length||c&&c.field?[]:null;for(var e=null,b=0;b<this.szThemesA.length&&(!(e=this.objThemesA[this.szThemesA[b]])||!e.dbRecords);b++);if(e&&e.dbRecords){if(this.szFlag.match(/CHART/)){var n=this.chartGroup.childNodes;for(b=0;b<n.length;b++){var m=[],u=
n.item(b);m.push(u);for(var z=0;z<m.length;z++){var x=m[z].getAttributeNS(null,"id");x=x.split(":")[1]+"::"+x.split(":")[3];this.itemA[x]?this.isItemInFilter(e,this.itemA[x],d,c)?(u.style.setProperty("display","inline",""),this.filterNodesA&&this.filterNodesA.push(x)):u.style.setProperty("display","none",""):u.style.setProperty("display","inline","")}}}else{this.beginDraw();for(n in this.itemA)if(this.itemA[n]&&typeof this.itemA[n].dbIndex!="undefined")if(this.isItemInFilter(e,this.itemA[n],d,c))for(this.filterNodesA&&
this.filterNodesA.push(n),b=this.getItemNodes(n),m=0;m<b.length;m++)this.szFlag.match(/BUFFER/)?(u=map.SVGDocument.getElementById(b[m].getAttributeNS(null,"id")+":paint"))&&u.style.setProperty("display","inline",""):(u=b[m].getAttributeNS(szMapNs,"themestyle"))&&u.length&&u!="null"&&(b[m].setAttributeNS(null,"style",u),b[m].removeAttributeNS(szMapNs,"themestyle"),(u=map.SVGDocument.getElementById(b[m].firstChild.nextSibling.getAttribute("id")+"L"))&&u.style.setProperty("display",u.getAttributeNS(szMapNs,
"display"),""),(u=map.SVGDocument.getElementById(b[m].firstChild.nextSibling.getAttribute("id")+"L:bg"))&&u.style.setProperty("display",u.getAttributeNS(szMapNs,"display"),""));else for(b=this.getItemNodes(n),m=0;m<b.length;m++)if(this.szFlag.match(/BUFFER/))(u=map.SVGDocument.getElementById(b[m].getAttributeNS(null,"id")+":paint"))&&u.style.setProperty("display","none","");else{b[m].getAttributeNS(szMapNs,"themestyle")||b[m].setAttributeNS(szMapNs,"themestyle",b[m].getAttributeNS(null,"style"));
b[m].setAttributeNS(null,"style",b[m].getAttributeNS(szMapNs,"origthemestyle"));if(u=map.SVGDocument.getElementById(b[m].firstChild.nextSibling.getAttribute("id")+"L"))u.setAttributeNS(szMapNs,"display",u.style.getPropertyValue("display")),u.style.setProperty("display","none","");if(u=map.SVGDocument.getElementById(b[m].firstChild.nextSibling.getAttribute("id")+"L:bg"))u.setAttributeNS(szMapNs,"display",u.style.getPropertyValue("display")),u.style.setProperty("display","none","")}this.endDraw()}this.fMarkClass=
!0}}};A.prototype.selectFilterItems=function(){map.Selections.newSelection("generic",this.filterNodesA,"type:queryresult",this.szItemFilter)};A.prototype.highlightItems=function(d,c){if(d==="")this.clearHighlightItems();else{map.highLightList.removeAll();var e=this;d.split(c||",").forEach(function(b){if(e.szFlag.match(/CHART/)){var n=map.SVGDocument.getElementById(e.szId+":"+b+":chartgroup");n||(b=e.szThemesA[0]+"::"+b,n=map.SVGDocument.getElementById(e.szId+":"+b+":chartgroup"));map.highLightList.addItem(n.parentNode,
"isolate");map.displayInfo(null,n.firstChild,"add|fix")}else{b=e.getItemNodes(b);for(n=0;n<b.length;n++)map.highLightList.addItem(b[n]);map.displayInfo(null,b[0].firstChild.nextSibling,"add|fix")}})}};A.prototype.clearHighlightItems=function(){map.highLightList.removeAll();map.removeInfo()};A.prototype.labelMap=function(d){var c=map.Zoom.getBox(),e=null;this.szValuesTextStyle="font-family:verdana;font-size:"+map.Scale.normalX(11)+"px;pointer-events:none";if(!d||d===0){var b=0;d=0;this.indexA=[];var n=
0,m=0;if(this.fClipCharts)for(b in this.itemA){if(m++,this.itemA[b].nValuesA&&this.itemA[b].nValuesA.length>0&&(e=this.getNodePosition(this.itemA[b].szSelectionId)))if(e.x<c.x||e.x>c.x+c.width||e.y<c.y||e.y>c.y+c.height){if(this.nSkipCount++,e=map.SVGDocument.getElementById(this.szId+":"+b+":chart"))e.parentNode.removeChild(e),this.chartPosA[this.itemA[b].szSelectionId]=null,this.posItemA[this.itemA[b].szSelectionId]=null}else this.indexA[this.indexA.length]=b,n++}else for(b in this.itemA)this.indexA[this.indexA.length]=
b,m++,n++;n>this.nMaxThemeCharts&&(this.indexA.length=0,this.nSkipCount=n);this.mapSleep&&(this.mapSleep.nCount=n);this.fEnableProgressBar=!1}for(;d<this.indexA.length;d++){if(this.fCancel){displayMessage("Canceled by user",1E3,!0);this.fCancel=!1;return}if(this.mapSleep&&(this.mapSleep.nDoneCount=this.nDoneCount,this.mapSleep.checkSleep(d,10))){this.fContinue=!0;this.continueIndex=d;return}b=this.indexA[d];this.nDoneCount++;if(this.itemA[b].nValuesA&&this.itemA[b].nValuesA.length>0)if(e=this.getNodePosition(this.itemA[b].szSelectionId))if(this.fClipCharts&&
!this.szFlag.match(/BUFFER/)&&(e.x<c.x||e.x>c.x+c.width||e.y<c.y||e.y>c.y+c.height))this.nSkipCount++;else for(e=this.getItemNodes(b),n=0;n<e.length;n++)m=this.itemA[b].nValue,!this.szValueField&&this.itemA[b].szLabel&&(m=this.itemA[b].szLabel),this.labelShape(e[n],this.itemA[b].szColor,m);else this.nMissingPositionCount++}this.fMakeLabel=!1;setTimeout(function(){map.Layer.adaptLabel(null)},10)};A.prototype.unlabelMap=function(){for(var d in map.Layer.generatedLabelA)map.Dom.removeElementById(d),
map.Layer.generatedLabelA[d]=null};A.prototype.labelShape=function(d,c,e){if(this.szFlag.match(/VALUES/)&&e!="undefined"&&typeof e!="undefined"&&(!this.szFlag.match(/NOZERO/)||e!==0)){var b=d.parentNode.getAttributeNS(null,"id"),n=map.SVGDocument.getElementById(b+":label");if(n){var m=map.SVGDocument.getElementById(b+":values:bg");m||(m=map.Dom.newGroup(n.parentNode,b+":values:bg"),map.Layer.generatedLabelA[b+":values:bg"]=m);var u=map.SVGDocument.getElementById(b+":values");u||(u=map.Dom.newGroup(n.parentNode,
b+":values"),map.Layer.generatedLabelA[b+":values"]=u);try{var z=d.firstChild.nextSibling.getAttributeNS(null,"id").split("#"),x=z[0]+"L"+(z[1]?"#"+z[1]:"")}catch(O){x=d.getAttributeNS(null,"id")+":::value"}if(!map.SVGDocument.getElementById(x)){n=L(c);c=typeof e=="string"?e:this.formatValue(e,this.nValueDecimals||0)+(this.szUnit.match(/%/)?"%":"");b=this.szTextColor||n.highColor;z=n.lowColor;var w=1;n=Math.max(.3,d.style.getPropertyValue("fill-opacity")||"1");this.szFlag.match(/DTEXT/)&&(w=Math.max(.7,
Math.min(1.5,2/Math.sqrt(this.nMax)*Math.sqrt(e))));e=map.Scale.normalX(11)*map.Scale.nZoomScale*w*map.Scale.nLabelScaling*(this.nLabelScale||1);m=map.Dom.newText(m,0,0,"font-family:verdana;font-weight:normal;font-size:"+e+"px;text-anchor:middle;fill:none;stroke:"+z+";stroke-width:"+map.Scale.normalX(4)*map.Scale.nZoomScale+";stroke-opacity:0.5;pointer-events:none;display:none;stroke-linejoin:bevel;",c);u=map.Dom.newText(u,0,0,"font-family:verdana;font-weight:normal;font-size:"+e+"px;text-anchor:middle;fill:"+
b+";stroke:none;pointer-events:none;display:none;",c);u.setAttributeNS(null,"id",x);m.setAttributeNS(null,"id",x+":bg");this.szFlag.match(/DOPACITY/)&&(u.style.setProperty("fill-opacity",n,""),m.style.setProperty("stroke-opacity",n*.3,""));(x=d.getAttributeNS(szMapNs,"center"))?(d=x.split(","),d=new point(Number(d[0].split(":")[1]),Number(d[1].split(":")[1]))):d=this.getNodePosition(d.getAttributeNS(null,"id"));d&&(u.fu.setPosition(d.x,d.y),m.fu.setPosition(d.x,d.y))}}}};A.prototype.zoomTo=function(){var d=
new point(1E5,1E5),c=new point(-1E5,-1E5);if(this.szFlag.match(/FEATURE/)){d=map.SVGDocument.getElementById(this.szThemesA[0]);var e=map.Dom.getBox(d);map.Zoom.setNewArea(e)}else{if(this.szFlag.match(/CHART/))for(var b in this.itemA)(e=this.itemA[b].ptPos||this.getNodePosition(this.itemA[b].szSelectionId))&&e.x&&e.y&&(d.x=Math.min(d.x,e.x),d.y=Math.min(d.y,e.y),c.x=Math.max(c.x,e.x),c.y=Math.max(c.y,e.y));else for(b in this.itemA)for(var n=this.getItemNodes(b),m=0;m<n.length;m++){e=map.Dom.getBox(n[m]);
if(e.width===0||e.height===0){var u=getMatrix(n[m]);e.x+=u[4];e.y+=u[5];e.width=map.Scale.viewBox.width/20;e.height=map.Scale.viewBox.height/20;e.x-=e.width/2;e.y-=e.height/2}u=map.Scale.getMapOffset(n[m]);e.x+=u.x;e.y+=u.y;d.x=Math.min(d.x,e.x);d.y=Math.min(d.y,e.y);c.x=Math.max(c.x,e.x+e.width);c.y=Math.max(c.y,e.y+e.height)}d=new box(d.x,d.y,c.x-d.x,c.y-d.y);d.scale(1);d=map.Zoom.clipArea(d);d.width>=0&&d.height>=0&&map.Zoom.setNewArea(d)}};A.prototype.createChartGroup=function(d){if(!this.chartGroup){if(this.szFlag.match(/FEATURE/)){if(this.chartGroup=
map.Dom.newGroup(map.Layer.layerNode,this.szThemesA[0]),map.Dom.newGroup(map.Layer.layerNode,this.szThemesA[0]+":label"),map.Layer.listA[this.szThemesA[0]]=new ixMap.Layer.Item(null),map.Layer.listA[this.szThemesA[0]].szName=this.szThemesA[0],map.Layer.listA[this.szThemesA[0]].szHighlight="fill:url(#DiagUp200000000);stroke:black;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;",map.Layer.listA[this.szThemesA[0]].szSelection=this.szItemField,this.nFeatureLower||this.nFeatureUpper)map.Layer.depListA[this.szThemesA[0]]=
{},map.Layer.depListA[this.szThemesA[0]].nLower=this.nFeatureLower||0,map.Layer.depListA[this.szThemesA[0]].nUpper=this.nFeatureUpper||1E9,map.Layer.depListA[this.szThemesA[0]].shapeId=this.szThemesA[0],map.Layer.depListA[this.szThemesA[0]].szDisplayAttribute="none",map.Layer.depListA[this.szThemesA[0]].szFeature=this.szThemesA[0],setTimeout("map.Layer.switchScaleDependentLayer(null)",10)}else this.chartGroup=map.Dom.newGroup(d,this.szId+":chartgroup");this.chartGroup.style.setProperty("opacity",
String(this.nOpacity?this.nOpacity:1),"");this.fVisible==0&&this.chartGroup.style.setProperty("display","none","");this.szFlag.match(/SILENT/)&&this.chartGroup.style.setProperty("pointer-events","none","");this.szFlag.match(/VECTOR/)&&map.antiZoomAndPanList.addGroup(this.chartGroup);this.szFlag.match(/NOSCALE/)&&map.antiZoomAndPanList.addGroup(this.chartGroup);this.szFlag.match(/AGGREGATE/)&&(this.szFlag.match(/AUTOSIZE/)||this.szFlag.match(/GRIDSIZE/))&&map.antiZoomAndPanList.addGroup(this.chartGroup);
this.szFlag.match(/GRIDSIZE/)&&!this.szFlag.match(/AGGREGATE/)&&map.antiZoomAndPanList.addGroup(this.chartGroup);if(this.szFlag.match(/BUFFER/)){this.szFlag.match(/OVERLAY/)&&!this.szShapeType.match(/line/)&&this.chartGroup.style.setProperty("opacity","1","");map.Layer.getLayerObj(this.szThemesA[0]);this.chartGroup.style.setProperty("pointer-events","none","");map.antiZoomAndPanList.addGroup(this.chartGroup);d=this.colorScheme[0];var c=this.colorScheme[1]?this.colorScheme[1]:"red";typeof this.szBorderColor!=
"undefined"&&(c=this.szBorderColor);var e="stroke-width:0;";if(typeof this.szBorderStyle!="undefined")switch(this.szBorderStyle){case "dotted":e="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:round;stroke-dasharray:1,50;";break;case "dashed":e="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:butt;stroke-dasharray:300,300;";break;case "solid":e="stroke-width:"+map.Scale.normalX(1)+";";break;case "none":e="stroke-width:0;"}if(typeof this.szBorderWidth!="undefined")switch(this.szBorderWidth){case "thin":e+=
"stroke-width:"+map.Scale.normalX(.5)+";";break;case "thick":e+="stroke-width:"+map.Scale.normalX(1.5)+";";break;default:e+="stroke-width:"+map.Scale.normalX(this.szBorderWidth)+";"}this.chartGroup.setAttributeNS(null,"style","fill:"+d+";fill-opacity:"+(this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:0)+";stroke:"+c+";"+e+";")}}};A.prototype.chartMap=function(d){if(this.nChartUpper||this.nChartLower){if(this.nChartUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nChartUpper||
this.nChartLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nChartLower){this.chartGroup||this.createChartGroup(map.Layer.objectGroup);this.chartGroup.style.setProperty("display","none","");this.fVisible=!1;this.realizeDone();return}this.chartGroup||this.createChartGroup(map.Layer.objectGroup);this.chartGroup.style.setProperty("display","inline","");this.fVisible=!0}this.chartGroup&&!d&&(this.chartPosA=[]);var c=this.nChartSize?this.nChartSize:30,e=map.Zoom.getBox(),b=this.szFlag.match(/AGGREGATE/)&&
this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth||0)*map.Scale.nZoomScale:map.Scale.normalX(30)*map.Scale.nZoomScale;e.x-=b/2;e.y-=b/2;e.width+=b;e.height+=b;var n=map.Zoom.getBoundsOfMapInGeoBounds(),m=Math.floor(Math.round(1/((n[1].x-n[0].x)/2)*100)/100);n[0].x=Math.floor(n[0].x*m)/m;n[0].y=Math.floor(n[0].y*m)/m;n[1].x=Math.ceil(n[1].x*m)/m;n[1].y=Math.ceil(n[1].y*m)/m;if(this.mapGeoBounds&&this.szFlag.match(/FEATURE/)&&this.szFlag.match(/CLIPTOGEOBOUNDS|CLIPTOVIEW/)&&n[0].x==
this.mapGeoBounds[0].x&&n[0].y==this.mapGeoBounds[0].y&&n[1].x==this.mapGeoBounds[1].x&&n[1].y==this.mapGeoBounds[1].y)this.realizeDone();else{this.mapGeoBounds=[new point(n[0].x,n[0].y),new point(n[1].x,n[1].y)];var u=null,z=8;if(!d||d===0){if(!this.partsA){this.realizeDone();return}var x=0;d=0;this.indexA=[];this.szValuesLineStyle="stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.5;";this.szValuesLineBgStyle="stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+";opacity:1;";this.szValuesTextStyle=
"font-family:"+(this.szTextFont||"arial")+";font-size:"+map.Scale.normalX(z)+"px;fill:#777777;pointer-events:none";this.szValuesTextBgStyle="font-family:"+(this.szTextFont||"arial")+";font-size:"+map.Scale.normalX(z)+"px;fill:none;stroke:white;stroke-width:"+map.Scale.normalY(z)/5+";stroke-opacity:0.8;pointer-events:none;stroke-linejoin:bevel;pointer-events:none";var w=map.Layer.objectGroup;this.chartGroup||this.createChartGroup(w);this.blur(this.nBlur);if(this.autoOpacity){var O=map.Scale.nTrueMapScale*
map.Scale.nZoomScale/map.Scale.nNormalSizeScale;this.fillOpacity=1*Math.max(.1,Math.min(1,20/Math.max(1,Math.pow(map.Zoom.nZoom/O,.5))))}this.mapSleep&&(this.mapSleep.checkSleepMessage="creating charts");this.szFlag.match(/LINEAR/)||this.szFlag.match(/SIZEP1/)?this.nSizePow=1:this.szFlag.match(/SIZEP1H/)?this.nSizePow=1.5:this.szFlag.match(/SIZELOG/)?this.nSizePow=10:this.szFlag.match(/SIZEP10/)?this.nSizePow=10:this.szFlag.match(/SIZEP4/)?this.nSizePow=4:this.szFlag.match(/SIZEP3/)||this.szFlag.match(/SIZEVOLUME/)?
this.nSizePow=3:this.nSizePow=this.nSizePow||2;this.nCharSizeNormal=c;var a=getRotateAttributeValue(map.Scale.canvasNode);if(this.szFlag.match(/\bSORT\b/)&&!this.szFlag.match(/SEQUENCE/)&&!this.szFlag.match(/3D/)){this.indexA=[];for(x in this.itemA)this.indexA[this.indexA.length]=x;for(var f=[],g=0;g<this.indexA.length;g++){var l=this.itemA[this.indexA[g]].nValuesA[this.nActualFrame||0];this.itemA[this.indexA[g]].nSize?l=this.itemA[this.indexA[g]].nSize:this.szFlag.match(/SIZE/)&&this.itemA[this.indexA[g]].nValueSum&&
(l=this.itemA[this.indexA[g]].nValueSum);isNaN(l)||f.push({a:this.indexA[g],y:l})}this.szFlag.match(/\bUP\b/)?f.sort(this.sortDownChartObjectsCompare):f.sort(this.sortUpChartObjectsCompare);if(this.szValueField&&this.szValueField=="$index$")for(g=0;g<f.length;g++)this.itemA[f[g].a].szValue=String(f.length-g);this.indexA=[]}if(this.szFlag.match(/CHART/)&&!this.szFlag.match(/CATEGORICAL/)){for(var h=0;h<this.partsA.length;h++)this.partsA[h].nCount=0,this.partsA[h].nSum=0;this.fRedrawInfo=!0;this.szFlag.match(/SEQUENCE/)&&
(this.nFadeNegative=this.nFadeNegative||1)}var r=0,C=0,F=0;if(!this.fClipCharts||this.szFlag.match(/BUFFER/)||this.szFlag.match(/\bPOSITION\b/)||this.szFlag.match(/FEATURE/))for(x in this.itemA)this.indexA[this.indexA.length]=x,C++,r++;else{for(g=0;g<this.partsA.length;g++)this.partsA[g].nCount=0,this.partsA[g].nSum=0;for(x in this.itemA)if(C++,this.itemA[x].nValuesA&&this.itemA[x].nValuesA.length>0)if(u=this.itemA[x].ptPos||this.getNodePosition(this.itemA[x].szSelectionId)){if(!this.szFlag.match(/NOCLIPTOVIEW/)&&
(u.x<e.x||u.x>e.x+e.width||u.y<e.y||u.y>e.y+e.height))if(this.szFlag.match(/\b(VECTOR|BEZIER)\b/)){u=this.itemA[x].ptPos2||(this.szLabelA?this.getNodePosition(this.szThemesA[0]+"::"+this.szLabelA[this.itemA[x].nValuesA[0]-1]):null);if(!u)continue;if(u.x<e.x||u.x>e.x+e.width||u.y<e.y||u.y>e.y+e.height){this.nSkipCount++;(v=this.itemA[x].chartNode)&&v.parentNode&&(v.parentNode&&v.parentNode.removeChild(v),this.itemA[x].chartNode=null,this.chartPosA[this.itemA[x].szSelectionId]=null,this.posItemA[this.itemA[x].szSelectionId]=
null);continue}}else{this.nSkipCount++;var v;(v=this.itemA[x].chartNode)&&v.parentNode&&(v.parentNode&&v.parentNode.removeChild(v),this.itemA[x].chartNode=null,this.chartPosA[this.itemA[x].szSelectionId]=null,this.posItemA[this.itemA[x].szSelectionId]=null);continue}this.indexA[this.indexA.length]=x;if(this.szFlag.match(/CHART/))if(this.szFlag.match(/CATEGORICAL/))if(this.nMaxA.length>1)for(g=0;g<this.partsA.length;g++)this.partsA[g].nCount+=this.itemA[x].nCountA&&this.itemA[x].nCountA[g]&&!isNaN(this.itemA[x].nCountA[g])?
this.itemA[x].nCountA[g]:0,this.partsA[g].nSum+=this.itemA[x].nValuesA&&this.itemA[x].nValuesA[g]&&!isNaN(this.itemA[x].nValuesA[g])?this.itemA[x].nValuesA[g]:0;else this.szAlphaField?this.szColorField&&this.partsA[this.itemA[x].nClass]?(this.partsA[this.itemA[x].nClass].nCount++,this.partsA[this.itemA[x].nClass].nSum+=isNaN(this.itemA[x].nAlpha)?isNaN(this.itemA[x].nSize)?1:this.itemA[x].nSize:this.itemA[x].nAlpha):this.partsA[this.itemA[x].nValuesA[0]-1]&&(this.partsA[this.itemA[x].nValuesA[0]-
1].nCount++,this.partsA[this.itemA[x].nValuesA[0]-1].nSum+=isNaN(this.itemA[x].nAlpha)?isNaN(this.itemA[x].nSize)?1:this.itemA[x].nSize:this.itemA[x].nAlpha):this.szColorField&&this.partsA[this.itemA[x].nClass]?(this.partsA[this.itemA[x].nClass].nCount++,this.partsA[this.itemA[x].nClass].nSum+=isNaN(this.itemA[x].nSize)?1:this.itemA[x].nSize):this.partsA[this.itemA[x].nValuesA[0]-1]&&(this.partsA[this.itemA[x].nValuesA[0]-1].nCount++,this.partsA[this.itemA[x].nValuesA[0]-1].nSum+=isNaN(this.itemA[x].nSize)?
1:this.itemA[x].nSize);else if(this.nMaxA.length>1)for(g=0;g<this.partsA.length;g++){if(!this.szFlag.match(/MEAN/)||this.itemA[x].nValuesA[g])this.partsA[g].nCount++,this.partsA[g].nSum+=isNaN(this.itemA[x].nValuesA[g])?0:this.itemA[x].nValuesA[g]}else for(g=0;g<this.partsA.length;g++)this.itemA[x].nValuesA[0]>=this.partsA[g].min&&this.itemA[x].nValuesA[0]<this.partsA[g].max&&(this.partsA[g].nCount++,this.partsA[g].nSum+=isNaN(this.itemA[x].nValuesA[0])?0:this.itemA[x].nValuesA[0]);r++}else this.missedA[x]=
x,F++;if(C==F&&!map.Tiles.allTilesLoaded()){this.fRedraw=this.fDataIncomplete=!0;map.Tiles.switchScaleDependentTiles();setTimeout(function(){map.Themes.execute()},1);return}}if(r>this.nMaxThemeCharts)for(x in this.ErrorMessage="max charts ("+this.nMaxThemeCharts+") exceeded; please zoom in",this.indexA.length=0,this.nSkipCount=r,this.itemA)(v=map.SVGDocument.getElementById(this.szId+":"+x+":chart"))&&v.parentNode.removeChild(v);this.fRedrawAllCharts=!1;r>this.nMaxShadowCharts?(this.fShadow&&(this.fRedrawAllCharts=
!0),this.fShadow=!1):(this.fOrigShadow&&!this.fShadow&&(this.fRedrawAllCharts=!0),this.fShadow=this.fOrigShadow);this.szShadowUpper&&(map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nShadowUpper?(this.xOrigShadow=this.xOrigShadow||this.fOrigShadow,this.fShadow=this.fOrigShadow=!1):this.fOrigShadow=this.xOrigShadow||this.fOrigShadow);this.szShadowLower&&(map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nShadowLower?(this.xOrigShadow=this.xOrigShadow||this.fOrigShadow,this.fShadow=this.fOrigShadow=
!1):this.fOrigShadow=this.xOrigShadow||this.fOrigShadow);this.mapSleep&&(this.mapSleep.nCount=r);this.fSorted=!1;if(this.fSortBeforeDraw&&(this.nMin!=this.nMax||this.szSizeField)&&!this.szFlag.match(/NOSRT/)&&!this.szFlag.match(/\bDOT\b/)&&(!this.szFlag.match(/NOSIZE/)||this.szFlag.match(/3D/)||this.szFlag.match(/\bSORT\b/))&&(!this.szFlag.match(/CATEGORICAL/)||this.szFlag.match(/AGGREGATE/)||this.szSizeField||this.szFlag.match(/\bSORT\b/))){var E=[];if((this.szFlag.match(/3D/)||this.szFlag.match(/PLOT/)||
this.szFlag.match(/xxxBOXxxx/)||this.szFlag.match(/POINTER/)&&this.szFlag.match(/BAR/))&&(!this.szFlag.match(/MULTIPLE/)&&!this.szFlag.match(/MULTIGRID/)||this.szFlag.match(/AGGREGATE/)))for(g=0;g<this.indexA.length;g++)(u=this.itemA[this.indexA[g]].ptPos||this.getNodePosition(this.itemA[this.indexA[g]].szSelectionId))?E[g]=a?{a:this.indexA[g],y:u.x*Math.sin(a)+u.y*Math.cos(a)}:{a:this.indexA[g],y:u.y}:E[g]={a:this.indexA[g],y:0};else if(this.szSizeField||this.szFlag.match(/AGGREGATE/)&&this.szFlag.match(/SUM/))for(g=
0;g<this.indexA.length;g++)l=this.itemA[this.indexA[g]].nSize,isNaN(l)||E.push({a:this.indexA[g],y:l});else if(this.szSizeField||this.szFlag.match(/AGGREGATE/)&&this.szFlag.match(/MEAN/))for(g=0;g<this.indexA.length;g++)l=this.itemA[this.indexA[g]].nValuesA[this.nActualFrame||0],isNaN(l)||E.push({a:this.indexA[g],y:l});else if(this.szFlag.match(/SIZE/))for(g=0;g<this.indexA.length;g++)l=this.itemA[this.indexA[g]].nValueSum,isNaN(l)||E.push({a:this.indexA[g],y:l});else for(g=0;g<this.indexA.length;g++)l=
this.itemA[this.indexA[g]].nValuesA[this.nActualFrame||0],isNaN(l)||E.push({a:this.indexA[g],y:l});this.szFlag.match(/\bSORT\b/)&&this.szFlag.match(/\bUP\b/)&&!this.szFlag.match(/SEQUENCE/)&&!this.szFlag.match(/3D/)?E.sort(this.sortDownChartObjectsCompare):E.sort(this.sortUpChartObjectsCompare);for(g=0;g<E.length;g++)this.indexA[g]=E[g].a;this.fSorted=!0}if(this.nMaxCharts&&r>this.nMaxCharts){this.fContinue=!0;this.continueIndex=r-this.nMaxCharts;this.indexA.slice(r-this.nMaxCharts-1,this.nMaxCharts);
map.Themes.executeContinue();return}this.fDone||this.unpaintMap()}this.chart={szColor:this.colorScheme[0],szLineColor:this.colorScheme[1]?this.colorScheme[1]:"none",szTextColor:this.colorScheme[1]?this.colorScheme[1]:"none"};if(this.colorScheme.length>2||this.szFlag.match(/CATEGORICAL/))this.chart.szColor=this.colorScheme[this.colorScheme.length-1],this.chart.szLineColor=this.colorScheme[0];if(this.szFlag.match(/NOLINES/))this.chart.szLineColor="none";else if(this.chart.szLineColor=="none"){var M=
L("#777777");this.chart.szLineColor=M.textColor}this.nXLen=this.nMaxA.length/(this.nGridX||1);if(this.szFlag.match(/PLOT/)&&(this.szFlag.match(/GRIDSIZE/)||this.szFlag.match(/AUTOSIZE/))){var G=0,I=map.Layer.nDynamicObjectScale,ea=this.szFlag.match(/GAP/)?1.2:1;G=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/ea*this.nScale/I:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/ea*this.nScale/I:map.Scale.normalX(c/3);this.nAutoScale=G/map.Scale.normalX((this.itemA[x]?this.itemA[x].nValuesA.length:
1)/(this.nGridX||1)*c);this.nGridSize=G}else this.szFlag.match(/GRIDSIZE/)&&(I=map.Layer.nDynamicObjectScale,ea=this.szFlag.match(/\bRECT\b/)||!this.szFlag.match(/AGGREGATE/)?this.szFlag.match(/GAP/)?1.15:1:this.szFlag.match(/GAP/)?.8:.75,this.nGridSize=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/ea/I:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/ea/I:map.Scale.normalX(c/3));this.szFlag.match(/PLOTXY/)&&(I=map.Layer.nDynamicObjectScale,ea=1.15,this.nChartWidth=this.nGridWidthPx?
map.Scale.normalX(this.nGridWidthPx)/ea/this.nScale/I:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/ea/this.nScale/I:map.Scale.normalX(c/3),this.nChartWidth-=map.Scale.normalX(this.nBoxMargin||0)*2,this.nChartHeight=this.nChartWidth-map.Scale.normalY(this.szFlag.match(/TITLE/)?10:0),this.nGridSize=this.nChartWidth,this.nAutoScale=1,this.nRangeX=this.nMaxX-this.nMinX,this.nRangeY=this.nMaxY-this.nMinY);this.nChartGroupScaleX=this.nChartGroupScale=map.fObjectScaling?(this.nAutoScale||
this.nScale)*map.Layer.nObjectScale*map.Scale.nObjectScaling:(this.nAutoScale||this.nScale)*map.Scale.nFeatureScaling*map.Scale.nObjectScaling;this.nChartGroupScaleY=this.nChartGroupScale/map.Zoom.nZoomY*map.Zoom.nZoomX;this.fGlowInScale=!1;(!this.szGlowUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nGlowUpper)&&(!this.szGlowLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.nGlowLower)&&(this.fGlowInScale=!0);this.fDoRedraw=!1;if(this.indexA.length<1E3||this.fRedraw||this.fRedrawAllCharts||
this.szFlag.match(/BUFFER/)&&this.szShapeType.match(/line/))this.fDoRedraw=!this.fDone;this.fHideValues=this.szValueUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nValueUpper||this.szValueLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nValueLower;if(this.szFlag.match(/\bUSER\b/))try{var pa={target:this.chartGroup,theme:this};this.userDraw?(this.opt=pa,eval("map.HTMLWindow.ixmaps."+this.userDraw+"_init(map.SVGDocument,this.opt);"),delete this.opt):map.HTMLWindow.ixmaps.htmlgui_initChart(map.SVGDocument,
pa)}catch(dc){displayMessage("'"+(this.userDraw||"USER chart")+"' undefined!",5E3)}if(this.szFlag.match(/FEATURE/)){this.chartGroup.style.setProperty("fill",this.chart.szColor||"white");this.chartGroup.style.setProperty("fill-opacity",this.fillOpacity||.7);this.chartGroup.style.setProperty("stroke",this.szLineColor||"red");this.chartGroup.style.setProperty("stroke-width",map.Scale.normalX(this.nLineWidth||1)*this.nChartGroupScaleY/(map.fFeatureScalingDynamic?1:map.Layer.nDynamicObjectScale));if(typeof this.szBorderStyle!=
"undefined")switch(this.szBorderStyle){case "dotted":this.chartGroup.style.setProperty("stroke-dasharray","0.1 0.2");break;case "dashed":this.chartGroup.style.setProperty("stroke-dasharray","0.5 0.2")}this.szFlag.match(/DASH/)&&this.chartGroup.style.setProperty("stroke-dasharray","0.1 0.2");this.chartGroup.style.setProperty("stroke-opacity","1");this.chartGroup.style.setProperty("stroke-linecap","butt");this.chartGroup.style.setProperty("stroke-linejoin","round");if(this.szFlag.match(/SILENT/))this.chartGroup.style.setProperty("pointer-events",
"none","");else{var R="";for(g=0;g<this.objTheme.dbFields.length-1;g++)R+=(g?"|":"")+this.objTheme.dbFields[g].id;this.chartGroup.setAttributeNS(szMapNs,"info",R)}if(this.fShadow===!0&&map.SVGDocument.getElementById(map.szShadowFilterShapeId))this.chartGroup.style.setProperty("filter","url(#"+map.szShadowFilterShapeId+")","");else if(this.fShadow===!0){var ca=map.Dom.newNode("filter",this.chartGroup.parentNode);ca.setAttributeNS(null,"id",map.szShadowFilterShapeId);ca.setAttributeNS(null,"x","-1");
ca.setAttributeNS(null,"y","-1");ca.setAttributeNS(null,"width","2000%");ca.setAttributeNS(null,"height","2000%");var aa=map.Dom.newNode("feGaussianBlur",ca);aa.setAttributeNS(null,"stdDeviation","0.3");aa.setAttributeNS(null,"result","BlurAlpha");aa=map.Dom.newNode("feOffset",ca);aa.setAttributeNS(null,"in","BlurAlpha");aa.setAttributeNS(null,"dx","0.2");aa.setAttributeNS(null,"dy","0.5");aa.setAttributeNS(null,"result","OffsetBlurAlpha");aa=map.Dom.newNode("feColorMatrix",ca);aa.setAttributeNS(null,
"in","OffsetBlurAlpha");aa.setAttributeNS(null,"type","matrix");aa.setAttributeNS(null,"values","0.1 0.1 0.1 0 0 0.1 0.1 0.1 0 0 0.1 0.1 0.1 0 0 0 0 0 1 0");aa.setAttributeNS(null,"result","matrixOut");aa=map.Dom.newNode("feMerge",ca);var wa=map.Dom.newNode("feMergeNode",aa);wa.setAttributeNS(null,"in","matrixOut");wa=map.Dom.newNode("feMergeNode",aa);wa.setAttributeNS(null,"in","SourceGraphic");this.chartGroup.style.setProperty("filter","url(#"+map.szShadowFilterShapeId+")","")}}G=map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/
2*20;G=G*map.Scale.nZoomScale*20;for(var qa=d;qa<this.indexA.length;qa++){if(this.fCancel){displayMessage("Canceled by user",1E3,!0);this.fCancel=!1;return}if(this.mapSleep&&(this.mapSleep.nDoneCount=this.nDoneCount,this.mapSleep.checkSleep(qa,10))){this.fContinue=!0;this.continueIndex=qa;this.szItemFilter&&this.szItemFilter.length&&this.filterItems(this.szItemFilter,this.itemFilterOpt);this.markedClass!=null&&this.markClass(this.markedClass,1);return}var T=null;x=this.indexA[qa];this.nDoneCount++;
if(this.itemA[x]&&this.itemA[x].nValuesA&&this.itemA[x].nValuesA.length!==0){var xa=this.itemA[x].szSelectionId;if(!this.szFlag.match(/FEATURE/)){if(u=this.itemA[x].ptPos||this.getNodePosition(xa))u.x=isNaN(u.x)?0:u.x,u.y=isNaN(u.y)?0:u.y;if(!u||isNaN(u.x)||isNaN(u.y)){this.nMissingPositionCount++;continue}this.fRedraw&&(this.itemA[x].chartNode=this.itemA[x].chartNode||map.SVGDocument.getElementById(this.szId+":"+x+":chart"));if(this.itemA[x].chartNode&&this.itemA[x].chartNode.parentNode)if(this.fDoRedraw)this.itemA[x].chartNode.parentNode.removeChild(this.itemA[x].chartNode),
this.itemA[x].chartNode=null;else{this.nRealizedCount++;continue}}var Ja=new point(0,0);if(this.szFlag.match(/FEATURE/))if(x.match(/\*/)&&(T=map.SVGDocument.getElementById(x.split("*")[0])),T||=map.Dom.newGroup(this.chartGroup,x),this.objTheme.dbRecords[this.itemA[x].dbIndex][this.objTheme.nFieldSelectionIndex])if(this.objTheme.dbRecords[this.itemA[x].dbIndex][this.objTheme.nFieldSelectionIndex].match(/coordinates/i)){var Da=JSON.parse(this.objTheme.dbRecords[this.itemA[x].dbIndex][this.objTheme.nFieldSelectionIndex]);
if(Da){if(this.szFlag.match(/CLIPTOGEOBOUNDS|CLIPTOVIEW/)&&Da.type=="Polygon"){var Za=Da.coordinates,ib=!0;for(g in Za){var Aa=Za[g];for(let dc in Aa)if(Aa[dc][0]>n[0].x&&Aa[dc][0]<n[1].x&&Aa[dc][1]>n[0].y&&Aa[dc][1]<n[1].y){ib=!1;break}}if(ib){T.parentNode.removeChild(T);for(g in map.Themes.themeNodesA[x])map.Themes.themeNodesA[x][g].parentNode&&map.Themes.themeNodesA[x][g].parentNode.removeChild(map.Themes.themeNodesA[x][g]);map.Themes.themeNodesA[x]=[];continue}else if(map.Themes.themeNodesA[x]&&
map.Themes.themeNodesA[x].length)continue}if(this.szFlag.match(/SILENT/))T.style.setProperty("pointer-events","none","");else{R="";var wb=this.objTheme.dbRecords[this.itemA[x].dbIndex];for(g=0;g<wb.length-1;g++)R+=(g?"|":"")+wb[g];T.setAttributeNS(szMapNs,"info",R);T.setAttributeNS(szMapNs,"tooltip",x)}if(this.szTimeField){var eb=(new Date(this.itemA[x].szTime)).getTime()||this.itemA[x].szTime;T.setAttributeNS(szMapNs,"time",eb)}if(this.szFlag.match(/CATEGORICAL/))this.chart.szColor=this.colorScheme[this.itemA[x].nValuesA[0]-
1];else if(this.partsA.length>1)for(this.chart.szColor=this.szNoDataColor?this.szNoDataColor:"white",g=0;g<this.partsA.length;g++)this.itemA[x].nValuesA[0]>=this.partsA[g].min&&this.itemA[x].nValuesA[0]<this.partsA[g].max&&(this.chart.szColor=this.colorScheme[g],this.itemA[x].nClass=g,this.partsA[g].nCount++);T.setAttributeNS(null,"style","stroke:"+this.chart.szColor);T.setAttributeNS(szMapNs,"class",typeof this.itemA[x].nClass!="undefined"?this.itemA[x].nClass:String(this.itemA[x].nValuesA[0]-1));
var nb=map.Scale.getMapPositionOfLatLon(80,180).x-map.Scale.getMapPositionOfLatLon(80,-180).x;if(Da.type=="Point"){map.Layer.listA[this.szThemesA[0]].szType="point";Aa=Da.coordinates;var oa=map.Scale.getMapPositionOfLatLon(Aa[1],Aa[0]);T.fu.setMatrix([this.nChartGroupScaleX,0,0,this.nChartGroupScaleY,oa.x,oa.y]);var Ca=map.Dom.newShape("circle",T,0,0,map.Scale.normalX(1),"fill:#dd0000;fill-opacity:0.3;stroke:#dd0000;stroke-opacity:1;stroke-width:1")}if(Da.type=="LineString"){this.chartGroup.style.setProperty("fill",
"none");map.Layer.listA[this.szThemesA[0]].szType="line";Aa=Da.coordinates;oa=map.Scale.getMapPositionOfLatLon(Aa[0][1],Aa[0][0]);var Ma="M "+oa.x+","+oa.y+" l ",Oa=new point(oa.x,oa.y);for(g in Aa)oa=map.Scale.getMapPositionOfLatLon(Aa[g][1],Aa[g][0]),Math.abs(oa.x-Oa.x)>nb*.99&&(oa=map.Scale.getMapPositionOfLatLon(Aa[g][1],Aa[g][0]+(oa.x<0?360:-360))),Ma+=oa.x-Oa.x+","+(oa.y-Oa.y)+" ",Oa=new point(oa.x,oa.y);Ca=map.Dom.newShape("path",T,Ma,"")}if(Da.type=="MultiLineString")for(g in this.chartGroup.style.setProperty("fill",
"none"),map.Layer.listA[this.szThemesA[0]].szType="line",Za=Da.coordinates,Za){Aa=Za[g];Oa=null;oa=map.Scale.getMapPositionOfLatLon(Aa[0][1],Aa[0][0]);Ma="M "+oa.x+","+oa.y+" l ";Oa=new point(oa.x,oa.y);for(var db in Aa)oa=map.Scale.getMapPositionOfLatLon(Aa[db][1],Aa[db][0]),Math.abs(oa.x-Oa.x)>nb*.99&&(oa=map.Scale.getMapPositionOfLatLon(Aa[db][1],Aa[db][0]+(oa.x<0?360:-360))),Ma+=oa.x-Oa.x+","+(oa.y-Oa.y)+" ",Oa=new point(oa.x,oa.y);Ca=map.Dom.newShape("path",T,Ma,"")}if(Da.type=="Polygon"){map.Layer.listA[this.szThemesA[0]].szType=
"polygon";Za=Da.coordinates;Ma="";var Pa=0,k=0,p=0;for(g in Za){Aa=Za[g];Oa=null;oa=map.Scale.getMapPositionOfLatLon(Aa[0][1],Aa[0][0]);Ma+="M "+oa.x+","+oa.y+" l ";Oa=new point(oa.x,oa.y);for(db in Aa)oa=map.Scale.getMapPositionOfLatLon(Aa[db][1],Aa[db][0]),Math.abs(oa.x-Oa.x)>nb*.99&&(oa=map.Scale.getMapPositionOfLatLon(Aa[db][1],Aa[db][0]+(oa.x<0?360:-360))),Pa+=oa.x,k+=oa.y,Ma+=oa.x-Oa.x+","+(oa.y-Oa.y)+" ",Oa=new point(oa.x,oa.y);Ma+=" z";p+=Aa.length}Ca=map.Dom.newShape("path",T,Ma,"");T.setAttributeNS(szMapNs,
"center","x:"+Pa/p+",y:"+k/p);T.setAttributeNS(szMapNs,"area",this.itemA[x].nSize);T.setAttributeNS(null,"style","fill:"+this.chart.szColor+";")}if(Da.type=="MultiPolygon"){Pa=[];k=[];p=[];map.Layer.listA[this.szThemesA[0]].szType="polygon";var q=Da.coordinates;for(cb in q){Za=q[cb];Ma="";Pa[cb]=0;k[cb]=0;p[cb]=0;for(g in Za){Aa=Za[g];Oa=null;oa=map.Scale.getMapPositionOfLatLon(Aa[0][1],Aa[0][0]);Ma+="M "+oa.x+","+oa.y+" l ";Oa=new point(oa.x,oa.y);for(db in Aa)oa=map.Scale.getMapPositionOfLatLon(Aa[db][1],
Aa[db][0]),Math.abs(oa.x-Oa.x)>nb*.99&&(oa=map.Scale.getMapPositionOfLatLon(Aa[db][1],Aa[db][0]+(oa.x<0?360:-360))),Pa[cb]+=oa.x,k[cb]+=oa.y,Ma+=oa.x-Oa.x+","+(oa.y-Oa.y)+" ",Oa=new point(oa.x,oa.y);Ma+=" z";p[cb]+=Aa.length}Ca=map.Dom.newShape("path",T,Ma,"")}var D=0;for(cb in p)p[cb]>D&&(T.setAttributeNS(szMapNs,"center","x:"+Pa[cb]/p[cb]+",y:"+k[cb]/p[cb]),T.setAttributeNS(szMapNs,"area",this.itemA[x].nSize),D=p[cb]);T.setAttributeNS(null,"style","fill:"+this.chart.szColor+";")}}}else(u=this.itemA[x].ptPos||
this.getNodePosition(xa))&&T.fu.setMatrix([this.nChartGroupScaleX,0,0,this.nChartGroupScaleY,u.x,u.y]);else(u=this.itemA[x].ptPos||this.getNodePosition(xa))&&T.fu.setMatrix([this.nChartGroupScaleX,0,0,this.nChartGroupScaleY,u.x,u.y]);else if(this.szFlag.match(/\bDOT\b/)){T=map.Dom.newGroup(this.chartGroup,this.szId+":"+xa+":chartgroup");T.fu.setMatrix([this.nChartGroupScaleX,0,0,this.nChartGroupScaleY,u.x,u.y]);if(this.szFlag.match(/CATEGORICAL/))this.chart.szColor=this.colorScheme[this.itemA[x].nValuesA[0]-
1];else if(this.partsA.length>1)for(g=0;g<this.partsA.length;g++)this.itemA[x].nValuesA[0]>=this.partsA[g].min&&this.itemA[x].nValuesA[0]<this.partsA[g].max&&(this.chart.szColor=this.colorScheme[g]);this.itemA[x].chartNode=map.Dom.newShape("circle",T,0,0,map.Scale.normalX(3),"fill:"+this.chart.szColor+";fill-opacity:"+(this.fillOpacity||1)+";stroke:none;")}else if(this.szFlag.match(/\bQUAD\b/)){T=map.Dom.newGroup(this.chartGroup,this.szId+":"+xa+":chart");T.fu.setMatrix([this.nChartGroupScaleX,0,
0,this.nChartGroupScaleY,u.x,u.y]);if(this.szFlag.match(/CATEGORICAL/))this.chart.szColor=this.colorScheme[this.itemA[x].nValuesA[0]-1];else if(this.partsA.length>1)for(g=0;g<this.partsA.length;g++)this.itemA[x].nValuesA[0]>=this.partsA[g].min&&this.itemA[x].nValuesA[0]<this.partsA[g].max&&(this.chart.szColor=this.colorScheme[g]);this.itemA[x].chartNode=map.Dom.newShape("rect",T,-G,-G,G*2,G*2,"fill:"+this.chart.szColor+";stroke:none;")}else if(this.szFlag.match(/\bBEZIER\b/)){if(!(this.nMinValue&&
this.itemA[x].nSize<this.nMinValue)){var H=this.itemA[x].ptPos,N=this.itemA[x].ptPos2||(this.szLabelA?this.getNodePosition(this.szThemesA[0]+"::"+this.szLabelA[this.itemA[x].nValuesA[0]-1]):null);if(H&&N&&H!=N){T=this.itemA[x].chartNode=map.Dom.newGroup(this.chartGroup,this.szId+":"+x+(x?":chartgroup":":ochrtgroup"));this.chart.szColor=this.szLineColor||this.itemA[x].szColor||this.colorScheme[this.itemA[x].nValuesA[0]-1]||this.szNoDataColor;var S=1/(this.nSizePow||1),ha=this.nLineWidth||10/Math.pow(this.nNormalSizeValue||
this.nMaxSize,S)*Math.pow(Math.abs(this.itemA[x].nSize),S),Ia=Number(this.nGapSize||20),mb=ha+(this.szFlag.match(/\bGAP\b/)?Ia:3);ha=map.Scale.normalX(ha)*this.nChartGroupScaleY*this.nScale;if(!(ha<=0)){if(this.szFlag.match(/\bREVERSE\b/)||this.itemA[x].nSize<0){var Sc=H;H=N;N=Sc}var vb=Math.sqrt((N.y-H.y)*(N.y-H.y)+(N.x-H.x)*(N.x-H.x));Pa=N.x-H.x;k=N.y-H.y;vb=Math.sqrt(Pa*Pa+k*k);this.szFlag.match(/\bDYNAMICWIDTH\b/)&&(ha*=Math.max(1,Math.log10(vb)));if(!(vb<=0)){var Rb=this.nRangeScale;this.szFlag.match(/\bRANDOM\b/)&&
(Rb-=this.nRangeScale*.66*Math.random());if(this.szFlag.match(/\bSHORT\b/)){O=k/vb*(Rb||5)*100*this.nChartGroupScaleY;var Vb=Pa/vb*(Rb||5)*100*this.nChartGroupScaleY}else this.szFlag.match(/\bLONG\b/)?(O=k/5E4*Math.max(vb,500)*(Rb||5),Vb=Pa/5E4*Math.max(vb,500)*(Rb||5)):(O=k/50*(Rb||5),Vb=Pa/50*(Rb||5));this.szFlag.match(/\bPOINTER|ARROW\b/)&&(Pa-=Pa/vb*map.Scale.normalX(mb)*this.nChartGroupScaleY*this.nScale*(this.nMarkerSize||1),k-=k/vb*map.Scale.normalX(mb)*this.nChartGroupScaleY*this.nScale*(this.nMarkerSize||
1));var Bc=0,sb=0;this.szFlag.match(/\bGAP\b/)&&(Pa+=O/500*mb,k-=Vb/500*mb,Bc=Pa/vb*Ia*20*this.nChartGroupScaleY,sb=k/vb*Ia*20*this.nChartGroupScaleY);Ma="M"+Bc+","+sb+" C"+(Pa/4+O)+","+(k/4-Vb)+" "+(Pa/2+O)+","+(k/2-Vb)+" "+Pa+","+k;Ca=map.Dom.newShape("path",T,Ma,"stroke-linecap:butt;fill:none;stroke:"+this.chart.szColor+";stroke-width:"+ha+";stroke-opacity:"+(this.fillOpacity||.3)+";");if(this.szFlag.match(/DOPACITYMIN/)){S=1/(this.nDopacityPow||1);var ob=Math.pow(this.nMax-this.itemA[x].nSize,
S)/Math.pow(this.nMax-this.nMin,S)*(this.fillOpacity||1)*(this.nDopacityScale||1);Ca.style.setProperty("stroke-opacity",String(ob),"")}else this.szFlag.match(/DOPACITY/)&&(S=1/(this.nDopacityPow||1),ob=Math.pow(this.itemA[x].nSize-this.nMin,S)/Math.pow(this.nMax-this.nMin,S)*(this.fillOpacity||1)*(this.nDopacityScale||1),Ca.style.setProperty("stroke-opacity",String(ob),""));if(this.szFlag.match(/\bDASH\b/)){var ta=1E3*this.nChartGroupScaleY,za=100*this.nChartGroupScaleY+ha;Ca.style.setProperty("stroke-dasharray",
String(ta)+" "+String(za));Ca.style.setProperty("stroke-dashoffset","0");Ca.style.setProperty("stroke-linecap","round");var tc=Math.random()*ta,fb=tc+ta+za,ba=tc;map.Dom.constructNode("animate",Ca,{attributeType:"XML",attributeName:"stroke-dashoffset",from:String(fb),to:String(ba),dur:"2s",repeatCount:"indefinite"})}if(this.szFlag.match(/\bGRADIENT\b|\bFADEIN\b/)){var kc=this.szLineColorA?this.szLineColorA[0]:this.chart.szColor,pb=this.szFlag.match(/\bFADEIN\b/)?.2:2,Ib="Gradient"+Math.random();if(Math.abs(k)>
Math.abs(Pa)){var Wb=map.Dom.constructNode("linearGradient",T,{id:Ib,x1:"0%",y1:"0%",x2:"0%",y2:"100%"});map.Dom.constructNode("stop",Wb,{offset:"0","stop-color":k<0?this.chart.szColor:kc,"stop-opacity":k<0?"2":pb});map.Dom.constructNode("stop",Wb,{offset:"1","stop-color":k<0?kc:this.chart.szColor,"stop-opacity":k<0?pb:"2"})}else Wb=map.Dom.constructNode("linearGradient",T,{id:Ib}),map.Dom.constructNode("stop",Wb,{offset:"0","stop-color":Pa<0?this.chart.szColor:kc,"stop-opacity":Pa<0?"2":pb}),map.Dom.constructNode("stop",
Wb,{offset:"1","stop-color":Pa<0?kc:this.chart.szColor,"stop-opacity":Pa<0?pb:"2"});Ca.style.setProperty("stroke","");Ca.style.setProperty("fill","none");Ca.setAttributeNS(null,"stroke","url(#"+Ib+")")}if(this.szFlag.match(/\bPOINTER|ARROW\b/)){var gb="ArrowMarker"+Math.random(),Jb=map.Dom.newNode("defs",T),ec=Math.min(5,2.5+100/(ha/this.nChartGroupScale))*(this.nMarkerSize||1),Cc=map.Dom.constructNode("marker",Jb,{id:gb,markerWidth:ec,markerHeight:ec,refX:ec/1.7,refY:ec/2,orient:"auto",markerUnits:"strokeWidth"}),
Kb=map.Dom.constructNode("path",Cc,{d:"M0,"+ec+" L"+ec+","+ec/2+" L0,0 Z",style:"fill:"+this.chart.szColor+";opacity:"+(this.fillOpacity||.3)*2+";stroke:none;stroke-width:0.03"});Ca.setAttributeNS(null,"marker-end","url(#"+gb+")");this.szFlag.match(/DOPACITYMIN/)?(S=1/(this.nDopacityPow||1),ob=Math.pow(this.nMax-this.itemA[x].nSize,S)/Math.pow(this.nMax-this.nMin,S)*(this.fillOpacity||1)*(this.nDopacityScale||1),Kb.style.setProperty("opacity",String(ob),"")):this.szFlag.match(/DOPACITY/)&&(S=1/(this.nDopacityPow||
1),ob=Math.pow(this.itemA[x].nSize-this.nMin,S)/Math.pow(this.nMax-this.nMin,S)*(this.fillOpacity||1)*(this.nDopacityScale||1),Kb.style.setProperty("opacity",String(ob),""))}if(this.szFlag.match(/\bVALUES\b/)&&!this.fHideValues){var Tc="VectorPath"+Math.random();Pa<0?(Ma="M"+Pa+","+k+" C"+(Pa/2+O)+","+(k/2-Vb)+" "+(Pa/4+O)+","+(k/4-Vb)+" "+Bc+","+sb,map.Dom.newShape("path",T,Ma,"fill:none;stroke:none").setAttributeNS(null,"id",Tc)):Ca.setAttributeNS(null,"id",Tc);z=Math.min(vb,Math.sqrt(this.itemA[x].nSize)/
Math.sqrt(this.nNormalSizeValue||this.nMaxSize)*this.nValueScale);z=24*map.Scale.normalX(z)*this.nChartGroupScaleY*this.nScale;var Nb=this.formatValue(this.itemA[x].nSize,this.nValueDecimals||(this.itemA[x].nSize<1?2:0),"ROUND")+this.szUnit;map.Dom.newTextOnPath(T,Tc,Nb,"font-family:arial;font-size:"+z+"px;fill:"+this.chart.szColor+";stroke:#ffffff;stroke-width:"+ha/10+"px;baseline-shift:-35%","40%")}T.setAttributeNS(szMapNs,"class",typeof this.itemA[x].nClass!="undefined"?this.itemA[x].nClass:String(this.itemA[x].nValuesA[0]-
1));T.setAttributeNS(szMapNs,"tooltip",this.formatValue(this.itemA[x].nSize,this.nValueDecimals||(this.itemA[x].nSize<1?2:0),"ROUND")+this.szUnit);this.szTimeField&&(eb=(new Date(this.itemA[x].szTime)).getTime()||this.itemA[x].szTime,T.setAttributeNS(szMapNs,"time",eb));T.fu.setMatrix([1,0,0,1,H.x,H.y])}}}}}else if(this.szFlag.match(/\bVECTOR\b/))this.nMinValue&&this.itemA[x].nSize<this.nMinValue||(H=this.itemA[x].ptPos,N=this.itemA[x].ptPos2||(this.szLabelA?this.getNodePosition(this.szThemesA[0]+
"::"+this.szLabelA[this.itemA[x].nValuesA[0]-1]):null),H&&N&&(T=this.itemA[x].chartNode=map.Dom.newGroup(this.chartGroup,this.szId+":"+x+(x?":chartgroup":":ochrtgroup")),this.chart.szColor=this.szLineColor||this.colorScheme[this.itemA[x].nValuesA[0]-1],ha=this.nLineWidth||2/(this.nNormalSizeValue||1)/this.nMaxSize*this.itemA[x].nSize,Ca=map.Dom.newShape("line",T,0,0,N.x-H.x,N.y-H.y,"stroke:"+this.chart.szColor+";stroke-width:"+map.Scale.normalX((ha||.1)*this.nChartGroupScaleY)+";stroke-opacity:"+
(this.fillOpacity||.3)+";"),this.szFlag.match(/\bDASH\b/)&&(ta=1E3*this.nChartGroupScaleY,za=300*this.nChartGroupScaleY,Ca.style.setProperty("stroke-dasharray",String(ta)+" "+String(za)),Ca.style.setProperty("stroke-dashoffset","0"),tc=Math.random()*ta,fb=tc+ta+za,ba=tc,map.Dom.constructNode("animate",Ca,{attributeType:"XML",attributeName:"stroke-dashoffset",from:String(fb),to:String(ba),dur:"1s",repeatCount:"indefinite"})),this.szFlag.match(/\bPOINTER|ARROW\b/)&&(Jb=map.Dom.newNode("defs",T),Cc=
map.Dom.constructNode("marker",Jb,{id:this.szId+":"+xa+":chartgroup:ArrowMarker",markerWidth:"4",markerHeight:"4",refX:"4",refY:"2",orient:"auto",markerUnits:"strokeWidth"}),Kb=map.Dom.constructNode("path",Cc,{d:"M0,4 L4,2 L0,0 Z",style:"fill:"+this.chart.szColor+";opacity:"+(this.fillOpacity||.3)*2+";stroke:white;stroke-width:0.1"}),Ca.setAttributeNS(null,"marker-end","url(#"+this.szId+":"+xa+":chartgroup:ArrowMarker)")),T.setAttributeNS(szMapNs,"class",typeof this.itemA[x].nClass!="undefined"?this.itemA[x].nClass:
String(this.itemA[x].nValuesA[0]-1)),T.setAttributeNS(szMapNs,"tooltip",this.formatValue(this.itemA[x].nSize,this.nValueDecimals||(this.itemA[x].nSize<1?2:0),"ROUND")+this.szUnit),T.fu.setMatrix([1,0,0,1,H.x,H.y])));else{T=null;if(xa)if(T=map.SVGDocument.getElementById(this.szId+":"+xa+":chart"))T.fu=new Methods(T);else if(T=map.Dom.newGroup(this.chartGroup,this.szId+":"+xa+":chart"),this.szFlag.match(/BOX/)){var sa="#bbbbbb";typeof this.szBorderColor!="undefined"&&(sa=this.szBorderColor);var Ua=
"stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.3;";if(typeof this.szBorderStyle!="undefined")switch(this.szBorderStyle){case "dotted":Ua="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:round;stroke-dasharray:1,50;";break;case "dashed":Ua="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:butt;stroke-dasharray:30,30;";break;case "solid":Ua="stroke-width:"+map.Scale.normalX(1)+";";break;case "none":Ua="stroke-width:0;"}if(typeof this.szBorderWidth!="undefined")switch(this.szBorderWidth){case "thin":Ua+=
"stroke-width:"+map.Scale.normalX(.3)+";";break;case "thick":Ua+="stroke-width:"+map.Scale.normalX(1.5)+";"}var xb=map.Dom.newShape("rect",T,0,0,1,1,"fill:"+(this.szBoxColor||"white")+";fill-opacity:"+(this.nBoxOpacity||1)+";stroke:"+sa+";"+Ua);xb.setAttributeNS(null,"id",this.szId+":"+xa+":chart:box");xb.style.setProperty("pointer-events","none","");switch(this.szSymbolBoxStyle){case "frame":this.boxShape.setAttributeNS(null,"fill-opacity",0);break;case "field":this.boxShape.setAttributeNS(null,
"fill-opacity",1)}}this.itemA[x].chartNode=T;T.setAttributeNS(szMapNs,"value",String(this.itemA[x].nValuesA[0]));Ja=this.drawChart(T,x,c,this.szFlag);var Xb=this.nScale;this.nScale=this.nAutoScale||this.nScale;var Ka=1;this.nMaxValue=="auto"&&(Ka=1/Math.pow(this.nMax,1/3)*Math.pow(this.nMaxValuePlot,1/3),map.Themes.autoScale||(this.fAutoScaleLeader=!0,map.Themes.autoScale=[]),Ka=map.Themes.autoScale[x]=map.Themes.autoScale[x]||Ka);Ja&&u&&T&&(this.szFlag.match(/PLOT/)&&this.nGridSize&&this.nAutoScale&&
(Ja.x+=this.nGridSize/2/this.nAutoScale*Ka,Ja.y-=this.nGridSize/2/this.nAutoScale*Ka),this.szFlag.match(/NOSCALE/)?T.fu.setMatrix([this.nScale,0,0,this.nScale,u.x-Ja.x*this.nScale,u.y-Ja.y*this.nScale]):T.fu.setMatrix([this.nChartGroupScaleX*Ka,0,0,this.nChartGroupScaleY*Ka,u.x-Ja.x*map.Layer.nObjectScale*this.nScale,u.y-Ja.y*map.Layer.nObjectScale*this.nScale]),this.itemA[x].ptPos&&this.itemA[x].ptPos2&&(T.setAttributeNS(szMapNs,"xEnd",this.itemA[x].ptPos2.x),T.setAttributeNS(szMapNs,"yEnd",this.itemA[x].ptPos2.y),
T.setAttributeNS(szMapNs,"dur",10)));this.nScale=Xb;if(Ja){xa=xa.split("*")[0];if((this.szFlag.match(/MULTIPLE/)||this.szFlag.match(/ALIGN/))&&T.lastChild.firstChild){var la=map.Dom.getBox(T.lastChild),yb=this.szFlag.match(/\bUP\b/)?la.height:la.width;if(this.chartPosA[xa]){this.chartPosA[xa]+=this.szFlag.match(/TEXTONLY/)?5:yb*.5;var $a=T.lastChild.fu.getPosition(),Xa=yb*(this.nGridX||10);this.szFlag.match(/\bUP\b/)?T.lastChild.fu.setPosition($a.x+la.width*Math.floor(this.chartPosA[xa]/Xa),$a.y-
la.y-la.height/2-this.chartPosA[xa]%Xa):T.lastChild.fu.setPosition($a.x+this.chartPosA[xa]%Xa,$a.y-la.height*Math.floor(this.chartPosA[xa]/Xa));this.chartPosA[xa]+=this.szFlag.match(/TEXTONLY/)?yb:yb*.5}else this.chartPosA[xa]=this.szFlag.match(/TEXTONLY/)?yb:-la.y;this.posItemA&&(this.posItemA[xa]||(this.posItemA[xa]=[]),this.posItemA[xa].push(this.itemA[x]))}else if((this.szFlag.match(/MULTIFIX/)||this.szFlag.match(/MULTIGRID/))&&T.lastChild){yb=1;var Lb=map.Scale.normalX(this.nCharSizeNormal*(this.nRangeScale||
1)),zb=map.Scale.normalX(this.nCharSizeNormal*(this.nRangeScale||1));if(u=this.getNodePosition(xa)){xa=String(u.x)+String(u.y);if(this.chartPosA[xa]){$a=T.lastChild.fu.getPosition();var tb=this.chartPosA[xa];Xa=this.nGridX||7;this.szFlag.match(/\bUP\b/)?T.lastChild.fu.setPosition($a.x+Lb*Math.floor(tb/Xa),$a.y-tb%Xa*zb):T.lastChild.fu.setPosition($a.x+tb%Xa*Lb,$a.y-zb*Math.floor(tb/Xa));this.chartPosA[xa]+=yb}else this.chartPosA[xa]=yb;this.posItemA&&(this.posItemA[xa]||(this.posItemA[xa]=[]),this.posItemA[xa].push(this.itemA[x]));
this.itemA[x].labelGroup&&tb%Xa!=Xa-1&&this.itemA[x].labelGroup.style.setProperty("display","none","")}}else if((this.szFlag.match(/MULTISQUARE/)||this.szFlag.match(/MULTIQUAD/))&&T.lastChild&&(yb=1,Lb=map.Scale.normalX(this.nCharSizeNormal*(this.nRangeScale||1)),zb=map.Scale.normalX(this.nCharSizeNormal*(this.nRangeScale||1)),u=this.getNodePosition(xa))){xa=String(u.x)+String(u.y);if(this.chartPosA[xa]){$a=T.lastChild.fu.getPosition();tb=this.chartPosA[xa];var Ob=Math.floor(Math.sqrt(tb));Ob<(this.nGridX||
1E7)?(Xa=tb-Ob*Ob,Pa=Xa<=Ob?Xa:Ob,k=Xa<=Ob?Ob:Ob-(Xa-Ob),T.lastChild.fu.setPosition($a.x+Pa*Lb,$a.y-k*zb)):($a=T.lastChild.fu.getPosition(),tb=this.chartPosA[xa],Xa=this.nGridX||7,this.szFlag.match(/\bUP\b/)?T.lastChild.fu.setPosition($a.x+Lb*Math.floor(tb/Xa),$a.y-tb%Xa*zb):T.lastChild.fu.setPosition($a.x+tb%Xa*Lb,$a.y-zb*Math.floor(tb/Xa)));this.chartPosA[xa]+=yb}else this.chartPosA[xa]=yb;this.posItemA&&(this.posItemA[xa]||(this.posItemA[xa]=[]),this.posItemA[xa].push(this.itemA[x]));this.itemA[x].labelGroup&&
tb%Xa!=Xa-1&&this.itemA[x].labelGroup.style.setProperty("display","none","")}if(this.szFlag.match(/TEXTONLY/)&&map.fCheckLabelOverlap){var uc=map.SVGDocument.getElementById(this.szId+":"+x+":text");uc&&new ixMap.Label.Item(uc)}a&&setRotate(T,-Number(a));this.fShadow===!0&&map.SVGDocument.getElementById(map.szShadowFilterId)?T.style.setProperty("filter","url(#"+map.szShadowFilterId+")",""):this.fShadow===!0&&(ca=map.Dom.newNode("filter",this.chartGroup.parentNode),ca.setAttributeNS(null,"id",map.szShadowFilterId),
ca.setAttributeNS(null,"filterUnits","objectBoundingBox"),ca.setAttributeNS(null,"x","-50%"),ca.setAttributeNS(null,"y","-50%"),ca.setAttributeNS(null,"width","200%"),ca.setAttributeNS(null,"height","200%"),aa=map.Dom.newNode("feGaussianBlur",ca),aa.setAttributeNS(null,"stdDeviation","10"),aa.setAttributeNS(null,"result","BlurAlpha"),aa=map.Dom.newNode("feOffset",ca),aa.setAttributeNS(null,"in","BlurAlpha"),aa.setAttributeNS(null,"dx","10"),aa.setAttributeNS(null,"dy","10"),aa.setAttributeNS(null,
"result","OffsetBlurAlpha"),aa=map.Dom.newNode("feColorMatrix",ca),aa.setAttributeNS(null,"in","OffsetBlurAlpha"),aa.setAttributeNS(null,"type","matrix"),aa.setAttributeNS(null,"values","0.1 0.1 0.1 0 0 0.1 0.1 0.1 0 0 0.1 0.1 0.1 0 0 0 0 0 1 0"),aa.setAttributeNS(null,"result","matrixOut"),aa=map.Dom.newNode("feMerge",ca),wa=map.Dom.newNode("feMergeNode",aa),wa.setAttributeNS(null,"in","matrixOut"),wa=map.Dom.newNode("feMergeNode",aa),wa.setAttributeNS(null,"in","SourceGraphic"),la=map.Dom.getBox(T.lastChild),
la.width&&la.height&&T.style.setProperty("filter","url(#"+map.szShadowFilterId+")",""))}}}}if(this.szFlag.match(/BOX/))if(this.nBoxUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nBoxUpper||this.nBoxLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nBoxLower){var ab=map.SVGDocument.getElementById(this.szId+":"+cb+":chart:box");ab&&ab.parentNode.removeChild(ab)}else for(qa=0;qa<this.indexA.length;qa++)if(x=this.indexA[qa],this.itemA[x].fDone){var cb=this.itemA[x].szSelectionId;T=map.SVGDocument.getElementById(this.szId+
":"+cb+":chart");v=map.SVGDocument.getElementById(this.szId+":"+cb+":chartgroup");ab=map.SVGDocument.getElementById(this.szId+":"+cb+":chart:box");if(T&&ab&&!ab.getAttributeNS(szMapNs,"boxed")){this.szFlag.match(/\bPLOT\b/)&&v&&v.style.setProperty("display","none");la=map.Dom.getBox(T);var Eb=map.Scale.normalX(this.nBoxMargin||2);Eb=Math.min(Eb*2,Eb*(la.width/map.Scale.normalX(c)));var lc=new point(la.x+la.width/2,la.y+la.height/2);if(this.szFlag.match(/CIRCULAR/)){var Dc=Math.max(la.width,la.height)/
2*1.1+Eb,cd=map.Dom.newShape("circle",ab.parentNode,lc.x,lc.y,Dc,"fill:"+(this.szBoxColor||"#eeeeee")+";stroke:"+(this.szBorderColor||"#dddddd")+";fill-opacity:"+(this.nBoxOpacity||1));ab.parentNode.insertBefore(cd,ab.parentNode.firstChild);ab.parentNode.removeChild(ab);la.x-=(Dc*2-la.width)/2;la.y-=(Dc*2-la.height)/2;la.height=la.width=Dc*2}if(this.szFlag.match(/TITLE/)&&this.szTitleField&&(!this.szTitleUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nTitleUpper)&&(!this.szTitleLower||
map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.nTitleLower)){z=map.Scale.normalX(5);this.szFlag.match(/DTEXT/)&&(z=Math.max(map.Scale.normalX(.9),Math.min(la.width/5,map.Scale.normalX(14/this.nScale))));this.szFlag.match(/GRIDSIZE/)&&(z=Math.max(la.width/10,map.Scale.normalX(6)));z*=this.nTextScale||this.nValueScale||1;var Yb=this.itemA[x].szTitle;try{Yb=map.HTMLWindow.ixmaps.htmlgui_onInfoTitle(this.itemA[x].szTitle,this.itemA[x])}catch(dc){}Yb+=this.szTitleUnits||"";var Ec=this.szTextColor||
"#888888",Zb=this.szFlag.match(/BOTTOMTITLE/)?la.y+la.height+z*1:la.y-z*.7;this.szFlag.match(/BAR/)&&!this.szFlag.match(/BOTTOMTITLE/)&&(Zb=this.nMaxValue?-this.nMaxValue*c/this.nScale:Zb);var Ab=null,$b=null;this.szFlag.match(/CIRCULAR/)?($b=map.Dom.newText(T,lc.x+10,Zb,"font-family:arial;font-size:"+z+"px;text-anchor:middle;fill:none;stroke:white;stroke-width:"+z/7+"px;opacity:0.5;pointer-events:none;",String(Yb||" ")),Ab=map.Dom.newText(T,lc.x+10,Zb,"font-family:arial;font-size:"+z+"px;text-anchor:middle;fill:"+
Ec+";stroke:none;pointer-events:none;",String(Yb||" "))):this.szAlign&&this.szAlign.match(/right/)?($b=map.Dom.newText(T,la.x+la.width,Zb,"font-family:arial;font-size:"+z+"px;text-anchor:end;fill:none;stroke:white;stroke-width:"+z/7+"px;opacity:0.5;pointer-events:none;",String(Yb||" ")),Ab=map.Dom.newText(T,la.x+la.width,Zb,"font-family:arial;font-size:"+z+"px;text-anchor:end;fill:"+Ec+";stroke:none;pointer-events:none;",String(Yb||" "))):($b=map.Dom.newText(T,la.x,Zb,"font-family:arial;font-size:"+
z+"px;text-anchor:start;fill:none;stroke:white;stroke-width:"+z/7+"px;opacity:0.5;pointer-events:none;",String(Yb||" ")),Ab=map.Dom.newText(T,la.x,Zb,"font-family:arial;font-size:"+z+"px;text-anchor:start;fill:"+Ec+";stroke:none;pointer-events:none;",String(Yb||" ")));map.Dom.wrapText($b,la.width);var vc=map.Dom.wrapText(Ab,la.width);this.szFlag.match(/BOTTOMTITLE/)||($b.fu.setPosition(Ab.fu.getPosition().x,Ab.fu.getPosition().y-z*1*(vc-1)),Ab.fu.setPosition(Ab.fu.getPosition().x,Ab.fu.getPosition().y-
z*1*(vc-1)));if(this.szFlag.match(/CLIPPEDTITLE/)){var Fb=la.height;la.height+=z*1.8;la.y-=la.height-Fb;map.Dom.setClipRect(Ab,new box(la.x,la.y-z*10,la.width-z/3,z*20))}else la=map.Dom.getBox(T),la.y+=z*.1,la.height-=z*.1;this.szTimeField&&(eb=(new Date(this.itemA[x].szTime)).getTime()||this.itemA[x].szTime,Ab.setAttributeNS(szMapNs,"time",eb))}if(this.szFlag.match(/\bPLOTX\b/))Fb=la.height,la.height=map.Scale.normalX(c),la.y=-map.Scale.normalX(c/2),la.width=this.nMax*map.Scale.normalX(c*1.1)/this.nMax*
5*(this.nRangeScale||1);else if(this.szFlag.match(/\bPLOTY\b/)){Fb=la.height;var dd=la.width;la.width=map.Scale.normalX(c);la.height=this.nMax*map.Scale.normalX(c*1.1)/this.nMax*5*(this.nRangeScale||1);la.x-=(la.width-dd)/2;la.y-=(la.height-Fb)/2}var Pb=la.height+Eb*2;la.width+Eb*2>=0&&Pb>=0&&(ab.setAttributeNS(null,"x",la.x-Eb),ab.setAttributeNS(null,"y",la.y-Eb),ab.setAttributeNS(null,"width",la.width+Eb*2),ab.setAttributeNS(null,"height",la.height+Eb*2));(this.szFlag.match(/AUTOSIZE/)||this.szFlag.match(/GRIDSIZE/))&&
la.width>la.height&&(ab.setAttributeNS(null,"y",la.y-Eb-(la.width-la.height)),ab.setAttributeNS(null,"height",la.width+Eb*2));if(typeof this.nBorderRadius!="undefined"&&!isNaN(this.nBorderRadius)){var qb=Math.min(map.Scale.normalX(this.nBorderRadius),map.Scale.normalX(this.nBorderRadius*(la.width/map.Scale.normalX(c))));ab.setAttributeNS(null,"rx",qb);ab.setAttributeNS(null,"ry",qb)}var Sb=map.Scale.normalX((this.szBorderWidth||1)*.2*(la.width/map.Scale.normalX(c)));ab.style.setProperty("stroke-width",
Sb);ab.setAttributeNS(szMapNs,"boxed","1");this.szFlag.match(/\bPLOT\b/)&&v&&v.style.setProperty("display","inline");this.szTimeField&&(console.log("---------!"),console.log("timestamp!"),eb=(new Date(this.itemA[x].szTime)).getTime()||this.itemA[x].szTime,ab.setAttributeNS(szMapNs,"time",eb))}}if(this.szFlag.match(/FEATURE/)){map.Themes.addToThemeNodesCache(this.chartGroup);var ub=map.Themes.getAllThemes();for(g in ub)ub[g]!=this&&!ub[g].szFlag.match(/FEATURE/)&&ub[g].szThemesA[0]==this.szThemesA[0]&&
ub[g].fDone&&(ub[g].fRealize=!0,setTimeout("map.Themes.execute()",500))}this.szItemFilter&&this.szItemFilter.length&&this.filterItems(this.szItemFilter,this.itemFilterOpt);this.markedClass!=null&&this.markClass(this.markedClass,1);this.isVisible=!0;this.realizeDone();this.fShowProgressBar=!1;displayProgressBar(1,1,"",1,"",1);this.showInfo();this.szFlag.match(/SHOWSTATISTIC/)&&this.showErrorInfo();if(this.szFlag.match(/\bCLIP\b/))if(this.nClipFrames==this.itemA[x].nValuesA.length)this.szXaxisA&&this.szXaxisA[this.nActualFrame]?
displayMessage(this.szXaxisA[this.nActualFrame],3E3,"big"):this.szLabelA&&this.szLabelA[this.nActualFrame]&&displayMessage(this.szLabelA[this.nActualFrame],3E3,"big");else{var Lc=this.szXaxisA||this.szLabelA;Lc&&(this.nActualFrame===0?displayMessage(Lc[0],3E3,"big"):this.nActualFrame==this.nClipFrames-1?displayMessage(Lc[1],3E3,"big"):displayMessage(" ... ",3E3,"big"))}else this.ErrorMessage?(displayMessage(this.ErrorMessage,1E4,"notify"),this.ErrorMessage=null):clearMessage();this.fSorted||(this.fResort=
!0,map.Themes.execute());this.szFlag.match(/DECLUTTER/)&&this.declutterCharts();this.szFlag.match(/\bANIMATESCALE\b/)&&this.animateCharts("scale");this.szFlag.match(/\bANIMATESCALEXX\b/)&&this.animateCharts("fire");if(this.szFlag.match(/\bUSER\b/))try{pa={target:this.chartGroup,theme:this},this.userDraw&&(this.opt=pa,eval("map.HTMLWindow.ixmaps."+this.userDraw+"_finish(map.SVGDocument,this.opt);"),delete this.opt)}catch(dc){}}};A.prototype.sortChartObjects=function(){if(!(!this.chartGroup||this.szFlag.match(/NOSRT/)||
this.szFlag.match(/NOSIZE/)&&!this.szFlag.match(/3D/)||this.szFlag.match(/CATEGORICAL/)&&!this.szFlag.match(/AGGREGATE/)&&!this.szSizeField)){var d=[],c=this.chartGroup.childNodes;if(this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||this.szFlag.match(/BUFFER/)||this.szFlag.match(/TEXTONLY/))for(var e=0;e<c.length;e++){var b=c.item(e);d[e]={node:b,y:Math.abs(Number(b.getAttributeNS(szMapNs,"value")))}}else{var n=getRotateAttributeValue(map.Scale.canvasNode)/180*Math.PI;for(e=0;e<c.length;e++)b=
c.item(e),d[e]=n?{node:b,y:getTranslate(b).x*Math.sin(n)+getTranslate(b).y*Math.cos(n)}:{node:b,y:getTranslate(b).y}}this.szFlag.match(/\bSORT\b/)&&this.szFlag.match(/\bUP\b/)&&!this.szFlag.match(/SEQUENCE/)?d.sort(this.sortDownChartObjectsCompare):d.sort(this.sortUpChartObjectsCompare);for(e=0;e<d.length;e++)d[e].node.parentNode.appendChild(d[e].node);var m;(m=getMatrix(this.chartGroup))&&setMatrix(this.chartGroup,m)}};A.prototype.sortUpChartObjectsCompare=function(d,c){return d.y-c.y};A.prototype.sortDownChartObjectsCompare=
function(d,c){return c.y-d.y};A.prototype.getChartSize=function(d,c,e,b){if(e.match(/NOSIZE/))return Math.max(5,c/4);b=Math.abs(b);var n=Math.max(5,c/2),m=this.nMax-this.nMin;this.nNormalSizeValue&&(m=this.nMaxSize=this.nNormalSizeValue);var u=this.itemA[d].nValue100A[0];e.match(/SIZE/)&&!e.match(/NORMSIZE/)&&this.szSizeField&&d&&this.itemA[d]?n=e.match(/SIZELOG/)?Math.max(1,n/Math.log(this.nMaxSize)*Math.log(this.itemA[d].nSize)):n/Math.pow(this.nMaxSize,1/this.nSizePow)*Math.pow(this.itemA[d].nSize,
1/this.nSizePow):e.match(/SIZE/)&&!e.match(/NORMSIZE/)&&(n=e.match(/SIZELOG/)?Math.max(1,n/Math.log(m)*Math.log(b)):n/Math.pow(m,1/this.nSizePow)*Math.pow(b,1/this.nSizePow));map.Scale.normalX(10);!e.match(/HEIGHT/)||e.match(/NORMSIZE/)||e.match(/SIZE/)||u&&this.nMax100&&this.nMin100&&e.match(/FRACTION/);e.match(/ZOOM/)&&(this.origSize=n*=map.Scale.nObjectScaling,n=c/10+n*1/(Math.log(Math.abs(m))*Math.log(Math.abs(b))||1),n=Math.min(n,c),n=Math.max(n,c/5));return Math.abs(n)};A.prototype.checkChartSize=
function(d,c,e,b){return this.nChartSizeMin&&!e.match(/ZOOM/)&&this.getChartSize(d,c,e,b)/map.Layer.nObjectScale<this.nChartSizeMin?!1:!0};A.prototype.getChart=function(d,c,e,b,n){this.fRealizeDone||this.realize();return this.drawChart(d,c,e,b,n)};A.prototype.drawChart=function(d,c,e,b,n){var m=null,u=0,z=0;this.szChartFlag=b;if(c){if(!this.itemA[c])return null;this.itemA[c].fDone=!1;m=this.itemA[c].nValuesA;u=this.itemA[c].nValue100A[0];z=Math.max(this.nMax,Math.abs(this.nMin));var x=0;if(!this.szFlag.match(/BUFFER/))for(var w=
0;w<m.length;w++)isNaN(m[w])&&(m[w]=0),x+=m[w];if(this.szFlag.match(/MORPH/)&&this.szFlag.match(/\bCLIP\b/)&&this.nClipFrames){m=[];var O=this.itemA[c].nValuesA;for(w=0;w<O.length/2;w++){var a=O[w]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+O[w+O.length/2]*this.nActualFrame/(this.nClipFrames-1);m[w]=a}for(w=x=0;w<m.length;w++)isNaN(m[w])&&(m[w]=0),x+=m[w]}if(b.match(/NOPE/))return new point(0,0);if(b.match(/\bDOT\b/)){var f=1;a=m[0];if(b.match(/CATEGORICAL/))this.chart.szColor=this.colorScheme[a];
else if(this.colorScheme.length>2||this.szRanges&&this.szRanges.length)for(Nb=!1,w=0;w<this.partsA.length;w++)if(a<this.partsA[w].max){this.chart.szColor=this.colorScheme[w];var g=L(E);b.match(/NOLINES/)?this.chart.szLineColor="none":this.chart.szLineColor=g.textColor;b.match(/RANGE/)&&!b.match(/RANGES/)&&(f=map.Scale.normalX(2+5*(w+1)/this.partsA.length));sa=w;Nb=!0;break}I=map.Dom.newShape("circle",d,0,0,map.Scale.normalX(3),"fill:"+this.chart.szColor+";stroke:none;");return new point(0,0)}}else{m=
[];x=0;b=b||this.szFlag+"|XAXIS";if(this.szOrigFlag.match(/CATEGORICAL/))if(this.szOrigFlag.match(/SUM/))for(w=0;w<this.colorScheme.length;w++)this.partsA[w]&&(m[w]=this.partsA[w].nSum,z=Math.max(z,this.partsA[w].nSum),x+=m[w]);else if(this.szOrigFlag.match(/COUNT/))for(w=0;w<this.colorScheme.length;w++)m[w]=this.partsA[w].nSum*100,z=Math.max(z,this.partsA[w].nSum*100),x+=m[w];else for(w=0;w<this.colorScheme.length;w++)m[w]=this.nOrigSumA[w]||this.exactCountA[w]||1,z=Math.max(z,this.nOrigSumA[w]||
this.exactCountA[w]||1);else if(this.szOrigFlag.match(/COUNT/))for(w=0;w<this.colorScheme.length;w++)m[w]=this.partsA[w].nCount,z=Math.max(z,this.partsA[w].nCount),x+=m[w];else for(w=0;w<this.colorScheme.length;w++)m[w]=this.partsA[w].nSum,z=Math.max(z,this.partsA[w].nSum),x+=m[w];if(u=this.nSum100){z=0;x=u;for(w=m.length-1;w>=0;w--)this.szFlag.match(/DIFFERENCE/)?u=w>0?m[w-1]:this.nSum100:this.szFlag.match(/CALCVAL/)||this.szFlag.match(/CALC100/)?m[w]=m[w]:this.szFlag.match(/PRODUCT/)?m[w]=m[w]:
(m[w]/=u,z=Math.max(z,m[w]),this.szFlag.match(/PERMILLE/)?m[w]*=1E3:this.szFlag.match(/FRACTION/)||(m[w]*=100),this.szFlag.match(/RELATIVE/)&&(m[w]-=100),this.szFlag.match(/INVERT/)&&(m[w]=100-m[w]));if(this.szFlag.match(/STACKED/)){if(z=100,this.szFlag.match(/NORMSIZE/)||b.match(/NORMSIZE/))for(w=z=0;w<m.length;w++)z+=m[w]}else z*=100,z+=z/10,z=this.nMax}else{if(this.szFlag.match(/DIFFERENCE/))for(w=m.length-1;w>=0;w--)w>0?m[w]-=m[w-1]:this.szFlag.match(/STACKED/)||(m[w]=0);if(c&&this.szAggregation&&
this.szAggregation.match(/mean/)){for(w=0;w<m.length;w++)m[w]/=this.nCount;z=this.szFlag.match(/MENUSIZE/)?z/this.nCount:this.nMax}if(this.szFlag.match(/MEAN/))for(w=0;w<m.length;w++)m[w]/=this.partsA[w].nCount;if(this.szFlag.match(/STACKED/)&&(this.szFlag.match(/NORMSIZE/)||b.match(/NORMSIZE/)||this.szFlag.match(/MENUSIZE/)||b.match(/MENUSIZE/)))for(w=z=0;w<m.length;w++)z+=m[w]}}if(this.nChartSizeMin&&!b.match(/ZOOM/)){if(f=c?this.getChartSize(c,e,b,x):1,f/map.Layer.nObjectScale<this.nChartSizeMin)return null}else if(!this.szFlag.match(/MULTIFIX|MULTIGRID|MULTIQUAD/)&&
(f=c?this.getChartSize(c,e,b,x):1,isNaN(f)||f===0))return null;var l=new point(0,0);if(!b)b=this.szFlag;else if(!b.match(/CHART/)&&b.match(/VALUES/)||b.match(/NORMSIZE/)||b.match(/MENUSIZE/))b=this.szFlag+"|"+b;b.match(/DOMINANT|COMPOSE/)&&!b.match(/CHART/)&&(b=b.match(/PERCENTOFMEAN/)?"BAR|OFFSETMEAN|POINTER|XAXIS|VALUES|ZOOM":b.match(/PERCENTOFMEDIAN/)?"BAR|OFFSETMEDIAN|POINTER|XAXIS|VALUES|ZOOM":b.match(/DEVIATION/)?"BAR|DEVIATION|POINTER|VALUES|ZOOM":"BAR|XAXIS|HORZ|SORT|VALUES|ZOOM");b.match(/ZOOM/)&&
b.match(/BAR/)&&b.match(/POINTER/)&&m.length>1&&(b=this.removeDefinition(b,"SIZE")+"|COMPRESSMAX");if(m.length==1&&m[0]===0&&!b.match(/ZEROISVALUE|AUTOCOMPLETE|CATEGORICAL/))return this.nZeroValueCount++,null;b.match(/VALUES/)&&(this.fHideValues=!1,b.match(/ZOOM/)||(this.fHideValues=this.szValueUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nValueUpper||this.szValueLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nValueLower),b.match(/ZOOM/)&&b.match(/PIE/)&&m.length>25&&(b=this.removeDefinition(b,
"VALUES")));var h=map.Dom.newGroup(d,this.szId+":"+c+(c?":chartgroup":":ochrtgroup")),r=null,C=null;b.match(/MOVABLE/)&&(h.setAttributeNS(null,"id",h.getAttributeNS(null,"id")+":movable"),h.setAttributeNS(null,"onmousedown",'map.Themes.initChartOffset(evt,"'+this.szId+'","'+this.szId+":"+c+':chartgroup:movable")'),h.setAttributeNS(null,"onmouseup",'map.Themes.endChartOffset(evt,"'+this.szId+'","'+this.szId+":"+c+':chartgroup:movable")'));if(b.match(/CHOROPLETH/)){var F=map.Scale.normalX(e/2),v=F*
2/3,E=this.colorScheme[0],M=this.colorScheme[1]?this.colorScheme[1]:"none",G=map.Scale.normalX(.1)*map.Scale.nFeatureScaling*map.Scale.nObjectScaling,I=map.Dom.constructNode("use",h,{"xlink:href":"#choropleth_icon"});I.fu.scale(2,2);e=v*2/map.Scale.normalX(1);l.x=0;l.y=v+map.Scale.normalY(5)}if(b.match(/BLANK/))return null;if(b.match(/\bUSER\b/))try{F=map.Scale.normalX(e/2);if(b.match(/AUTOSIZE/)){var ea=map.Layer.nDynamicObjectScale,pa=b.match(/\bRECT\b/)?b.match(/GAP/)?2.3:2:b.match(/GAP/)?1.7:
1.6;R=Math.max(this.nAllMaxValue,this.nMax);F=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/pa/ea:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/pa/ea:F}var R=Math.max(this.nMax,this.nMaxA[0]);this.nNormalSizeValue&&(this.nMaxSize=R=this.nNormalSizeValue);a=this.itemA[c].nValuesA[0];E=this.colorScheme[0];M=this.colorScheme[1]?this.colorScheme[1]:"none";var ca=this.colorScheme[1]?this.colorScheme[1]:"white";if(this.colorScheme.length>2||b.match(/CATEGORICAL/))E=this.colorScheme[this.colorScheme.length-
1],M=this.colorScheme[0];b.match(/NOLINES/)?M="none":M=="none"&&(g=L(E),M=g.lowColor);if(b.match(/CATEGORICAL/))sa=a-1,E=this.colorScheme[sa]||this.colorScheme[0],g=L(E),ca=g.textColor,M=b.match(/NOLINES/)?"none":g.lowColor,b.match(/RANGE/)&&!b.match(/RANGES/)&&(v=map.Scale.normalX(2+5*(w+1)/this.partsA.length)),Nb=!0;else if(this.szFlag.match(/COMPOSECOLOR/))this.szFlag.match(/SUBTRACTIVE/)?this.itemA[c].szColor=ia(this.itemA[c].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255)):
this.itemA[c].szColor=Z(this.itemA[c].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255));else if(this.colorScheme.length>2||this.partsA.length>1||this.szRanges&&this.szRanges.length)if(Nb=!1,this.szFlag.match(/DOMINANT/)){var aa=0,wa=0;ja=-1;for(w=0;w<this.itemA[c].nValuesA.length;w++){a=this.itemA[c].nValuesA[w];var qa=100/this.nMeanA[w]*a,T=100/this.nMedianA[w]*a,xa=(a-this.nMeanA[w])/this.nDeviationA[w];aa=a;this.szFlag.match(/PERCENTOFMEAN/)&&(aa=qa);this.szFlag.match(/PERCENTOFMEDIAN/)&&
(aa=T);this.szFlag.match(/DEVIATION/)&&(aa=xa);a>this.nFilterA[w]&&aa>wa&&(this.itemA[c].nClass=w,wa=aa,ja=w)}ja>=0&&(this.itemA[c].nDominant=ja,a=this.itemA[c].nValuesA[ja],ha=" "+this.szFieldsA[ja]+" ",this.szLabelA&&this.szLabelA[ja]&&(ha=" "+this.szLabelA[ja]+" "),this.itemA[c].nValue=this.itemA[c].nValuesA[ja],this.itemA[c].szLabel=ha,E=this.colorScheme[ja],g=L(E),ca=g.textColor,M=b.match(/NOLINES/)?"none":g.lowColor,sa=ja,Nb=!0,a=m[sa||0])}else for(w=0;w<this.partsA.length;w++)if(a>=this.partsA[w].min&&
a<this.partsA[w].max){E=this.colorScheme[w];g=L(E);ca=g.textColor;M=b.match(/NOLINES/)?"none":g.lowColor;b.match(/RANGE/)&&!b.match(/RANGES/)&&(v=map.Scale.normalX(2+5*(w+1)/this.partsA.length));sa=w;Nb=!0;break}if(this.szFlag.match(/\bCLIP\b/)&&!this.szFlag.match(/MORPH/)&&this.nClipFrames&&(this.nClipFrames==m.length?(a=Number(m[this.nActualFrame]),R=this.nNormalSizeValue||this.nMaxA[this.nActualFrame]):a=m[0]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+m[m.length-1]*this.nActualFrame/
(this.nClipFrames-1),a===0&&!b.match(/ZEROISVALUE/))||b.match(/INVERTSIZE/)&&R-m[0]===0&&!b.match(/ZEROISVALUE/))return null;var Ja=c&&this.itemA[c]&&this.szSizeField?this.itemA[c].nSize||0:a,Da=c&&this.itemA[c]&&this.szSizeField?this.nMaxSize:R;if(Ja===0&&!b.match(/NOSIZE/)||this.nMinValue&&Ja<this.nMinValue)return null;v=b.match(/GRIDSIZE/)?this.nGridSize:b.match(/MENUSIZE/)?map.Scale.normalX(e/2.5):b.match(/CATEGORICAL/)&&!this.szSizeField?F/3/(this.nNormalSizeValue||1):b.match(/NOSIZE/)?F/2:b.match(/FIXSIZE/)?
F/2/(this.nNormalSizeValue||1):b.match(/NORMSIZE/)?F*2/3/(b.match(/CATEGORICAL/)?1:Math.log(Da)*Math.log(Math.abs(Ja))):b.match(/SUM/)&&!c?F*2/3:F/Math.pow(Da,1/this.nSizePow)*Math.pow(Math.abs(Ja),1/this.nSizePow);h.parentNode.setAttributeNS(szMapNs,"value",String(a));h.parentNode.setAttributeNS(szMapNs,"class",String(sa));var Za=L(E).lowColor,ib=this.objThemesA[this.szThemesA[0]],Aa={target:h,theme:this,item:this.itemA[c],value:a,values:m,size:v,maxSize:F,color:E,textcolor:Za,ccolor:L(E),class:sa,
flag:b,mark:n,dbRecord:ib.dbRecords?ib.dbRecords[this.itemA[c].dbIndex]:null};this.ptNullUser=null;this.userDraw?(this.opt=Aa,eval("this.ptNullUser = map.HTMLWindow.ixmaps."+this.userDraw+"(map.SVGDocument,this.opt);"),delete this.opt):this.ptNullUser=map.HTMLWindow.ixmaps.htmlgui_drawChart(map.SVGDocument,Aa);this.ptNullUser?(h.fu.setPosition(h.fu.getPosition().x-this.ptNullUser.x,h.fu.getPosition().y-this.ptNullUser.y),this.ptNullUser.x=0,this.ptNullUser.y=0):this.userChartDrawError=(this.userChartDrawError||
0)+1}catch(Hd){}if(b.match(/PIE/)){if(x===0&&!b.match(/AUTOCOMPLETE/))return null;if(b.match(/\bSORT\b/)){this.sortedIndex=[];for(w=0;w<m.length;w++)this.sortedIndex[w]={index:w,value:m[w]};this.sortedIndex.sort(this.sortIndexDown)}else this.sortedIndex=null;if(b.match(/\bREVERSE\b/))for(this.sortedIndex=[],w=0;w<m.length;w++)this.sortedIndex[w]={index:m.length-w,value:m[w]};this.nCenterValue=0;if(b.match(/CENTER/)){for(var wb=this.nCenter=0,eb=-Number.MAX_VALUE,nb=Number.MAX_VALUE,oa=0;oa<(this.nClipParts||
m.length);oa++){var Ca=this.sortedIndex?this.sortedIndex[oa].index:oa;wb+=m[Ca]||0;m[Ca]<nb&&(nb=m[Ca],this.nCenterMin=Ca);m[Ca]>eb&&(eb=m[Ca],this.nCenterMax=Ca)}this.szCenterPart=this.szCenterPart||"max",this.szCenterPart=="first"?this.nCenter=0:this.szCenterPart=="last"?this.nCenter=m.length-1:this.szCenterPart=="min"?this.nCenter=this.nCenterMin:this.szCenterPart=="max"?this.nCenter=this.nCenterMax:Number(this.szCenterPart)&&(this.nCenter=Number(this.szCenterPart));this.nCenterValue=m[this.nCenter];
this.nCenterSize=this.nCenterValue/wb*100}var Ma=0;f=Math.max(5,e/2);var Oa=this.nMax-this.nMin,db=this.nMax100-this.nMin100;this.nNormalSizeValue&&(Oa=db=this.nNormalSizeValue);b.match(/GRIDSIZE/)&&!b.match(/NORMSIZE/)?f=this.nGridSize/e*(b.match(/\bRECT\b/)?.72:.6):b.match(/SIZE/)&&!b.match(/NORMSIZE/)&&this.szSizeField&&c&&this.itemA[c]?f=b.match(/SIZELOG/)?Math.max(1,f/Math.log(this.nMaxSize)*Math.log(this.itemA[c].nSize)):f/Math.pow(this.nMaxSize,1/this.nSizePow)*Math.pow(this.itemA[c].nSize,
1/this.nSizePow):b.match(/SIZE/)&&!b.match(/NORMSIZE/)&&(f=b.match(/SIZELOG/)?Math.max(1,f/Math.log(Oa)*Math.log(x)):f/Math.pow(Oa,1/this.nSizePow)*Math.pow(x,1/this.nSizePow));Ma=map.Scale.normalX(10);b.match(/HEIGHT/)&&!b.match(/NORMSIZE/)&&(Ma=b.match(/SIZE/)?this.szSizeField&&c&&this.itemA[c]?Ma*Math.pow(10/Oa*this.itemA[c].nSize,1/3)*3:Ma*Math.pow(10/Oa*x,1/3)*3:u&&this.nMax100&&this.nMin100&&!b.match(/FRACTION/)?Ma*10/db*u:Ma*10/Oa*x);b.match(/ZOOM/)&&(this.origSize=f*=map.Scale.nObjectScaling,
f=e/10+f*3/Math.log(Oa)*Math.log(x)*map.Layer.nDynamicObjectScale,f=Math.min(f,e*1.2),f=Math.max(f,e/2));for(var Pa=[],k=0;k<(this.nGridX||1);k++){var p=DonutCharts.newChart(map.SVGDocument,h,0,0,map.Scale.normalX(f),0);p.ident=k;l.x=0;l.y=map.Scale.normalY(f)+map.Scale.normalY(5);p.setStyle("flat");p.setLine("#555566");p.setLineWidth(map.Scale.normalX(this.nLineWidth||.1));b.match(/NOLINES/)&&p.setLine("none");b.match(/WHITELINES/)&&p.setLine("white");this.szLineColor&&p.setLine(this.szLineColor);
if(b.match(/3D/)){p.setStyle("3D");var q=.5;b.match(/P3/)?q=1/3:b.match(/P4/)&&(q=.25);b.match(/SIZE/)&&!b.match(/NORMSIZE/)&&this.szSizeField&&c&&this.itemA[c]?Ma=Ma/Math.pow(this.nMaxSize,q)*Math.pow(this.itemA[c].nSize,q):b.match(/SIZE/)&&!b.match(/NORMSIZE/)&&(Ma=Ma/Math.pow(Oa,q)*Math.pow(x,q));b.match(/ZOOM/)&&(Ma*=map.Scale.nObjectScaling,Ma=Ma/this.origSize*f);l.y*=.7}b.match(/VOLUME/)&&p.addStyle("VOLUME");if(b.match(/DONUT/))b.match(/3D/)?p.setRadInner(map.Scale.normalX(f*.5)):b.match(/XTHIN/)?
p.setRadInner(map.Scale.normalX(f*.95)):b.match(/THIN/)?p.setRadInner(map.Scale.normalX(f*.66)):b.match(/THICK/)?p.setRadInner(map.Scale.normalX(f*.25)):p.setRadInner(map.Scale.normalX(f*.42));else if(b.match(/CENTER/)){var D=Math.sqrt(Math.pow(map.Scale.normalX(f),2)/100*this.nCenterSize);p.setRadInner(D)}b.match(/STARBURST/)&&(p.addStyle("STARBURST"),l.y*=.8);if(b.match(/XLFLOWER/)||b.match(/XLRAYS/))p.addStyle("XLRAYS"),l.y*=.8;else if(b.match(/LFLOWER/)||b.match(/LRAYS/))p.addStyle("LRAYS"),l.y*=
.8;else if(b.match(/XSFLOWER/)||b.match(/XSRAYS/))p.addStyle("XSRAYS"),l.y*=.8;else if(b.match(/SFLOWER/)||b.match(/SRAYS/))p.addStyle("SRAYS"),l.y*=.8;else if(b.match(/FLOWER/)||b.match(/RAYS/))p.addStyle("RAYS"),l.y*=.8;b.match(/SILENT/)&&p.addStyle("SILENT");b.match(/AUTOCOMPLETE/)&&(p.addStyle("AUTOCOMPLETE"),p.szNoDataColor=this.szNoDataColor||"#eeeeee");b.match(/BIGTOTOP/)&&p.addStyle("BIGTOTOP");b.match(/NOROTATE/)&&p.addStyle("NOROTATE");b.match(/ROTATE/)&&p.addStyle("ROTATE");b.match(/SYMMETRIC/)&&
p.addStyle("SYMMETRIC");b.match(/HALFPLUS20/)&&(p.addStyle("HALFPLUS20"),p.addStyle("NOROTATE"));b.match(/HALFMINUS20/)&&(p.addStyle("HALFMINUS20"),p.addStyle("NOROTATE"));b.match(/HALFPLUS10/)&&(p.addStyle("HALFPLUS10"),p.addStyle("NOROTATE"));b.match(/HALFMINUS10/)&&(p.addStyle("HALFMINUS10"),p.addStyle("NOROTATE"));b.match(/HALF/)&&(p.addStyle("HALF"),p.addStyle("NOROTATE"));b.match(/DIRECTION/)&&p.addStyle("DIRECTION");b.match(/DIRECTED/)&&p.addStyle("DIRECTED");b.match(/POLAR/)&&k==(this.nGridX||
1)-1&&p.addStyle("POLAR");var H=0,N=0;R=0;if(b.match(/DONUT/))for(w=0;w<m.length;w++)m[w]>m[H]&&(H=w),m[w]<m[N]&&(N=w);if(b.match(/STARBURST/)){for(w=0;w<m.length;w++)m[w]=Math.max(m[w],0),R=Math.max(R,this.nMaxA[w]);b.match(/\bSIZE\b/)||p.setNormalSizeValue(this.nNormalSizeValue||this.nMaxValue||R);p.setMaxValue(this.nMaxValue||R)}b.match(/BOW/)&&(p.nBow=1.3);b.match(/SBOW/)&&(p.nBow=1.2);b.match(/XSBOW/)&&(p.nBow=1.1);b.match(/LBOW/)&&(p.nBow=1.5);b.match(/XLBOW/)&&(p.nBow=1.8);Pa.push(p)}for(w=
0;w<(this.nClipParts?Math.min(this.nClipParts,m.length):m.length);w++){var S=w%(this.nGridX||1);p=Pa[S];var ha="";Ca=w;this.sortedIndex&&(Ca=this.sortedIndex[Ca].index);var Ia=Ca;if(!b.match(/CENTER/)||b.match(/DONUT/)||Ca!=this.nCenter){ha=this.szLabelA&&this.szLabelA[Ca]?" '"+this.szLabelA[Ca]+"'":" '"+this.szFieldsA[Ca]+"'";E=c?this.itemA[c].szColor||this.colorScheme[Ca]:this.colorScheme[Ca];E=c?this.itemA[c].szColor||this.colorScheme[Ca%(this.nGridX||1E5)]:this.colorScheme[Ca%(this.nGridX||1E6)];
if(b.match(/CLASSES/)||m.length==1)for(gb=0;gb<this.partsA.length;gb++)if(b.match(/CATEGORICAL/)&&m[Ca]==this.partsA[gb].min||!b.match(/CATEGORICAL/)&&m[Ca]<this.partsA[gb].max){E=this.colorScheme[gb];Ia=gb;break}var mb=(b.match(/AUTOCOMPLETE/)&&!this.szUnit.match(/%/)?" % ":"")+this.szUnit;if(this.szShowParts){var Sc=E;E="none";for(oa in this.szShowPartsA)this.szShowPartsA[oa]==Ca&&(E=Sc)}if(m[Ca]>0||m[Ca]===0&&!b.match(/ZEROISNOTVALUE/)){if(b.match(/COUNT/)&&this.itemA[c].nCountA)var vb=p.addPart(m[Ca],
Ma,E,0,this.formatValue(this.itemA[c].nCountA[Ca],this.nValueDecimals||(this.itemA[c].nCountA[Ca]<1?2:0),"ROUND")+mb,ha);else S==0&&(Uc=0),vb=p.addPart(m[Ca]+(b.match(/STACKED/)?Uc:0),Ma,E,0,(this.szAggregation&&this.szAggregation.match(/sum/),this.formatValue(m[Ca],this.nValueDecimals||(m[Ca]<1?2:0),"ROUND")+mb),ha),Uc+=m[Ca];vb.nClass=Ia;if(b.match(/DIRECTION|DIRECTED/)){var Rb=this.itemA[c].ptPos,Vb=this.getNodePosition(this.szThemesA[0]+"::"+this.szLabelA[Ca]);Rb&&Vb&&(vb.nAngle=(450-180/Math.PI*
Math.atan2(Rb.y-Vb.y,Vb.x-Rb.x))%360)}}this.colorScheme[w]=="none"&&p.setLine(this.szLineColor||"black")}}p.partsA.length<2&&c&&this.itemA[c].nCount==1&&(p.nRadInner=0);for(k=(this.nGridX||1)-1;k>=0;k--)Pa[k].realize();if(b.match(/CENTER/)&&!b.match(/DONUT/)){v=Math.sqrt(Math.pow(map.Scale.normalX(f),2)/100*this.nCenterSize);E=this.colorScheme[this.nCenter];var Bc=map.Dom.newShape("circle",h,0,0,v*.9,"fill:"+E+";");Bc&&(Bc.setAttributeNS(szMapNs,"class",String(this.nCenter)),Bc.setAttributeNS(szMapNs,
"tooltip",this.szLabelA?this.szLabelA[this.nCenter]+": "+m[this.nCenter]+this.szUnit:m[this.nCenter]+this.szUnit));if(b.match(/GLOW/)&&!b.match(/ZOOM/)&&(!this.szGlowUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nGlowUpper)&&(!this.szGlowLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.nGlowLower)){var sb=map.Dom.newShape("circle",h,0,0,v*6,"fill:"+E+";stroke:none;fill-opacity:0.05;pointer-events:none;");sb&&sb.setAttributeNS(szMapNs,"class",String(Na));var ob=map.Dom.newShape("circle",
h,0,0,v*2,"fill:"+E+";stroke:none;fill-opacity:0.1;pointer-events:none;");ob&&ob.setAttributeNS(szMapNs,"class",String(Na))}if(b.match(/CENTERVALUE/)||b.match(/ZOOM/)||b.match(/VALUES/)&&!this.fHideValues){var ta=this.formatValue(this.nCenterValue,this.nValueDecimals||0,"ROUND")+(this.szUnit.length<=5?this.szUnit:"");g=L(E);ca=g.textColor;var za=String(Math.min(v*.8,3.3/ta.length*v)*this.nValueScale),tc=map.Dom.newText(h,0,za*.33,"font-family:arial;font-size:"+za+"px;font-weight:bold;text-anchor:middle;fill:"+
ca+";opacity:"+String(this.nOpacity?this.nOpacity:1)+";stroke:none;pointer-events:none",ta);tc&&tc.setAttributeNS(szMapNs,"class",String(this.nCenter))}}else if(b.match(/CENTERVALUE/)){ta=String(this.itemA[c].nCount||this.itemA[c].nSize);ca=this.szValueColor||this.szTextColor||"#888888";v=map.Scale.normalX(f);za=String(Math.min(v*.5,2/ta.length*v));var fb=this.nValueSizeMin?za/map.Scale.normalX(5):1;map.Dom.newText(h,0,za*.35,"font-family:arial;font-size:"+za+"px;text-anchor:middle;fill:none;stroke:black;stroke-width:"+
za/40+";stroke-opacity:0.5;pointer-events:none;stroke-linejoin:bevel;",ta);var ba=map.Dom.newText(h,0,za*.35,"font-family:arial;font-size:"+za+"px;text-anchor:middle;fill:"+ca+";opacity:"+fb+";stroke:none;pointer-events:none",ta)}!b.match(/VALUES/)||b.match(/STACKED/)||!b.match(/ZOOM/)&&this.fHideValues||(za=Math.min(f*.8,3.4/(p.partsA[0]?p.partsA[0].szText.length:1)*f),m.length>1||b.match(/NOINLINETEXT/)||b.match(/ZOOM/)&&za<6?(za=b.match(/ZOOM/)||b.match(/NORMSIZE/)?map.Scale.normalX(8):map.Scale.normalX(5*
(this.nValueScale||1)),this.drawDonutText(p,za)):(ta=p.partsA[0]?p.partsA[0].szText:"",g=L(E),ca=this.szValueColor||this.szTextColor||g.textColor,v=map.Scale.normalX(f),za=String(Math.min(v*.8,3.4/ta.length*v)),fb=this.nValueSizeMin?za/map.Scale.normalX(5):1,b.match(/VOLUME/)&&(Ma=p.donutPartsA[0].nHeight),b.match(/3D/)||(Ma=v*.6),ba=map.Dom.newText(h,0,-Ma+v/2+za*.45,"font-family:arial;font-size:"+za+"px;text-anchor:middle;fill:"+ca+";opacity:"+fb+";stroke:none;pointer-events:none",ta),b.match(/3D/)&&
(ba.fu.setPosition(0,-v/2+za*(b.match(/VOLUME/)?.5:.25)),ba.fu.scale(1,.5))));this.fillOpacity&&h.setAttributeNS(null,"fill-opacity",String(this.fillOpacity));this.nOpacity&&(h.setAttributeNS(null,"fill-opacity",String(this.nOpacity)),h.setAttributeNS(null,"stroke-opacity",String(this.nOpacity)));if(b.match(/FADEDEVIATION/)){var kc=(m[0]-this.nMeanA[0])/this.nDeviationA[0];kc>10&&(fb=3.1622776601683795/Math.pow(kc,.5),h.setAttributeNS(null,"opacity",String(fb)))}else b.match(/LIMITDEVIATION/)&&(kc=
(m[0]-this.nMeanA[0])/this.nDeviationA[0],kc>10&&h.setAttributeNS(null,"opacity","0"));b.match(/ZOOM/)&&b.match(/STARBURST/);if(m.length==1&&b.match(/CATEGORICAL/))p.donutPartsA[0]&&(p.donutPartsA[0].objNode.setAttributeNS(szMapNs,"class",d.getAttributeNS(szMapNs,"class")),p.donutPartsA[0].objNode.setAttributeNS(szMapNs,"part",String(w)),p.donutPartsA[0].textNode&&(p.donutPartsA[0].textNode.setAttributeNS(szMapNs,"class",d.getAttributeNS(szMapNs,"class")),p.donutPartsA[0].textNode.setAttributeNS(szMapNs,
"part",String(w))));else for(w=0;w<p.donutPartsA.length;w++)p.donutPartsA[w]&&(p.donutPartsA[w].objNode.setAttributeNS(szMapNs,"class",String(p.partsA[w].nClass)),p.donutPartsA[w].objNode.setAttributeNS(szMapNs,"part",String(w)),p.donutPartsA[w].textNode&&(p.donutPartsA[w].textNode.setAttributeNS(szMapNs,"class",String(p.partsA[w].nClass)),p.donutPartsA[w].textNode.setAttributeNS(szMapNs,"part",String(w))));this.nRealizedCount++}else if(b.match(/WAFFLE/)){var pb=map.Scale.normalX(e);b.match(/GRIDSIZE/)?
pb=this.nGridSize*1.05:b.match(/AUTOSIZE/)&&(ea=map.Layer.nDynamicObjectScale,pa=b.match(/\bRECT\b/)?b.match(/GAP/)?2.3:2:b.match(/GAP/)?1.7:1.6,R=Math.max(this.nAllMaxValue,this.nMax),pb=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/pa/ea:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/pa/ea:F,pb=pb/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[c].nSize));pb*=.97;I=map.Dom.newShape("rect",h,-(pb/2)+10,-(pb/2)+10,pb-20,pb-20,"fill:"+(this.szBoxColor||"back")+";stroke:"+
(this.szBorderColor||"none")+";stroke-width:"+(this.szBorderWidth||2)+";fill-opacity:"+(this.nBoxOpacity||.05)+";opacity:1;");pb*=.9;if(b.match(/\bSORT\b/)){this.sortedIndex=[];for(w=0;w<m.length;w++)this.sortedIndex[w]={index:w,value:m[w]};this.sortedIndex.sort(this.sortIndexDown)}else this.sortedIndex=null;z=Math.max(this.nMax,Math.abs(this.nMin));var Ib=this.nGridX||(b.match(/WAFFLE100/)?10:Math.max(5,Math.round(Math.sqrt(z))));b.match(/AUTO100/)&&(Ib=10);var Wb=pb/(Ib*1.1),gb=-pb/2,Jb=pb/2,ec=
0,Cc=1E5;b.match(/WAFFLE100/)&&(Cc=100);for(w=0;w<m.length;w++){var Kb=this.sortedIndex?this.sortedIndex[w].index:w;m[Kb]=Math.round(m[Kb]);if(m[Kb]){var Tc=Math.min(m[Kb],Cc);Cc-=m[Kb];for(Ra=0;Ra<Tc;Ra++)I=map.Dom.newShape("rect",h,gb,Jb-Wb,Wb,Wb,"fill:"+this.colorScheme[Kb]+";stroke:null;fill-opacity:"+(this.fillOpacity||1)+";opacity:"+(this.nOpacity||1)+";"),I.setAttributeNS(szMapNs,"class",String(Kb)),I.setAttributeNS(szMapNs,"tooltip",this.szLabelA?this.szLabelA[Kb]+": "+m[Kb]+this.szUnit:m[Kb]+
this.szUnit),gb+=Wb*1.1,++ec>=Ib&&(gb=-pb/2,Jb-=Wb*1.1,ec=0)}}this.nRealizedCount++}else if(b.match(/BUBBLE/)||b.match(/SQUARE/)||b.match(/LABEL/)){F=map.Scale.normalX(e/2);b.match(/AUTOSIZE/)&&(ea=map.Layer.nDynamicObjectScale,pa=b.match(/\bRECT\b/)?b.match(/GAP/)?2.3:2:b.match(/GAP/)?1.7:1.6,R=Math.max(this.nAllMaxValue,this.nMax),F=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/pa/ea:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/pa/ea:F);R=Math.max(this.nMax,this.nMaxA[0]);
this.nNormalSizeValue&&(this.nMaxSize=R=this.nNormalSizeValue);a=m[0];if(this.szFlag.match(/\bCLIP\b/)&&!this.szFlag.match(/MORPH/)&&this.nClipFrames&&(this.nClipFrames==m.length?(a=Number(m[this.nActualFrame]),R=this.nNormalSizeValue||this.nMaxA[this.nActualFrame]):a=m[0]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+m[m.length-1]*this.nActualFrame/(this.nClipFrames-1),a===0&&!b.match(/ZEROISVALUE/))||b.match(/INVERTSIZE/)&&R-m[0]===0&&!b.match(/ZEROISVALUE/))return null;Ja=c&&this.itemA[c]&&
this.szSizeField?this.itemA[c].nSize||0:a;Da=c&&this.itemA[c]&&this.szSizeField?this.nMaxSize:R;if(Ja===0&&!b.match(/NOSIZE/)||this.nMinValue&&Ja<this.nMinValue)return null;v=b.match(/MENUSIZE/)?map.Scale.normalX(e/2.5):b.match(/CATEGORICAL/)&&!this.szSizeField?F/3/(this.nNormalSizeValue||1):b.match(/NOSIZE/)?F/2:b.match(/FIXSIZE/)?F/2/(this.nNormalSizeValue||1):b.match(/NORMSIZE/)?F*2/3/(b.match(/CATEGORICAL/)?1:Math.log(Da)*Math.log(Math.abs(Ja))):b.match(/SUM/)&&!c?F*2/3:F/Math.pow(Da,1/this.nSizePow)*
Math.pow(Math.abs(Ja),1/this.nSizePow);var Nb=!0,sa=null,Ua=I=null,xb=ba=ob=sb=null,Xb=null;E=this.colorScheme[0];M=this.colorScheme[1]?this.colorScheme[1]:"none";ca=this.colorScheme[1]?this.colorScheme[1]:"white";if(this.colorScheme.length>2||b.match(/CATEGORICAL/))E=this.colorScheme[this.colorScheme.length-1],M=this.colorScheme[0];b.match(/NOLINES/)?M="none":M=="none"&&(g=L(E),M=g.lowColor);if(b.match(/CATEGORICAL/))sa=a-1,E=this.colorScheme[sa]||this.colorScheme[0],g=L(E),ca=g.textColor,M=b.match(/NOLINES/)?
"none":g.lowColor,b.match(/RANGE/)&&!b.match(/RANGES/)&&(v=map.Scale.normalX(2+5*(w+1)/this.partsA.length)),Nb=!0;else if(this.szFlag.match(/COMPOSECOLOR/))this.szFlag.match(/SUBTRACTIVE/)?this.itemA[c].szColor=ia(this.itemA[c].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255)):this.itemA[c].szColor=Z(this.itemA[c].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255));else if(this.colorScheme.length>2||this.partsA.length>1||this.szRanges&&this.szRanges.length)if(Nb=
!1,this.szFlag.match(/DOMINANT/)){wa=aa=0;ja=-1;for(w=0;w<this.itemA[c].nValuesA.length;w++)a=this.itemA[c].nValuesA[w],qa=100/this.nMeanA[w]*a,T=100/this.nMedianA[w]*a,xa=(a-this.nMeanA[w])/this.nDeviationA[w],aa=a,this.szFlag.match(/PERCENTOFMEAN/)&&(aa=qa),this.szFlag.match(/PERCENTOFMEDIAN/)&&(aa=T),this.szFlag.match(/DEVIATION/)&&(aa=xa),a>this.nFilterA[w]&&aa>wa&&(this.itemA[c].nClass=w,wa=aa,ja=w);ja>=0&&(this.itemA[c].nDominant=ja,a=this.itemA[c].nValuesA[ja],ha=" "+this.szFieldsA[ja]+" ",
this.szLabelA&&this.szLabelA[ja]&&(ha=" "+this.szLabelA[ja]+" "),this.itemA[c].nValue=this.itemA[c].nValuesA[ja],this.itemA[c].szLabel=ha,E=this.colorScheme[ja],g=L(E),ca=g.textColor,M=b.match(/NOLINES/)?"none":g.lowColor,sa=ja,Nb=!0)}else for(w=0;w<this.partsA.length;w++)if(a>=this.partsA[w].min&&a<this.partsA[w].max){E=this.colorScheme[w];g=L(E);ca=g.textColor;M=b.match(/NOLINES/)?"none":g.lowColor;b.match(/RANGE/)&&!b.match(/RANGES/)&&(v=map.Scale.normalX(2+5*(w+1)/this.partsA.length));sa=w;Nb=
!0;break}this.itemA[c]&&(this.itemA[c].szColor=E);ca=this.szValueColor||this.szTextColor||ca;M=this.szLineColor||M;if(Nb){G=this.nLineWidth||.1;G=b.match(/OUTLINE/)?map.Scale.normalX(Math.min(1,1/F*v)):map.Scale.normalX(G/Math.sqrt(F)*Math.sqrt(v));if(b.match(/BUBBLE/)){var Ka=null;this.szTimeField=="$item$"?Ka=(new Date(this.szFieldsA[ja].split(" ")[0])).getTime():c&&(Ka=(new Date(this.itemA[c].szTime)).getTime());if(b.match(/GLOW/)&&!b.match(/ZOOM/)&&this.fGlowInScale){if(I=map.Dom.newShape("circle",
h,0,0,v*6,"fill:"+E+";stroke:none;fill-opacity:0.05;pointer-events:none;"))I.setAttributeNS(szMapNs,"class",String(sa)),I.setAttributeNS(szMapNs,"time",Ka);if(I=map.Dom.newShape("circle",h,0,0,v*2,"fill:"+E+";stroke:none;fill-opacity:0.1;pointer-events:none;"))I.setAttributeNS(szMapNs,"class",String(sa)),I.setAttributeNS(szMapNs,"time",Ka)}else b.match(/AURA/)&&!b.match(/ZOOM/)&&this.fGlowInScale&&(I=map.Dom.newShape("circle",h,0,0,v*1.3,"fill:"+(this.szLineColor||E)+";stroke:none;fill-opacity:0.3;"))&&
(I.setAttributeNS(szMapNs,"class",String(sa)),I.setAttributeNS(szMapNs,"time",Ka));I=map.Dom.newShape("circle",h,0,0,v,"fill:"+E+";stroke:"+M+";stroke-width:"+G+";")}else if(b.match(/SQUARE/))I=map.Dom.newShape("rect",h,-v,-v,v*2,v*2,"fill:"+E+";stroke:"+M+";stroke-width:"+G+";");else if(b.match(/TEXTONLY/))I=map.Dom.newShape("rect",h,-v,-8,v*2.05,8,"fill:none;stroke:none;");else if(b.match(/LABEL/)){ta=this.formatValue(a,this.nValueDecimals||(a<1||R<=1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:
"");a===0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/SIGN/))?ta="+-"+ta:a>0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/SIGN/))&&(ta="+"+ta);var la=Math.min(v*.8,3.4/ta.length*v);if(!this.fShadow&&this.fOrigShadow&&v>map.Scale.normalX(5)){if(I=map.Dom.newShape("rect",h,-v+v*.02,-la*.83+v*.02,v*2.05,la*1.6,"fill:#000000;stroke:none;opacity:"+.4*(this.fillOpacity?this.fillOpacity:1)))I.setAttributeNS(null,"rx",map.Scale.normalX(2*
v/F)),I.setAttributeNS(null,"ry",map.Scale.normalX(2*v/F));if(I=map.Dom.newShape("rect",h,-v+v*.03,-la*.83+v*.03,v*2.05,la*1.6,"fill:"+E+";stroke:none;opacity:"+.2*(this.fillOpacity?this.fillOpacity:1)))I.setAttributeNS(null,"rx",map.Scale.normalX(2*v/F)),I.setAttributeNS(null,"ry",map.Scale.normalX(2*v/F))}if(I=map.Dom.newShape("rect",h,-v,-la*.83,v*2.05,la*1.6,"fill:"+E+";stroke:"+M+";stroke-width:"+G+";"))I.setAttributeNS(null,"rx",map.Scale.normalX(2*v/F)),I.setAttributeNS(null,"ry",map.Scale.normalX(2*
v/F))}if(I){b.match(/SILENT/)||(b.match(/CATEGORICAL/)&&this.szLabelA&&this.szLabelA[a-1]?I.setAttributeNS(szMapNs,"tooltip",this.szLabelA[a-1]+" "+this.szTitle):I.setAttributeNS(szMapNs,"tooltip",this.formatValue(a,2)+this.szUnit+" "+this.szTitle));ba=null;if(b.match(/VALUES/)&&!this.fHideValues)if(ta=null,this.szValueField&&this.szValueField=="$title$"?ta=this.itemA[c].szTitle:this.szValueField&&this.itemA[c].szValue?(ta=this.itemA[c].szValue,isNaN(ta)||(ta=this.formatValue(ra(this.itemA[c].szValue),
this.nValueDecimals||(this.itemA[c].szValue<1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),a===0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/\bSIGN\b/))?ta="+/-"+ta:a>0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/\bSIGN\b/))&&(ta="+"+ta))):this.szValueField&&this.szValueField==this.szSizeField&&Ja?(ta=this.formatValue(ra(Ja),this.nValueDecimals||(Ja<1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),Ja===
0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/\bSIGN\b/))?ta="+/-"+ta:Ja>0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/\bSIGN\b/))&&(ta="+"+ta)):b.match(/CATEGORICAL/)&&this.szLabelA?ta=this.szLabelA[a-1]||"?":(ta=this.formatValue(a,this.nValueDecimals||(a<1||R<=1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),a===0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/\bSIGN\b/))?
ta="+/-"+ta:a>0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/\bSIGN\b/))&&(ta="+"+ta)),za=String(Math.min(v*.8,3.3/ta.length*v)*this.nValueScale),b.match(/TEXTONLY/)){g=L(E);ca=g.textColor;za=v*.8*this.nValueScale;if(this.nValueSizeMin&&!b.match(/ZOOM/)&&za*map.Layer.nDynamicObjectScale<map.Scale.normalX(this.nValueSizeMin)||this.nValueValueMin&&!b.match(/ZOOM/)&&a<this.nValueValueMin)return null;var yb=this.szTextFont||"arial";xb=map.Dom.newText(h,0,za*.33,
"font-family:"+yb+";font-size:"+za+"px;font-weight:normal;text-anchor:middle;fill:none;stroke:"+E+";stroke-width:"+za/7+";stroke-opacity:0.5;pointer-events:none;stroke-linejoin:bevel;",ta);xb.setAttributeNS(null,"id",this.szId+":"+c+":text:bg");ba=map.Dom.newText(h,0,za*.33,"font-family:"+yb+";font-size:"+za+"px;font-weight:normal;text-anchor:middle;fill:"+(this.szValueColor||this.szTextColor||"#000000")+";opacity:"+fb+";stroke:none;",ta);ba.setAttributeNS(null,"id",this.szId+":"+c+":text");I.parentNode.removeChild(I)}else if(b.match(/LABEL/)||
za>map.Scale.normalX(1))fb=this.nValueSizeMin?za/map.Scale.normalX(5):1,ba=map.Dom.newText(h,0,za*.33,"font-family:"+(this.szTextFont||"arial")+";font-size:"+za+"px;font-weight:bold;text-anchor:middle;fill:"+ca+";opacity:"+fb+";stroke:none;pointer-events:none",ta);if(b.match(/DTEXT/)&&c&&!b.match(/ZOOM/)){var $a=Math.pow(Math.abs(v),1/3)/Math.pow(F,1/3);I.style.setProperty("fill-opacity",String($a),"");I.style.setProperty("stroke-opacity",String($a),"");ba&&ba.style.setProperty("fill-opacity",String($a),
"")}else I.style.setProperty("fill-opacity",String(this.fillOpacity?this.fillOpacity:1),""),b.match(/OUTLINE/)||this.szLineColor?I.style.setProperty("stroke-opacity","1",""):I.style.setProperty("stroke-opacity",String(this.fillOpacity&&this.fillOpacity<.5?1:.3),"")}sa!=null&&(I&&(I.setAttributeNS(szMapNs,"value",String(a)),I.setAttributeNS(szMapNs,"class",String(sa))),ba&&(ba.setAttributeNS(szMapNs,"value",String(a)),ba.setAttributeNS(szMapNs,"class",String(sa))),xb&&(xb.setAttributeNS(szMapNs,"value",
String(a)),xb.setAttributeNS(szMapNs,"class",String(sa))));this.szTimeField&&(Ka=null,Ka=this.szTimeField=="$item$"?(new Date(this.szFieldsA[ja].split(" ")[0])).getTime():(new Date(this.itemA[c].szTime)).getTime(),I&&I.setAttributeNS(szMapNs,"time",Ka),ba&&ba.setAttributeNS(szMapNs,"time",Ka),xb&&xb.setAttributeNS(szMapNs,"time",Ka));e=v*2/map.Scale.normalX(1);l.x=0;l.y=b.match(/TEXTONLY/)?v:v+map.Scale.normalY(5);this.nRealizedCount++}else return this.nMissingRangeCount++,null}else if(b.match(/SYMBOL/)){if(typeof this.szSymbolBoxStyle!=
"undefined"){M="#dddddd";typeof this.szBorderColor!="undefined"&&(M=this.szBorderColor);var Xa="stroke-width:0;";if(typeof this.szBorderStyle!="undefined")switch(this.szBorderStyle){case "dotted":Xa="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:round;stroke-dasharray:1,50;";break;case "dashed":Xa="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:butt;stroke-dasharray:30,30;";break;case "solid":Xa="stroke-width:"+map.Scale.normalX(1)+";";break;case "none":Xa="stroke-width:0;"}var Lb=map.Dom.newShape("rect",
h,0,0,1,1,"fill:white;stroke:"+M+";"+Xa);switch(this.szSymbolBoxStyle){case "frame":Lb.setAttributeNS(null,"fill-opacity",0);break;case "field":Lb.setAttributeNS(null,"fill-opacity",1)}}if(!this.szSymbolsA)for(this.szSymbolsA=[],w=0;w<m.length;w++)this.szSymbolsA.push("circle");else if(this.szSymbolsA.length<m.length)for(w=this.szSymbolsA.length;w<m.length;w++)this.szSymbolsA.push(this.szSymbolsA[this.szSymbolsA.length-1]);var zb=null;b.match(/VALUES|AXIS/)&&(zb=map.Dom.newGroup(h,this.szId+":"+c+
":textgroup"));this.initAngle=0;if(b.match(/\bSORT\b/))if(b.match(/\bBYMEAN\b/)){this.sortedIndex=[];for(w=this.sortedMax=0;w<m.length;w++)this.sortedIndex[w]={index:w,value:m[w],tvalue:m[w],mean:this.nMeanA[w]},this.sortedMax=Math.max(this.sortedMax,m[w]);this.sortedIndex.sort(this.sortMeanUp);this.initAngle=0}else if(b.match(/\bBYMEDIAN\b/)){this.sortedIndex=[];for(w=this.sortedMax=0;w<m.length;w++)this.sortedIndex[w]={index:w,value:m[w],tvalue:m[w],mean:this.nMedianA[w]},this.sortedMax=Math.max(this.sortedMax,
m[w]);this.sortedIndex.sort(this.sortMeanUp);this.initAngle=0}else if(b.match(/\bUP\b/)){this.sortedIndex=[];for(w=this.sortedMax=0;w<m.length;w++)this.sortedIndex[w]={index:w,value:m[w],tvalue:m[w]},this.sortedMax=Math.max(this.sortedMax,m[w]);this.sortedIndex.sort(this.sortIndexUp);this.initAngle=0}else if(b.match(/\bDOWN\b/)){this.sortedIndex=[];for(w=this.sortedMax=0;w<m.length;w++)this.sortedIndex[w]={index:w,value:m[w],tvalue:m[w]},this.sortedMax=Math.max(this.sortedMax,m[w]);this.sortedIndex.sort(this.sortIndexDown);
this.initAngle=0}else{if(b.match(/\bRANDOM\b/)){this.sortedIndex=[];this.sortedMax=0;if(this.nClipParts&&this.nClipParts<m.length){var tb=[];for(w=0;w<m.length;w++)tb[w]={index:w,value:m[w],tvalue:m[w]};tb.sort(this.sortIndexDown);for(w=0;w<this.nClipParts;w++){var Ob=tb[w].index;this.sortedIndex[w]={index:Ob,value:m[Ob],tvalue:m[Ob]};this.sortedMax=Math.max(this.sortedMax,m[w])}}else for(w=0;w<m.length;w++)this.sortedIndex[w]={index:w,value:m[w],tvalue:m[w]},this.sortedMax=Math.max(this.sortedMax,
m[w]);c?(this.itemA[c].randomA||(this.itemA[c].randomA=this.getRandomNumberArray(m.length+1)),this.shuffleArray(this.sortedIndex,this.itemA[c].randomA),this.initAngle=Math.floor(this.itemA[c].randomA[0]*360)):this.initAngle=0}}else this.sortedIndex=null;if(b.match(/RINGS/)){if(this.sortedIndex){var uc=0;for(w=0;w<this.sortedIndex.length;w++)this.sortedIndex[w].value&&(this.sortedIndex[w].value+=uc,uc=this.sortedIndex[w].value)}else for(uc=0,this.sortedIndex=[],w=0;w<m.length;w++)this.sortedIndex[w]=
{index:w,value:m[w],tvalue:m[w]},this.sortedIndex[w].value&&(this.sortedIndex[w].value+=uc,uc=this.sortedIndex[w].value);this.sortedIndex.sort(this.sortIndexDown)}if(b.match(/\bSMOOTH\b/)&&!b.match(/\bZOOM\b/)){var ab=m.slice();for(w=m.length-2;w>=1;w--){m[w]=ab[w];m[w]+=ab[w+1];for(wc=1;wc<2;wc++)m[w]+=ab[w-wc];m[w]/=3}}if(b.match(/\bLINREG\b/)){var cb=0,Eb=0;for(w=0;w<m.length;w++)cb+=w,Eb+=m[w];var lc=cb/m.length,Dc=Eb/m.length,cd=0,Yb=0;for(w=0;w<m.length;w++)gb=w,Jb=m[w],cd+=(gb-lc)*(Jb-Dc),
Yb+=(gb-lc)*(gb-lc);var Ec=cd/Yb,Zb=Dc-Ec*lc}var Ab=null,$b=null,vc=null;sa=0;var Fb="",dd=0,Pb=0,qb=0,Sb=0,ub=0,Lc=0,dc=0,mc=!1,Tb=0;H=m.length;this.nClipParts&&this.nClipParts<m.length&&(b.match(/\bUP\b/)?Tb=m.length-this.nClipParts:H=this.nClipParts);if(this.szFlag.match(/DOMINANT/)){wa=aa=0;var ed=-1;for(w=0;w<this.itemA[c].nValuesA.length;w++)a=this.itemA[c].nValuesA[w],qa=100/this.nMeanA[w]*a,T=100/this.nMedianA[w]*a,xa=(a-(this.nMeanA[w]||0))/this.nDeviationA[w],aa=a,this.szFlag.match(/PERCENTOFMEAN/)&&
(aa=qa),this.szFlag.match(/PERCENTOFMEDIAN/)&&(aa=T),this.szFlag.match(/DEVIATION/)&&(aa=xa),a>(this.nFilterA[w]||0)&&aa>wa&&(this.itemA[c].nClass=w,wa=aa,ed=w);ed>=0&&(Tb=this.itemA[c].nDominant=ed,H=Tb+1,sa=ed)}else this.szFlag.match(/COMPOSECOLOR/)&&(this.szFlag.match(/SUBTRACTIVE/)?this.itemA[c].szColor=ia(this.itemA[c].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255)):this.itemA[c].szColor=Z(this.itemA[c].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255)));
this.szFlag.match(/\bCLIP\b/)&&(H=Tb+1);for(w=Tb;w<H;w++)Lc+=m[w]!==0,ub=Math.max(ub,m[w]);if(this.szFlag.match(/STACKED/)&&this.nGridX)for(w=Tb;w<H;){for(var Uc=0,Ra=0;Ra<this.nGridX;Ra++)Uc+=m[w++];ub=Math.max(ub,Uc)}var Id=this.formatValue(Math.max(this.nAllMaxValue,this.nMax),this.nValueDecimals||"")+(this.szUnit.length<=5?this.szUnit:""),pd=0;for(w=Tb;w<H;w++){var ja=w;a=m[ja];var jb=m[ja];b.match(/COUNT/)&&this.itemA[c].nCountA&&(jb=this.itemA[c].nCountA[ja]);this.sortedIndex&&(a=this.sortedIndex[ja].value,
jb=this.sortedIndex[ja].tvalue,ja=this.sortedIndex[ja].index);this.szValueField&&this.itemA[c]&&this.szValueField=="$title$"?jb=this.itemA[c].szTitle:this.szValueField&&this.itemA[c]&&this.itemA[c].szValue&&(jb=isNaN(this.itemA[c].szValue)?this.itemA[c].szValue:ra(this.itemA[c].szValue));if(this.szShowParts){var Vc=!0;for(oa in this.szShowPartsA)this.szShowPartsA[oa]==ja%(this.nGridX||1E6)&&(Vc=!1);if(Vc)continue}if(!b.match(/ZOOM/)||!this.markedClasses||this.markedClasses[ja]){sa=ja;this.nGridX&&
b.match(/PLOT/)&&(sa%=this.nGridX);b.match(/STACKED/)&&(sa==0&&(pd=0),pd=jb+=pd);if((b.match(/ZOOM/)||b.match(/NORMSIZE/))&&this.szLabelA){var Gb=this.formatValue(jb,jb<1?2:0);Fb=Gb+this.szUnit;Fb+=" "+this.szLabelA[ja%(this.nGridX||1E7)]}else Gb=this.formatValue(jb,2),Fb=" "+Gb+this.szUnit;Ka=null;this.szTimeField&&(Ka=this.szTimeField=="$item$"?(new Date(this.szFieldsA[ja].split(" ")[0])).getTime():(new Date(this.itemA[c].szTime)).getTime());if(!b.match(/CATEGORICAL/)||b.match(/AGGREGATE/)||b.match(/GROUP/)){F=
map.Scale.normalX(e/2);R=this.nNormalSizeValue||this.nAllMaxValue;b.match(/MENUSIZE/)?R=ub*5:!this.nNormalSizeValue||b.match(/SEQUENCE/)&&this.szSizeField||(this.nMaxSize=R=this.nNormalSizeValue);ub&&b.match(/ZOOM/)&&b.match(/SEQUENCE/)&&(R=ub/2+ub/2*Math.pow(R,.5)/Math.pow(ub,.5));if(b.match(/INVERTSIZE/)&&R-a===0&&!b.match(/ZEROISVALUE/))return null;this.szFlag.match(/\bCLIP\b/)&&!this.szFlag.match(/MORPH/)&&this.nClipFrames&&(jb=a=this.nClipFrames==m.length?Number(m[this.nActualFrame]):m[ja]*(this.nClipFrames-
1-this.nActualFrame)/(this.nClipFrames-1)+m[m.length-1]*this.nActualFrame/(this.nClipFrames-1));if(a||b.match(/PLOT|NOSIZE/)){v=0;b.match(/AUTOSIZE/)&&(ea=map.Layer.nDynamicObjectScale,pa=b.match(/\bRECT\b/)?b.match(/GAP/)?2.3:2:b.match(/GAP/)?1.6:1.5,R=Math.max(this.nAllMaxValue,this.nMax),F=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/pa/ea:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/pa/ea:F);v=b.match(/GRIDSIZE/)&&!b.match(/PLOT/)?this.nGridSize/2:b.match(/NOSIZE/)?
map.Scale.normalX(e/3):b.match(/FIXSIZE/)?map.Scale.normalX(e/3)/(this.nNormalSizeValue||1):F/Math.pow(R,1/this.nSizePow)*Math.pow(a,1/this.nSizePow);b.match(/SEQUENCE/)?b.match(/MENUSIZE/)||b.match(/SUM/)&&!c?v*=this.szField100?1:2:b.match(/ZOOM/)&&!b.match(/PLOT/)?v*=2:b.match(/AGGREGATE/)&&b.match(/CATEGORICAL/)||!this.szSizeField||!c||!this.itemA[c]||(v=v/Math.pow(this.nMaxSize,1/this.nSizePow)*Math.pow(this.itemA[c].nSize,1/this.nSizePow)):b.match(/MENUSIZE/)||b.match(/SUM/)&&!c?v=F*1.5:b.match(/ZOOM/)&&
!b.match(/PLOT/)?v=Math.max(v,F*2/3):b.match(/NOSIZE/)?v=F/5:(!b.match(/GRIDSIZE/)&&this.szSizeField&&c&&this.itemA[c]&&(v=F/Math.pow(this.nMaxSize,1/this.nSizePow)*Math.pow(this.itemA[c].nSize,1/this.nSizePow)),b.match(/PLOTXY/)&&(v/=5));if(isNaN(v)||!v){if(!b.match(/STAR|STACKED|PLOT/))continue;v=1}Fa=this.szSymbolsA[ja];if(this.nRangesA&&this.nRangesA.length)for(Ra=0;Ra<this.nRangesA.length;Ra++)if(a==this.nRangesA[Ra]||Number(a)==Number(this.nRangesA[Ra])){Fa=this.szSymbolsA[Ra]||this.szSymbolsA[0]||
"circle";break}Fa=this.itemA[c]?this.itemA[c].szSymbol||Fa:Fa;b.match(/SEQUENCE/)&&(Fa=this.szSymbolsA[ja]);if(c&&this.itemA[c].szColor)E=this.itemA[c].szColor,sa=this.itemA[c].nClass,this.colorClassUsedA&&(this.colorClassUsedA[sa]=!0);else if((b.match(/SEQUENCE/)||b.match(/DOMINANT/))&&this.colorScheme.length>=this.partsA.length)E=this.colorScheme[ja%(this.nGridX||1E4)],M=this.colorScheme[ja];else if(E=this.colorScheme[0],M=this.colorScheme[1]?this.colorScheme[1]:"none",this.colorScheme.length>2&&
(E=this.colorScheme[this.colorScheme.length-1],M=this.colorScheme[0]),b.match(/NOLINES/)?M="none":M=="none"&&(g=L(E),M=g.textColor),this.colorScheme.length>2||this.szRanges&&this.szRanges.length){for(Ra=0;Ra<this.partsA.length;Ra++)if(b.match(/CATEGORICAL/)&&a==this.partsA[Ra].min||!b.match(/CATEGORICAL/)&&a<this.partsA[Ra].max){E=this.colorScheme[Ra];g=L(E);M=g.textColor;b.match(/RANGE/)&&!b.match(/RANGES/)&&(v=map.Scale.normalX(2+5*(Ra+1)/this.partsA.length));sa=Ra;break}else if(this.szRanges&&
this.szRanges.length&&a<this.partsA[Ra].min){E=this.colorScheme[Ra-1];g=L(E);M=g.textColor;sa=Ra-1;break}b.match(/NOLINES/)&&(M="none")}M=M||E;this.nSymbolScale=v/map.Scale.normalX(e);if(Fa=="circle"||Fa=="square"||Fa=="roundrect"||Fa=="carot"||Fa=="diamond"||Fa=="triangle"||Fa=="hexagon"||Fa=="empty"||Fa=="label"||Fa=="cross"){M=this.szLineColor||M;G=(this.nLineWidth||1)*map.Scale.normalX(Math.min(2*v/F,.2));switch(Fa){case "empty":I=map.Dom.newShape("circle",h,0,0,v,"fill:#888888;fill-opacity:0;stroke:#888888;stroke-width:"+
G+";");break;case "circle":!this.fShadow&&this.fOrigShadow&&(Ua=map.Dom.newShape("circle",h,map.Scale.normalX(.5)+v*.02,map.Scale.normalX(.5)+v*.02,v*1.02,"fill:#000000;stroke:none;opacity:"+.6*(this.fillOpacity?this.fillOpacity:1)));ob=sb=null;if(!b.match(/GLOW/)||this.sortedIndex&&w!=Tb||b.match(/ZOOM/)||this.szGlowUpper&&!(map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nGlowUpper)||this.szGlowLower&&!(map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.nGlowLower))b.match(/AURA/)&&w==Tb&&!b.match(/ZOOM/)&&
(!this.szGlowUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nGlowUpper)&(!this.szGlowLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.nGlowLower)&&(sb=map.Dom.newShape("circle",h,0,0,v*1.3,"fill:"+(this.szLineColor||E)+";stroke:none;fill-opacity:0.3;"))&&(sb.setAttributeNS(szMapNs,"class",String(sa)),sb.setAttributeNS(szMapNs,"time",String(Ka)));else{if(sb=map.Dom.newShape("circle",h,0,0,v*6,"fill:"+E+";stroke:none;fill-opacity:0.05;pointer-events:none;"))sb.setAttributeNS(szMapNs,
"class",String(sa)),sb.setAttributeNS(szMapNs,"time",Ka);if(ob=map.Dom.newShape("circle",h,0,0,v*2,"fill:"+E+";stroke:none;fill-opacity:0.1;pointer-events:none;"))ob.setAttributeNS(szMapNs,"class",String(sa)),ob.setAttributeNS(szMapNs,"time",String(Ka))}I=map.Dom.newShape("circle",h,0,0,v,"fill:"+E+";stroke:"+M+";stroke-width:"+G+";");break;case "square":I=map.Dom.newShape("rect",h,-v,-v,v*2,v*2,"fill:"+E+";stroke:"+M+";stroke-width:"+G+";");break;case "roundrect":I=map.Dom.newShape("rect",h,-v,-v,
v*2,v*2,"fill:"+E+";stroke:"+M+";stroke-width:"+G+";");I.setAttributeNS(null,"rx",v*.3);break;case "cross":I=map.Dom.newShape("rect",h,-v*1.6,-v*.4,v*2*1.6,v*2*.4,"fill:"+E+";stroke:"+M+";stroke-width:"+map.Scale.nFeatureScaling*map.Scale.nObjectScaling+";");I=map.Dom.newShape("rect",h,-v*.4,-v*1.6,v*2*.4,v*2*1.6,"fill:"+E+";stroke:"+M+";stroke-width:"+map.Scale.nFeatureScaling*map.Scale.nObjectScaling+";");break;case "carot":case "diamond":(I=map.Dom.newShape("rect",h,-v,-v,v*2,v*2,"fill:"+E+";stroke:"+
M+";stroke-width:"+G+";"))&&I.setAttributeNS(null,"transform","rotate(45)");break;case "triangle":I=map.Dom.newShape("path",h,"M 0,"+v+" l"+v*1.2+",-"+v*2+" -"+v*2.4+",0 "+v*1.2+","+v*2+"z","fill:"+E+";stroke:"+M+";stroke-width:"+G+";");break;case "hexagon":Db=v/2;rb=v*Math.sin(60/180*Math.PI);Wc=v;I=map.Dom.newShape("path",h,"M -"+v+",0 l "+Db+",-"+rb+" "+Wc+",0 "+Db+","+rb+" -"+Db+","+rb+" -"+Wc+",0 -"+Db+",-"+rb+" z","fill:"+E+";stroke:"+M+";stroke-width:"+G+";");break;case "label":if(ta=this.formatValue(jb,
this.nValueDecimals||(jb<1||R<=1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),b.match(/TEXTONLY/))ca=L(E).textColor,za=String(Math.max(Math.min(v*.8,map.Scale.normalX(500)),map.Scale.normalX(2))),this.nValueSizeMin&&!b.match(/ZOOM/)&&za*map.Layer.nDynamicObjectScale<map.Scale.normalX(this.nValueSizeMin)?(I=map.Dom.newShape("rect",h,0,0,0,0,"fill:none;"),Ua=map.Dom.newShape("rect",h,0,0,0,0,"fill:none;")):this.nValueValueMin&&!b.match(/ZOOM/)&&a<this.nValueValueMin?(I=map.Dom.newShape("rect",
h,0,0,0,0,"fill:none;"),Ua=map.Dom.newShape("rect",h,0,0,0,0,"fill:none;")):(yb=this.szTextFont||"arial",Ua=map.Dom.newText(h,0,0,"font-family:"+yb+";font-size:"+za+"px;font-weight:bold;text-anchor:middle;fill:none;stroke:"+E+";stroke-width:"+za/7+";stroke-opacity:0.5;pointer-events:none;stroke-linejoin:bevel;",ta),Ua.setAttributeNS(null,"id",this.szId+":"+c+":text:bg"),I=map.Dom.newText(h,0,0,"font-family:"+yb+";font-size:"+za+"px;font-weight:bold;text-anchor:middle;fill:"+(this.szValueColor||this.szTextColor||
"#000000")+";opacity:"+fb+";stroke:none;",ta),I.setAttributeNS(null,"id",this.szId+":"+c+":text"));else if(za=String(Math.max(1,Math.min(v*.8,3.4/ta.length*v))),this.nValueSizeMin&&!b.match(/ZOOM/)&&za*map.Layer.nDynamicObjectScale<map.Scale.normalX(this.nValueSizeMin))I=map.Dom.newShape("rect",h,0,0,0,0,"fill:none;");else if(this.nValueValueMin&&!b.match(/ZOOM/)&&a<this.nValueValueMin)I=map.Dom.newShape("rect",h,0,0,0,0,"fill:none;");else if(qd=za*1.6,I=map.Dom.newShape("rect",h,-v,-za*.83,v*2.05,
za*1.6,"fill:"+E+";stroke:"+M+";stroke-width:"+G+";"))I.setAttributeNS(null,"rx",map.Scale.normalX(2*v/F)),I.setAttributeNS(null,"ry",map.Scale.normalX(2*v/F))}I&&(b.match(/OUTLINE/)?(I.style.setProperty("stroke-width",String(map.Scale.normalX(.5))),I.style.setProperty("stroke-opacity","1"),I.style.setProperty("fill-opacity","0.7")):b.match(/RANDOM/)?(I.style.setProperty("stroke-opacity",String(this.nOpacity?this.nOpacity:1),""),I.style.setProperty("fill-opacity",String(this.fillOpacity?this.fillOpacity:
this.nOpacity?this.nOpacity:1),""),b.match(/DOPACITY/)&&(q=1/(this.nDopacityPow||1),fb=Math.pow(a,q)/Math.pow(this.sortedMax,q)*(this.nOpacity||1)*(this.nDopacityScale||1),I.style.setProperty("fill-opacity",String(fb),""))):b.match(/\bSORT\b/)&&b.match(/DOPACITY/)?(I.style.setProperty("stroke-opacity",String(this.nOpacity?this.nOpacity:1),""),q=1/(this.nDopacityPow||1),fb=Math.pow(a,q)/Math.pow(this.sortedMax,q)*(this.nOpacity||1)*(this.nDopacityScale||1),I.style.setProperty("fill-opacity",String(fb),
"")):b.match(/DOPACITY/)&&this.szAlphaField?c&&typeof this.itemA[c].nAlpha!="undefined"&&(q=1/(this.nDopacityPow||1),fb=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,q)*Math.pow(this.itemA[c].nAlpha,q),I.style.setProperty("fill-opacity",String(fb),"")):b.match(/DOPACITY/)?(q=1/(this.nDopacityPow||1),fb=Math.pow(a-this.nMin,q)/Math.pow(this.nMax-this.nMin,q)*(this.fillOpacity||1)*(this.nDopacityScale||1),I.style.setProperty("fill-opacity",String(fb),""),b.match(/CATEGORICAL/)||(sa=Math.min(6,Math.ceil((a-
this.nMin)/(this.nMax-this.nMin)*7)),I.setAttributeNS(szMapNs,"class",String(sa)),h.setAttributeNS(szMapNs,"class",String(sa)),d.setAttributeNS(szMapNs,"class",String(sa)))):I.style.setProperty("fill-opacity",String(this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:1),""),this.chartGroup&&this.chartGroup.style.setProperty("opacity","1",""),I.setAttributeNS(szMapNs,"tooltip",Fb),I.setAttributeNS(szMapNs,"time",Ka))}else Fa.match(/.svg|.png|.jpeg/)?(I=map.Dom.constructNode("image",h,{"xlink:href":Fa}),
I.setAttributeNS(null,"x",String(map.Scale.normalX(-e/2))),I.setAttributeNS(null,"y",String(map.Scale.normalY(-e/2))),I.setAttributeNS(null,"width",String(map.Scale.normalX(e))),I.setAttributeNS(null,"height",String(map.Scale.normalY(e)))):I=map.Dom.constructNode("use",h,{"xlink:href":"#"+Fa+":antizoomandpan"}),map.Dom.newShape("circle",h,0,0,v*.5,"fill:white;stroke:none;opacity:0"),I.fu.scale(v/F,v/F),I.setAttributeNS(null,"style","fill:"+E+";stroke:"+M);if(I&&b.match(/VALUES/)&&!b.match(/TEXTONLY/)&&
!this.fHideValues&&(!this.nValueValueMin||a>=this.nValueValueMin))if(ba=null,ta=jb,isNaN(jb)||(ta=this.formatValue(jb,this.nValueDecimals||"")+(this.szUnit.length<=5?this.szUnit:"")),g=L(E),ca=this.szValueColor||this.szTextColor||g.textColor,rd=Math.max((jb?.length||0)+1,Id.length),za=String(Math.min(F*1,(Fa=="hexagon"?2.7:3.2)/rd*F)),za*=v/F*this.nValueScale,b.match(/ZOOM/)&&b.match(/LINES/)&&!b.match(/INLINETEXT/)&&(this.nGridX==null||this.nGridX<=1||b.match(/STACKED/))){ca="black";C=C||map.Dom.newGroup(d,
this.szId+":"+c+":textchartontop");za=4+.5*m.length/(this.nGridX?this.nGridX*2:1);var Jd=Math.log(m.length)/3;ba=this.createTextLabel(map.SVGDocument,C,"",ta,za*Jd*this.nValueScale,"","rgba(255,255,255,0)",g.lowColor,"GLOW");ba.setAttributeNS(null,"opacity","0.9");C.fu.setPosition(-map.Scale.normalX(za*Jd)*3,-map.Scale.normalY(8/(this.nGridX||1)))}else if(Fa=="circle"||Fa=="square"||Fa=="roundrect"||Fa=="triangle"||Fa=="hexagon"||Fa=="label"||Fa=="empty")if(b.match(/CENTERVALUES/))sa===0&&(ba=map.Dom.newText(h,
0,za*.33,"font-family:"+(this.szTextFont||"arial")+";font-size:"+za+"px;text-anchor:middle;fill:"+ca+";stroke:none;pointer-events:none",ta));else if((b.match(/\bCENTER\b/)||b.match(/\bTOP\b/)||b.match(/\bBOTTOM\b/))&&!b.match(/\bDOMINANT\b/)){if(a){var ya=6;this.szChartFlag+="|VALUEBACKGROUND";r=r||map.Dom.newGroup(d,this.szId+":"+c+":chartontop");Sb=Sb?Sb:v;var sd=-map.Scale.normalX(1),td=-map.Scale.normalX(ya*1.33)*(Lc-dc-1);ba=this.createTextLabel(map.SVGDocument,r,"",ta,ya,"",this.colorScheme[ja%
(this.nGridX||1E4)],this.szTextColor);ba.fu.setPosition(sd,td);if(c&&(b.match(/ZOOM/)||b.match(/NORMSIZE/))&&this.szLabelA){var Kd=ba.fu.getBox().width;xb=map.Dom.newText(r,0,0,this.szValuesTextBgStyle,this.szLabelA[ja]);xb.fu.setPosition(sd+Kd+map.Scale.normalX(6),td-map.Scale.normalX(-1));xb.fu.scale(.6,.6);ba=map.Dom.newText(r,0,0,this.szValuesTextStyle+";fill:#000;fill-opacity:0.8",this.szLabelA[ja]);ba.fu.setPosition(sd+Kd+map.Scale.normalX(6),td-map.Scale.normalX(-1));ba.fu.scale(.6,.6)}ba.setAttributeNS(szMapNs,
"class",String(sa%(this.nGridX||1E6)));ba=null;dc++}}else if(this.szValueField&&b.match(/2VALUES/)){ba=map.Dom.newText(h,0,-za*.2,"font-family:"+(this.szTextFont||"arial")+";font-size:"+za+"px;text-anchor:middle;fill:"+ca+";stroke:none;pointer-events:none",ta);var Ld=Math.min(za*.8,120);Gb=this.formatValue(a,this.nValueDecimals||0)+this.szUnit;Xb=map.Dom.newText(h,0,za-Ld*.2,"font-family:"+(this.szTextFont||"arial")+";font-size:"+Ld+"px;text-anchor:middle;fill:"+ca+";stroke:none;pointer-events:none",
Gb)}else ba=map.Dom.newText(h,0,za*.33,"font-family:"+(this.szTextFont||"arial")+";font-size:"+za+"px;text-anchor:middle;fill:"+ca+";stroke:none;pointer-events:none",ta);else za=Math.max(v*.8,1)*this.nValueScale,r=r||map.Dom.newGroup(d,this.szId+":"+c+":chartontop"),ba=this.createTextLabel(map.SVGDocument,r,"",ta,za/map.Scale.normalX(1),"","rgba(255,255,255,0.3)",g.lowColor,"GLOW"),ba.fu.setPosition(map.Scale.normalX(0)+Pb,map.Scale.normalY(0)+qb);if(I&&(I.setAttributeNS(szMapNs,"class",String(sa%
(this.nGridX||1E6))),I.setAttributeNS(szMapNs,"time",Ka),ba&&(ba.setAttributeNS(szMapNs,"class",String(sa%(this.nGridX||1E6))),ba.setAttributeNS(szMapNs,"time",Ka),ba.setAttributeNS(szMapNs,"tooltip",Fb)),Xb&&(Xb.setAttributeNS(szMapNs,"class",String(sa%(this.nGridX||1E6))),Xb.setAttributeNS(szMapNs,"time",Ka)),Ua&&(Ua.setAttributeNS(szMapNs,"class",String(sa%(this.nGridX||1E6))),Ua.setAttributeNS(szMapNs,"time",Ka)),!b.match(/CENTER/))){var kb=null;if(b.match(/STAR/)){if(w===0&&(Ab=I,$b=ba,vc=Xb,
Sb=v,b.match(/EXPAND/)&&b.match(/\bSORT\b/)&&b.match(/\bUP\b/)&&(Sb=b.match(/LINEAR/)||b.match(/SIZEP1/)?(b.match(/EXPANDMAX/)?2:.5)*F/R*this.sortedIndex[m.length-1].value:(b.match(/EXPANDMAX/)?2:.5)*F/Math.sqrt(R)*Math.sqrt(this.sortedIndex[m.length-1].value)),b.match(/ZOOM/)&&b.match(/STAR/)&&b.match(/\bUP\b/)?Sb*=2:b.match(/COMPRESS/)&&(Sb*=b.match(/COMPRESSMAX/)?.25:.5)),(w>0||b.match(/\bUP\b/))&&v){var $d=this.nClipParts&&this.nClipParts<this.partsA.length?this.nClipParts:this.partsA.length,
ud=v,Md=Sb+v,vd=90-Math.asin(ud*Math.sqrt(Math.pow(Md,2)-Math.pow(ud,2))/Md/ud)/Math.PI*180,xc=Sb+v;b.match(/\bUP\b/)&&(w>5&&(vd/=1+v/F*2),xc=Sb*(1+$d/5));b.match(/ZOOM/)||(xc=this.nRangeScale?xc*this.nRangeScale:b.match(/EXPANDMAX/)?xc*2:b.match(/EXPAND/)?xc*1.5:xc);this.initAngle+=vd;Pb=Math.cos(this.initAngle/180*Math.PI)*xc;qb=Math.sin(this.initAngle/180*Math.PI)*xc;this.initAngle+=vd;kb=new point(map.Scale.normalX(0)+Pb,map.Scale.normalY(0)+qb)}}else if(b.match(/RANDOM/)){var wd=b.match(/EXPANDMAX/)?
v*2:b.match(/EXPAND/)?v*1.5:v;b.match(/ZOOM/)&&(F*=2,wd*=2);Pb=Math.cos(this.initAngle+360/this.partsA.length*w/180*Math.PI)*Math.min(F,wd);qb=Math.sin(this.initAngle+360/this.partsA.length*w/180*Math.PI)*Math.min(F,wd);kb=new point(map.Scale.normalX(0)+Pb,map.Scale.normalY(0)+qb)}else b.match(/HORZ/)?(Pb+=v,kb=new point(map.Scale.normalX(0)+Pb,map.Scale.normalY(0)+qb),Pb+=v):b.match(/BOTTOM/)?kb=new point(map.Scale.normalX(0),-v):b.match(/TOP/)?kb=new point(-v*.3,v*.7-F):b.match(/CONE/)?kb=new point(map.Scale.normalY(w*
.33),-map.Scale.normalY(w*1)):b.match(/BASE/)&&(kb=new point(map.Scale.normalX(0),qb-v),qb-=v*(b.match(/VALUES/)?1.25:1));kb?(I.fu.setPosition(kb.x,kb.y),Ua&&Ua.fu.setPosition(kb.x,kb.y),sb&&sb.fu.setPosition(kb.x,kb.y),ob&&ob.fu.setPosition(kb.x,kb.y),ba&&ba.fu.setPosition(kb.x,kb.y),Xb&&Xb.fu.setPosition(kb.x,kb.y)):Xb&&Xb.fu.setPosition(0,0);if(b.match(/PLOT/)){a!==0||b.match(/STACKED/)||(I.parentNode.removeChild(I),Ua&&Ua.parentNode.removeChild(Ua),ba&&ba.parentNode.removeChild(ba));var Y=map.Scale.normalX(e)*
(b.match(/LINES/),1),Ga=w*Y;this.nGridX&&(Ga=b.match(/PLOTVAR/)?Math.floor(w%this.nGridX)*Y:Math.floor(w/this.nGridX)*Y);var Va=0;R=this.nAllMaxValue||this.nMax;R=Math.max(ub,R);R=this.nMaxValuePlot=typeof this.nMaxValue!=="undefined"?this.nMaxValue:R;Va=this.nMinValuePlot=typeof this.nMinValue!=="undefined"?this.nMinValue:Math.min(this.nMin,this.nAllMinValue);this.nMaxValue=="auto"&&(R=this.nMaxValuePlot=ub);if(this.nMaxValue=="inherit"){this.nMaxValuePlot=this.nMinValuePlot=null;for(var Xc=0;Xc<
this.parent.themesA.length;Xc++)this.parent.themesA[Xc]!=this&&this.parent.themesA[Xc].nMaxValuePlot&&(R=this.parent.themesA[Xc].nMaxValuePlot)}ka=map.Scale.normalX(e)/(R-Va)*(this.nGridX||m.length-1)*(this.nRangeScale||1);if(!mc){var ae=this.szId+":"+this.itemA[c].szSelectionId+":chartgrid",Sa=null;if(!Sa||b.match(/ZOOM/))r=r||map.Dom.newGroup(d,this.szId+":"+c+":chartontop"),Sa=map.Dom.newGroup(r,ae)}if(b.match(/PLOTXY/))mc||(mc=!0,b.match(/BOX/)&&b.match(/\bGRID\b/)&&!Sa.childNodes.length&&(map.Dom.newShape("line",
Sa,0,0,this.nChartWidth+100,0,"stroke:#888888;stroke-width:"+map.Scale.normalX(.3)+";"),map.Dom.newShape("line",Sa,0,0,0,-this.nChartHeight-100,"stroke:#888888;stroke-width:"+map.Scale.normalX(.3)+";"),map.Dom.newText(Sa,10,80,"font-family:arial;font-size:80px;text-anchor:start;fill:#444444;stroke:none;pointer-events:none;",String(this.nMinX)),map.Dom.newText(Sa,this.nChartWidth+100,80,"font-family:arial;font-size:80px;text-anchor:end;fill:#444444;stroke:none;pointer-events:none;",String(this.nMaxX)),
map.Dom.newText(Sa,-10,10,"font-family:arial;font-size:80px;text-anchor:end;fill:#444444;stroke:none;pointer-events:none;",String(this.nMinY)),map.Dom.newText(Sa,-10,-this.nChartHeight-100+80,"font-family:arial;font-size:80px;text-anchor:end;fill:#444444;stroke:none;pointer-events:none;",String(this.nMaxY)))),gb=50+(this.itemA[c].nX-this.nMinX)*this.nChartWidth/this.nRangeX,Jb=-100-(this.itemA[c].nY-this.nMinY)*this.nChartHeight/this.nRangeY,I.fu.setPosition(gb,Jb),Ua&&Ua.fu.setPosition(gb,Jb),sb&&
sb.fu.setPosition(gb,Jb),ob&&ob.fu.setPosition(gb,Jb),ba&&ba.fu.setPosition(gb,Jb);else if(b.match(/PLOTYX/))I.fu.setPosition((R+Math.abs(R-a))*ka,Ga),Ua&&Ua.fu.setPosition((R+Math.abs(R-a))*ka,Ga),ba&&ba.fu.setPosition((R+Math.abs(R-a))*ka,Ga);else if(b.match(/PLOTY/)){I.fu.setPosition(0,(-R+Math.abs(R-a))*ka);Ua&&Ua.fu.setPosition(0,(-R+Math.abs(R-a))*ka);ba&&ba.fu.setPosition(0,(-R+Math.abs(R-a))*ka);var Qa=1;Qa=R/5;Qa=Math.floor(Math.log(Qa))*10*Math.ceil(Qa/(Math.floor(Math.log(Qa))*10))||1;
R=Math.ceil(R/Qa)*Qa;if(!mc&&(mc=!0,b.match(/BOX/)&&b.match(/\bGRID\b/)))for(k=map.Scale.normalX(e)/2;k<R*ka;k+=ka*Qa)map.Dom.newShape("line",Sa,-20,-k,20,-k,"stroke:#444444;stroke-width:"+map.Scale.normalX(1)+";")}else if(b.match(/PLOTX/)){if(I.fu.setPosition((R-Math.abs(R-a))*ka,0),Ua&&Ua.fu.setPosition((R-Math.abs(R-a))*ka,0),ba&&ba.fu.setPosition((R-Math.abs(R-a))*ka,0),Qa=1,Qa=R/5,Qa=Math.floor(Math.log(Qa))*10*Math.ceil(Qa/(Math.floor(Math.log(Qa))*10))||1,R=Math.ceil(R/Qa)*Qa,!mc&&(mc=!0,b.match(/BOX/)&&
b.match(/\bGRID\b/)))for(k=map.Scale.normalX(e);k<R*ka+map.Scale.normalX(e);k+=ka*Qa)map.Dom.newShape("line",Sa,k,-20,k,20,"stroke:#444444;stroke-width:"+map.Scale.normalX(1)+";")}else{Qa=1;Qa=Math.ceil(R-Va)/5;Qa<.5&&(Qa=Math.ceil(R-Va)/10);if(Qa>1){var Nd=Math.pow(10,Math.floor(Math.log10(Qa)));Qa=Math.ceil(Qa/Nd)*Nd||1}R=Math.ceil(R/Qa)*Qa;for(Va=Math.floor(Va/Qa)*Qa;(R-Va)/Qa<5;)Qa/=2;(R-Va)/Qa>5&&(Qa*=2);if(!mc){mc=!0;this.plot_last_last_position=[];this.plot_last_position=[];this.plot_last_value=
[];this.plot_last_stacked_value=[];this.plot_last_shape=[];this.plot_last_mean=[];this.plot_last_areaValue=[];this.plot_area_points=[];this.plot_area_shapes=[];this.plot_area_shapes[0]=map.Dom.newShape("path",h,"M0,0","fill:"+E+";fill-opacity:"+(this.fillOpacity||1)+";stroke:none");var fc=m.length/(this.nGridX||1),ac=map.Scale.normalX(Math.max(m.length/(this.nGridX||1),3));ac*=(b.match(/ZOOM/),1);var bc=map.Dom.newGroup(h,"");bc.parentNode.insertBefore(bc,h.firstChild);if(b.match(/BOX/)&&b.match(/\bGRID\b/)&&
(b.match(/ZOOM/)||!(this.nBoxUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nBoxUpper||this.nBoxLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nBoxLower))){if(!b.match(/ZOOM/)){var Mc=-Y/(b.match(/LINES/)?3:1),cc=Y*(this.nGridX?m.length/this.nGridX-1:m.length-1);map.Dom.newShape("rect",h,0,-(R-Va)*ka,cc,(R-Va)*ka,"fill:#ffffff;fill-opacity:0;stroke:none;pointer-events:none")}var Od=.8,be=0;for(k=0;k<=(R-Va)*ka;k+=ka*Qa){var fd=this.formatValue(Math.round(b.match(/INVERT/)?R-k/
ka+Va:(k/ka+Va)*100)/100,2);R>5&&(fd=String(Math.round(b.match(/INVERT/)?R-k/ka+Va:k/ka+Va)));var Ub=k;b.match(/LOG/)&&(Ub=100*Math.pow(10,be++),Ub>R&&(k=R*ka),fd=this.formatValue(Ub,0),Ub=Math.log10(Ub)*R/Math.ceil(Math.log10(R))*ka);Mc=-Y/(b.match(/LINES/)?5:1);cc=Y*(this.nGridX?m.length/this.nGridX-1:m.length-1);b.match(/PLOTVAR/)&&m.length/this.nGridX>1&&(cc=Y*this.nGridX);if(b.match(/GRADIENT/)&&k!==0){var Pd=cc+(b.match(/LINES/),0);na=map.Dom.newShape("path",h,"M0,"+-k+" L "+Pd+","+-k+" "+Pd+
","+(-k+ka*Qa)+" 0,"+(-k+ka*Qa)+" z","fill:#d8d8dd;fill-opacity:"+Od+";stroke:none;");Od-=.3}Ub===-Va*ka?map.Dom.newShape("line",Sa,Mc,-Ub,cc,-Ub,"stroke:#444444;stroke-opacity:1;stroke-width:"+map.Scale.normalX(.05*fc)+";"):map.Dom.newShape("line",Sa,Mc,-Ub,cc,-Ub,"stroke:#888888;stroke-opacity:0.4;stroke-width:"+map.Scale.normalX(.05*fc)+";stroke-dasharray:"+6*fc+" "+3*fc+";");b.match(/RIGHT/)?map.Dom.newText(Sa,cc+map.Scale.normalX(15),-Ub+ac*.3,"font-family:arial;font-size:"+ac+"px;text-anchor:start;fill:"+
(b.match(/\bCOLOR\b/)?E:"#888888")+";stroke:none;pointer-events:none;",fd):map.Dom.newText(Sa,Mc*1.1,-Ub+ac*.3,"font-family:arial;font-size:"+ac+"px;text-anchor:end;fill:"+(b.match(/\bCOLOR\b/)?E:"#888888")+";stroke:none;pointer-events:none;",fd);this.nPlotHeight=k}b.match(/ZOOM/)&&(this.nLowValue&&(map.Dom.newShape("line",Sa,Mc,-(this.nLowValue-Va)*ka,cc,-(this.nLowValue-Va)*ka,"stroke:#dd0000;stroke-opacity:0.4;stroke-width:"+map.Scale.normalX(.1*fc)+";stroke-dasharray:"+6*fc+" "+3*fc+";"),b.match(/ZOOM/)&&
map.Dom.newText(Sa,cc*1.06,-(this.nLowValue-Va)*ka+ac*.3,"font-family:arial;font-size:"+ac+"px;text-anchor:end;fill:#888888;stroke:none;pointer-events:none;",this.nLowValue)),this.nHighValue&&(map.Dom.newShape("line",Sa,Mc,-(this.nHighValue-Va)*ka,cc,-(this.nHighValue-Va)*ka,"stroke:#dd0000;stroke-opacity:0.4;stroke-width:"+map.Scale.normalX(.1*fc)+";stroke-dasharray:"+6*fc+" "+3*fc+";"),b.match(/ZOOM/)&&map.Dom.newText(Sa,cc*1.06,-(this.nHighValue-Va)*ka+ac*.3,"font-family:arial;font-size:"+ac+"px;text-anchor:end;fill:#888888;stroke:none;pointer-events:none;",
this.nHighValue)));map.Dom.newShape("line",Sa,Ga,0,Ga,-(R-Va)*ka,"stroke:#aaaaaa;stroke-width:"+map.Scale.normalX(.1)+";");if(this.szXaxisA&&this.szXaxisA.length)for(k=0;k<this.szXaxisA.length;k++)if(this.szXaxisA[k].length&&this.szXaxisA[k]!=" "||k==0||k==this.szXaxisA.length-1)map.Dom.newShape("line",Sa,Y*k,100,Y*k,-(R-Va)*ka,"stroke:#888888;stroke-opacity:0.4;stroke-width:"+map.Scale.normalX(.05*this.szXaxisA.length)+";stroke-dasharray:"+6*this.szXaxisA.length+" "+3*this.szXaxisA.length+";"),map.Dom.newText(Sa,
Y*k,ac*1.5,"font-family:arial;font-size:"+ac+"px;text-anchor:middle;fill:#888888;stroke:none;pointer-events:none;",this.szXaxisA[k])}b.match(/NOCLIP/)||map.Dom.setClipRect(h,{x:-100,y:-(R-Va)*ka,width:100+H/(this.nGridX||1)*Y,height:100+(R-Va)*ka})}var hc=this.nGridX?Math.floor(w/this.nGridX)+1:1,Ha=this.nGridX?w%this.nGridX:1;b.match(/LOG/)&&a&&(a=Math.log10(a)*R/Math.ceil(Math.log10(R)));var hb=b.match(/INVERT/)?R-a:a;hb-=Va;hb+=b.match(/STACKED/)?this.plot_last_stacked_value[hc]||0:0;I.fu.setPosition(Ga,
-hb*ka);Ua&&Ua.fu.setPosition(Ga,-hb*ka);if(ba&&ba.parentNode){if(this.nXLen>10){var Qd=Math.floor(w/(this.nGridX||1));Qd!=0&&Qd!=this.nXLen-1&&ba.parentNode.removeChild(ba)}ba&&ba.parentNode&&(b.match(/\bINLINETEXT\b/)?ba.fu.setPosition(Ga,-hb*ka):b.match(/\bSTACKED\b/)?ba.parentNode.removeChild(ba):b.match(/LINES/)&&(this.nGridX==null||this.nGridX<=1)?(ba.fu.setPosition(Ga-map.Scale.normalX(e*this.nGridX||1),-hb*ka),ba.fu.scale(2.5,2.5)):(ba.fu.scale(1.5*this.nValueScale,1.5*this.nValueScale),ba.fu.setPosition(Ga-
map.Scale.normalX(e/7),-hb*ka)))}if(b.match(/LINES/)){var na=null;if(b.match(/ZEROISVALUE/)&&!b.match(/ZEROISNOTVALUE/)&&this.plot_last_position[Ha]&&(a||this.plot_last_position[Ha].y)||a&&this.plot_last_position[Ha]&&this.plot_last_position[Ha].y)if(b.match(/AREA/)){if(na=map.Dom.newShape("path",bc,"M"+(this.plot_last_position[Ha].x-2)+","+this.plot_last_position[Ha].y+"L"+Ga+","+-hb*ka+" "+Ga+","+(-hb+a)*ka+" "+(this.plot_last_position[Ha].x-2)+","+((this.plot_last_last_position[Ha-1]?this.plot_last_last_position[Ha-
1].y:0)+Va*ka)+" z","fill:"+E+";fill-opacity:"+(this.fillOpacity||1)+";")){na.setAttributeNS(szMapNs,"value",String(a));na.setAttributeNS(szMapNs,"class",String(sa%(this.nGridX||1E6)));var xd=this.nXLen<25?this.formatValue(this.plot_last_areaValue[Ha],this.nValueDecimals||2)+" ... "+this.formatValue(a,this.nValueDecimals||2):this.formatValue(a,this.nValueDecimals||2);na.setAttributeNS(szMapNs,"tooltip",xd+this.szUnit+" "+(this.szLabelA?this.szLabelA[ja%(this.nGridX||1E6)]:""));na.setAttributeNS(szMapNs,
"time",String(Ka));if(this.szFlag.match(/\bFADE\b/)){var Rd="Gradient"+Math.random(),Sd=map.Dom.constructNode("linearGradient",h,{id:Rd,gradientTransform:"rotate(90)"});map.Dom.constructNode("stop",Sd,{offset:"0","stop-color":E,"stop-opacity":"1"});map.Dom.constructNode("stop",Sd,{offset:"1","stop-color":E,"stop-opacity":"0.1"});na.style.setProperty("fill","url(#"+Rd+")")}}var ce=w==1||w==H-1||hc==2||hc==H/(this.nGridX||1)?"but":"round";if(na=map.Dom.newShape("line",bc,this.plot_last_position[Ha].x,
this.plot_last_position[Ha].y,Ga,-hb*ka,"stroke:"+E+";stroke-width:"+map.Scale.normalX(b.match(/STACKED/)?1:this.nLineWidth||3)+";stroke-linecap:"+ce+";"))na.setAttributeNS(szMapNs,"value",String(a)),na.setAttributeNS(szMapNs,"tooltip",this.formatValue(a,this.nValueDecimals||2)+this.szUnit+" "+(this.szLabelA?this.szLabelA[sa%(this.nGridX||1E6)]:""))}else{na=map.Dom.newShape("line",bc,this.plot_last_position[Ha].x,this.plot_last_position[Ha].y,Ga,-hb*ka,"stroke:"+(this.szLineColor||E)+";stroke-width:"+
map.Scale.normalX(this.nLineWidth||3)+";stroke-linecap:round;");xd=this.nXLen<25?this.formatValue(this.plot_last_areaValue[Ha],this.nValueDecimals||2)+" ... "+this.formatValue(a,this.nValueDecimals||2):this.formatValue(a,this.nValueDecimals||2);na&&(na.setAttributeNS(szMapNs,"value",String(a)),na.setAttributeNS(szMapNs,"class",String(sa%(this.nGridX||1E6))),na.setAttributeNS(szMapNs,"tooltip",xd+this.szUnit+" "+(this.szLabelA?this.szLabelA[sa%(this.nGridX||1E6)]:"")),na.setAttributeNS(szMapNs,"time",
String(Ka)));try{h.insertBefore(na,this.plot_last_shape[Ha])}catch(Hd){}}b.match(/LOLLIPOP/)&&a&&(na=map.Dom.newShape("line",bc,Ga,Va*ka,Ga,-hb*ka,"stroke:"+E+";stroke-width:"+map.Scale.normalX(3)+";stroke-linecap:butt;"))&&(na.setAttributeNS(szMapNs,"value",String(a)),na.setAttributeNS(szMapNs,"class",String(sa%(this.nGridX||1E6))),na.setAttributeNS(szMapNs,"time",String(Ka)));b.match(/LASTPOP/)&&a&&w>=H-(this.nGridX||1)&&(na=map.Dom.newShape("circle",bc,Ga,-hb*ka,map.Scale.normalX((this.nLineWidth||
5)*(this.nMarkerSize||1.5)),"fill:"+E+";stroke:"+M+";stroke-width:"+G+";"))&&(na.setAttributeNS(szMapNs,"value",String(a)),na.setAttributeNS(szMapNs,"time",String(Ka)));if(na&&this.szFlag.match(/\bLASTARROW\b/)&&w>=H-(this.nGridX||1)){var Td="ArrowMarker"+Math.random(),de=map.Dom.newNode("defs",bc),Fc=Math.min(5,2.5+100/((this.nLineWidth||1)/this.nChartGroupScale))*(this.nMarkerSize||3),ee=map.Dom.constructNode("marker",de,{id:Td,markerWidth:Fc,markerHeight:Fc,refX:Fc/1.7,refY:Fc/2,orient:"auto",
markerUnits:"strokeWidth"});map.Dom.constructNode("path",ee,{d:"M0,"+Fc+" L"+Fc+","+Fc/2+" L0,0 Z",style:"fill:"+E+";opacity:1;stroke:none;stroke-width:0.03"});na.setAttributeNS(null,"marker-end","url(#"+Td+")")}b.match(/\bLASTVALUE\b/)&&!b.match(/\bZOOM\b/)&&a&&w>=H-(this.nGridX||1)&&(ba=this.createTextLabel(map.SVGDocument,h,"",a,3/this.nScale*this.nValueScale,"","rgba(255,255,255,0)",this.szTextColor||"#444444","GLOW"),ba.fu.setPosition(Ga-2E3,-hb*ka-1E3));if(b.match(/PLOTVAR/)){var Bb=b.match(/MEDIAN/)?
this.nMedianA[ja]:this.nMeanA[ja];Bb-=Va;this.plot_last_mean[Ha]&&((na=map.Dom.newShape("path",Sa,"M"+this.plot_last_mean[Ha].x+","+(this.plot_last_mean[Ha].y-this.nDeviationA[ja-1]*ka)+" L "+Ga+","+(-Bb-this.nDeviationA[ja])*ka+" "+Ga+","+(-Bb+this.nDeviationA[ja])*ka+" "+this.plot_last_mean[Ha].x+","+(this.plot_last_mean[Ha].y+this.nDeviationA[ja-1]*ka)+" z","fill:#d8d8dd;fill-opacity:0.2;stroke:none;"))&&na.setAttributeNS(szMapNs,"tooltip","standard deviation"),(na=map.Dom.newShape("line",h,this.plot_last_mean[Ha].x,
this.plot_last_mean[Ha].y,Ga,-Bb*ka,"stroke:#888888;stroke-width:"+map.Scale.normalX(2)+";stroke-linecap:round;stroke-dasharray:10 80;"))&&na.setAttributeNS(szMapNs,"tooltip","mean"));this.plot_last_mean[Ha]=new point(Ga,-Bb*ka)}this.plot_last_last_position[Ha]=b.match(/STACKED/)?this.plot_last_position[Ha]||new point(0,0):new point(0,0);this.plot_last_position[Ha]=hb>=0?new point(Ga,-hb*ka):new point(Ga,0);this.plot_last_shape[Ha]=I;this.plot_last_areaValue[Ha]=a;this.plot_area_points.push(new point(Ga,
-hb*ka))}else if(b.match(/LOLLIPOP/)&&a){if(na=map.Dom.newShape("line",bc,Ga,Va*ka,Ga,-hb*ka,"stroke:"+E+";stroke-width:"+map.Scale.normalX(3)+";stroke-linecap:butt;"))na.setAttributeNS(szMapNs,"value",String(a)),na.setAttributeNS(szMapNs,"class",String(sa%(this.nGridX||1E6))),na.setAttributeNS(szMapNs,"time",String(Ka))}else if(b.match(/LASTPOP/)&&a){if(na=map.Dom.newShape("line",bc,Ga,0,Ga,-hb*ka,"stroke:"+E+";stroke-width:"+map.Scale.normalX(3)+";stroke-linecap:round;"))na.setAttributeNS(szMapNs,
"value",String(a)),na.setAttributeNS(szMapNs,"class",String(sa%(this.nGridX||1E6))),na.setAttributeNS(szMapNs,"time",String(Ka))}else if(m.length/this.nGridX>1)if(b.match(/PLOTVAR/)){I.style.setProperty("fill-opacity",hc==m.length/this.nGridX?"1":"0.2","");I.style.setProperty("stroke-width",hc==m.length/this.nGridX?"0":"3","");na=null;if(this.plot_last_position[Ha])if(b.match(/PLOTVAR/)){if(na=map.Dom.newShape("line",h,this.plot_last_position[Ha].x,this.plot_last_position[Ha].y,Ga,-hb*ka,"stroke:"+
E+";stroke-width:"+map.Scale.normalX(2)+";"))na.setAttributeNS(szMapNs,"value",String(a)),na.setAttributeNS(szMapNs,"class",String(sa%(this.nGridX||1E6))),na.setAttributeNS(szMapNs,"time",String(Ka)),na.parentNode.insertBefore(na,na.parentNode.firstChild);if(na=map.Dom.newShape("line",h,this.plot_last_position[Ha].x-40,this.plot_last_position[Ha].y,this.plot_last_position[Ha].x+40,this.plot_last_position[Ha].y,"stroke:"+E+";stroke-width:"+map.Scale.normalX(this.nLineWidth||3)+";"))na.setAttributeNS(szMapNs,
"value",String(a)),na.setAttributeNS(szMapNs,"class",String(sa%(this.nGridX||1E6))),na.setAttributeNS(szMapNs,"time",String(Ka)),na.parentNode.insertBefore(na,na.parentNode.firstChild);if(na=map.Dom.newShape("line",h,Ga,0,Ga,-this.nPlotHeight,"stroke:#dddddd;stroke-width:"+map.Scale.normalX(.25)+";"))na.setAttributeNS(szMapNs,"value",String(a)),na.setAttributeNS(szMapNs,"class",String(sa%(this.nGridX||1E6))),na.setAttributeNS(szMapNs,"time",String(Ka)),na.parentNode.insertBefore(na,na.parentNode.firstChild)}else if(na=
map.Dom.newShape("line",h,this.plot_last_position[Ha].x,this.plot_last_position[Ha].y,Ga,-hb*ka,"stroke:"+E+";stroke-width:"+map.Scale.normalX(this.nLineWidth||3)+";"))na.setAttributeNS(szMapNs,"value",String(a)),na.setAttributeNS(szMapNs,"class",String(sa%(this.nGridX||1E6))),na.setAttributeNS(szMapNs,"time",String(Ka)),h.insertBefore(na,this.plot_last_shape[Ha]);this.plot_last_last_position[Ha]=this.plot_last_position[Ha]||new point(0,0);this.plot_last_position[Ha]=new point(Ga,-hb*ka);this.plot_last_shape[Ha]=
I}else b.match(/BOX/)&&map.Dom.newShape("line",Sa,Ga,0,Ga,-this.nPlotHeight,"stroke:#dddddd;stroke-width:"+map.Scale.normalX(.25)+";");else if(b.match(/PLOTVAR/)){na=null;Bb=b.match(/MEDIAN/)?this.nMedianA[ja]:this.nMeanA[ja];Bb-=Va;if(na=map.Dom.newShape("line",Sa,Ga,-(Bb-this.nDeviationA[ja])*ka,Ga,-(Bb+this.nDeviationA[ja])*ka,"stroke:#444444;stroke-width:"+map.Scale.normalX(1)+";"))na.setAttributeNS(szMapNs,"value",String(a)),na.setAttributeNS(szMapNs,"class",String(sa%(this.nGridX||1E6))),na.setAttributeNS(szMapNs,
"time",String(Ka));if(na=map.Dom.newShape("line",Sa,Ga-40,-Bb*ka,Ga+40,-Bb*ka,"stroke:#444444;stroke-width:"+map.Scale.normalX(2)+";"))na.setAttributeNS(szMapNs,"value",String(a)),na.setAttributeNS(szMapNs,"class",String(sa%(this.nGridX||1E6))),na.setAttributeNS(szMapNs,"time",String(Ka));if(na=map.Dom.newShape("line",Sa,Ga-80,-(Bb-this.nDeviationA[ja])*ka,Ga+80,-(Bb-this.nDeviationA[ja])*ka,"stroke:#444444;stroke-width:"+map.Scale.normalX(1)+";"))na.setAttributeNS(szMapNs,"value",String(a)),na.setAttributeNS(szMapNs,
"class",String(sa%(this.nGridX||1E6))),na.setAttributeNS(szMapNs,"time",String(Ka));if(na=map.Dom.newShape("line",Sa,Ga-80,-(Bb+this.nDeviationA[ja])*ka,Ga+80,-(Bb+this.nDeviationA[ja])*ka,"stroke:#444444;stroke-width:"+map.Scale.normalX(1)+";"))na.setAttributeNS(szMapNs,"value",String(a)),na.setAttributeNS(szMapNs,"class",String(sa%(this.nGridX||1E6))),na.setAttributeNS(szMapNs,"time",String(Ka));map.Dom.newShape("line",Sa,Ga,0,Ga,-this.nPlotHeight,"stroke:#dddddd;stroke-width:"+map.Scale.normalX(.25)+
";");this.plot_last_position[Ha]&&(na=map.Dom.newShape("line",Sa,this.plot_last_position[Ha].x,this.plot_last_position[Ha].y,Ga,-Bb*ka,"stroke:#888888;stroke-width:"+map.Scale.normalX(1)+";"));this.plot_last_last_position[Ha]=this.plot_last_position[Ha]||new point(0,0);this.plot_last_position[Ha]=new point(Ga,-Bb*ka)}else b.match(/BOX/)&&map.Dom.newShape("line",Sa,Ga,0,Ga,-this.nPlotHeight,"stroke:#aaaaaa;stroke-width:"+map.Scale.normalX(.25)+";");this.plot_last_value[hc]=a;this.plot_last_stacked_value[hc]=
hb}qb=0}else Fa=="label"&&(qb-=qd/1.95),I.fu.setPosition(map.Scale.normalX(0)+Pb,map.Scale.normalY(0)+qb),Ua&&Ua.fu.setPosition(map.Scale.normalX(0)+Pb,map.Scale.normalY(0)+qb),ba&&ba.fu.setPosition(Pb,map.Scale.normalY(0)+qb),qb=Fa=="label"?qb-qd/1.95:qb-v}}}else{var Fa="";if(this.nRangesA&&this.nRangesA.length)for(Ra=0;Ra<this.nRangesA.length;Ra++)if(a==this.nRangesA[Ra]||Number(a)==Number(this.nRangesA[Ra])){Fa=this.szSymbolsA[Ra]||this.szSymbolsA[0]||"circle";sa=Ra;break}Fa=this.itemA[c].szSymbol||
Fa;Fb=String(a);ha=String(a);this.szLabelA&&this.szLabelA[sa]&&(Fb=this.szLabelA[sa],ha=this.szLabelA[sa]);Fa.length||ja!==0||(Fa="empty",Fb=ha="no data",sa=0);if(Fa.length){dd++;I=null;sa=typeof this.itemA[c].nClass!="undefined"?this.itemA[c].nClass:sa;E=typeof this.itemA[c].szColor!="undefined"?this.itemA[c].szColor:this.colorScheme[sa];if(b.match(/NOLINES/))M="none";else if(M=this.itemA[c].szColor||this.colorScheme[sa],E=="white"||E=="#ffffff")M="gray";M=this.szLineColor||M;v=map.Scale.normalX(e/
2);b.match(/FIXSIZE/)?v=map.Scale.normalX(e/2)/(this.nNormalSizeValue||1):b.match(/NOSIZE/)?v=map.Scale.normalX(e/2):c&&this.itemA[c]&&this.itemA[c].nSize&&(v=v/Math.pow(this.nNormalSizeValue||this.nMaxSize,1/this.nSizePow)*Math.pow(this.itemA[c].nSize,1/this.nSizePow));if(Fa=="circle"||Fa=="square"||Fa=="roundrect"||Fa=="label"||Fa=="carot"||Fa=="diamond"||Fa=="triangle"||Fa=="hexagon"||Fa=="cross"||Fa=="empty"){F=map.Scale.normalX(e/2);G=(this.nLineWidth||1)*map.Scale.normalX(Math.min(v/F,1));switch(Fa){case "empty":I=
map.Dom.newShape("circle",h,0,0,v,"fill:#888888;fill-opacity:0;stroke:#888888;stroke-width:"+G+";");break;case "circle":I=map.Dom.newShape("circle",h,0,0,v,"fill:"+E+";stroke:"+M+";stroke-width:"+G+";");break;case "square":I=map.Dom.newShape("rect",h,-v*.8,-v*.8,v*2*.8,v*2*.8,"fill:"+E+";stroke:"+M+";stroke-width:"+G+";");break;case "roundrect":I=map.Dom.newShape("rect",h,-v*.8,-v*.8,v*2*.8,v*2*.8,"fill:"+E+";stroke:"+M+";stroke-width:"+G+";");I.setAttributeNS(null,"rx",v*.3);break;case "cross":var Db=
v*.4,rb=v*.8;I=map.Dom.newShape("path",h,"M 0,-"+(rb+Db/2)+" l"+Db/2+",0 0,"+rb+" "+rb+",0 0,"+Db+" -"+rb+",0 0,"+rb+" -"+Db+",0 0,-"+rb+" -"+rb+",0 0,-"+Db+" "+rb+",0 0,-"+rb+" "+Db/2+",0 z","fill:"+E+";stroke:"+M+";stroke-width:"+G+";");break;case "diamond":case "carot":(I=map.Dom.newShape("rect",h,-v*.8,-v*.8,v*2*.8,v*2*.8,"fill:"+E+";stroke:"+M+";stroke-width:"+G+";"))&&I.setAttributeNS(null,"transform","rotate(45)");break;case "triangle":I=map.Dom.newShape("path",h,"M 0,"+v+" l"+v*1.2+",-"+v*
2+" -"+v*2.4+",0 "+v*1.2+","+v*2+"z","fill:"+E+";stroke:"+M+";stroke-width:"+G+";");break;case "hexagon":Db=v/2;rb=v*Math.sin(60/180*Math.PI);var Wc=v;I=map.Dom.newShape("path",h,"M -"+v+",0 l "+Db+",-"+rb+" "+Wc+",0 "+Db+","+rb+" -"+Db+","+rb+" -"+Wc+",0 -"+Db+",-"+rb+" z","fill:"+E+";stroke:"+M+";stroke-width:"+G+";");break;case "label":var qd=v*2*.4;I=map.Dom.newShape("rect",h,-v*.8,-v*.4,v*2*.8,v*2*.4,"fill:"+E+";stroke:"+M+";stroke-width:"+G+";")}if(!I)continue;if(b.match(/HORZ/)){b.match(/LEFT/)&&
(ja=-ja);b.match(/VALUES/)&&(g=L(E),M=g.textColor,ba=map.Dom.newText(zb,0,0,"font-family:"+(this.szTextFont||"arial")+";font-size:"+String(v/2)+"px;text-anchor:start;baseline-shift:-90%;fill:#bbbbbb;stroke:none;pointer-events:none",ha),ba.fu.setPosition(ja*v*2,-v-map.Scale.normalX(5)),m.length>1&&setRotate(ba,-45));if(b.match(/AXIS/)&&this.szXaxisA&&(!this.fHideValues||b.match(/ZOOM/))){g=L(E);M=g.textColor;var gd=this.szXaxisA[w];ba=map.Dom.newText(zb,0,0,"font-family:"+(this.szTextFont||"arial")+
";font-size:"+String(v)+"px;text-anchor:start;baseline-shift:-90%;fill:#bbbbbb;stroke:none;pointer-events:none",gd);ba.fu.setPosition(ja*v*2+map.Scale.normalX(2),v+map.Scale.normalX(1));m.length>1&&setRotate(ba,45)}I.setAttributeNS(szMapNs,"tooltip",Fb);I.fu.setPosition(ja*v*2,0);b.match(/LEFT/)&&(ja=-ja)}else{if(b.match(/VALUES/)&&(!this.fHideValues||b.match(/ZOOM/))){g=L(E);ca=this.szValueColor||this.szTextColor||g.textColor;var rd=Math.max((jb?.length||0)+1,Id.length);b.match(/INLINETEXT/)?(ta=
this.formatValue(jb,this.nValueDecimals||(jb<1||R<=1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),za=String(Math.min(F*1,(Fa=="hexagon"?2.7:3.2)/rd*F)),za*=v/F*this.nValueScale,ba=map.Dom.newText(h,0,za*.33,"font-family:"+(this.szTextFont||"arial")+";font-size:"+za+"px;text-anchor:middle;fill:"+ca+";stroke:none;pointer-events:none",ta)):(g=L(E),M=g.textColor,ta=this.formatValue(jb,this.nValueDecimals||(jb<1||R<=1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),ba=map.Dom.newText(zb,0,
0,"font-family:"+(this.szTextFont||"arial")+";font-size:"+String(v/2*this.nValueScale)+"px;text-anchor:start;baseline-shift:-45%;fill:#bbbbbb;stroke:none;pointer-events:none",ta),ba.fu.setPosition(v+map.Scale.normalX(3),-ja*(v*2-map.Scale.normalY(0))))}I.setAttributeNS(szMapNs,"tooltip",Fb);I.fu.setPosition(0,-ja*(v*2-map.Scale.normalY(0)))}b.match(/OUTLINE/)?(I.style.setProperty("stroke-width",String(map.Scale.normalX(.5))),I.style.setProperty("stroke-opacity","1"),I.style.setProperty("fill-opacity",
"0.7")):b.match(/DOPACITY/)&&this.szAlphaField?c&&typeof this.itemA[c].nAlpha!="undefined"&&(q=1/(this.nDopacityPow||1),fb=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,q)*Math.pow(this.itemA[c].nAlpha,q),I.style.setProperty("fill-opacity",String(fb),"")):I.style.setProperty("fill-opacity",String(this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:1),"")}else{Fa.match(/.svg|.png|.jpeg/)?(I=map.Dom.constructNode("image",h,{"xlink:href":Fa}),I.setAttributeNS(null,"x",String(map.Scale.normalX(-e/
2))),I.setAttributeNS(null,"y",String(map.Scale.normalY(-e))),I.setAttributeNS(null,"width",String(map.Scale.normalX(e))),I.setAttributeNS(null,"height",String(map.Scale.normalY(e)))):I=map.Dom.constructNode("use",h,{"xlink:href":"#"+Fa+":antizoomandpan"});I.setAttributeNS(null,"style","fill:"+E+";stroke:"+M);if(this.szSizeField&&c&&this.itemA[c]){var ka=1/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[c].nSize);I.fu.scale(ka,ka)}I.fu.scale(v/e,v/e);I.fu.setPosition(map.Scale.normalX(0)+ja*map.Scale.normalX(20),
map.Scale.normalY(0));ja>0&&(map.Dom.newText(h,map.Scale.normalX(-9)+ja*map.Scale.normalX(20),0,"font-family:"+(this.szTextFont||"arial")+";font-size:360px;text-anchor:middle;baseline-shift:-50%;fill:none;stroke:black;stroke-width:60;pointer-events:none;opacity:0.3;","+"),map.Dom.newText(h,map.Scale.normalX(-9)+ja*map.Scale.normalX(20),0,"font-family:"+(this.szTextFont||"arial")+";font-size:360px;text-anchor:middle;baseline-shift:-50%;fill:white;stroke:none;pointer-events:none;opacity:0.8;","+"));
b.match(/VALUES/)&&(g=L(E),M=g.textColor,ba=map.Dom.newText(zb,0,0,"font-family:"+(this.szTextFont||"arial")+";font-size:"+String(v/2)+"px;text-anchor:start;baseline-shift:-45%;fill:#bbbbbb;stroke:none;pointer-events:none",ha),ba.fu.setPosition(v/2+map.Scale.normalX(3),v*2*-ja),b.match(/MULTILINE/)&&this.szSizeField&&c&&this.itemA[c]&&(ba=map.Dom.newText(zb,0,0,"font-family:"+(this.szTextFont||"arial")+";font-size:"+String(v/2)+"px;text-anchor:start;baseline-shift:-45%;fill:#bbbbbb;stroke:none;pointer-events:none",
String(this.itemA[c].nSize)+this.szSizeValueUnits),ba.fu.setPosition(v/2+map.Scale.normalX(3),v*2*-ja+v/2)))}I.setAttributeNS(szMapNs,"value",String(a));I.setAttributeNS(szMapNs,"class",String(sa));I.setAttributeNS(szMapNs,"time",String(Ka));this.nRealizedCount++}else this.nMissingRangeCount++}}}zb&&zb.parentNode&&zb.parentNode.appendChild(zb);Ab&&Ab.parentNode&&Ab.parentNode.appendChild(Ab);$b&&$b.parentNode&&$b.parentNode.appendChild($b);vc&&vc.parentNode&&vc.parentNode.appendChild(vc);if(0&b.match(/AREA/)&&
!this.nGridX&&this.plot_area_points&&this.plot_area_points.length){var Ud=!0,yd=this.plot_area_points.length;for(oa=0;oa<yd;oa++)this.plot_area_points[oa].y===0&&(Ud=!1);if(Ud||b.match(/ZEROISVALUE/)){var Yc="M"+this.plot_area_points[0].x+","+this.plot_area_points[0].y+" L ";for(oa=1;oa<yd;oa++)Yc+=this.plot_area_points[oa].x+","+this.plot_area_points[oa].y+" ";Yc+=this.plot_area_points[yd-1].x+",0 ";Yc+="0,0 ";Yc+="z ";this.plot_area_shapes[0].setAttributeNS(null,"d",Yc)}}if(b.match(/\bLINREG\b/)){var nc=
0,oc=m.length-1,Gc=Ec*nc+Zb,Nc=Ec*oc+Zb;M=this.szLineColorA?this.szLineColorA[0]:this.chart.szColor;map.Dom.newShape("line",bc,nc*Y,-Gc*ka,oc*Y,-Nc*ka,"stroke:"+M+";stroke-width:50;stroke-dasharray:50 50").setAttributeNS(szMapNs,"tooltip","linerar regression")}if(typeof this.szSymbolBoxStyle!="undefined"){var Vd=map.Dom.getBox(h);Lb.setAttributeNS(null,"x",-map.Scale.normalX(15));Lb.setAttributeNS(null,"y",-map.Scale.normalY(15));Lb.setAttributeNS(null,"width",map.Scale.normalX(30*dd));Lb.setAttributeNS(null,
"height",map.Scale.normalY(30));Lb.setAttributeNS(null,"fill-opacity",1)}l.x=map.Scale.normalY(0);l.y=map.Scale.normalY(b.match(/ZOOM/)||b.match(/MENUSIZE/)?20:v/map.Scale.normalY(1)+5)}else if(b.match(/BUFFER/)){R=this.nMaxA[0];a=m[0];v=this.nBufferSize?this.nBufferSize:1E3;this.szShapeType.match(/line/)&&(v*=this.nScale);v=map.Scale.getDeltaXofDistanceInMeter(v);E=this.colorScheme[0];if(this.szFields&&this.szFields.length&&this.nRangesA&&this.nRangesA.length&&(E=null,this.nRangesA.length==this.colorScheme.length))for(w=
0;w<this.nRangesA.length;w++)if(a==this.nRangesA[w]||Number(a)==Number(this.nRangesA[w])){E=this.colorScheme[w];g=L(E);M=typeof this.szBorderColor!="undefined"?this.szBorderColor:this.fillOpacity<.8?"#888888":g.textColor;break}if(this.szShapeType.match(/dummy||point/))if(E){e=v*2/map.Scale.normalX(1);l.x=0;l.y=v+map.Scale.normalY(5);this.szFlag.match(/OVERLAY/);I=map.Dom.newShape("circle",h,0,0,v,"");if(this.szFlag.match(/VALUE/)){var Hc="font-family:arial;font-size:"+map.Scale.normalX(30)+"px;fill:#222222;fill-opacity:1;stroke:white;stroke-opacity:0.2;stroke-dasharray:none;pointer-events:none;";
ba=map.Dom.newText(h,v-map.Scale.normalX(20),0,Hc,ixMap.Scale.prototype.formatDistanceString(this.nBufferSize))}this.nRealizedCount++}else return new point(0,0);if(this.szShapeType.match(/line/)){var hd=map.SVGDocument.getElementById(c),zd=hd.getAttributeNS(null,"id");if(!zd.match(":paint")){var Zc=map.SVGDocument.getElementById(zd+":paint");Zc||(Zc=hd.cloneNode(1E3),h.appendChild(Zc),Zc.setAttributeNS(null,"id",zd+":paint"));hd=Zc;this.nRealizedCount++}var fe=v*2/map.Scale.normalX(1);hd.setAttributeNS(null,
"style","fill:none;stroke:"+E+";stroke-linejoin:round;stroke-linecap:round;stroke-width:"+map.Scale.normalX(fe)*map.Scale.nZoomScale+";stroke-opacity:"+String(this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:0));return null}}else if(b.match(/BAR/)||b.match(/BARS/)){var ua=0,bb=0,ge=e,lb=1;Ma=0;f=1;Oa=this.nMax-this.nMin;db=this.nMax100-this.nMin100;this.nNormalSizeValue&&(Oa=db=this.nMaxSize=this.nNormalSizeValue);if(b.match(/SIZE/)&&!b.match(/NORMSIZE/)&&this.szSizeField&&c&&this.itemA[c])lb=
b.match(/SIZELOG/)?1/Math.max(1,Math.log(this.nMaxSize)*Math.log(this.itemA[c].nSize)):1/Math.pow(this.nMaxSize,1/this.nSizePow)*Math.pow(this.itemA[c].nSize,1/this.nSizePow);else if(b.match(/SIZE/)&&!b.match(/NORMSIZE/)){var id=x;b.match(/POINTER/)&&(id/=m.length);lb=b.match(/SIZELOG/)?1/Math.max(1,Math.log(Oa)*Math.log(Math.abs(id))):1/Math.pow(Oa,1/this.nSizePow)*Math.pow(Math.abs(id),1/this.nSizePow)}lb===0&&x!==0&&(lb=30/e);e*=lb;var Q=map.Scale.normalX(e/m.length*.66);b.match(/STACKED/)&&(Q=
map.Scale.normalX(e/3),this.nGridX&&!b.match(/MULTI/)&&(Q/=2));b.match(/MENUSIZE/)&&m.length==1&&(Q=map.Scale.normalX(e/2));ya=Q<map.Scale.normalX(5)?Q*4/5:Q*5/5;$a=1;b.match(/COLUMN/)&&(Q*=b.match(/THICK/)?2:b.match(/THIN/)?1:1.5);b.match(/THIN/)&&(Q*=.6,ya*=.75);b.match(/THICK/)&&(Q*=1.5,ya*=1.5);b.match(/STACKED/)?ya=map.Scale.normalX(5):(b.match(/ZOOM/)||b.match(/NORMSIZE/))&&m.length==1&&(ya*=2.5);b.match(/STACKED/)&&!b.match(/ZOOM/)&&(ya*=lb);ya*=this.nValueScale||1;Hc="font-family:arial;font-size:"+
ya*.95+"px;fill:#606060;pointer-events:none;";Hc=map.Scale.tStyle.Values.szStyle+"font-size:"+ya*.95+"px";b.match(/NORMSIZE/)||b.match(/MENUSIZE/)||this.szFlag.match(/NORMSIZE/)||this.szFlag.match(/MENUSIZE/)||!this.nNormalSizeValue||this.szField100&&!b.match(/POINTER/)||(z=this.nNormalSizeValue);this.nOverrideMax&&(z=this.nOverrideMax);Y=map.Scale.normalX(ge)/z;if(b.match(/OFFSETMEAN/)||b.match(/OFFSETMEDIAN/)||b.match(/DEVIATION/))Y=map.Scale.normalX(e)/300;b.match(/SIZE/)&&b.match(/SEQUENCE/)&&
c&&m.length>1&&!this.szSizeField&&!this.szField100?Y=Y*m.length/lb:b.match(/SIZE/)&&c&&m.length>1&&!b.match(/EXPAND/)&&(Y=this.szField100||b.match(/POINTER/)?Y*lb:Y/(b.match(/SIZEP4/)?lb*lb:lb));this.nRangeScale&&(Y*=this.nRangeScale);b.match(/COMPRESSMAX/)?Y/=4:b.match(/COMPRESSMORE/)?Y/=3:b.match(/COMPRESS/)?Y/=2:b.match(/EXPANDMAX/)?Y*=4:b.match(/EXPANDMORE/)?Y*=3:b.match(/EXPAND/)&&(Y*=2);b.match(/POINTER/)&&!b.match(/NORMSIZE/)&&(Y*=1.2);var $c=map.Dom.newGroup(h,"");if(b.match(/\bSORT\b/)){this.sortedIndex=
[];for(w=0;w<m.length;w++)this.sortedIndex[w]={index:w,value:m[w]};this.sortedIndex.sort(b.match(/STACKED/)?this.sortIndexUp:this.sortIndexDown)}else this.sortedIndex=null;Tb=0;b.match(/\bUP\b/)&&(Tb=m.length-1);var Na=1;b.match(/CENTER/)&&(Na=2);var Ic=new point(0,0),jd=null,ic=null,pc=null,qc=null,Hb=null,Ad=null,kd=id=0;sa=null;var he=Y;for(w=this.nClipParts&&this.nClipParts<m.length?m.length-this.nClipParts:0;w<m.length;w++){if(this.szShowParts){Vc=!0;for(oa in this.szShowPartsA)this.szShowPartsA[oa]==
w&&(Vc=!1);if(Vc)continue}Y=he;ja=Math.abs(Tb-w);this.sortedIndex&&(ja=this.sortedIndex[ja].index);a=m[ja];this.szFlag.match(/\bCLIP\b/)&&!this.szFlag.match(/MORPH/)&&this.nClipFrames&&(a=this.nClipFrames==m.length?Number(m[this.nActualFrame]):m[0]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+m[m.length-1]*this.nActualFrame/(this.nClipFrames-1),ja=this.nActualFrame,w=m.length);var Mb=a;b.match(/INVERT/)&&(a!==0||b.match(/ZEROISVALUE/))&&(a=this.nMax-a);Gb=this.formatValue(a,this.nValueDecimals||
2);b.match(/OFFSETMEAN/)||b.match(/OFFSETMEDIAN/)?(b.match(/OFFSETMEAN/)&&(a*=100/this.nMeanA[ja]),b.match(/OFFSETMEDIAN/)&&(a*=100/this.nMedianA[ja]),a-=100,Mb=a=isFinite(a)&&!isNaN(a)?a:0,z=100,Gb=this.formatValue(a,this.nValueDecimals||2),a>0&&(Gb="+"+Gb)):b.match(/DEVIATION/)&&(a=(a-this.nMeanA[ja])/this.nDeviationA[ja],Mb=a=isFinite(a)&&!isNaN(a)?a:0,a*=100,Gb=this.formatValue(a,this.nValueDecimals||2),a>0&&(Gb="+"+Gb));var Wa=this.colorScheme[ja]||this.colorScheme[ja%(this.nGridX||1E6)];sa=
ja%(this.nGridX||1E6);if((b.match(/SEQUENCE|CLIP/)||m.length==1)&&this.colorScheme.length>=2)for(Wa=this.colorScheme[this.partsA.length-1],Ra=0;Ra<this.partsA.length;Ra++)if(a<this.partsA[Ra].max){Wa=this.colorScheme[Ra];sa=Ra;break}b.match(/LEFT/)&&b.match(/HORZ/)&&(a=-a);a<0&&!b.match(/STACKED/)&&(bb=-a*Y,a=-a);b.match(/VOLUME/)&&b.match(/3D/)?(Y=1,a=this.szSizeField&&c?Q=map.Scale.normalX(e/3*2)*Math.pow(1/this.nMaxSize*this.itemA[c].nSize,1/3):Q=map.Scale.normalX(e/3*2)*Math.pow(1/z*a,1/3)):(b.match(/POINTER/)&&
b.match(/SIZE/)&&c&&(Q=b.match(/WIDTH/)&&u&&(!(b.match(/DIFFERENCE/)||b.match(/RELATIVE/)||b.match(/FRACTION/))||b.match(/OFFSETMEAN/)||b.match(/OFFSETMEDIAN/)||b.match(/DEVIATION/))?map.Scale.normalX(e)*Math.pow(Math.abs(1/this.nMax100*u),.5):map.Scale.normalX(e)*Math.pow(Math.abs(1/z*a),1/3),ya=Q*.6,this.nValueSizeMin&&!b.match(/ZOOM/)&&(ya=ya*map.Layer.nDynamicObjectScale>map.Scale.normalX(this.nValueSizeMin)?ya:0),this.nValueValueMin&&!b.match(/ZOOM/)&&(ya=a>this.nValueValueMin?ya:0),b.match(/ZOOM|XAXIS/)||
($a=Math.pow(Math.abs(a),.5)/Math.pow(this.nMax,.5),this.szFadeValuePow&&Number(this.szFadeValuePow)&&($a=Math.pow(Math.abs(a),Number(this.szFadeValuePow))/Math.pow(z,Number(this.szFadeValuePow))))),b.match(/DTEXT/)&&c&&!b.match(/ZOOM/)?(ya=map.Scale.normalX(e/3*2)*Math.pow(Math.abs(1/z*a),.5)*.75,this.nValueSizeMin&&!b.match(/ZOOM/)&&(ya=ya*map.Layer.nDynamicObjectScale>map.Scale.normalX(this.nValueSizeMin)?ya:0),this.nValueValueMin&&!b.match(/ZOOM/)&&(ya=a>this.nValueValueMin?ya:0),$a=Math.pow(Math.abs(a),
1/3)/Math.pow(z,1/3)):(this.nValueSizeMin&&!b.match(/ZOOM/)&&(ya=ya*map.Layer.nDynamicObjectScale>map.Scale.normalX(this.nValueSizeMin)?ya:0),this.nValueValueMin&&!b.match(/ZOOM/)&&(ya=a>this.nValueValueMin?ya:0)));a=isFinite(a)&&!isNaN(a)?a:0;if(a===0&&b.match(/NOZERO/))bb=0;else if(Mb<0&&b.match(/NONEGATIVE/))bb=0;else if(Mb>0&&b.match(/ONLYNEGATIVE/))bb=0;else{var Ba=map.Dom.newGroup($c,"");this.szFlag.match(/MENUSIZE/)&&m.length==1&&!b.match(/VOLUME/)&&(Q*=.8,a=Q/Y*1.7,map.Dom.newShape("rect",
Ba,0,-map.Scale.normalY(e*.75),map.Scale.normalX(e*.5),map.Scale.normalY(e*.75),"fill:red;stroke:none;fill-opacity:0"));var Ya=a;if(b.match(/COLUMN/))a*Y>0&&(p=DonutCharts.newChart(map.SVGDocument,Ba,ua+Q/2,0,Q/2,0),p.setStyle("3D"),p.addStyle("SILENT"),p.addPart(100,a*Y*2-(b.match(/SPACED/)?Q/2:Q/5),Wa,0,(this.szAggregation&&this.szAggregation.match(/sum/),this.formatValue(m[Ca],this.nValueDecimals||(m[Ca]<5?1:0),"ROUND")+this.szUnit),this.formatValue(m[Ca],2)+this.szUnit+ha),p.realize());else if(b.match(/3D/)){g=
L(Wa);if(b.match(/VOLUME/)&&ic){var Cb=(a*Y-ic)/15;bb+=Cb;E="white";E="#444444";E=Ad.borderColor;var Wd=Ad.mainColor,Bd=.3;ic<a*Y&&(Bd=.2);map.Dom.newShape("line",Ba,pc+Hb,qc-Cb,ua,bb-Cb,"stroke:"+E+";stroke-width:"+map.Scale.normalX(.25)+";");map.Dom.newShape("line",Ba,pc+Hb,qc-ic-Cb,ua,bb-a*Y-Cb,"stroke:"+E+";stroke-width:"+map.Scale.normalX(.25)+";");map.Dom.newShape("line",Ba,pc+Hb+Hb/3,qc-Hb/4-Cb,ua+Q/3,bb-Q/4-Cb,"stroke:"+E+";stroke-width:"+map.Scale.normalX(.25)+";");map.Dom.newShape("line",
Ba,pc+Hb+Hb/3,qc-ic-Hb/4-Cb,ua+Q/3,bb-a*Y-Q/4-Cb,"stroke:"+E+";stroke-width:"+map.Scale.normalX(.25));map.Dom.newShape("path",Ba,"M"+(pc+Hb)+","+(qc-Cb)+" L "+ua+","+(bb-Cb)+" "+ua+","+(bb-a*Y-Cb)+" "+(pc+Hb)+","+(qc-ic-Cb)+" z","fill:"+Wd+";stroke:"+E+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:"+Bd);ic-a*Y>-Q/4&&map.Dom.newShape("path",Ba,"M"+(pc+Hb)+","+(qc-ic-Cb)+" L "+ua+","+(bb-a*Y-Cb)+" "+(ua+Q/3)+","+(bb-a*Y-Q/4-Cb)+" "+(pc+Hb+Hb/3)+","+(qc-ic-Hb/4-Cb)+" z","fill:"+Wd+";stroke:"+
E+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:"+Bd)}ic=a*Y;pc=ua;qc=bb;Hb=Q;Ad=g;if(Ya=this.nFilterA[ja]){var ad="fill:#FFFFFF;stroke:gray;stroke-width:"+map.Scale.normalX(.5)+";fill-opacity:0.1;stroke-opacity:0.1";map.Dom.newShape("path",Ba,"M"+ua+",0 l "+Q+",0 "+Q/3+","+-Q/4+" "+-Q+" 0 z",ad);map.Dom.newShape("rect",Ba,ua+Q/3,-Ya*Y/Na-Q/4,Q,Ya*Y,ad);map.Dom.newShape("path",Ba,"M"+ua+",0 l 0,"+-Ya*Y/Na+" "+Q/3+","+-Q/4+" 0,"+Ya*Y+" z",ad);map.Dom.newShape("rect",Ba,ua,-Ya*Y/Na,Q,Ya*Y,
ad);map.Dom.newShape("path",Ba,"M"+(ua+Q)+",0 l 0,"+-Ya*Y/Na+" "+Q/3+","+-Q/4+" 0,"+Ya*Y+" z",ad);g.highColor=ColorScheme.getDerivateColor(Wa,.9)}bb<=0||b.match(/LEFT/)||b.match(/VOLUME/)?(a&&(a===0&&(g=L("none")),map.Dom.newShape("rect",Ba,ua,-a*Y/Na,Q,a*Y,"fill:"+g.mainColor+";stroke:"+g.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";stroke-opacity:0.3"),map.Dom.newShape("path",Ba,"M"+(ua+Q)+",0 l 0,"+-a*Y/Na+" "+Q/3+","+-Q/4+" 0,"+a*Y+" z","fill:"+g.lowColor+";stroke:"+g.borderColor+";stroke-width:"+
map.Scale.normalX(.05)),g.highColor=ColorScheme.getDerivateColor(Wa,.9)),map.Dom.newShape("path",Ba,"M"+ua+","+-a*Y/Na+" l "+Q+",0 "+Q/3+","+-Q/4+" "+-Q+" 0 z","fill:"+g.highColor+";stroke:"+g.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";stroke-opacity:1")):(map.Dom.newShape("path",Ba,"M"+ua+",0 l "+Q+",0 "+Q/3+","+-Q/4+" "+-Q+" 0 z","fill:"+g.highColor+";stroke:"+g.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.2"),map.Dom.newShape("rect",Ba,ua+Q/3,-a*Y/Na-Q/4,Q,a*
Y,"fill:"+g.mainColor+";stroke:"+g.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.4"),map.Dom.newShape("path",Ba,"M"+ua+",0 l 0,"+-a*Y/Na+" "+Q/3+","+-Q/4+" 0,"+a*Y+" z","fill:"+g.lowColor+";stroke:"+g.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.4"),g.highColor=ColorScheme.getDerivateColor(Wa,.9),map.Dom.newShape("rect",Ba,ua,-a*Y/Na,Q,a*Y,"fill:"+g.mainColor+";stroke:"+g.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.4"),map.Dom.newShape("path",
Ba,"M"+(ua+Q)+",0 l 0,"+-a*Y/Na+" "+Q/3+","+-Q/4+" 0,"+a*Y+" z","fill:"+g.lowColor+";stroke:"+g.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.4"),g.highColor=ColorScheme.getDerivateColor(Wa,.9));Ya&&(map.Dom.newShape("rect",Ba,ua,-Ya*Y/Na,Q,Ya*Y,"fill:#FFFFFF;stroke:none;stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.25"),Ya>a?map.Dom.newShape("path",Ba,"M"+ua+","+-Ya*Y/Na+" l "+Q+",0 "+Q/3+","+-Q/4+" "+-Q+" 0 z","fill:#8888FF;stroke:#444488;stroke-width:"+map.Scale.normalX(.1)+
";fill-opacity:0.2"):map.Dom.newShape("path",Ba,"M"+ua+","+-Ya*Y/Na+" l "+Q+",0 "+Q/3+","+-Q/4+" "+-Q+" 0 z","fill:#8888FF;stroke:"+g.borderColor+";stroke-width:"+map.Scale.normalX(.1)+";fill-opacity:0.1;stroke-opacity:0.4"))}else if(b.match(/Border/))map.Dom.newShape("rect",Ba,ua,-a*Y/Na,Q,a*Y,"fill:"+Wa+";stroke:none;"),nc=ua+2,oc=ua+Q-2,Gc=2-a*Y/Na,Nc=Gc+a*Y-2,g=L(Wa),map.Dom.newShape("line",Ba,nc,Gc,nc,Nc,"stroke:white;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:1.0"),map.Dom.newShape("line",
Ba,nc,Gc,oc,Gc,"stroke:white;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:1.0"),map.Dom.newShape("line",Ba,nc,Nc,oc,Nc,"stroke:black;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:0.9"),map.Dom.newShape("line",Ba,oc,Gc,oc,Nc,"stroke:black;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:0.9");else if(b.match(/POINTER/)&&a){(b.match(/OFFSETMEAN/)||b.match(/OFFSETMEDIAN/)||b.match(/DEVIATION/))&&Math.abs(a*Y)>1E3&&(Y=(1E3+(Math.abs(a*Y)-1E3)/10+Math.abs(a*Y)%1E3)/Math.abs(a));
var rc="fill:"+Wa+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+(this.szLineColor||"black")+";stroke-opacity:0.5;stroke-width:"+map.Scale.normalX(this.nLineWidth)*Math.sqrt(lb||1);if(bb<=0)if(!this.fShadow&&this.fOrigShadow&&map.Dom.newShape("path",Ba,"M"+(ua+Q/7+10)+","+(-a*Y/Na+10)+" l "+-Q/7+",0 0,"+-Q/15+" "+Q/2+","+-Q/3+" "+Q/2+","+Q/3+" 0,"+Q/15+" "+-Q/7+",0 0,"+a*Y+" "+-Q*5/7+",0 z","fill:000000;fill-opacity:0.5;stroke:none;"),b.match(/SMALLARROW/)){var bd=map.Dom.newShape("path",Ba,"m "+
(ua+lb*10)+",-230.68306 49.394,-49.394 v 263.787999 c 0,8.2839998 6.716001,14.9999998 15.000001,14.9999998 8.284001,0 15.000001,-6.716 15.000001,-14.9999998 V -280.07706 l 49.394,49.394 c 2.928,2.929 6.767,4.394 10.606,4.394 3.839,0 7.678,-1.465 10.606,-4.394 5.858,-5.857 5.858,-15.355 0,-21.213 l -75,-75 c -5.857001,-5.858 -15.355001,-5.858 -21.213001,0 l -75.0000008,75 c -5.85799995,5.857 -5.85799995,15.355 0,21.213 5.8579998,5.857 15.3559998,5.857 21.2129998,0 z",rc);bd.fu.setPosition(30+a*Y/40,
0);bd.fu.scale(a*Y/250,a*Y/220)}else b.match(/ARROW/)?map.Dom.newShape("path",Ba,"M"+(ua+Q/3)+","+-a*Y*.9/Na+" l "+-Q/3+",0 0,"+-Q/15+" "+Q/2+","+-Q/1.5+" "+Q/2+","+Q/1.5+" 0,"+Q/15+" "+-Q/3+",0 0,"+a*Y*.9+" "+-Q/3+",0 z",rc):map.Dom.newShape("path",Ba,"M"+(ua+Q/7)+","+-a*Y/Na+" l "+-Q/7+",0 0,"+-Q/15+" "+Q/2+","+-Q/2+" "+Q/2+","+Q/2+" 0,"+Q/15+" "+-Q/7+",0 0,"+a*Y+" "+-Q*5/7+",0 z",rc);else b.match(/NONEGATIVE/)||(b.match(/LEFT/)||(b.match(/ZOOM/)||b.match(/NORMSIZE/)?rc="fill:"+Wa+";stroke:"+Wa+
";stroke-width:"+map.Scale.normalX(.25)+";fill-opacity:0.5":this.partsA.length>2?(g=L(Wa),rc="fill:"+Wa+";stroke:"+g.lowColor+";stroke-width:"+map.Scale.normalX(this.nLineWidth*.25*lb||.25)+";fill-opacity:"+(this.nFadeNegative||.1)+";stroke-opacity:0.8"):(g=L(Wa),rc="fill:"+Wa+";stroke:"+g.highColor+";stroke-width:"+map.Scale.normalX(this.nLineWidth)*Math.sqrt(lb||1)+";fill-opacity:"+(this.nFadeNegative||.1)+";stroke-opacity:1")),b.match(/SMALLARROW/)?(bd=map.Dom.newShape("path",Ba,"m 155.27191,-100.6065 -49.394,49.393999 V -315.0005 c 0,-8.284 -6.716003,-15 -15.000003,-15 -8.284,0 -15,6.716 -15,15 v 263.787999 l -49.394,-49.393999 c -2.928,-2.929 -6.767,-4.394 -10.606,-4.394 -3.839,0 -7.6779996,1.465 -10.6059996,4.394 -5.85799995,5.856999 -5.85799995,15.354999 0,21.212999 L 80.271907,-4.3935012 c 5.857,5.858 15.355,5.858 21.213003,0 l 75,-74.9999998 c 5.858,-5.857 5.858,-15.355 0,-21.212999 -5.858,-5.857 -15.356,-5.857 -21.213,0 z",
rc),bd.fu.setPosition(20+a/30,a/3),bd.fu.scale(a*Y/250,a*Y/220)):b.match(/ARROW/)?map.Dom.newShape("path",Ba,"M"+(ua+Q/3)+","+-a*Y/Na+" l "+Q/3+",0 0,"+a*Y+" "+Q/3+",0 "+-Q/2+","+Q/2+" "+-Q/2+","+-Q/2+" "+Q/3+",0 z",rc):map.Dom.newShape("path",Ba,"M"+(ua+Q/7)+","+-a*Y/Na+" l "+Q*5/7+",0 0,"+a*Y+" "+Q/7+",0 "+-Q/2+","+Q/4+" "+-Q/2+","+-Q/4+" "+Q/7+",0 z",rc))}else if(b.match(/DOTTED/))if(z<1E3){bb==0&&map.Dom.newShape("rect",Ba,ua,0,Q,2,"fill:none;stroke:"+(this.szLineColor||"black")+";stroke-width:"+
map.Scale.normalX(this.nLineWidth*.25*lb||.2)+";stroke-opacity:"+(this.nLineWidth?1:.1));var yc=Q*.8;Y=yc;Ib=Math.min(5,Math.ceil(z/20));yc/=Ib;Y=yc/Ib;for(var wc=0;wc<a;wc++)map.Dom.newShape("circle",Ba,ua+yc/2+wc%Ib*yc,-yc*Math.floor(wc/Ib)-yc/2,yc/2.2,"fill:"+Wa+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+(this.szLineColor||"black")+";stroke-width:"+map.Scale.normalX(this.nLineWidth*.25*lb||.2)+";stroke-opacity:"+(this.nLineWidth?1:.1));a=Math.ceil(a/Ib)*Ib+(a?.5:0)}else b.match(/NOZERO/)||
(a=a||1E-5),bb<=0||b.match(/LEFT/)?map.Dom.newShape("rect",Ba,ua,-a*Y/Na,Q,a*Y,"fill:"+Wa+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+(this.szLineColor||"black")+";stroke-width:"+map.Scale.normalX(this.nLineWidth*.25*lb||.2)+";stroke-opacity:"+(this.nLineWidth?1:.1)):map.Dom.newShape("rect",Ba,ua,-a*Y/Na,Q,a*Y,"fill:"+Wa+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+Wa+";stroke-width:"+map.Scale.normalX(.25)+";fill-opacity:0.3"),(Ya=this.nFilterA[ja])&&(bb<=0||b.match(/LEFT/)?map.Dom.newShape("rect",
Ba,ua,-Ya*Y/Na,Q,Ya*Y,"fill:none;stroke:black;stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.1"):map.Dom.newShape("rect",Ba,ua,-Ya*Y/Na,Q,Ya*Y,"fill:none;stroke:"+Wa+";stroke-width:"+map.Scale.normalX(.5)+";fill-opacity:0.3"));else b.match(/NOZERO/)||(a=a||1E-5),bb<=0||b.match(/LEFT/)?map.Dom.newShape("rect",Ba,ua,-a*Y/Na,Q,a*Y,"fill:"+Wa+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+(this.szLineColor||"black")+";stroke-width:"+map.Scale.normalX(this.nLineWidth*.25*lb||.2)+";stroke-opacity:"+
(this.nLineWidth?1:.1)):map.Dom.newShape("rect",Ba,ua,-a*Y/Na,Q,a*Y,"fill:"+Wa+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+Wa+";stroke-width:"+map.Scale.normalX(.25)+";fill-opacity:0.3"),(Ya=this.nFilterA[ja])&&(bb<=0||b.match(/LEFT/)?map.Dom.newShape("rect",Ba,ua,-Ya*Y/Na,Q,Ya*Y,"fill:none;stroke:black;stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.1"):map.Dom.newShape("rect",Ba,ua,-Ya*Y/Na,Q,Ya*Y,"fill:none;stroke:"+Wa+";stroke-width:"+map.Scale.normalX(.5)+";fill-opacity:0.3"));
if(!(!b.match(/VALUES/)&&!this.szXaxisA||bb>0&&b.match(/NONEGATIVE/)||!b.match(/ZOOM/)&&this.fHideValues)){a||=0;if(b.match(/AXIS/)&&(this.szLabelA||this.szXaxisA)){hc=ja/(this.nGridX||1);gd=(this.szXaxisA?this.szXaxisA[hc]:this.szLabelA?this.szLabelA[hc]:" ")||" ";var Cd=Q*.5;b.match(/\bUP\b/)&&(Cd=Q*.6);b.match(/\bHORZ\b/)&&(Cd=Q*.7);ba=map.Dom.newText(Ba,0,0,Hc+";fill:#888888;text-anchor:end;font-size:"+Cd+"px"," "+gd+" ");var La=new point(map.Scale.normalX(.8),Q/2+ya/5*2);this.fNegativeValues?
ba.setAttributeNS(null,"transform","translate("+(ua+La.y)+","+(-La.x+ya*.9+10)+") rotate(270)"):b.match(/CENTER/)?ba.setAttributeNS(null,"transform","translate("+(ua+La.y)+","+(map.Scale.normalX(e/2)+ya*.9)+") rotate(270)"):b.match(/HORZ/)?ba.setAttributeNS(null,"transform","translate("+(ua+La.y)+","+(-La.x+ya*.9+5)+") rotate(270)"):(ba.style.setProperty("text-anchor","end",""),m.length==1?ba.setAttributeNS(null,"transform","translate("+(ua+(b.match(/VOLUME/)?Q*1.3:La.y*1.5))+","+-La.x+") "):gd.length>
1?ba.setAttributeNS(null,"transform","translate("+(ua+La.y*.66)+","+(ya*.66+10)+") rotate(315)"):ba.setAttributeNS(null,"transform","translate("+(ua+La.y*.1)+","+(-La.x+ya)+")"))}if(b.match(/VALUES/)&&ya>0&&!(this.nGridX&&this.partsA.length/this.nGridX>2)){ta=this.formatValue(Mb,this.nValueDecimals||(this.nMax<=1?1:0));b.match(/POINTER/)&&Mb>0&&(this.nMin<0||b.match(/OFFSETMEAN/)||b.match(/OFFSETMEDIAN/)||this.szFlag.match(/\bSIGN\b/))&&(ta="+"+ta);b.match(/VOLUME/)||(ta+=this.szUnit?" "+this.szUnit+
" ":"");!b.match(/STACKED/)||Mb===0||u||this.nGridX||(ta=ta+" ("+Math.round(Mb/x*100)+"%)");b.match(/STACKED/)&&(ya=b.match(/ZOOM/)?map.Scale.normalX(18):map.Scale.normalX(5),ya*=this.nValueScale||1);var ld=ta.length*ya*4/8;ba=this.createTextLabel(map.SVGDocument,Ba,"",ta,ya/map.Scale.normalX(1),null,Mb>0&&(b.match(/CTEXT/)||b.match(/VALUEBACKGROUND/))?Wa:null,parseFloat(ta)<0?this.szValueColor||"red":this.szTextColor);ba.style.setProperty("opacity",String($a),"");var Dd=xb=null;this.szXaxisA&&b.match(/CATEGORICAL/)&&
!b.match(/AXIS/)&&(Dd=map.Dom.newTSpan(ba,"fill:fill:#444444;font-size:"+ya+"px"," "+this.szXaxisA[w]));var Oc=ba.fu.getBox().width;La=new point(map.Scale.normalX(-4),Q/2+ya*.15);var Xd=!0;if(b.match(/DOINLINETEXT/)&&!b.match(/ZOOM/)&&!b.match(/NORMSIZE/)||!b.match(/VALUE/)||b.match(/VOLUME/)&&!b.match(/ZOOM/)||!(b.match(/THIN/)||b.match(/NOINLINETEXT/)||b.match(/DTEXT/)||b.match(/SIZE/)||Oc+map.Scale.normalX(1)>a*Y/Na||b.match(/STACKED/)||b.match(/NORMSIZE/)||b.match(/ZOOM/))){g=L(Wa);ba.removeChild(ba.firstChild);
ba.firstChild.style.setProperty("fill",g.textColor,"");Dd&&Dd.style.setProperty("fill",g.textColor,"");xb&&xb.parentNode.removeChild(xb);var ie=map.Scale.normalX(0),Pc=map.Scale.normalY(.5);b.match(/VOLUME/)?(ka=a*Y/(Oc+map.Scale.normalX(2)),ba.parentNode.removeChild(ba),ba=map.Dom.newText(Ba,ua+a*Y/2,ya*ka/4-a*Y/2,"font-family:arial;font-size:"+ya*ka+"px;text-anchor:middle;fill:"+g.textColor+";opacity:"+fb+";stroke:none;pointer-events:none",ta)):(ka=Math.min(1,a*Y/Oc),ka<.33?ba.parentNode.removeChild(ba):
(Mb>0&&(La.x+=Math.max(map.Scale.normalX(1),a*Y-(Oc+map.Scale.normalX(3))*ka)),Pc/=ka,ba.firstChild.style.setProperty("font-size",String(ya*ka)),ba.firstChild.setAttributeNS(null,"transform","translate("+(ua+La.y-Pc)+","+(-La.x-ie)+") rotate(270)\t")));Ic.x=Math.max(0,Ic.x-a*Y)}else if(Xd=!1,b.match(/STACKED/))if(a!==0||b.match(/ZEROISVALUE/))if(this.nGridX&&m.length/this.nGridX>2)ba.parentNode.removeChild(ba);else{La.x=0;b.match(/3D/)&&(La.x+=Q/4,La.y+=Q/3);var md=a*Y/(b.match(/SUM/),2);Ic.x=Math.max(0,
Ic.x+(ya*.75-md));var nd=new point(Ic.x+La.x+md-ya/3,0),sc=map.Scale.normalX(.5)*lb,zc=ua+La.y+Q/3,Ac=ua+La.y+Q*7/8,Jc=-La.x-md,Kc=-nd.x-ya/3;if(this.nGridX&&kd<this.nGridX){La.y-=Q*2+ba.fu.getBox().width;var je=Ac;Ac=zc-(b.match(/3D/)?Q*1.5:Q*1.4);zc=je-(b.match(/3D/)?Q*7/4:Q*1.4);b.match(/3D/)&&(Jc+=Q/5,Kc+=Q/5,nd.x-=Q/7);sc=-sc}ba.setAttributeNS(null,"transform","translate("+(ua+La.y+Q+sc-ya)+","+(-nd.x-ya*.25)+") ");var Ed=map.Dom.newGroup(Ba,""),Fd=map.Dom.newGroup(Ba,"");map.Dom.newShape("line",
Ed,zc,Jc,zc+sc,Jc,"stroke-width:"+map.Scale.normalX(.15)+";stroke:white;opacity:0.2;");map.Dom.newShape("line",Fd,zc,Jc,zc+sc,Jc,"stroke-width:"+map.Scale.normalX(.05)+";stroke:#888888;");map.Dom.newShape("line",Ed,zc+sc,Jc,Ac,Kc,"stroke-width:"+map.Scale.normalX(.15)+";stroke:white;opacity:0.2;stroke-linecap:round;");map.Dom.newShape("line",Fd,zc+sc,Jc,Ac,Kc,"stroke-width:"+map.Scale.normalX(.05)+";stroke:#888888;");map.Dom.newShape("line",Ed,Ac,Kc,Ac+sc,Kc,"stroke-width:"+map.Scale.normalX(.15)+
";stroke:white;opacity:0.2;");map.Dom.newShape("line",Fd,Ac,Kc,Ac+sc,Kc,"stroke-width:"+map.Scale.normalX(.05)+";stroke:#888888;");Ic.x=Math.max(0,Ic.x+(ya*2/3-(a*Y-md)))}else ba.parentNode.removeChild(ba);else{La.x+=Q/4;b.match(/3D/)&&(La.x+=Q/4,La.y=Q*.3+ya/2);b.match(/POINTER/)&&Mb>0&&(La.x+=Q*.25);var Qc=a;Oc+map.Scale.normalX(1)>(Ya-a)*Y/Na&&(Qc=Math.max(a,Ya),Ya>a&&(Qc+=Q/Y*.2,map.Dom.newShape("line",Ba,ua+Q*.6,-La.x-a*Y/Na+Q/3,ua+Q*.6,-La.x-Ya*Y/Na-Q*.4,"stroke:white;")));b.match(/VOLUME/)&&
(Qc+=Q/5);if(m.length!=1||b.match(/HORZ/)||b.match(/VOLUME/))b.match(/VOLUME/)?ba.setAttributeNS(null,"transform","translate("+(ua+La.y)+","+(-La.x-Qc*Y/Na)+")  scale(0.9,0.9)"):ba.setAttributeNS(null,"transform","translate("+(ua+La.y)+","+(-10-Q*.25-Qc*Y/Na)+") rotate(270) scale(0.9,0.9)");else{if(b.match(/ZOOM/)||b.match(/NORMSIZE/)){La.y+=b.match(/3D/)?Q*.75:Q*.5;var ke=Math.min(0,ya*.55-a*Y),Yd=ya;!b.match(/3D/)&&!b.match(/ZOOM/)||b.match(/SIZE/)||(Yd=0);ba.setAttributeNS(null,"transform","translate("+
(ua+Yd)+","+(ke-ya*.5)+")")}else La.y+=b.match(/3D/)?b.match(/VOLUME/)?Q*.75:Q*.6:Q*.2,ba.setAttributeNS(null,"transform","translate("+(ua-Q*.8)+","+(-Qc*Y/Na-ya*.8-(b.match(/POINTER/)&&Mb>0?Q*.5:0))+")");Mb<0&&ba.style.setProperty("opacity",String($a*.75),"")}ba.style.setProperty("fill","#404040","")}}}n!=null&&w==n&&(f=ya*2,g=L(Wa),map.Dom.newShape("path",Ba,"M5,0 l 35,-45 -25,0 0,-30 -20,0 0,30 -25,0 35,45","fill:#404040;stroke:white;stroke-width:"+map.Scale.normalX(.2)).fu.setPosition(w*(Q+1.5)+
Q*.5,-a*Y+(Xd?-map.Scale.normalX(3):-Oc-map.Scale.normalX(12))));if(b.match(/TRENDLINE/)){Pc=Math.min(a*Y/2,map.Scale.normalY(1.5));g=L(Wa);E=g.lowColor;f=ya/5;w>0&&(nc=(w-1)*(Q+(b.match(/SPACED/)?Q/5:1))+Q/2,oc=w*(Q+(b.match(/SPACED/)?Q/5:1))+Q/2,E="white",E=jd>a?"#CC3333":jd<a?"#22BB22":g.lowColor,map.Dom.newShape("line",Ba,nc,-jd*Y+Pc,oc,-a*Y+Pc,"stroke:#666666;stroke-width:"+map.Scale.normalX(1/m.length*1.2)+";opacity:0.8"));var Zd=map.Dom.newShape("circle",Ba,0,0,f,"fill:"+E+";stroke:none;opacity:0.8");
Zd&&Zd.fu.setPosition(w*(Q+(b.match(/SPACED/)?Q/5:0))+Q/2,-a*Y+Pc)}b.match(/SILENT/)||(this.szFlag.match(/SEQUENCE/)?Ba.setAttributeNS(szMapNs,"tooltip",Gb+" ("+(this.szLabelA?this.szLabelA[sa]:"")+") ["+this.szFieldsA[ja]+"]"):(ha=this.szFieldsA[ja],this.szLabelA&&this.szLabelA[ja]&&(ha=this.szLabelA[ja]),Gb+=this.szUnit?" ["+this.szUnit+"]":"",!x||this.nGridX||this.szField100&&this.szFlag.match(/FRACTION/),Ba.setAttributeNS(szMapNs,"tooltip",Gb+" '"+ha+"'")));b.match(/FADEIN/)&&(m.length==2&&w===
0?Ba.style.setProperty("opacity","0.6",""):b.match(/NORMSIZE/)||(q=b.match(/FADEINP4/)?10:3,Ba.style.setProperty("opacity",String(.1+.9*Math.pow(w+1,q)/Math.pow(m.length,q)),"")));b.match(/FADENEGATIVE/)&&Mb<0&&Ba.style.setProperty("opacity","0.5","");Ba.setAttributeNS(szMapNs,"class",String(sa));Ba.fu.setPosition(0,bb);b.match(/STACKED/)?b.match(/CENTER/)||(bb-=a*Y):(bb=0,ua+=Q,b.match(/VOLUME/)&&b.match(/SPACED/)?ua+=Q/(m.length==2?2:4):b.match(/SPACED/)?ua+=Q/5:b.match(/\bUP\b/)||(ua+=1));kd++;
b.match(/STACKED/)&&!b.match(/MULTI/)&&this.nGridX&&kd%this.nGridX===0&&(bb=0,ua+=Q+Q/20);jd=a}}b.match(/HOR/)&&$c.setAttributeNS(null,"transform","rotate(90) translate("+-ua+",0)");b.match(/DIAGLEFT/)&&$c.setAttributeNS(null,"transform","rotate(315) translate("+-ua+",0)");b.match(/DIAGRIGHT/)&&$c.setAttributeNS(null,"transform","rotate(45) translate("+-ua+",0)");l.y=0;l.x=0;b.match(/HOR/)?(l.y-=Q*1/2,b.match(/3D/)&&(l.y-=Q*1/3)):b.match(/STACKED/)?l.x=Q/2:b.match(/Up/)||b.match(/HOR/)?l.x=0:l.x=
Q*kd/2;b.match(/MENUSIZE/)&&(l.x+=Q*(b.match(/HORZ/)?1:0),l.y+=Q*(b.match(/HORZ/)?.3:0),l.y+=Q*(b.match(/HORZ/)&&b.match(/3D/)?1:b.match(/VOLUME/)?.3:.6));this.nRealizedCount++;var Gd=map.Dom.newGroup(h,"");Gd.appendChild($c);b.match(/ZOOM/)&&(ka=240/ya/(m.length>1?2:1),Gd.fu.scale(ka,ka));Gd.fu.setPosition(h.fu.getPosition().x-l.x,-l.y);l.x=0;l.y=0;b.match(/HOR/)&&(l.y=Q*1/2)}if(b.match(/EXTEND/)&&map.HTMLWindow.ixmaps.htmlgui_drawChartAfter)try{ib=this.objThemesA[this.szThemesA[0]],map.HTMLWindow.ixmaps.htmlgui_drawChartAfter(map.SVGDocument,
{target:h,theme:this,item:c,values:m,maxSize:e,flag:b,mark:n,dbRecord:ib.dbRecords?ib.dbRecords[this.itemA[c].dbIndex]:null})}catch(Hd){}if(!b.match(/NORMSIZE/)){var Qb=new point(l.x,l.y);b.match(/PLOT/)?(l.x=map.Scale.normalX(this.nOffsetX||0),l.y=map.Scale.normalY(-this.nOffsetY||0)):(l.x=map.Scale.normalX(this.nOffsetX||0)*(this.nSymbolScale||1),l.y=map.Scale.normalY(-this.nOffsetY||0)*(this.nSymbolScale||1));this.szAlign&&(b.match(/PLOT/)&&!b.match(/ZOOM/)?(this.szAlign.match(/center/)&&(l.x=
map.Scale.normalX(e/2*m.length/(this.nGridX||1)),this.szAlign.match(/top/)||(l.y=-map.Scale.normalX(e/2*m.length/(this.nGridX||1)))),this.szAlign.match(/right/)&&(l.x=map.Scale.normalX(e*m.length/(this.nGridX||1))),this.szAlign.match(/23right/)&&(l.x=map.Scale.normalX(e*.66*m.length/(this.nGridX||1))),this.szAlign.match(/10%right/)&&(l.x=map.Scale.normalX(e*.9*m.length/(this.nGridX||1))),this.szAlign.match(/10%left/)&&(l.x=map.Scale.normalX(e*.1*m.length/(this.nGridX||1))),this.szAlign.match(/23left/)&&
(l.x=map.Scale.normalX(e*.33*m.length/(this.nGridX||1)))):this.nGridX&&!b.match(/ZOOM/)?(this.szAlign.match(/center/)&&(l.x=map.Scale.normalX(e/2/this.partsA.length*m.length/(this.nGridX||1))),this.szAlign.match(/right/)&&(l.x=map.Scale.normalX(e/this.partsA.length*m.length/(this.nGridX||1))),this.szAlign.match(/23right/)&&(l.x=map.Scale.normalX(e/this.partsA.length*.66*m.length/(this.nGridX||1)))):(this.szAlign.match(/center/)&&(l.y=0),this.szAlign.match(/bottom/)&&(l.y=Qb.y?Qb.y:map.Scale.normalX(e/
5)),this.szAlign.match(/above/)&&(l.y=Qb.y?Qb.y:map.Scale.normalX(e/2)),this.szAlign.match(/2above/)&&(l.y+=map.Scale.normalX(e/2)),this.szAlign.match(/below/)&&(l.y=-(Qb.y?Qb.y:map.Scale.normalX(e/2))),this.szAlign.match(/2below/)&&(l.y-=map.Scale.normalX(e/2)),this.szAlign.match(/top/)&&(l.y=-(Qb.y?Qb.y:map.Scale.normalX(e/2))),this.szAlign.match(/left/)&&(l.x=-(Qb.y?Qb.y:map.Scale.normalX(e/2))),this.szAlign.match(/2left/)&&(l.x-=map.Scale.normalX(e/2)),this.szAlign.match(/right/)&&(l.x=Qb.y?Qb.y:
map.Scale.normalX(e/2)),this.szAlign.match(/2right/)&&(l.x+=map.Scale.normalX(e/2)),this.szAlign.match(/23right/)&&(l.x=map.Scale.normalX(e/3)),this.szAlign.match(/baseline/)&&(l.y+=map.Scale.normalY(e/5))))}if(c&&this.szLabelField&&!b.match(/NORMSIZE/)&&!b.match(/ZOOM/)&&(!this.nLabelUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nLabelUpper)&&(!this.nLabelLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nLabelLower)){ha=(ha=this.itemA[c].szLabel)?isNaN(ra(ha))?ha+(this.szLabelUnits||
""):this.formatValue(ra(ha),this.nValueDecimals||2)+(this.szLabelUnits||""):this.itemA[c].szTitle?this.itemA[c].szTitle:this.szLabelField+"?";ya=map.Scale.normalX(5)*(this.nTextScale||1);Hc="opacity:0.7;font-family:arial;font-size:"+ya+"px;text-anchor:middle;fill:#000000;pointer-events:none";var le="opacity:1;fill:white;fill-opacity:0.4;stroke:#000000;stroke-width:"+map.Scale.normalX(1)+"pointer-events:none;";ld=(ha.length+2)*ya*.5;var jc=map.Dom.newGroup(h,"");jc.parentNode.append(jc);b.match(/MULTI/)?
Hc+=";fill:#444444;text-anchor:start;":jc.setAttributeNS(szMapNs,"class",String(sa));var Rc=map.Dom.newShape("rect",jc,-ld/2,-ya*.95,ld,ya*1.2,le);Rc.setAttributeNS(null,"rx",ya*.2);Rc.setAttributeNS(null,"ry",ya*.2);ba=map.Dom.newText(jc,0,0,Hc,ha);Vd=ba.fu.getBox();Q=Math.max(Vd.width,ld);Rc.setAttributeNS(null,"x",-Q/2);Rc.setAttributeNS(null,"width",Q);b.match(/MULTI/)?(jc.fu.setPosition(map.Scale.normalX(e*.8),ya*.77),jc.fu.scale(2,2),Rc.parentNode.removeChild(Rc)):jc.fu.setPosition(Q/3,ya/3+
Qb.y);this.itemA[c].labelGroup=jc;this.szTimeField&&(Ka=(new Date(this.itemA[c].szTime)).getTime()||this.itemA[c].szTime,jc.setAttributeNS(szMapNs,"time",Ka))}if(b.match(/MENU/)){var od=h.fu.getBox();h.fu.setPosition(-od.x-od.width/2,-od.y-od.height/2-map.Scale.normalY(e/2)-map.Scale.normalY(2))}else b.match(/ZOOM/)||(h.fu.setPosition(h.fu.getPosition().x-l.x,h.fu.getPosition().y-l.y),Sa&&Sa.fu.setPosition(Sa.fu.getPosition().x-l.x,Sa.fu.getPosition().y-l.y));this.nRotation&&h.fu.rotateBy(this.nRotation);
l.x=0;l.y=0;c&&(this.itemA[c].fDone=!0);return l};A.prototype.getShapes=function(){var d=map.Layer.getLayerObj(this.szThemesA[0]);if(!d||!d.szFlag.match(/tiled/))for(var c in this.itemA)this.parent.themeNodesA[c]||(this.parent.themeNodesA[c]=this.getShapeA(c))};A.prototype.getItemNodes=function(d){this.parent.themeNodesA[d]&&this.parent.themeNodesA[d].length||(this.parent.themeNodesA[d]=this.getShapeA(d));return this.parent.themeNodesA[d]||[]};A.prototype.getShapeA=function(d){d=V(d);var c=map.SVGDocument.getElementById(d.trim());
if(c)return Array(c);if(d.match(/,/))for(var e=d.split("::"),b=e[0].split(","),n=0;n<b.length;n++)if(c=map.SVGDocument.getElementById((b[n]+"::"+e[1]).trim()))return Array(c);this.nMissingLookupCount++;this.missedA[d]=d;return[]};A.prototype.getPositions=function(){for(var d in this.itemA)this.getNodePosition(this.itemA[d].szSelectionId)};A.prototype.getNodePosition=function(d){if(typeof d=="undefined")return null;if(map.Themes.themeNodesPosA[d])return map.Themes.themeNodesPosA[d];var c=this.themeNodesPosA;
if(!c[d]){if(d.match(/:clone/))return null;if(d.match(/(-?[0-9\.]+) ?, ?(-?[0-9\.]+)/)){var e=this.getMapPosition(d);c[d]=new point(e.x,e.y);return c[d]}this.parent.themeNodesA[d]||(this.parent.themeNodesA[d]=this.getShapeA(d));e=this.parent.themeNodesA[d][0];if(this.parent.themeNodesA[d].length>1)for(var b=parseFloat(e.getAttributeNS(szMapNs,"area")),n=1;n<this.parent.themeNodesA[d].length;n++){var m=this.parent.themeNodesA[d][n],u=parseFloat(m.getAttributeNS(szMapNs,"area"));u>b&&(b=u,e=m)}e&&(this.szShapeType.match(/line/)?
((b=e.getAttributeNS(szMapNs,"center"))&&b.length>2?(b=b.split(","),new box(Number(b[0].split(":")[1]),Number(b[1].split(":")[1]),0,0)):map.Dom.getBox(e),b=map.Dom.getBox(e)):(b=e.getAttributeNS(szMapNs,"center"),!b&&e.parentNode&&(b=e.parentNode.getAttributeNS(szMapNs,"center")),b&&b.length>2?(b=b.split(","),b=new box(Number(b[0].split(":")[1]),Number(b[1].split(":")[1]),0,0)):b=map.Dom.getBox(e)),n=map.Scale.getMapOffset(e),c[d]=new point(n.x+b.x+b.width/2,n.y+b.y+b.height/2),e=getMatrix(e))&&(c[d].x+=
e[4],c[d].y+=e[5])}if(c[d]&&typeof c[d].x!="undefined"&&typeof c[d].y!="undefined")return c[d];this.missedA[d]=d;return null};A.prototype.getNodeBox=function(d){if(typeof d=="undefined")return null;if(!this.parent.themeNodesBoxA[d]){if(d.match(/:clone/))return null;this.parent.themeNodesA[d]||(this.parent.themeNodesA[d]=this.getShapeA(d));var c=this.parent.themeNodesA[d][0];if(this.parent.themeNodesA[d].length>1)for(var e=parseFloat(c.getAttributeNS(szMapNs,"area")),b=1;b<this.parent.themeNodesA[d].length;b++){var n=
this.parent.themeNodesA[d][b],m=parseFloat(n.getAttributeNS(szMapNs,"area"));m>e&&(e=m,c=n)}c&&(e=map.Dom.getBox(c),c=map.Scale.getMapOffset(c),this.parent.themeNodesBoxA[d]=new box(c.x+e.x,c.y+e.y,e.width,e.height))}return this.parent.themeNodesBoxA[d]};A.prototype.getNodeArea=function(d){return(d=this.getItemNodes(d)[0])?Number(d.getAttributeNS(szMapNs,"area"))/1E6:0};var ma=/(-?[0-9\.]+) ?[, ] ?(-?[0-9\.]+)/;A.prototype.getMapPosition=function(d){if(d){var c=null;if(d&&(c=d.match(ma)))return Math.abs(parseFloat(c[1]))>
180||Math.abs(parseFloat(c[2]))>180?new point(0,0):map.Scale.getMapPositionOfLatLon(parseFloat(c[1]),parseFloat(c[2]))}return new point(0,0)};A.prototype.onClick=function(d){this.fRemove||(this.widgetNode&&this.enable(),this.fToFront=!0,executeWithMessage("map.Themes.execute()","... processing ..."),map.Themes.onclickInfo(d,this.szId))};A.prototype.showErrorInfo=function(){if(this.nMissingPositionCount!==0){var d=this.szId+":errordisplay:widget",c=map.Dictionary.getLocalText("Chart statistic");c=
new InfoContainer(map.SVGDocument,this.widgetNode,d+":movable",new point(map.Scale.normalX(0),map.Scale.normalX(0)),new point(-map.Scale.normalX(15),map.Scale.normalX(80)),"fixed",c);var e=c.workspaceNode,b=[map.Dictionary.getLocalText("total items"),map.Dictionary.getLocalText("charts drawn"),map.Dictionary.getLocalText("missing positions"),map.Dictionary.getLocalText("missing value match"),map.Dictionary.getLocalText("zero values"),String(this.nCount),String(this.nRealizedCount),String(this.nMissingPositionCount),
String(this.nMissingRangeCount),String(this.nZeroValueCount)];e=map.Dom.newGroup(e,"");e.fu.setPosition(0,map.Scale.normalY(3));createTextGrid(map.SVGDocument,e,d+":textgrid",b,2);c.reformat()}};A.prototype.getDataGrid=function(d,c){if(this.szFlag.match(/AGGREGATE/)&&this.itemA[d].nCount>3)return null;if((d=map.Themes.getDataRow(d,this))&&d.length){for(var e=0;e<d.length;e++)d[e]=d[e]||"---";c=new ScrollArea(null,c,null,10,10,10);c.reformat();e=c.workspaceNode;for(var b=[],n=map.Themes.getFieldIndexArray(this),
m=0;m<n.length;m++)b[n[m]]="font-weight:bold;fill:#087BBB",b[n[m+d.length/2]]="font-weight:bold;fill:#087BBB";n=map.Scale.tStyle.Description.nFontHeight/map.Scale.normalX(1);d=createTextGrid(map.SVGDocument,e,":textgrid",d,2,n,b);return c?(c.setWidth(Math.min(d.fu.getBox().width/map.Scale.normalX(1)+25,map.Scale.bBox.width/map.Scale.normalY(2.2))),c.setHeight(Math.min(d.fu.getBox().height/map.Scale.normalY(1)+25,map.Scale.bBox.height/map.Scale.normalY(1.5))),c.reformat(),c.hasScrollBars()&&c.setScrollPosition(new point(0,
0)),c):d.fu}};A.prototype.drawTextforOneQuadrant=function(d,c,e,b,n,m,u,z){var x=d.szStyle.match(/3D/)?e*2.4:e*1.2,w=x/2;z-=x*(c.length-2);for(var O=0;O<c.length;O++){var a=c[O].y/c[O].ly,f=Math.max(w,Math.min(c[O].y,z));w=f+x;z+=e;var g=u+map.Scale.normalX(2);f>c[O].y&&(a=Math.max(a,f/c[O].y));var l=d.mX+c[O].lx*n,h=d.mY+c[O].ly*m,r=d.mX+c[O].x*n,C=d.mY+c[O].y*m;g=d.mX+g*n;f=d.mY+f*m;var F=map.Dom.newGroup(d.frameGroup,"");d.donutPartsA[c[O].index].textNode=F;var v=map.Dom.newGroup(F,""),E=map.Dom.newGroup(F,
"");a&&(map.Dom.newShape("line",v,l,h,r,C,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;"),map.Dom.newShape("line",E,l,h,r,C,"stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+";opacity:1;"),l=r,h=C);c[O].x<u-map.Scale.normalX(3)&&(map.Dom.newShape("line",v,l,h,d.mX+(u-map.Scale.normalX(3))*n,h,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;stroke-linecap:round;"),map.Dom.newShape("line",E,l,h,d.mX+(u-map.Scale.normalX(3))*n,h,"stroke:#888888;stroke-width:"+
map.Scale.normalX(.5)+";opacity:1;"),l=d.mX+(u-map.Scale.normalX(3))*n);map.Dom.newShape("line",v,l,h,g,f,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;stroke-linecap:round;");map.Dom.newShape("line",E,l,h,g,f,"stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+";opacity:1;");l=g;g+=map.Scale.normalX(2)*n;map.Dom.newShape("line",v,l,f,g,f,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;");map.Dom.newShape("line",E,l,f,g,f,"stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+
";opacity:1;");g+=map.Scale.normalX(1.5)*n;(a=d.partsA[c[O].index]&&d.partsA[c[O].index].szText?d.partsA[c[O].index].szText:null)||(a=d.partsA[c[O].index].szInfo?d.partsA[c[O].index].szInfo:Math.round(d.partsA[c[O].index].nInfoValue*10)/10+" % ");a=this.createTextLabel(map.SVGDocument,F,"",a,e/map.Scale.normalX(1),b,this.szFlag.match(/VALUEBACKGROUND/)?d.partsA[c[O].index].color:"white",this.szChartFlag.match(/ZOOM/)?null:this.szTextColor);a.fu.setPosition(g-e,f-e*0);a.setAttributeNS(szMapNs,"tooltip",
d.partsA[c[O].index].szInfo);d.szStyle.match(/3D/)&&a.fu.scale(1,2)}};A.prototype.drawDonutText=function(d,c){for(var e=0,b=0,n=0,m=[],u=[],z=[],x=[],w=Math.min(50,this.partsA.length),O=0;O<w;O++){var a=d.getTextPosition(O);if(a){if(this.szShowPartsA){var f=!1,g;for(g in this.szShowPartsA)this.szShowPartsA[g]==O&&(f=!0);if(!f)continue}e=Math.max(e,Math.abs(a.y));b=Math.max(b,a.x);n=Math.min(n,a.x);d.szStyle.match(/STARBURST/)?(b=Math.max(b,a.x),n=Math.min(n,a.x)):(b=d.nRadOuter,n=-d.nRadOuter);a.x>
0?a.y>0?u[u.length]={index:O,x:a.x,y:a.y,lx:a.lx,ly:a.ly}:m[m.length]={index:O,x:a.x,y:-a.y,lx:a.lx,ly:-a.ly}:a.y>0?z[z.length]={index:O,x:-a.x,y:a.y,lx:-a.lx,ly:a.ly}:x[x.length]={index:O,x:-a.x,y:-a.y,lx:-a.lx,ly:-a.ly}}}m.sort(J);u.sort(J);z.sort(J);x.sort(J);c||=map.Scale.normalX(12);this.drawTextforOneQuadrant(d,m,c,"text-anchor:start;",1,-1,b,e);this.drawTextforOneQuadrant(d,u,c,"text-anchor:start;",1,1,b,e);this.drawTextforOneQuadrant(d,z,c,"text-anchor:end;",-1,1,-n,e);this.drawTextforOneQuadrant(d,
x,c,"text-anchor:end;",-1,-1,-n,e)};A.prototype.createTextLabel=function(d,c,e,b,n,m,u,z,x){var w=!0,O=!0,a=1,f=" "+this.szChartFlag+"|"+this.szFlag;if(f.match(/ZOOM/)||f.match(/MENUSIZE/)||f.match(/NORMSIZE/)||f.match(/INFOSIZE/)||f.match(/AXIS/)||f.match(/SELECTION/))w=u?w:!1,O=!1;f.match(/VALUEBACKGROUND/)&&(w=!0);f.match(/HORZ/)&&(w=!1);isNaN(n)&&(n=14);m||="";u&&w?(z=z||ColorScheme.getTextColor(u),a=f.match(/ZOOM/)?.9:.5):u="#fefeff";if(d&&c)return d=map.Dom.newGroup(c,e),c=null,O&&!this.fShadow&&
this.fOrigShadow&&(c=map.Dom.newShape("rect",d,1,1,1,1,"fill:#444444;fill-opacity:0.4;stroke:none;")),u=map.Dom.newShape("rect",d,1,1,1,1,"fill:"+u+";fill-opacity:"+a+";stroke:none;stroke-width:"+map.Scale.normalX(n*.05)),m=map.Scale.tStyle.Values.szStyle+(this.szTextFont?"font-family:"+this.szTextFont:"")+";font-size:"+map.Scale.normalY(n)+"px;fill:"+z+";fill-opacity:1;"+m,x&&x.match(/\bGLOW\b/)&&map.Dom.newText(d,map.Scale.normalX(n),map.Scale.normalY(n*.25),m+";font-size:"+map.Scale.normalY(n)+
"px;font-weight:normal;fill:none;stroke:white;stroke-width:"+map.Scale.normalY(n)/5+";stroke-opacity:0.8;pointer-events:none;stroke-linejoin:bevel;",b),map.Dom.newText(d,map.Scale.normalX(n),map.Scale.normalY(n*.25),m,b),b=map.Dom.newText(map.SVGHiddenGroup,map.Scale.normalX(n),map.Scale.normalY(n*.25),m,b),x=b.fu.getBox(),map.SVGHiddenGroup.removeChild(b),u.setAttributeNS(null,"rx",map.Scale.normalX(n*.1)),u.setAttributeNS(null,"ry",map.Scale.normalX(n*.1)),u.setAttributeNS(null,"x",x.x-map.Scale.normalX(n*
.3)),u.setAttributeNS(null,"y",x.y-map.Scale.normalY(n*0)),u.setAttributeNS(null,"width",x.width+map.Scale.normalX(n*.7)),u.setAttributeNS(null,"height",x.height+map.Scale.normalY(n)*.1),c&&(c.setAttributeNS(null,"rx",map.Scale.normalX(n*.1)),c.setAttributeNS(null,"ry",map.Scale.normalX(n*.1)),c.setAttributeNS(null,"x",x.x-map.Scale.normalX(n*.3)+map.Scale.normalX(n*.12)),c.setAttributeNS(null,"y",x.y+map.Scale.normalY(n*0)+map.Scale.normalY(n*.12)),c.setAttributeNS(null,"width",x.width+map.Scale.normalX(n*
.7)),c.setAttributeNS(null,"height",x.height+map.Scale.normalY(n)*.1)),w||(u.style.setProperty("display","none",""),c&&c.style.setProperty("display","none","")),d};A.prototype.getOverviewChart=function(d,c){d.fu=new Methods(d);var e=30;this.szChartFlag+="|MENUSIZE";if(this.szOverviewChart&&this.szOverviewChart!="NONE"&&this.nCount){e=map.Scale.normalX(100);c=map.Scale.normalY(100);var b=map.Scale.normalX(75),n=map.Scale.normalX(50);if(typeof DonutCharts!="undefined"){var m=map.Dom.newGroup(d);e=DonutCharts.newChart(map.SVGDocument,
m,e,c,b,n);this.szOverviewChart.match(/PIE/)&&(e.setStyle("flat"),e.setRadInner(0),e.setRadOuter(map.Scale.normalX(55)),e.setCenter(map.Scale.normalX(80),map.Scale.normalY(55)));if(this.szOverviewChart.match(/DONUT/)||this.szOverviewChart.match(/3D/))e.setStyle("3D"),e.setCenter(map.Scale.normalX(80),map.Scale.normalY(100));e.setLine("white");e.setLineWidth(map.Scale.normalX(.1));c=map.Scale.normalY(20);for(b=0;b<this.partsA.length;b++){n=this.partsA[b].nCount/this.nCount*100;m=100/this.nSum*this.partsA[b].nSum;
this.nRealizedCount&&this.szFlag.match(/CHART/)&&(n=this.partsA[b].nCount/this.nRealizedCount*100);this.nExactCount&&this.exactSizeA&&(n=this.partsA[b].nCount/this.nExactCount*100,m=this.exactSizeA[b]);this.szOverviewChart.match(/DONUT/)&&(c=map.Scale.normalY(this.partsA[b].nSum/this.nSum*80));var u=String(this.partsA[b].nCount),z=n?String(" = "+this.formatValue(n,1)+" %"):"",x=m?String(", "+this.szLabelA[b]+" => "+this.formatValue(m,1)+this.szUnit):"";this.szOverviewChart.match(/PERCENTOFVALUE/)?
(n=m,z="",u=this.nExactCount&&this.exactSizeA?String(this.formatValue(n,0)):String(this.formatValue(n,1)+(this.szFlag.match(/CHART/)?this.szUnit:" %"))):this.szOverviewChart.match(/DONUT/)||(x="");this.szFlag.match(/CATEGORICAL/)?(z+=" ("+this.szLabelA[b]+")",x=""):this.szLegendLabelA&&this.szLegendLabelA.length&&(z+=" ["+this.szLegendLabelA[b]+"])");e.addPart(n,c,this.partsA[b].color,0,u,String(this.partsA[b].nCount)+" member(s)"+z+x,"map.Themes.markClass(evt,'"+this.szId+"','"+b+"')","map.Themes.unmarkClass(evt,'"+
this.szId+"')")}e.realize();this.drawDonutText(e);e=map.Dom.getBox(d);if(e.width>0&&e.height>0){d.fu.getPosition();u=this.szOverviewChart.match(/PERCENTOFVALUE/)?"*  value / class":"*  members / class";c=map.Scale.normalY(10);if(this.szOverviewChart.match(/DONUT/)||this.szOverviewChart.match(/3D/))c=map.Scale.normalY(15);map.Dom.newText(d,map.Scale.normalX(80),e.y+e.height+c,map.Scale.tStyle.Note.szStyle+";text-anchor:middle;",u)}}}else{if((this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||
this.szFlag.match(/SYMBOL/))&&(!this.szFlag.match(/CATEGORICAL/)||!this.szFlag.match(/SYMBOL/))){n=this.nMinA[0];z=this.nMaxA[0];this.szSizeField&&(n=this.nMinSize,z=this.nMaxSize);b=map.Scale.normalX(e/2);m=b/Math.sqrt(z)*Math.sqrt(n);if(this.szFlag.match(/LINEAR/)||this.szFlag.match(/SIZEP1/))m=b/z*n;u=this.szFlag.match(/SUM/)?"sum":"mean";x=map.Dom.newGroup(d);if(!this.szFlag.match(/CATEGORICAL/)){var w=map.Dom.newGroup(x);this.drawChart(w,null,e*1.5,"VALUES|ZOOM|NORMSIZE");if(this.szFlag.match(/SEQUENCE/)){var O=
map.Dom.getBox(w);var a=w.fu.getPosition();w.fu.setPosition(O.width/1.5+a.x,-O.height/2+a.y);a=map.Scale.normalX(e*7)/O.height;w.fu.scale(a,a);e*=7}map.Dom.newText(x,map.Scale.normalX(0),map.Scale.normalY(5),map.Scale.tStyle.Note.szStyle+";text-anchor:left;",map.Dictionary.getLocalText(u));x.fu.setPosition(map.Scale.normalX(20),map.Scale.normalY(e))}this.szFlag.match(/SEQUENCE/)||(u=map.Dom.newGroup(d),x=map.Dom.getBox(x),u.fu.setPosition(x.x+x.width+map.Scale.normalX(e*.66),map.Scale.normalY(-5)),
x="fill:none;stroke:black;stroke-width:"+map.Scale.normalX(.25)+"px",w=map.Dom.newGroup(u),this.szFlag.match(/BUBBLE/)?map.Dom.newShape("circle",w,0,0,b,x):this.szFlag.match(/SQUARE/)&&map.Dom.newShape("rect",w,-b,-b,b*2,b*2,x),map.Dom.newShape("line",w,0,-b,b*1.1,-b,x),map.Dom.newText(w,b*1.1+map.Scale.normalX(2),-b,"font-family:arial;font-size:"+map.Scale.normalX(10)+"px;text-anchor:left;baseline-shift:-10%;fill:black;stroke:none;pointer-events:none",this.formatValue(z,1)+this.szUnit),w.fu.setPosition(map.Scale.normalX(20),
map.Scale.normalY(e/2)),m>0&&m!=b&&(z=map.Dom.newGroup(u),this.szFlag.match(/BUBBLE/)?map.Dom.newShape("circle",z,0,0,m,x):this.szFlag.match(/SQUARE/)&&map.Dom.newShape("rect",z,-m,-m,m*2,m*2,x),map.Dom.newShape("line",z,0,-m,b*1.1,-m,x),map.Dom.newText(z,b*1.1+map.Scale.normalX(2),-m,"font-family:arial;font-size:"+map.Scale.normalX(10)+"px;text-anchor:left;baseline-shift:-60%;fill:black;stroke:none;pointer-events:none",this.formatValue(n,1)+this.szUnit),z.fu.setPosition(map.Scale.normalX(20),map.Scale.normalY(0)+
b*2-m)),map.Dom.newText(u,map.Scale.normalX(20),map.Scale.normalY(0+e+15),map.Scale.tStyle.Note.szStyle+";text-anchor:left;",map.Dictionary.getLocalText("min / max size-values")));d.fu.scale(1,1)}this.szFlag.match(/CHART/)&&this.szFlag.match(/BUFFER/)&&(b=map.Scale.normalX(e/2),n=map.Dom.getBox(d.parentNode),n=n.width>0?n.width/map.Scale.normalX(1)+10:10,w=map.Dom.newGroup(d.parentNode),map.Dom.newShape("circle",w,0,0,b,"fill:none;stroke:black;"),x="fill:none;stroke:black;stroke-width:"+map.Scale.normalX(1)+
";",map.Dom.newShape("line",w,0,0,b,0,x),map.Dom.newShape("line",w,0,map.Scale.normalY(-2),0,map.Scale.normalY(2.5),x),map.Dom.newShape("line",w,b,0,b+map.Scale.normalX(-3),map.Scale.normalY(-3),x),map.Dom.newShape("line",w,b,0,b+map.Scale.normalX(-3),map.Scale.normalY(3),x),map.Dom.newText(w,b*1.1+map.Scale.normalX(2),map.Scale.normalX(-10),"font-family:arial;font-size:"+map.Scale.normalX(10)+"px;text-anchor:left;baseline-shift:-10%;fill:black;stroke:none;pointer-events:none",ixMap.Scale.prototype.formatDistanceString(this.nBufferSize*
this.nScale)),w.fu.setPosition(map.Scale.normalX(e/2+n),map.Scale.normalY(e/2)),c=new Button(d.parentNode,c+":bufferselectbutton","BUTTON","#bufferselect_button","map.Selections.newSelection('activeLayer','activeBuffer','type:BUFFER;buffersize:200','test');","","select active layer with this buffer"),c.setPosition(map.Scale.normalX(e+n+10),map.Scale.normalY(e)),c.scale(1.4,1.4),map._activeTheme&&map.Dom.newText(d.parentNode,map.Scale.normalX(e+n+20),map.Scale.normalY(e+6),"font-family:arial;font-size:"+
map.Scale.normalX(8)+"px;text-anchor:left;baseline-shift:-10%;fill:gray;stroke:none;pointer-events:none","... "+map._activeTheme));if(!(!this.szFlag.match(/CHART/)||this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||this.szFlag.match(/CATEGORICAL/)||this.szFlag.match(/BUFFER/)||this.szFlag.match(/SYMBOL/))){b=map.Dom.getBox(d.parentNode);b.width<0&&(b=new box(0,0,0,0));e=30;this.szFlag.match(/BAR/)&&this.nOrigSumA.length>5&&!this.szFlag.match(/STACKED/)&&(e=15*this.nOrigSumA.length/Math.log(this.nOrigSumA.length));
this.drawChart(d,null,e,"VALUES|NORMSIZE"+(this.szFlag.match(/STACKED/)?"|EXPANDMAX":""));e=map.Dom.getBox(d);e=Math.min(2.5,Math.max(b.height/e.height,map.Scale.normalX(100)/e.height));d.fu=new Methods(d);d.fu.scale(e,e);c=map.Dom.newGroup(d,"textGroup");c.fu.scale(1/e,1/e);e=d.fu.getBox();this.szFlag.match(/BAR/)?d.fu.setPosition(b.width-e.x+map.Scale.normalX(10),-e.y+Math.max(10,b.height*.95-e.height)):d.fu.setPosition(b.width-e.x+map.Scale.normalX(10),-e.y+Math.max(10,b.height/2-e.height/2));
u=" * overall sum";this.szAggregation&&this.szAggregation.match(/mean/)&&(u=" * arithmetic mean");d="middle";if(this.szFlag.match(/RIGHT/)||this.szFlag.match(/STACKED/)||this.szFlag.match(/CENTER/)||this.szFlag.match(/POINTER/)||this.partsA.length<=2)d="start";map.Dom.newText(c,0,e.height+e.y+map.Scale.normalY(5),map.Scale.tStyle.Note.szStyle+"baseline-shift:-100%;text-anchor:"+d+";",u)}}};A.prototype.drawColorSchemeLegend=function(d,c){var e=map.Scale.nButtonSize?map.Scale.nButtonSize*.66:12,b=map.Scale.nButtonSize||
12,n=map.Scale.nButtonSize?map.Scale.nButtonSize*1.2:18,m=n,u="font-family:arial;font-size:"+map.Scale.normalY(e)+"px;fill:#666666;pointer-events:none;",z=b*1.2;this.szFlag.match(/BAR/)&&this.szFlag.match(/\bUP\b/)&&(z=b);var x=e*1.15,w=0*z,O=0;this.szFlag.match(/BAR/)&&(this.szFlag.match(/\bUP\b/)||this.szFlag.match(/STACKED/))&&(O=this.partsA.length-1);this.showInfoMore||this.szFlag.match(/CATEGORICAL/)||this.szFlag.match(/\bUP\b/)||this.szFlag.match(/SYMBOL/)||this.szLabelA&&!this.szFlag.match(/\bCLIP\b/)||
this.partsA.length<=2?this.szLegendStyle="large":this.szLegendStyle="compact";var a=new ScrollArea(null,d,null,10,10,10);a.reformat();var f=a.workspaceNode;for(var g=1,l=0;l<this.partsA.length;l++)this.partsA[l].min&&(this.partsA[l].min.toFixed(0)!=this.partsA[l].min&&(g=Math.min(g,.1)),this.partsA[l].min.toFixed(1)!=this.partsA[l].min&&(g=Math.min(g,.01)));var h=[];for(l=0;l<this.partsA.length;l++)h[l]={},h[l].i=l,h[l].value=this.partsA[l].nCount;this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/CATEGORICAL/)&&
this.szFlag.match(/SORTDOWN/)&&h.sort(this.sortIndexDown);!this.szFlag.match(/POINTER/)&&!this.szFlag.match(/INVERT/)||this.szLegendStyle.match(/compact/)||h.reverse();var r=1;!this.szLabelA&&h.length>15&&(r=Math.floor(h.length/10),b*=1.5);var C=this.showInfoMore&&this.isMarkable?18:10,F=!1;if(this.szFlag.match(/CHART/)&&this.szFieldsA.length>1&&!this.szFlag.match(/OFFSET/)&&!this.szFlag.match(/DEVIATION/)){for(var v=F=0;v<this.nOrigSumA.length;v++)this.partsA[v]&&typeof this.partsA[v].nSum!="undefined"&&
F++;F=F==this.nOrigSumA.length}for(var E=0;E<h.length;E+=r){l=h[E].i;var M=Math.min(Math.abs(O-l),this.partsA.length-r);if(this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/CATEGORICAL/))n=this.nSkipCount===0?3*this.partsA[l].nCount/this.nCount*100:30/this.nCount*10*this.partsA[l].nCount;else if(F){n=0;if(this.szFlag.match(/MORPH/)){for(v=0;v<this.nOrigSumA.length/2;v++)n=Math.max(n,this.nOrigSumA[v]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.nOrigSumA[v+this.nOrigSumA.length/
2]*this.nActualFrame/(this.nClipFrames-1));n=(this.nOrigSumA[M]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.nOrigSumA[M+this.nOrigSumA.length/2]*this.nActualFrame/(this.nClipFrames-1))/n}else{for(v=0;v<this.nOrigSumA.length;v++)n=Math.max(n,this.partsA[v].nSum);n=this.partsA[M].nSum/n}n*=60}n=isNaN(n)?m:n;if(this.szFlag.match(/BUBBLE/))v=this.szFlag.match(/CATEGORICAL/)||this.szSizeField?b/2:b/4+b/4*(l+1)/this.partsA.length,v=map.Dom.newShape("circle",f,map.Scale.normalX(C+b/
2),map.Scale.normalY(w+b/2),map.Scale.normalY(v),"fill:"+this.colorScheme[M]+";stroke:#eeeeee;stroke-width:"+map.Scale.normalX(.1)+";");else if(r>1){v=map.Dom.newGroup(f,"");for(var G=0;G<r;G++)map.Dom.newShape("rect",v,map.Scale.normalX(C),map.Scale.normalY(w+b/r*G),map.Scale.normalX(n),map.Scale.normalY(b/r),"fill:"+this.colorScheme[M+G]+";stroke:none;")}else v=map.Dom.newShape("rect",f,map.Scale.normalX(C),map.Scale.normalY(w),map.Scale.normalX(n),map.Scale.normalY(b),"fill:"+this.colorScheme[M]+
";stroke:#eeeeee;stroke-width:"+map.Scale.normalX(.1)+";");if(v){var I=this.partsA[M].nCount;for(G=1;G<r;G++)I+=this.partsA[M+G].nCount;this.isMarkable&&this.showInfoMore&&(map.Dom.newShape("rect",f,map.Scale.normalX(-5),map.Scale.normalY(w-2),map.Scale.normalX(n),map.Scale.normalY(b+4),"fill:white;stroke:none;opacity:0;").setAttributeNS(null,"id",this.szId+":widget:background:"+M),G=new Button(f,this.szId+":class:"+M,"CHECKBOX|SELECTED","","map.Themes.showClass(evt,'"+this.szId+"','"+M+"','"+r+"')",
"map.Themes.hideClass(evt,'"+this.szId+"','"+M+"','"+r+"')","show/hide class"),G.setPosition(map.Scale.normalX(map.Scale.nButtonSize/2-1),map.Scale.normalY(w+map.Scale.nButtonSize/2-1)),G.scale(.75,.75));var ea=this.partsA[M].min+(E?g:0);G=this.partsA[M+r-1].max;var pa=G-ea>100?0:2;ea=this.formatValue(ea,pa);pa=this.formatValue(G,pa);G="";this.szFlag.match(/SHOWMEMBERS/)&&(G="  ["+I+"]");G=ea!=pa?ea+"..."+pa+(this.szLegendUnits?this.szLegendUnits:"")+this.szUnit+G:ea+(this.szLegendUnits?this.szLegendUnits:
"")+this.szUnit+G;(!this.szFlag.match(/\bCLIP\b/)||this.szFlag.match(/MORPH/))&&this.szLabelA&&this.szLabelA[M]&&(G=this.szLabelA[M]);this.szLegendLabelA[M]=G;if(this.szLegendStyle.match(/compact/)){if(this.fGrayNoMember&&I===0&&this.szFlag.match(/CHOROPLETH/)&&this.szFlag.match(/DOMINANT/)&&(v.style.setProperty("fill-opacity","0.03",""),v.style.getPropertyValue("fill"),v.style.setProperty("stroke-opacity","0.2",""),v.style.setProperty("stroke","black",""),v.style.setProperty("stroke-width",map.Scale.normalX(.3),
"")),!(this.szFlag.match(/CATEGORICAL/)||this.szFlag.match(/DOMINANT/)&&G.length>15)){var R=";font-size:"+map.Scale.normalX(e*.9)+"px;";E===0?(G=G.length>0?ea+this.szUnit:G,map.Dom.newText(f,map.Scale.normalX(C+2),map.Scale.normalY(w+x*(r+1.5)),u+R,G)):E==h.length-r&&(G=G.length>0?pa+this.szUnit:G,map.Dom.newText(f,map.Scale.normalX(C+2),map.Scale.normalY(w+x*(r+1.5)),u+R,G))}}else if(this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/CATEGORICAL/))ea=n+2,pa=String(this.partsA[l].nCount),this.nSkipCount===
0&&(pa=String(Math.round(100/this.nCount*this.partsA[l].nCount))+"%"),R=pa.length*5/7*e,this.szTextPlacement=="dynamic"&&R<n&&(ea-=String(this.partsA[l].nCount).length*5/7*e),map.Dom.newText(f,map.Scale.normalX(C+ea),map.Scale.normalY(w+x+1),u,pa),ea+=R,this.szSymbolsA[l]&&this.szSymbolsA[l].match(/symbol/)&&(pa=map.Dom.constructNode("use",f,{"xlink:href":"#"+this.szSymbolsA[l]+":antizoomandpan"}),pa.setAttributeNS(null,"style","fill:"+this.colorScheme[M]),pa.fu.scale(.5,.5),pa.fu.setPosition(map.Scale.normalX(C+
ea+10),map.Scale.normalY(w+x-3)),ea+=20),ea=map.Dom.newText(f,map.Scale.normalX(C+ea),map.Scale.normalY(w+x),u,"("+G+")"),ea.style.setProperty("fill","#bbbbdd","");else{ea=n+4;if(F){pa=this.partsA[M].nSum;this.szFlag.match(/MORPH/)&&(pa=this.nOrigSumA[M]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.nOrigSumA[M+this.nOrigSumA.length/2]*this.nActualFrame/(this.nClipFrames-1));if(this.szField100&&!this.szFlag.match(/SUM/)||this.szAggregation&&!this.szAggregation.match(/sum/))pa/=
this.partsA[M].nCount;G=G+"  ("+this.formatValue(pa,1)+this.szUnit+")"}ea=map.Dom.newText(f,map.Scale.normalX(C+ea),map.Scale.normalY(w+x),u,G);this.fGrayNoMember&&I===0&&this.szFlag.match(/CHOROPLETH/)&&(ea.style.setProperty("fill","#bbbbdd",""),v.style.setProperty("opacity","0.1",""))}this.szFlag.match(/BUFFER/)&&v.style.setProperty("fill-opacity",this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:0,"");this.szFieldsA.length==1||!this.szFlag.match(/CHART/)||this.szFlag.match(/SYMBOL/)&&
this.szFlag.match(/CATEGORICAL/)?(this.szLegendStyle.match(/compact/)?v.setAttributeNS(szMapNs,"tooltip",G+" ("+I+" member(s))"):v.setAttributeNS(szMapNs,"tooltip",I+" member(s)"),l=v.getAttributeNS(null,"style"),v.setAttributeNS(szMapNs,"onoverstyle",l+";stroke:black;stroke-width:"+map.Scale.normalX(.5)+";"),v.setAttributeNS(null,"onmouseover","map.Themes.markClass(evt,'"+this.szId+"','"+M+"','"+r+"')"),v.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+this.szId+"')"),v.setAttributeNS(null,
"onclick","map.Themes.zoomToClass(evt,'"+this.szId+"','"+M+"','"+r+"')"),v.setAttributeNS(null,"id",c+":widget:classrect:"+M)):this.szFlag.match(/SYMBOL/)?this.szFlag.match(/CATEGORICAL/)?v.setAttributeNS(szMapNs,"tooltip",this.partsA[l].nCount+" ("+this.formatValue(this.partsA[l].nCount/this.nCount*100,1)+" %)"):this.szFlag.match(/SEQUENCE/)&&v.setAttributeNS(szMapNs,"tooltip",this.nOrigSumA[l]+" ("+this.formatValue(this.nOrigSumA[l]/this.nSum*100,1)+" %)"):this.szFieldsA.length>1&&!this.szFlag.match(/SEQUENCE/)&&
(this.nSum100?v.setAttributeNS(szMapNs,"tooltip",this.formatValue(100/this.nSum100*this.nOrigSumA[M],1)+" %"):this.nSum&&v.setAttributeNS(szMapNs,"tooltip",this.nOrigSumA[M]+" ("+this.formatValue(100/this.nSum*this.nOrigSumA[M],1)+" %)"),v.setAttributeNS(null,"onmouseover","map.Themes.markClass(evt,'"+this.szId+"','"+M+"','"+r+"')"),v.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+this.szId+"')"))}this.szLegendStyle.match(/compact/)?C+=n:w+=z*9/10}this.szLegendStyle.match(/compact/)?
w+=z*r*2:this.nNoData&&(w+=z*1.5/10,v=map.Dom.newShape("rect",f,0,map.Scale.normalY(w),map.Scale.normalX(n),map.Scale.normalY(b),"fill:"+(this.szNoDataColor?this.szNoDataColor:"#ffffff")+";stroke:#000000;stroke-width:"+map.Scale.normalX(.1)+";"),v.setAttributeNS(szMapNs,"tooltip",this.nNoData+" member(s)"),v.setAttributeNS(null,"onmouseover","map.Themes.markClass(evt,'"+this.szId+"','"+M+"')"),v.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+this.szId+"')"),map.Dom.newText(f,map.Scale.normalX(22),
map.Scale.normalY(w+x),u,map.Dictionary.getLocalText("no data")),w+=z*9/10);a&&(a.setWidth(-1),a.setHeight(Math.min(w+z,map.Scale.bBox.height/map.Scale.normalY(2.2))),this.nClipColorLegend&&a.setHeight(this.nClipColorLegend),a.reformat(),a.hasScrollBars()&&(f.style.setProperty("display","none",""),map.Dom.newShape("rect",d,0,0,map.Scale.normalX(a.getWidth()),map.Scale.normalY(a.getHeight()),"fill:none;stroke:none;")));return f};A.prototype.showInfo=function(){};A.prototype.chartButton=function(d,
c,e){d=map.Dom.newGroup(d,"chartvari"+String(Math.random()));var b=this.szFlag;e=="2D"&&this.removeDefinitionFromFlag("3D");this.szFlag+="|NORMSIZE|SILENT|MENUSIZE|"+e;this.drawChart(d,null,c);this.szFlag=b;b=map.Dom.getBox(d);this.addChartTypeSign(d,e);e=Math.min(map.Scale.normalX(c)/b.width,map.Scale.normalY(c)/b.height);d.fu.scale(e,e);d.fu.setPosition(map.Scale.normalX(c+10),map.Scale.normalY(c)*e);return d};A.prototype.addDefinitionToFlag=function(d){return this.szFlag=this.szFlag+"|"+d};A.prototype.removeDefinitionFromFlag=
function(d){for(var c="",e=this.szFlag.split("|"),b=0;b<e.length;b++)e[b]!=d&&(c+=(c.length?"|":"")+e[b]);return this.szFlag=c};A.prototype.removeDefinition=function(d,c){var e="";d=d.split("|");for(var b=0;b<d.length;b++)d[b]!=c&&(e+=(e.length?"|":"")+d[b]);return e};A.prototype.addChartTypeSign=function(d,c){var e="M0,0 l"+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5)+" 0,"+map.Scale.normalX(3)+" -"+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5)+" M"+map.Scale.normalX(2.5)+",0 l"+map.Scale.normalX(17.5)+
",0 M"+map.Scale.normalX(22.5)+",0 l-"+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5)+" 0,"+map.Scale.normalX(3)+" "+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5);if(c.match(/SIZE/)){var b=map.Dom.newGroup(d,"");map.Dom.newShape("path",b,e,"stroke:white;stroke-width:"+map.Scale.normalX(4)+";stroke-opacity:0.5;stroke-linejoin:miter;stroke-linecap:square;");map.Dom.newShape("path",b,e,"stroke:#666666;stroke-width:"+map.Scale.normalX(1.5)+";stroke-linejoin:miter;stroke-linecap:square;");b.fu.setPosition(-map.Scale.normalX(10),
map.Scale.normalX(-5))}c.match(/HEIGHT/)&&(b=map.Dom.newGroup(d,""),map.Dom.newShape("path",b,e,"stroke:white;stroke-width:"+map.Scale.normalX(4)+";stroke-opacity:0.5;stroke-linejoin:miter;stroke-linecap:square;"),map.Dom.newShape("path",b,e,"stroke:#666666;stroke-width:"+map.Scale.normalX(1.5)+";stroke-linejoin:miter;stroke-linecap:square;"),b.setAttributeNS(null,"transform","translate(0,"+-map.Scale.normalX(25)+") rotate(90)"))};A.prototype.getChartTypeMenu=function(d,c,e){if(typeof b=="undefined")var b=
"CHART|BAR CHART|BAR|3D CHART|BAR|3D|SORT CHART|BAR|HORZ|LEFT|UP CHART|BAR|HORZ|RIGHT|UP CHART|BAR|HORZ|LEFT|UP|COMPRESS CHART|BAR|HORZ|RIGHT|UP|COMPRESS CHART|BAR|HORZ|LEFT|UP|3D CHART|BAR|HORZ|RIGHT|UP|3D CHART|BAR|HORZ|LEFT|UP|COMPRESS|3D CHART|BAR|HORZ|RIGHT|UP|COMPRESS|3D CHART|BAR|HORZ|CENTER|UP CHART|BAR|STACKED CHART|BAR|STACKED|3D CHART|BAR|SORT|3D|COLUMNS|STACKED CHART|BAR|SORT|3D|COLUMNS|STACKED|SIZE CHART|PIE CHART|PIE|SIZE CHART|PIE|3D CHART|PIE|3D|SIZE CHART|PIE|3D|HEIGHT CHART|PIE|3D|VOLUME CHART|PIE|DONUT CHART|PIE|DONUT|SIZE CHART|PIE|DONUT|3D CHART|PIE|DONUT|3D|SIZE CHART|PIE|DONUT|3D|HEIGHT CHART|PIE|DONUT|3D|VOLUME CHART|PIE|STARBURST CHART|PIE|STARBURST|SIZE CHART|PIE|STARBURST|3D CHART|PIE|STARBURST|3D|SIZE CHART|PIE|STARBURST|3D|HEIGHT CHART|PIE|STARBURST|3D|VOLUME CHART|PIE|DONUT|STARBURST CHART|PIE|DONUT|STARBURST|SIZE CHART|PIE|DONUT|STARBURST|3D CHART|PIE|DONUT|STARBURST|3D|SIZE CHART|PIE|DONUT|STARBURST|3D|HEIGHT CHART|PIE|DONUT|STARBURST|3D|VOLUME".split(" ");
if(typeof n=="undefined")var n="CHOROPLETH CHART|BUBBLE CHART|SQUARE CHART|PIE|3D|SIZE CHART|PIE|3D|HEIGHT CHART|PIE|3D|SIZE|HEIGHT CHART|BAR|3D|VOLUME CHART|BAR CHART|BAR|3D CHART|BAR|3D|SIZE CHART|BAR|HORZ|RIGHT|UP CHART|BAR|HORZ|RIGHT|UP|3D CHART|BAR|POINTER CHART|BAR|POINTER|SIZE CHART|BAR|HORZ|RIGHT|UP|POINTER CHART|LABEL".split(" ");c=this.szOrigFlag;if(this.szFieldsA.length>1||this.szFlag.match(/CATEGORICAL/)&&this.szFlag.match(/AGGREGATE/))n=b;e=e?e/60:3;for(b=0;b<n.length;b++){var m=this.szFlag;
var u=map.Dom.constructNode("a",d,{});map.Dom.newShape("rect",u,map.Scale.normalX(b%e*60),map.Scale.normalY(60*Math.floor(b/e)),map.Scale.normalX(60),map.Scale.normalY(60),"fill:#f8f8ff;stroke:lightgray;stroke-dasharray:50 50;stroke-width:"+map.Scale.normalX(1)+";");var z=map.Dom.newGroup(u,"szDisplayId:chart:"+String(Math.random()));map.Dom.setClipRect(z,new box(-map.Scale.normalX(25),-map.Scale.normalX(60),map.Scale.normalX(60),map.Scale.normalX(60)));this.szFlag=n[b]+"|NORMSIZE|SILENT|MENUSIZE";
m.match(/CATEGORICAL/)&&(this.szFlag+="|CATEGORICAL");m.match(/GROUP/)&&(this.szFlag+="|GROUP");m.match(/AGGREGATE/)&&(this.szFlag+="|AGGREGATE");m.match(/COMPATIBLE/)&&(this.szFlag+="|COMPATIBLE");m.match(/FAST/)&&(this.szFlag+="|FAST");m.match(/RELOCATE/)&&(this.szFlag+="|RELOCATE");m.match(/DIFFERENCE/)&&(this.szFlag+="|DIFFERENCE");m.match(/FRACTION/)&&(this.szFlag+="|FRACTION");m.match(/INVERT/)&&(this.szFlag+="|INVERT");m.match(/INVERTSIZE/)&&(this.szFlag+="|INVERTSIZE");m.match(/RELATIVE/)&&
(this.szFlag+="|RELATIVE");m.match(/DENSITY/)&&(this.szFlag+="|DENSITY");m.match(/DOPACITYMAX/)?this.szFlag+="|DOPACITYMAX":m.match(/DOPACITYLOGMAX/)?this.szFlag+="|DOPACITYLOGMAX":m.match(/DOPACITYPOWMAX/)?this.szFlag+="|DOPACITYPOWMAX":m.match(/DOPACITYMEAN/)?this.szFlag+="|DOPACITYMEAN":m.match(/DOPACITYLOGMEAN/)?this.szFlag+="|DOPACITYLOGMEAN":m.match(/DOPACITYPOWMEAN/)?this.szFlag+="|DOPACITYPOWMEAN":m.match(/DOPACITYLOG/)?this.szFlag+="|DOPACITYLOG":m.match(/DOPACITY/)&&(this.szFlag+="|DOPACITY");
m.match(/AUTO100/)&&(this.szFlag+="|AUTO100");m.match(/AUTOCOMPLETE/)&&(this.szFlag+="|AUTOCOMPLETE");var x=this.szAggregation,w=this.nClipParts;this.nClipParts=10;var O=this.drawChart(z,null,40);typeof w==="undefined"?delete this.nClipParts:this.nClipParts=w;this.szAggregation=x;if(O){this.szFlag=m;var a=map.Scale.normalX(10);O.x-=map.Scale.normalX(60/e);z.fu.setPosition(a-O.x+b%e*map.Scale.normalX(60),map.Scale.normalY(40)+a+O.y+Math.floor(b/e)*map.Scale.normalY(60));z.setAttributeNS(null,"clip-path",
"");a=900/Math.max(z.fu.getBox().width,z.fu.getBox().height);a<1&&z.fu.scale(a,a);a="";c.match(/UNDEFINEDISVALUE/)&&(a+="|UNDEFINEDISVALUE");c.match(/ZEROISVALUE/)&&(a+="|ZEROISVALUE");c.match(/NEGATIVEISVALUE/)&&(a+="|NEGATIVEISVALUE");c.match(/NONEGATIVE/)&&(a+="|NEGATIVEISVALUE");c.match(/GROUP/)&&(a+="|GROUP");c.match(/AGGREGATE/)&&(a+="|AGGREGATE");c.match(/COMPATIBLE/)&&(a+="|COMPATIBLE");c.match(/FAST/)&&(a+="|FAST");c.match(/\bRECT\b/)&&(a+="|RECT");c.match(/HEX/)&&(a+="|HEX");c.match(/RELOCATE/)&&
(a+="|RELOCATE");c.match(/CATEGORICAL/)&&(a+="|CATEGORICAL");c.match(/SUM/)&&(a+="|SUM");c.match(/MEAN/)&&(a+="|MEAN");c.match(/DIFFERENCE/)&&(a+="|DIFFERENCE");c.match(/RELATIVE/)&&(a+="|RELATIVE");c.match(/INVERT/)&&(a+="|INVERT");c.match(/INVERTSIZE/)&&(a+="|INVERTSIZE");c.match(/CALCMEAN/)&&(a+="|CALCMEAN");c.match(/CALC100/)&&(a+="|CALC100");c.match(/PRODUCT/)&&(a+="|PRODUCT");c.match(/AUTOCOMPLETE/)&&(a+="|AUTOCOMPLETE");c.match(/AUTO100/)&&(a+="|AUTO100");c.match(/QUANTILE/)&&(a+="|QUANTILE");
c.match(/DENSITY/)&&(a+="|DENSITY");c.match(/DOPACITY/)&&(a+="|DOPACITY");if(c.match(/VALUES/)||m.match(/VALUES/))a+="|VALUES";c.match(/VALUEBACKGROUND/)&&(a+="|VALUEBACKGROUND");n[b].match(/SIZE/)&&(m.match(/SIZELOG/)?a+="|SIZELOG":m.match(/SIZEP4/)?a+="|SIZEP4":m.match(/SIZEP3/)?a+="|SIZEP3":m.match(/SIZE/)&&(a+="|SIZE"));m.match(/SPACED/)&&(a+="|SPACED");u.setAttributeNS(null,"onclick","map.Themes.changeThemeStyle(evt,'"+this.szId+"','type:"+n[b]+a+"')");this.addChartTypeSign(z,n[b])}}d=[];for(var f in n)d.push(n[f]+
a);return d};A.prototype.formatValue=function(d,c,e){return isNaN(d)?d:this.nMin>999&&this.nMax<3E3?__formatValue(d,c,e+"|NOBREAKS"):__formatValue(d,c,e)};A.prototype.remove=function(d){this.parent.removeTheme(d,this.szId)};A.prototype.removeElements=function(d){this.szFlag.match(/FEATURE/)&&this.chartGroup&&this.parent.removeFromThemeNodesCache(this.chartGroup);this.widgetNode&&(widgetList.removeWidget(this.widgetNode),this.widgetNode.parentNode.removeChild(this.widgetNode),this.widgetNode=null);
this.clipTimeout&&clearTimeout(this.clipTimeout);this.unpaintMap();this.clearWMS();this.szFlag.match(/FEATURE/)&&this.chartGroup&&(d=map.SVGDocument.getElementById(this.chartGroup.getAttributeNS(null,"id")+":label"),this.chartGroup.parentNode.removeChild(d),this.chartGroup.parentNode.removeChild(this.chartGroup),this.parent.removeFromThemeNodesCache(this.chartGroup));if(this.onremove)try{eval(this.onremove)}catch(c){}try{map.HTMLWindow.ixmaps.htmlgui_onRemoveTheme(this.szId)}catch(c){}};A.prototype.removeMapThemeStyles=
function(d){d=d.split("|");for(var c=map.SVGRootElement.getElementsByTagName("path"),e=0;e<c.length;e++)if(c.item(e).nodeType==1){var b=c.item(e).parentNode.getAttributeNS(null,"id"),n=!1;if(b&&b.length!==0){b=map.Tiles.getMasterId(b).split(":")[0];for(var m=0;m<d.length;m++)b==d[m]&&(n=!0)}n&&c.item(e).parentNode.removeAttributeNS(null,"style")}};A.prototype.disable=function(){if(!this.szFlag.match(/CHART/)&&this.widgetNode)for(var d=this.widgetNode.getElementsByTagName("g"),c=0;c<d.length;c++)d.item(c).setAttributeNS(null,
"opacity","0.9")};A.prototype.enable=function(){if(this.widgetNode){for(var d=this.widgetNode.getElementsByTagName("g"),c=0;c<d.length;c++)d.item(c).setAttributeNS(null,"opacity","1.0");this.widgetNode.parentNode.appendChild(this.widgetNode)}map.Themes.setActive(this)};A.prototype.makeVisible=function(){for(var d=0;d<this.szThemesA.length;d++)map.Layer.isLayerOn(this.szThemesA[d])||map.Layer.isScaleDependentLayer(this.szThemesA[d])||(map.Themes.switchedLayerA[this.szThemesA[d]]=!0,map.Api.switchMapTheme(this.szThemesA[d],
"on")),map.Tiles.switchScaleDependentTiles()};A.prototype.checkVisible=function(){for(var d=0;d<this.szThemesA.length;d++)map.Themes.isThemeLayerUsed(this.szThemesA[d])&&this.isVisible||!map.Themes.switchedLayerA[this.szThemesA[d]]||(map.Api.switchMapTheme(this.szThemesA[d],"off"),map.Themes.switchedLayerA[this.szThemesA[d]]=null)};A.prototype.resize=function(d){d!=999&&(this.nScale*=d);if(this.szFlag.match(/BUFFER/)&&this.szShapeType.match(/line/))this.fRedrawInfo=this.fRedraw=!0,this.nSkipCount=
1,map.Themes.execute();else{map.Layer.changeObjectScaling(null,d,this.chartGroup);this.szFlag.match(/DECLUTTER/)&&this.declutterCharts();if(this.szFlag.match(/BUFFER/))for(var c=this.chartGroup.getElementsByTagName("circle"),e=0;e<c.length;e++){var b=c.item(e).getAttributeNS(null,"style");b&&b.length&&(b=__scaleStyleString(b,1/d),c.item(e).setAttributeNS(null,"style",b))}this.f=!0;this.showInfo()}};A.prototype.offset=function(d){var c=this.chartGroup.fu.getPosition();this.chartGroup.fu.setPosition(c.x+
d.x,c.y+d.y)};A.prototype.opacity=function(d){this.fillOpacity=(this.fillOpacity?this.fillOpacity:1)*d;this.fillOpacity=Math.min(1,this.fillOpacity);this.fillOpacity=Math.max(0,this.fillOpacity);this.nOpacity=(this.nOpacity?this.nOpacity:1)*d;this.nOpacity=Math.min(1,this.nOpacity);this.nOpacity=Math.max(0,this.nOpacity);if(this.chartGroup)for(var c=this.chartGroup.childNodes,e=0;e<c.length;e++)map.Layer.changeNodeOpacity(c.item(e),d);else if(this.szShapeType.match(/line/))for(e=0;e<this.szThemesA.length;e++)map.Layer.changeLayerOpacity(this.szThemesA[e],
d);else for(c in this.itemA){e=this.getItemNodes(c);for(var b=0;b<e.length;b++)map.Layer.changeNodeOpacity(e[b],d,"fill-opacity")}};A.prototype.blur=function(d){if(this.chartGroup)if(this.nBlur){var c="blur-3",e=map.SVGDocument.getElementById(c);e?e.firstChild.setAttributeNS(null,"stdDeviation",map.Scale.normalX(d)):(e=map.Dom.newNode("filter",this.chartGroup.parentNode),e.setAttributeNS(null,"id",c),e=map.Dom.newNode("feGaussianBlur",e),e.setAttributeNS(null,"stdDeviation",map.Scale.normalX(d)));
this.chartGroup.style.setProperty("filter","url(#"+c+")","")}else this.chartGroup.style.removeProperty("filter");else if(this.szThemesA[0]){var b=map.SVGDocument.getElementById("maplayer");b&&(this.nBlur?(c="blur-map",(e=map.SVGDocument.getElementById(c))?e.firstChild.setAttributeNS(null,"stdDeviation",map.Scale.normalX(d)/map.Zoom.nZoom):(e=map.Dom.newNode("filter",b.parentNode),e.setAttributeNS(null,"id",c),e.setAttributeNS(null,"x",0),e.setAttributeNS(null,"y",0),e.setAttributeNS(null,"width",
"100%"),e.setAttributeNS(null,"height","100%"),e=map.Dom.newNode("feGaussianBlur",e),e.setAttributeNS(null,"stdDeviation",map.Scale.normalX(d)/map.Zoom.nZoom)),b.style.setProperty("filter","url(#"+c+")","")):b.style.removeProperty("filter"))}};A.prototype.toggle=function(d){this.chartGroup?d===!0||typeof d=="undefined"&&this.chartGroup.style.getPropertyValue("display")=="none"?(this.chartGroup.style.setProperty("display","inline",""),this.chartGroup.display="inline",this.isChecked=!0):(this.chartGroup.style.setProperty("display",
"none",""),this.chartGroup.display="none",this.isChecked=!1):this.isChecked?(this.unpaintMap(),this.isChecked=!1,map.Themes.activateNextPaint(this)&&(this.fToggle=!1,map.Themes.execute(),this.widgetNode&&(this.widgetNode.setAttributeNS(null,"opacity","1.0"),this.widgetNode.parentNode.appendChild(this.widgetNode)))):(this.fRedraw=this.isChecked=!0,this.fToggle=!1,map.Themes.execute())};A.prototype.getHistogram=function(d,c,e){map.Themes.getHistogram(d,c,e,this)};var va=[]})();var mapSelection=null;
(function(){function Ea(y,B,A,J){this.nSelected=this.nCount=0;this.szThemes=y;this.szThemesA=y.split("|");this.szSelectShape=B;this.highLightList=new HighLight;this.szTitle=J?J:"["+B+"] - "+y;this.szTitle=map.Dictionary.getLocalText(this.szTitle);this.szOrigFlag=this.szFlag=A?A:"";this.nRefreshTimeout=0;this.szId="theme"+String(Math.random());this.szShapeType="polygon"}function t(y,B){var A=y.x;y=y.y;for(var J=!1,L=0,da=B.length-1;L<B.length;da=L++){var V=B[L].x,U=B[L].y,P=B[da].x;da=B[da].y;U>y!=
da>y&&A<(P-V)*(y-U)/(da-U)+V&&(J=!J)}return J}function K(y){if(y){var B=y instanceof Array?[]:{},A;for(A in y)A!="clone"&&(B[A]=y[A]&&typeof y[A]=="object"?K(y[A]):y[A]);return B}return null}ixMap.Selections=function(){};ixMap.Selections.prototype=new Map;typeof thisversion=="string"&&map.checkVersion(thisversion)?map.Selections=new ixMap.Selections:alert("ixMap.Themes incompatible !");ixMap.Selections.prototype.newSelection=function(y,B,A,J){if(B==null)return displayMessage("empty selection",1E3),
null;A==null&&(A="type:circle");var L=A.split("style=");if(A=L&&L.length>1?__getStyleObj(L[1]):__getStyleObj(A)){y=="activeLayer"&&(y=getActiveTheme(),y==null&&map.Themes.activeTheme&&(y=map.Themes.activeTheme.szThemes));if(y==null)return displayMessage("nothing to select!",1E3),null;mapSelection=new Ea(y,B,"SELECTION|"+A.type,J);A.buffersize&&(mapSelection.nBufferSize=A.buffersize)}mapSelection.parent=map.Themes;map.Themes.addTheme(mapSelection);mapSelection.fRealize=!0;executeWithMessage("map.Themes.execute()",
"please wait ...");return mapSelection};Ea.prototype.initValues=function(){this.nSelectedArea=this.nSelected=this.nThemeItems=this.nTested=this.nCount=this.nNodes=0;this.activeTheme=map.Themes.getTheme(this.szThemes)||map.Themes.getTheme();this.activeTheme.szThemes!=this.szThemes&&this.activeTheme.szId!=this.szThemes||!this.activeTheme.szFlag.match(/CHART/)||this.activeTheme.szFlag.match(/MULTIPLE/)||(this.szThemes="generic");this.themeNodesA=[];if(this.szThemes=="generic"){var y=this.activeTheme;
this.nCount=this.nNodes=this.nThemeItems=(this.themeRootNodesA=y.filterNodesA&&y.filterNodesA!=this.szSelectShape?K(y.filterNodesA):K(y.indexA))?this.themeRootNodesA.length:0}else{this.themeRootNodesA=[];for(y=0;y<this.szThemesA.length;y++){var B=map.Layer.getLayerObj(this.szThemesA[y]);if(B&&B.szSelection&&B.szSelection.length!==0){this.szThemeType=B.szType;this.nThemeItems+=B.nItems;var A=[];B.szFlag.match(/tiled/)?A=map.Tiles.getTileNodes(this.szThemesA[y]):A[0]=SVGDocument.getElementById(B.szName);
if(B.nRenderer&1&&B.szRenderer&&B.szRenderer.length)for(B=0;B<A.length;B++)for(var J=A[B].childNodes,L=0;L<J.length;L++)J.item(L).nodeType==1&&J.item(L).hasChildNodes()&&(this.themeRootNodesA[this.themeRootNodesA.length]=J.item(L));else for(B=0;B<A.length;B++)this.themeRootNodesA[this.themeRootNodesA.length]=A[B]}}if(this.themeRootNodesA.length===0)return!1;for(y=0;y<this.themeRootNodesA.length;y++)this.nNodes+=this.themeRootNodesA[y].childNodes.length;this.nCount=this.nNodes}if(this.szSelectShape==
"queryresult")return!0;if(typeof this.szSelectShape=="object"){this.queryResultA=this.szSelectShape;if(this.szThemes=="generic")for(y=0;y<this.szSelectShape.length;y++)this.themeRootNodesA[y]=this.szSelectShape[y];else for(y=0;y<this.szSelectShape.length;y++)this.themeRootNodesA[y]=this.szSelectShape[y].node.parentNode;this.nNodes=this.themeRootNodesA.length=this.szSelectShape.length;this.szSelectShape="queryresult";this.szSelectQuery=this.szTitle;this.markGroup||(this.markGroup=map.Dom.newGroup(map.Layer.objectGroup,
this.szId+":markgroup"));return!0}if(this.szSelectShape=="activeBuffer"){A=map.Themes.activeBuffer;if(A!=null){B=[];y=A.chartGroup;J=y.getElementsByTagName("path");L=y.getElementsByTagName("circle");for(y=0;y<J.length;y++)B[B.length]=J.item(y);for(y=0;y<L.length;y++)B[B.length]=L.item(y);this.selectCenterA=[];for(y=0;y<B.length;y++)this.selectCenterA[this.selectCenterA.length]=map.Scale.getMapOffset(B[y]);this.selectBufferSize=A.nBufferSize/map.Scale.mapUnitsPPX;this.selectScale=A.nScale;this.markGroup||
(this.markGroup=map.Dom.newGroup(map.Layer.objectGroup,this.szId+":markgroup"));return!0}alert("error: no active theme/buffer to select with");return!1}if(this.szSelectShape=="mapbounds")y=map.Zoom.getBox(),this.selectCenterA=[],this.selectionCenter=new point(y.x+y.width/2,y.y+y.height/2),this.selectCenterA.push(this.selectionCenter),this.selectBufferSizeX=y.width/2,this.selectBufferSizeY=y.height/2,this.selectScale=1;else{this.selectCenterA=[];B=map.SVGDocument.getElementById(this.szSelectShape);
if(!B)return!1;B.fu=new Methods(B);if(this.szFlag.match(/shape/))B.fu.getPosition(),y=B.fu.getBox(),this.selectionCenter=new point(y.x+y.width/2,y.y+y.height/2),this.selectCenterA[this.selectCenterA.length]=this.selectionCenter,this.selectBufferSize=Math.max(y.width/2,y.height/2),this.selectBufferSize/=map.Scale.nZoomScale;else if(this.szFlag.match(/circle/)){y=B.fu.getPosition();y.x=Number(B.getAttributeNS(null,"cx"));y.y=Number(B.getAttributeNS(null,"cy"));this.selectionCenter=new point(y.x,y.y);
this.selectCenterA[this.selectCenterA.length]=map.Scale.getMapPosition(y.x,y.y);map.Scale.getMapPosition(y.x,y.y);this.selectBufferSize=B.getAttributeNS(null,"r");if(this.selectBufferSize===0)return!1;y=map.antiZoomAndPanList.getActualMatrix();this.selectBufferSize*=y[0]}else if(this.szFlag.match(/square/)){y=B.fu.getPosition();y.x=Number(B.getAttributeNS(null,"x"));y.y=Number(B.getAttributeNS(null,"y"));A=Number(B.getAttributeNS(null,"width"));B=Number(B.getAttributeNS(null,"height"));this.selectionCenter=
new point(y.x+A/2,y.y+B/2);this.selectCenterA[this.selectCenterA.length]=map.Scale.getMapPosition(y.x+A/2,y.y+B/2);map.Scale.getMapPosition(y.x+A/2,y.y+B/2);this.selectBufferSizeX=A/2;this.selectBufferSizeY=B/2;if(this.selectBufferSizeX===0||this.selectBufferSizeY===0)return!1;y=map.antiZoomAndPanList.getActualMatrix();this.selectBufferSizeX*=y[0];this.selectBufferSizeY*=y[0]}this.selectScale=map.Scale.nZoomScale;this.markGroup||(this.markGroup=map.Dom.newGroup(map.Layer.objectGroup,this.szId+":markgroup"))}return!0};
Ea.prototype.realize=function(){this.fShowProgressBar=!0;this.initValues()?(this.nSkipCount=this.nDoneCount=0,this.mapSleep=new ixMap.Sleep("activeSelection.selectShapes",100,map.Dictionary.getLocalText("do selection")),this.mapSleep.fShowProgressBar=!0,this.mapSleep.nCount=this.nCount,this.mapSleep.szCancel="activeSelection.cancel()",this.selectShapes()):(this.remove(),displayMessage("Selection could not be done",3E3))};Ea.prototype.realizeContinue=function(y){this.selectShapes(y)};Ea.prototype.realizeDone=
function(){this.nRefreshTimeout&&setTimeout("map.Themes.refreshTheme('"+this.szId+"')",this.nRefreshTimeout)};Ea.prototype.redraw=function(){};Ea.prototype.removeValues=function(){};Ea.prototype.disable=function(){};Ea.prototype.cancel=function(){this.fCancel=!0};Ea.prototype.nextThemeNode=function(y){return this.szThemes=="generic"||this.szSelectShape=="queryresult"?this.themeRootNodesA[y]:y===0?(this.nRootIndex=0,this.actNode=this.themeRootNodesA[this.nRootIndex].firstChild):this.actNode?(this.actNode=
this.actNode.nextSibling)?this.actNode:++this.nRootIndex>=this.themeRootNodesA.length?null:this.actNode=this.themeRootNodesA[this.nRootIndex].firstChild:null};Ea.prototype.selectShapes=function(y){if(!y||y===0)if(y=0,this.testA=[],this.itemA=[],this.chartPosA=[],this.exactCountA=[],this.exactSizeA=[],this.activeTheme||(this.activeTheme=map.Themes.activeTheme),this.activeTheme&&this.szThemesA[0]+" == "+this.activeTheme.szThemesA[0]){this.nPartsA=K(this.activeTheme.nPartsA);this.partsA=K(this.activeTheme.partsA);
this.origColorScheme=K(this.activeTheme.origColorScheme);this.colorScheme=K(this.activeTheme.colorScheme);this.szFieldsA=K(this.activeTheme.szFieldsA);this.szLabelA=K(this.activeTheme.szLabelA);this.szLegendLabelA=K(this.activeTheme.szLegendLabelA);this.szXaxisA=K(this.activeTheme.szXaxisA);this.szSymbolsA=K(this.activeTheme.szSymbolsA);this.szRanges=this.activeTheme.szRanges;this.szSizeField=this.activeTheme.szSizeField;this.nMeanA=K(this.activeTheme.nMeanA);this.nMedianA=K(this.activeTheme.nMedianA);
this.nDeviationA=K(this.activeTheme.nDeviationA);this.nFilterA=K(this.activeTheme.nFilterA);this.nOrigSumA=K(this.activeTheme.nOrigSumA);this.szUnit=this.activeTheme.szUnit;this.formatValue=this.activeTheme.formatValue;this.nMin100=this.activeTheme.nMin100;this.nMax100=this.activeTheme.nMax100;this.nClipFrames=this.activeTheme.nClipFrames;this.nActualFrame=this.activeTheme.nActualFrame;this.sortIndexDown=this.activeTheme.sortIndexDown;this.sortIndexUp=this.activeTheme.sortIndexUp;this.shuffleArray=
this.activeTheme.shuffleArray;this.removeDefinition=this.activeTheme.removeDefinition;this.szValuesTextStyle=this.activeTheme.szValuesTextStyle;this.nOrigValuesSumA=[];this.nValuesSumA=[];this.nValuesMinA=[];this.nValuesMaxA=[];this.nExactCount=this.nCount=this.nSum=this.nSum100=0;this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;this.nMinSize=Number.MAX_VALUE;this.nMaxSize=-Number.MAX_VALUE;for(var B=this.nSumSize=0;B<this.activeTheme.szFieldsA.length;B++)this.nOrigValuesSumA[B]=0,this.nValuesSumA[B]=
0,this.nValuesMinA[B]=Number.MAX_VALUE,this.nValuesMaxA[B]=-Number.MAX_VALUE;for(var A=0;A<this.partsA.length;A++)this.partsA[A].nCount=0,this.partsA[A].nSum=0,this.exactSizeA[A]=0}if(this.nNodes){var J=null,L=null,da=this.selectBufferSize*this.selectScale,V=null;this.selectBufferSizeX&&(da=this.selectBufferSizeX*this.selectScale,V=this.selectBufferSizeY*this.selectScale);for(A=y;A<this.nNodes;A++){this.mapSleep.nDoneCount=this.nDoneCount;if(this.mapSleep.checkSleep(A,10))return;if(this.szThemes==
"generic"){y=this.nextThemeNode(A);this.nDoneCount++;var U=!1;if(this.szSelectShape=="queryresult")U=!0;else if(this.szFlag.match(/shape/)){U=map.SVGDocument.getElementById(this.szSelectShape);var P=map.Api.getShapePoints(U.firstChild);U=t(this.activeTheme.getNodePosition(y),P)}else for(P=0;P<this.selectCenterA.length;P++){var fa=this.activeTheme.getNodePosition(y),ra=this.selectCenterA[P];fa&&ra&&da?(B=ra.x-fa.x,fa=ra.y-fa.y,B=V?Math.abs(B)<=da&&Math.abs(fa)<=V:Math.sqrt(B*B+fa*fa)<=da):B=!1;if(B){U=
!0;break}}}else{J=this.nextThemeNode(A);this.nDoneCount++;if(!J||J.nodeType!=1)continue;if(J.getAttributeNS(null,"id").match(/:paint/))continue;y=map.Tiles.getMasterId(J.getAttributeNS(null,"id"));this.testA&&!this.testA[y]&&(this.testA[y]=J,this.nTested++);U=!1;if(this.szSelectShape=="queryresult")for(this.selectionCenter||(this.selectionCenter=new point(0,0)),P=0;P<this.queryResultA.length;P++){if(this.queryResultA[P].node.parentNode==J){U=!0;(P=J.getAttributeNS(szMapNs,"center"))&&P.length>2&&
(L=P.split(","),L=new point(Number(L[0].split(":")[1]),Number(L[1].split(":")[1])));L||(P=map.Dom.getBox(J),L=new point(P.x,P.y));P=map.Scale.mapCanvasCenter;map.Scale.getMapOffset(J);L.x+=P.x;L.y+=P.y;this.selectionCenter.x+=L.x/this.queryResultA.length;this.selectionCenter.y+=L.y/this.queryResultA.length;break}}else if(P=map.Dom.getBox(J),U=map.Scale.getMapOffset(J),P.x+=U.x,P.y+=U.y,P.x>this.selectCenterA[0].x+da||P.y>this.selectCenterA[0].y+V||P.x+P.width<this.selectCenterA[0].x-da||P.y+P.height<
this.selectCenterA[0].y-V)U=!1;else if(P.x<this.selectCenterA[0].x-da&&P.y<this.selectCenterA[0].y-V&&P.x+P.width>this.selectCenterA[0].x+da&&P.y+P.height>this.selectCenterA[0].y+V){P=J.getElementsByTagName("path");P=map.Api.getShapePoints(P.item(0));B=map.Scale.getMapOffset(J);for(let X in P)P[X].x+=B.x,P[X].y+=B.y;U=t(new point(this.selectCenterA[0].x,this.selectCenterA[0].y),P)}else{U=!1;P=J.getElementsByTagName("path");P=map.Api.getShapePoints(P.item(0));B=map.Scale.getMapOffset(J);for(let X in P)if(P[X].x+
B.x<=this.selectCenterA[0].x+da&&P[X].y+B.y<=this.selectCenterA[0].y+V&&P[X].x+B.x>=this.selectCenterA[0].x-da&&P[X].y+B.y>=this.selectCenterA[0].y-V){U=!0;break}}}if(U){if(this.szThemes=="generic")this.itemA[y]=this.activeTheme.itemA[y],this.nSelected++;else{this.szThemeType=="point"&&(this.markGroup?map.Dom.newShape("circle",this.markGroup,L.x,L.y,map.Scale.normalX(1)*map.Scale.nZoomScale,"fill:yellow;stroke:none;"):J&&J.style.setProperty("opacity","0.0"));U=J.getAttributeNS(szMapNs,"area");if(this.itemA&&
this.itemA[y])continue;this.itemA[y]=J;this.nSelected++;this.nSelectedArea+=Number(U)}if(this.activeTheme)for(U=[],this.activeTheme.itemA[y]?U.push(this.activeTheme.itemA[y]):this.activeTheme.posItemA[y]&&(U=this.activeTheme.posItemA[y]),y=0;y<U.length;y++)if(P=U[y],P.nValuesA.length!=1||!(isNaN(P.nValuesA[0])||P.nValuesA[0]===0&!this.activeTheme.szFlag.match(/ZEROISVALUE/))){this.nCount++;for(B=0;B<P.nValuesA.length;B++)isNaN(P.nValuesA[B])||(this.nOrigValuesSumA[B]+=P.nOrigValuesA[B],this.nValuesSumA[B]+=
P.nValuesA[B],this.nValuesMinA[B]=Math.min(this.nValuesMinA[B],P.nValuesA[B]),this.nValuesMaxA[B]=Math.max(this.nValuesMaxA[B],P.nValuesA[B]),this.nMin=Math.min(this.nMin,P.nValuesA[B]),this.nMax=Math.max(this.nMax,P.nValuesA[B]),this.nMinSize=Math.min(this.nMinSize,P.nSize||this.nMinSize),this.nMaxSize=Math.max(this.nMaxSize,P.nSize||this.nMaxSize),this.nSumSize+=P.nSize);P.nValue100&&(this.nSum100+=P.nValue100);if(this.activeTheme.szFlag.match(/AGGREGATE/)&&this.activeTheme.szFlag.match(/CATEGORICAL/))for(console.log(P.nValuesA),
B=0;B<this.partsA.length;B++)this.partsA[B].nCount+=P.nValuesA[B]?1:0,this.partsA[B].nSum+=P.nValuesA[B]||0,this.nSum+=P.nValuesA[B],this.nExactCount++,this.exactSizeA[B]+=P.nSize||1;else if(this.activeTheme.szFlag.match(/CATEGORICAL/))for(fa=0;fa<P.nValuesA.length;fa++)for(B=0;B<this.partsA.length;B++){if(P.nValuesA[fa]==this.partsA[B].min){this.partsA[B].nCount++;this.partsA[B].nSum+=P.nValuesA[fa];this.nSum+=P.nValuesA[fa];this.nExactCount++;this.exactSizeA[B]+=P.nSize||1;break}}else if(this.activeTheme.szFlag.match(/SEQUENCE/)||
this.activeTheme.szFlag.match(/CHART/))for(B=0;B<this.partsA.length;B++)this.partsA[B].nCount++,this.partsA[B].nSum+=P.nValuesA[B],this.nSum+=P.nValuesA[B];else if(this.activeTheme.szFlag.match(/CLIP/)&&this.activeTheme.nClipFrames)this.nSum=this.nClipFrames==P.nValuesA.length?this.nSum+Number(P.nValuesA[this.nActualFrame]):this.nSum+Number(P.nValuesA[0]*(this.nClipFrames-this.nActualFrame)/this.nClipFrames+P.nValuesA[P.nValuesA.length-1]*this.nActualFrame/this.nClipFrames);else for(fa=0;fa<P.nValuesA.length;fa++)for(B=
0;B<this.partsA.length;B++)if(P.nValuesA[fa]<this.partsA[B].max){this.partsA[B].nCount++;this.partsA[B].nSum+=P.nValuesA[fa];this.nSum+=P.nValuesA[fa];break}}}if(this.fCancel){this.fShowProgressBar=!1;this.showInfo(!1);clearMessage();return}}}this.nThemeItems===0&&(this.nThemeItems=this.nTested);if(this.szThemes!="generic"&&this.szThemeType!="point")for(var Ta in this.itemA)if((A=map.Tiles.getTileNodes(Ta))&&A.length)for(var W in A)this.highLightList.addItem(A[W]),this.highLightList.lock();else this.highLightList.addItem(this.itemA[Ta]),
this.highLightList.lock();this.isVisible=!0;this.realizeDone();this.fShowProgressBar=!1;clearMessage();if(map.HTMLWindow.ixmaps.htmlgui_onSelection(this.szId))return null;this.showInfo(!0)};Ea.prototype.showInfo=function(y){if(this.nCount===0)displayMessage("Selection: no values found !",1E3),this.remove();else if(this.nSelected===0)displayMessage("Selection is empty !",1E3),this.remove();else if(!this.widgetNode||this.fRedrawInfo){this.fRedrawInfo=!1;var B=this.szId+":display:widget",A=map.Dictionary.getLocalText("Selection");
typeof y=="undefined"||y||(A+=" ("+map.Dictionary.getLocalText("incomplete")+"!)");this.selectionCenter||(this.selectionCenter=map.Scale.mapCanvasCenter);this.widgetNode?(y=this.widgetNode,y.clear()):y=new InfoContainer(map.SVGDocument,map.SVGFixedGroup,B+":movable",this.selectionCenter,new point(-map.Scale.normalX(55),map.Scale.normalY(50)),"fixed|pointer",A);y.frameNode.style.setProperty("fill","#e8e8e8","");A=map.szTextGridStyle;map.szTextGridStyle="firstgray";this.widgetNode=y;y.fClipped=!1;var J=
y.workspaceNode;y.setOnRemove("map.Themes.removeTheme(evt,'"+this.szId+"')");var L=0;if(this.szSelectShape=="activeBuffer"){var da=map.Themes.activeBuffer.szTitle;var V=[map.Dictionary.getLocalText("layer"),map.Dictionary.getLocalText("selected by"),map.Dictionary.getLocalText("selected items"),this.szThemesA.length==1?String(map.Layer.listA[this.szThemesA[0]].szLegendName):"(multiple)",String(da),String(this.nSelected)+" / "+String(this.nThemeItems)+"  ("+String(__formatValue(100/this.nThemeItems*
this.nSelected,2))+"%)"],U=Array(3);U[0]="font-weight:bold;fill:#ffffff;";U[1]="font-weight:bold;fill:#ffffff;";U[2]="font-weight:bold;fill:#ffffff;";L+=50}else this.szSelectShape=="queryresult"?(da=this.szThemes,this.szThemesA.length>1?da="(multiple)":this.szThemes!="generic"&&(da=String(map.Layer.listA[this.szThemesA[0]].szLegendName)),V=[map.Dictionary.getLocalText("layer"),map.Dictionary.getLocalText("selected by"),map.Dictionary.getLocalText("selected items"),da,this.szSelectQuery,String(this.nSelected)+
" / "+String(this.nThemeItems)+"  ("+String(__formatValue(100/this.nThemeItems*this.nSelected,2))+"%)"],U=Array(3),U[0]="font-weight:bold;fill:#ffffff;",U[1]="font-weight:bold;fill:#ffffff;",U[2]="font-weight:bold;fill:#ffffff;",L+=50):(V=this.szThemes=="generic"?[map.Dictionary.getLocalText("layer"),map.Dictionary.getLocalText("selected items"),"(generic)",String(this.nSelected)+" / "+String(this.nThemeItems)+"  ("+String(__formatValue(100/this.nThemeItems*this.nSelected,2))+"%)"]:[map.Dictionary.getLocalText("layer"),
map.Dictionary.getLocalText("selected items"),this.szThemesA.length==1?String(map.Layer.listA[this.szThemesA[0]].szLegendName):"(multiple)",String(this.nSelected)+" / "+String(this.nThemeItems)+"  ("+String(__formatValue(100/this.nThemeItems*this.nSelected,2))+"%)"],U=Array(2),U[0]="font-weight:bold;fill:#ffffff;",U[1]="font-weight:bold;fill:#ffffff;",L+=40);var P=map.Dom.newGroup(J,"");P.fu.setPosition(map.Scale.normalY(3),map.Scale.normalY(3));createTextGrid(map.SVGDocument,P,B+":textgrid",V,2,
11,U,"fill:#bbbbbb;");da=[];if(this.activeTheme){L+=14;map.Dom.newText(J,map.Scale.normalX(3),map.Scale.normalY(L),"font-family:arial;font-weight:bold;font-size:"+map.Scale.normalY(11)+"px;fill:#555555;pointer-events:none",map.Dictionary.getLocalText("Theme")+": "+this.activeTheme.szTitle);L+=8;P=map.Dom.newGroup(J,"");P.fu.setPosition(map.Scale.normalY(3),map.Scale.normalY(L));this.drawDonutText=this.activeTheme.drawDonutText;this.drawTextforOneQuadrant=this.activeTheme.drawTextforOneQuadrant;this.createTextLabel=
this.activeTheme.createTextLabel;if(this.nValuesSumA.length==1){this.addItemValues=this.activeTheme.addItemValues;this.szFieldsA=this.activeTheme.szFieldsA;this.fField100=this.activeTheme.fField100;var fa=this.szFlag;this.szFlag=this.activeTheme.szFlag;this.itemA=[];V=[];for(U=0;U<this.nOrigValuesSumA.length;U++)V[U]=this.nOrigValuesSumA[U];this.addItemValues("selection",V,this.nSum100);this.szFlag=fa;if(this.activeTheme.szFlag.match(/CATEGORICAL/))V=[map.Dictionary.getLocalText("selected items"),
String(__formatValue(Number(this.nCount,2)))],U=Array(2),U[0]="font-weight:bold;fill:#7996D7;",U[1]="font-weight:bold;fill:#000000;font-size:240px;",createTextGrid(map.SVGDocument,P,B+":textgrid",V,2,11,U),L+=P.fu.getBox().height/map.Scale.normalX(1)+5;else if(this.activeTheme.szAggregation&&this.activeTheme.szAggregation.match(/sum/)||this.activeTheme.szFlag.match(/SUM/)){if(V=[map.Dictionary.getLocalText("value of selection"),map.Dictionary.getLocalText("% of total value")," ",map.Dictionary.getLocalText("min"),
map.Dictionary.getLocalText("max"),map.Dictionary.getLocalText("average"),String(__formatValue(Number(this.itemA.selection.nValuesA[0]),2))+" "+this.szUnit,String(__formatValue(Number(this.nValuesSumA[0])/Number(this.activeTheme.nOrigSumA[0])*100,2))+" %"," ",String(__formatValue(Number(this.nValuesMinA[0]),2))+" "+this.szUnit,String(__formatValue(Number(this.nValuesMaxA[0]),2))+" "+this.szUnit,String(__formatValue(Number(this.nValuesSumA[0])/this.nCount,2))+" "+this.szUnit],U=Array(12),U[0]="font-weight:bold;fill:#7996D7;",
U[6]="font-weight:bold;fill:#000000;font-size:240px;",createTextGrid(map.SVGDocument,P,B+":textgrid",V,2,11,U),L+=P.fu.getBox().height/map.Scale.normalX(1)+5,B=map.Dom.newGroup(J,""),da.push(B),P=DonutCharts.newChart(map.SVGDocument,B,map.Scale.normalX(55),map.Scale.normalY(55),0,0),P.setRadInner(0),P.setRadOuter(map.Scale.normalX(55)),P.setCenter(map.Scale.normalX(80),map.Scale.normalY(100)),V=Number(this.nValuesSumA[0])/Number(this.activeTheme.nOrigSumA[0])*100,P.addPart(V,map.Scale.normalY(20),
"#ddddee",0,this.formatValue(V,2)+"%","selection: "+this.formatValue(V,2)+"% of total value"),P.addPart(100-V,map.Scale.normalY(20),"#f8f8ff",0,this.formatValue(100-V,2)+"%",this.formatValue(100-V,2)+"%"),P.realize(),map.Dom.newText(B,map.Scale.normalX(80),map.Scale.normalX(82),"font-size:"+map.Scale.normalX(10)/.66+"px;text-anchor:middle;baseline-shift:-60%;fill:darkgrey;stroke:none;pointer-events:none",this.formatValue(V,0)+" % of total"),this.activeTheme.szFlag.match(/BUBBLE/)||this.activeTheme.szFlag.match(/SQUARE/)||
this.activeTheme.szFlag.match(/SYMBOL/))this.getOverviewChart=this.activeTheme.getOverviewChart,this.szOverviewChart=this.activeTheme.szOverviewChart,this.drawChart=this.activeTheme.drawChart,this.getOverviewChart&&(P=map.Dom.newGroup(J,""),B=map.Dom.newGroup(P,""),da.push(P),P=this.szFlag,this.szFlag=this.activeTheme.szFlag,this.nOrigSumA=this.nOrigValuesSumA,this.nMaxA=this.nValuesMaxA,this.nMinA=this.nValuesMinA,this.szAggregation=this.activeTheme.szAggregation,this.getOverviewChart(B),this.szFlag=
P,B.fu.scale(1.3,1.3),B.fu.setPosition(map.Scale.normalX(-35),map.Scale.normalY(35)))}else this.fField100?(V=[map.Dictionary.getLocalText("value of selection")," ",map.Dictionary.getLocalText("min value"),map.Dictionary.getLocalText("max value"),map.Dictionary.getLocalText("mean value"),String(__formatValue(Number(this.itemA.selection.nValuesA[0]),2))+this.szUnit," ",String(__formatValue(Number(this.nValuesMinA[0]),2))+this.szUnit,String(__formatValue(Number(this.nValuesMaxA[0]),2))+this.szUnit,String(__formatValue(Number(this.nValuesSumA[0])/
this.nCount,2))+this.szUnit],U=Array(10),U[0]="font-weight:bold;fill:#7996D7;",U[5]="font-weight:bold;fill:#000000;font-size:240px;"):this.activeTheme.szFlag.match(/DENSITY/)?(V=[map.Dictionary.getLocalText("value of selection")," ",map.Dictionary.getLocalText("min value"),map.Dictionary.getLocalText("max value"),map.Dictionary.getLocalText("mean value"),String(__formatValue(Number(this.itemA.selection.nValuesA[0]),2))+this.szUnit," ",String(__formatValue(Number(this.nValuesMinA[0]),2))+this.szUnit,
String(__formatValue(Number(this.nValuesMaxA[0]),2))+this.szUnit,String(__formatValue(Number(this.nValuesSumA[0])/this.nCount,2))+this.szUnit],U=Array(10),U[0]="font-weight:bold;fill:#7996D7;",U[5]="font-weight:bold;fill:#000000;font-size:240px;"):(V=[map.Dictionary.getLocalText("mean value"),map.Dictionary.getLocalText(" "),map.Dictionary.getLocalText("min value"),map.Dictionary.getLocalText("max value"),String(__formatValue(Number(this.nValuesSumA[0])/this.nCount,2))+this.szUnit,map.Dictionary.getLocalText(" "),
String(__formatValue(Number(this.nValuesMinA[0]),2))+this.szUnit,String(__formatValue(Number(this.nValuesMaxA[0]),2))+this.szUnit],U=Array(8),U[0]="font-weight:bold;fill:#7996D7;",U[4]="font-weight:bold;fill:#000000;font-size:240px;"),createTextGrid(map.SVGDocument,P,B+":textgrid",V,2,11,U),L+=P.fu.getBox().height/map.Scale.normalX(1)+5;this.getOverviewChart=this.activeTheme.getOverviewChart;this.szOverviewChart=this.activeTheme.szOverviewChart;if(this.activeTheme.colorScheme.length>2||this.activeTheme.szFlag.match(/CATEGORICAL/)||
!this.activeTheme.szFlag.match(/CHART/)&&!this.activeTheme.szFlag.match(/DOMINANT/))this.szOverviewChart=this.nOrigSumA.length>5?"BAR":"PIE";this.szOverviewChart&&(B=map.Dom.newGroup(J,""),da.push(B),this.getOverviewChart(B),this.szOverviewChart.match(/PIE/)&&this.activeTheme.szAggregation.match(/sum/)&&(this.szOverviewChart+="|PERCENTOFVALUE",B=map.Dom.newGroup(J,""),da.push(B),this.getOverviewChart(B)));!this.activeTheme.szFlag.match(/CHART/)||this.activeTheme.szAggregation&&this.activeTheme.szAggregation.match(/sum/)||
(this.getOverviewChart=this.activeTheme.getOverviewChart,this.szOverviewChart=null,this.drawChart=this.activeTheme.drawChart,this.getOverviewChart&&(P=map.Dom.newGroup(J,""),B=map.Dom.newGroup(P,""),da.push(P),P=this.szFlag,this.szFlag=this.activeTheme.szFlag,this.nOrigSumA=this.nOrigValuesSumA,this.nMaxA=this.nValuesMaxA,this.nMinA=this.nValuesMinA,this.nOverrideMax=this.activeTheme.nMax,this.szAggregation=this.activeTheme.szAggregation,this.getOverviewChart(B),this.szFlag=P,this.activeTheme.szFlag.match(/BAR/)?
(B.fu.scale(2.5,2.5),B.fu.setPosition(map.Scale.normalX(55),map.Scale.normalY(65))):(B.fu.scale(1.3,1.3),B.fu.setPosition(map.Scale.normalX(-35),map.Scale.normalY(35))),P=this.szFlag,this.szFlag=this.activeTheme.szFlag,this.szOverviewChart+="|PERCENTOFVALUE",B=map.Dom.newGroup(J,""),da.push(B),this.getOverviewChart(B),this.szFlag=P))}else{if(this.activeTheme.szAggregation.match(/sum/)||this.activeTheme.szFlag.match(/SUM/))fa=this.nSum100?this.nSum100:this.activeTheme.szFlag.match(/CATEGORICAL/)?this.nExactCount:
this.nSum,V=this.activeTheme.nSum100?this.activeTheme.nSum100:this.activeTheme.szFlag.match(/CATEGORICAL/)?this.activeTheme.nExactCount:this.activeTheme.nSum,V=[map.Dictionary.getLocalText("total of selection"),String(__formatValue(fa,2))+" ("+String(__formatValue(Number(fa)/Number(V)*100,2))+" %)"],U=Array(2),U[0]="font-weight:bold;fill:#7996D7;",U[1]="font-weight:bold;fill:#000000;font-size:240px;",createTextGrid(map.SVGDocument,P,B+":textgrid",V,2,11,U),L+=P.fu.getBox().height/map.Scale.normalX(1)+
5;this.nSum100&&(fa=this.nSum100,this.activeTheme.szFlag.match(/DOMINANT/)||this.activeTheme.szAggregation.match(/sum/)||(fa/=this.nSelected),V=this.activeTheme.nSum100,V=[map.Dictionary.getLocalText("total of selection"),String(__formatValue(fa,2))+" ("+String(__formatValue(Number(fa)/Number(V)*100,2))+" %)"],U=Array(2),U[0]="font-weight:bold;fill:#7996D7;",U[1]="font-weight:bold;fill:#000000;font-size:240px;",createTextGrid(map.SVGDocument,P,B+":textgrid",V,2,11,U),L+=P.fu.getBox().height/map.Scale.normalX(1)+
5);this.drawChart=this.activeTheme.drawChart;this.getOverviewChart=this.activeTheme.getOverviewChart;this.szOverviewChart=this.activeTheme.szOverviewChart;if(this.activeTheme.szFlag.match(/CATEGORICAL/)||!this.activeTheme.szFlag.match(/CHART/)&&!this.activeTheme.szFlag.match(/DOMINANT/))this.szOverviewChart="PIE";this.nOrigSumA=this.nOrigValuesSumA;this.nMaxA=this.nValuesMaxA;this.nMinA=this.nValuesMinA;fa=this.szFlag;this.szFlag=this.activeTheme.szFlag;this.szAggregation=this.activeTheme.szAggregation;
this.szOverviewChart?(B=map.Dom.newGroup(J,""),da.push(B),this.getOverviewChart(B),this.szOverviewChart.match(/PIE/)&&this.activeTheme.szAggregation.match(/sum/)&&(this.szOverviewChart+="|PERCENTOFVALUE",B=map.Dom.newGroup(J,""),da.push(B),this.getOverviewChart(B))):(B=map.Dom.newGroup(J,""),this.nMin=this.activeTheme.nMin,this.nMax=this.activeTheme.nMax,P=1.8,this.szFlag.match(/DOMINANT/)&&(P=1.8),this.drawColorSchemeLegend=this.activeTheme.drawColorSchemeLegend,this.nOrigSumA=this.activeTheme.nOrigSumA,
this.nSum=this.activeTheme.nSum,this.szField100=this.activeTheme.szField100,this.drawColorSchemeLegend(B,"test").fu.scale(.9/P,.9/P),J=map.Dom.getBox(B),J.width>0&&J.height>0&&(B.fu.scale(P,P),B.fu.setPosition(map.Scale.normalX(10)-J.x*P,map.Scale.normalY(L)+map.Scale.normalY(5)-J.y*P),map.Dom.newText(B,J.x,J.y+J.height+map.Scale.normalX(6),"font-family:Arial;font-style:italic;font-size:"+map.Scale.normalY(6)+"px;fill:#888888;pointer-events:none",this.activeTheme.fField100||this.activeTheme.szAggregation.match(/sum/)?
map.Dictionary.getLocalText("* summary over selected area"):map.Dictionary.getLocalText("* arithmetic mean over selected area"))))}this.szFlag=fa}__formatValue(100/this.nThemeItems*this.nSelected,2);U=map.Scale.normalX(L);var ra=L=0;for(B=fa=J=0;B<da.length;B++)P=da[B],P.fu.scale(.8,.8),V=P.fu.getBox(),ra=Math.min(ra,V.y),J=Math.max(J,V.width);U=U-ra+40;for(B=0;B<da.length;B++)P=da[B],V=P.fu.getBox(),B===0?L=map.Scale.normalX(2)-0:B%2===0&&(U+=map.Scale.normalX(20)+fa,L=map.Scale.normalX(2)-V.x,fa=
0),fa=Math.max(fa,V.height),P.fu.setPosition(L,U),L+=J-map.Scale.normalX(10);y.reformat();map.szTextGridStyle=A}};Ea.prototype.markClass=function(y){};Ea.prototype.unmarkClass=function(y){};Ea.prototype.remove=function(y){this.parent.removeTheme(y,this.szId)};Ea.prototype.removeElements=function(y){this.markGroup&&(this.markGroup.style.setProperty("display","none",""),setTimeout("map.Dom.removeElementById('"+this.markGroup.getAttributeNS(null,"id")+"')",1E4));try{this.mapTool.remove()}catch(B){}this.highLightList.unlock();
this.highLightList.removeAll()};Ea.prototype.getItemNodes=function(y){return[]};Ea.prototype.getNodeArea=function(y){return this.nSelectedArea?this.nSelectedArea/1E6:1};ixMap.Selections.prototype.selectItemByPosition=function(y,B){y=map.Themes.getTheme(y);B=map.Scale.getMapPositionOfLatLon(B.lat,B.lng);for(var A in y.itemA){y=map.SVGDocument.getElementById(A).childNodes;for(var J=0;J<y.length;J++){var L=map.Api.getShapePoints(y.item(J));if(t(B,L))return A}}return null};ixMap.Selections.prototype.selectItemByBoundingBox=
function(y,B){var A=map.Themes.getTheme(y);y=map.Scale.getMapPositionOfLatLon(B[0].lat,B[0].lng);B=map.Scale.getMapPositionOfLatLon(B[1].lat,B[1].lng);let J=[];for(var L in A.itemA){A=map.SVGDocument.getElementById(L).childNodes;for(var da=0;da<A.length;da++){var V=map.Api.getShapePoints(A.item(da)),U;for(U in V){V[U].x>y.x&&V[U].x<B.x&&V[U].y<y.y&&V[U].y>B.y&&J.push(L);break}}}return J}})();(function(){function Ea(W,X,Z,ia,ma,va){this.targetDocument=window.document;this.targetGroup=X;this.mX=isNaN(Z)?0:Z;this.mY=isNaN(ia)?0:ia;this.nRadOuter=isNaN(ma)?0:ma;this.nRadInner=isNaN(va)?0:va;this.szStyle="flat";this.szLine=null;this.nLineWidth=1;this.partsA=[]}function t(W,X,Z,ia){W=X.createElementNS("http://www.w3.org/2000/svg",W);Z.appendChild(W);for(var ma in ia)W.setAttribute(ma,ia[ma]);return W}function K(W,X,Z,ia,ma,va,d,c,e,b,n,m,u,z,x,w,O){w==null&&(w=0);var a=c<e?(c+e)/2:Math.max(360,
(c+e+360)/2);var f=Math.sin(a/180*Math.PI);a=-Math.cos(a/180*Math.PI);Z+=w*f;ia+=w*a;x==null&&(x="3D");b==null&&(b="#ffff00");n==null&&(n=ColorScheme.getDerivateColor(b,.7));m==null&&(m=ColorScheme.getDerivateColor(b,.7));u==null&&(u=ColorScheme.getBorderColor(b));X=x.match(/SILENT/)?t("g",W,X,{}):t("g",W,X,{onmouseover:"DonutCharts.partOver(evt)",onmouseout:"DonutCharts.partOut(evt)",onmousedown:"DonutCharts.partDown(evt)",onmouseup:"DonutCharts.partUp(evt)"});if(c<0||e<0||c==e)return X;t("rect",
W,X,{id:"extractPoint",x:f*ma/3,y:a*ma/3,width:0,height:0,style:"fill:none;stroke:none"});x.match(/3D/)&&(c>e?(y(W,X,Z,ia,ma,va,d,c,360,n,"none",0),y(W,X,Z,ia,ma,va,d,0,e,n,"none",0)):y(W,X,Z,ia,ma,va,d,c,e,n,u,z));x.match(/3D/)&&c>180&&(w=""+ra(Z,ia-d,ma,c),w+=Ta(Z,ia-d,va,c),w+=Ta(Z,ia,va,c),w+=Ta(Z,ia,ma,c),w+=Ta(Z,ia-d,ma,c),t("path",W,X,{d:w,style:"stroke:"+u+";fill:"+m+";stroke-width:"+z+";"}));x.match(/3D/)&&e<180&&(w=""+ra(Z,ia-d,ma,e),w+=Ta(Z,ia-d,va,e),w+=Ta(Z,ia,va,e),w+=Ta(Z,ia,ma,e),
w+=Ta(Z,ia-d,ma,e),t("path",W,X,{d:w,style:"stroke:"+u+";fill:"+m+";stroke-width:"+z+";"}));x.match(/3D/)&&(c>e?(B(W,X,Z,ia,ma,va,d,c,360,n,"none",0),B(W,X,Z,ia,ma,va,d,0,e,n,"none",0)):B(W,X,Z,ia,ma,va,d,c,e,n,u,z));e-c>=360?(w=""+ra(Z,ia-d,ma,c),w+=P(Z,ia-d,ma,c,e,O),w+=ra(Z,ia-d,va,e),va&&(w+=fa(Z,ia-d,va,e,c))):(w=""+ra(Z,ia-d,ma,c),w+=P(Z,ia-d,ma,c,e,O),w+=Ta(Z,ia-d,va,e),va&&(w+=fa(Z,ia-d,va,e,c)),w+=Ta(Z,ia-d,ma,c));t("path",W,X,{d:w,style:"stroke:"+u+";fill:"+b+";stroke-width:"+z+";"});return X}
function y(W,X,Z,ia,ma,va,d,c,e,b,n,m){c>90&&c<270&&e<270||(ma=""+ra(Z,ia-d,va,c),ma+=P(Z,ia-d,va,c,e),ma+=Ta(Z,ia,va,e),ma+=fa(Z,ia,va,e,c),ma+=Ta(Z,ia-d,va,c),t("path",W,X,{d:ma,style:"stroke:"+n+";fill:"+b+";stroke-width:"+m+";"}))}function B(W,X,Z,ia,ma,va,d,c,e,b,n,m){va=Math.max(c,90);e=Math.min(e,270);va>e||(c=""+ra(Z,ia-d,ma,va),c+=P(Z,ia-d,ma,va,e),c+=Ta(Z,ia,ma,e),c+=fa(Z,ia,ma,e,va),c+=Ta(Z,ia-d,ma,va),t("path",W,X,{d:c,style:"stroke:"+n+";fill:"+b+";stroke-width:"+m+";"}))}function A(W){var X=
Number(W.currentTarget.firstChild.getAttributeNS(null,"x")),Z=Number(W.currentTarget.firstChild.getAttributeNS(null,"y"));W.currentTarget.setAttribute("transform","translate("+X/25+","+Z/25+")");try{eval(W.currentTarget.getAttribute("onover"))}catch(ia){}}function J(W){W.currentTarget.setAttribute("transform","translate(0,0)");try{eval(W.currentTarget.getAttribute("onout"))}catch(X){}}function L(W){var X=Number(W.currentTarget.firstChild.getAttributeNS(null,"x")),Z=Number(W.currentTarget.firstChild.getAttributeNS(null,
"y"));Z+=map.Scale.normalY(.1);W.currentTarget.setAttribute("transform","translate("+X/5+","+Z/5+")")}function da(W){var X=Number(W.currentTarget.firstChild.getAttributeNS(null,"x")),Z=Number(W.currentTarget.firstChild.getAttributeNS(null,"y"));W.currentTarget.setAttribute("transform","translate("+X/5+","+Z/5+")")}function V(W){if(W.firstChild){var X=Number(W.firstChild.getAttributeNS(null,"x")),Z=Number(W.firstChild.getAttributeNS(null,"y"));if(X&&Z)return W.setAttribute("transform","translate("+
X+","+Z+")"),!0}return!1}function U(W){if(W.firstChild){var X=Number(W.firstChild.getAttributeNS(null,"x")),Z=Number(W.firstChild.getAttributeNS(null,"y"));if(X&&Z)return W.setAttribute("transform","translate(0,0)"),!0}return!1}function P(W,X,Z,ia,ma,va){var d,c=" ";ia%=360;if(ia>ma)return c+=P(W,X,Z,ia,360,va),c+=P(W,X,Z,0,ma,va);for(d=1;d<=8;d++)if(!(ia>d*45||ma<(d-1)*45)){var e=Math.max(ia,(d-1)*45);var b=Math.min(ma,d*45);if(e!=b){e>180&&(e=360-e);e>90&&(e=180-e);e>45&&(e=90-e);b>180&&(b=360-
b);b>90&&(b=180-b);b>45&&(b=90-b);var n=Math.PI*e/180;var m=Math.PI*b/180;var u=Z*Math.sin(n);var z=Z*Math.cos(n);b=Z*Math.sin(m);e=Z*Math.cos(m);u=z+Math.tan(n)*u;z=e+Math.tan(m)*b;m=(z-u)/(Math.tan(m)-Math.tan(n));n=-Math.tan(n)*m+u;m*=va||1;n*=va||1;switch(d){case 1:var x=b;var w=m;var O=-e;var a=-n;break;case 2:x=e;w=n;O=-b;a=-m;break;case 3:x=e;w=n;O=b;a=m;break;case 4:x=b;w=m;O=e;a=n;break;case 5:x=-b;w=-m;O=e;a=n;break;case 6:x=-e;w=-n;O=b;a=m;break;case 7:x=-e;w=-n;O=-b;a=-m;break;case 8:x=
-b,w=-m,O=-e,a=-n}c+="Q"+String(W+w)+","+String(X+a)+" "+String(W+x)+","+String(X+O)}}return c}function fa(W,X,Z,ia,ma){var va="";ia=(""+P(W,X,Z,ma,ia)).split("Q");for(var d=ia.length-1;d>0;d--)for(var c=ia[d].split(" "),e=1;e>=0;e--)if(d!=ia.length-1||e!=1)va=e===0?va+(" Q"+c[e]):va+(" "+c[e]);ma=Math.PI*ma/180;return va+=" "+String(W+Z*Math.sin(ma))+","+String(X+-(Z*Math.cos(ma)))}function ra(W,X,Z,ia){ia=Math.PI*ia/180;return"M"+String(W+Z*Math.sin(ia))+","+String(X+-(Z*Math.cos(ia)))}function Ta(W,
X,Z,ia){ia=Math.PI*ia/180;return"L"+String(W+Z*Math.sin(ia))+","+String(X+-(Z*Math.cos(ia)))}Ea.prototype.setCenter=function(W,X){this.mX=W;this.mY=X};Ea.prototype.setRadOuter=function(W){this.nRadOuter=isNaN(W)?0:W};Ea.prototype.setRadInner=function(W){this.nRadInner=isNaN(W)?0:W};Ea.prototype.setStyle=function(W){this.szStyle=W};Ea.prototype.addStyle=function(W){this.szStyle+="|"+W};Ea.prototype.setLine=function(W){this.szLine=W};Ea.prototype.setLineWidth=function(W){this.nLineWidth=W};Ea.prototype.setMaxValue=
function(W){this.nMaxValue=W};Ea.prototype.setNormalSizeValue=function(W){this.nNormalSizeValue=W};Ea.prototype.addPart=function(W,X,Z,ia,ma,va,d,c){this.partsA[this.partsA.length]={nPercent:W,nInfoValue:W,nHeight:X,color:Z,nOffset:ia,szText:ma,szInfo:va,szOver:d,szOut:c};return this.partsA[this.partsA.length-1]};Ea.prototype.realize=function(){var W,X=360,Z=this.partsA[0],ia=0,ma=this.partsA.length-1;this.donutPartsA=[];for(var va=!1,d=0;d<this.partsA.length;d++)this.partsA[d].nPercent>0&&(this.szStyle.match(/BIGTOTOP/)&&
this.partsA[d].nPercent>ia&&(Z=this.partsA[d],ia=this.partsA[d].nPercent),va=!0);if(va||this.szStyle.match(/AUTOCOMPLETE/)){var c=W=0,e=0,b=va=ia=0;if(this.szStyle.match(/VOLUME/)){for(d=0;d<this.partsA.length;d++)c+=this.partsA[d].nPercent,W+=Math.sqrt(this.partsA[d].nPercent);W=Math.sqrt(this.nMaxValue*this.partsA.length);for(d=0;d<this.partsA.length;d++)this.partsA[d].nPercent=100/W*Math.sqrt(this.partsA[d].nPercent),this.szStyle.match(/VOLUME/)&&(this.partsA[d].nHeight*=this.partsA[d].nPercent/
25);e=100/W*Math.sqrt(this.nMaxValue||100);ia=100/W*Math.sqrt(this.nMaxValue/4||50);va=100/W*Math.sqrt(this.nMaxValue/2||50);b=100/W*Math.sqrt(this.nMaxValue/4*3||50)}if(this.szStyle.match(/STARBURST/)){for(d=0;d<this.partsA.length;d++)c+=this.partsA[d].nPercent,W+=Math.sqrt(this.partsA[d].nPercent);e=this.nMaxValue||100;ia=this.nMaxValue/4||50;va=this.nMaxValue/2||50;b=this.nMaxValue/4*3||50}else{for(d=0;d<this.partsA.length;d++)c+=this.partsA[d].nPercent;if(c!=100)if(this.szStyle.match(/AUTOCOMPLETE/)&&
c<100)this.addPart(Math.floor((100-c)*1E5)/1E5,this.partsA[0]?this.partsA[0].nHeight:0,this.szNoDataColor||"#eeeeee",0,"");else for(d=0;d<this.partsA.length;d++)this.partsA[d].nPercent=this.partsA[d].nPercent/c*100}if(this.szStyle.match(/SYMMETRIC/))if(this.szStyle.match(/STARBURST/))X=360-Math.floor(360/this.partsA.length/2);else if(this.szStyle.match(/BIGTOTOP/)){X=360;for(d=0;d<this.partsA.length&&this.partsA[d]!=Z;d++)X-=this.partsA[d].nPercent<100?Math.floor(3.6*this.partsA[d].nPercent):0;X-=
this.partsA[d].nPercent<100?Math.floor(1.8*Z.nPercent):0}else this.partsA[0].nPercent<100&&(X=360-Math.floor(1.8*this.partsA[0].nPercent));this.szStyle.match(/HALF/)&&(X=270);this.szStyle.match(/HALFPLUS10/)&&(X=260);this.szStyle.match(/HALFMINUS10/)&&(X=280);this.szStyle.match(/HALFPLUS20/)&&(X=250);this.szStyle.match(/HALFMINUS20/)&&(X=290);c=this.szStyle.match(/HALF/)?180:360;c=this.szStyle.match(/HALFPLUS10/)?200:c;c=this.szStyle.match(/HALFMINUS10/)?160:c;c=this.szStyle.match(/HALFPLUS20/)?220:
c;c=this.szStyle.match(/HALFMINUS20/)?140:c;var n=0,m=0;this.szStyle.match(/STARBURST/)&&(n=c/this.partsA.length,this.nRadOuter+=this.nRadInner,this.szStyle.match(/XLRAYS/)?(n=Math.min(c/4,c/this.partsA.length),m=n*.1*(this.szStyle.match(/HALF/)?.5:1),this.nRadInner=Math.max(5,this.nRadInner)):this.szStyle.match(/LRAYS/)?(n=Math.min(c/4,c/this.partsA.length),m=n*.2*(this.szStyle.match(/HALF/)?.5:1),this.nRadInner=Math.max(5,this.nRadInner)):this.szStyle.match(/XSRAYS/)?(n=Math.min(c/12,c/this.partsA.length),
m=n*.4*(this.szStyle.match(/HALF/)?.5:1),this.nRadInner=Math.max(5,this.nRadInner)):this.szStyle.match(/SRAYS/)?(n=Math.min(c/10,c/this.partsA.length),m=n*.33*(this.szStyle.match(/HALF/)?.5:1),this.nRadInner=Math.max(5,this.nRadInner)):this.szStyle.match(/RAYS/)&&(n=c/this.partsA.length,m=n*.35*(this.szStyle.match(/HALF/)?.5:1),this.nRadInner=Math.max(5,this.nRadInner)));for(d=this.nRadOuterMaxR=this.nRadOuterMaxL=0;d<this.partsA.length;d++)this.szStyle.match(/STARBURST/)||(n=this.partsA[d].nPercent/
100*c,m=0),W=X%360,X=W+n,X>360&&(X%=360),this.szStyle.match(/DIRECTION/)?this.donutPartsA[d]=this.partsA[d].nAngle?{nStartAngle:this.partsA[d].nAngle-1,nEndAngle:this.partsA[d].nAngle+1,color:this.partsA[d].color,nHeight:this.partsA[d].nHeight,nOffset:this.partsA[d].nOffset}:{}:this.szStyle.match(/DIRECTED/)?this.donutPartsA[d]=this.partsA[d].nAngle?{nStartAngle:this.partsA[d].nAngle-10,nEndAngle:this.partsA[d].nAngle+10,color:this.partsA[d].color,nHeight:this.partsA[d].nHeight,nOffset:this.partsA[d].nOffset}:
{}:this.donutPartsA[d]={nStartAngle:W+m,nEndAngle:X-m,color:this.partsA[d].color,nHeight:this.partsA[d].nHeight,nOffset:this.partsA[d].nOffset},this.szStyle.match(/3D/)||(this.donutPartsA[d].nHeight=0),this.szStyle.match(/STARBURST/)&&(Z=this.nMaxValue/(this.nNormalSizeValue||this.nMaxValue)*2.14,this.donutPartsA[d].nRadOuter=Math.max(1,this.nRadInner+Math.sqrt(this.partsA[d].nPercent)/Math.sqrt(this.nMaxValue)*(this.nRadOuter-this.nRadInner)*Z)),W<=180&&X>=180&&(ma=d),W<=180?this.nRadOuterMaxR=Math.max(this.nRadOuterMaxR,
this.donutPartsA[d].nRadOuter):this.nRadOuterMaxL=Math.max(this.nRadOuterMaxL,this.donutPartsA[d].nRadOuter),this.partsA[d].nOpacity&&(this.donutPartsA[d].nOpacity=this.partsA[d].nOpacity);this.szStyle.match(/STARBURST/)&&this.szStyle.match(/POLAR/)&&(Z=this.nMaxValue/(this.nNormalSizeValue||this.nMaxValue)*2.14,X=Math.max(1,this.nRadInner+Math.sqrt(e)/Math.sqrt(this.nMaxValue)*(this.nRadOuter-this.nRadInner)*Z),X=map.Dom.newShape("circle",this.targetGroup,this.mX,this.mY,X,"fill:white;fill-opacity:0.25;stroke:#444444;stroke-width:1px;"),
X.setAttributeNS(szMapNs,"tooltip","range "+String((this.nMaxValue||100)*.75)+"-"+String((this.nMaxValue||100)*1)),X=Math.max(1,this.nRadInner+Math.sqrt(b)/Math.sqrt(this.nMaxValue)*(this.nRadOuter-this.nRadInner)*Z),X=map.Dom.newShape("circle",this.targetGroup,this.mX,this.mY,X,"fill:none;stroke:#444444;stroke-width:3px;stroke-dasharray:50 50"),X.setAttributeNS(szMapNs,"tooltip","range "+String((this.nMaxValue||100)*.5)+"-"+String((this.nMaxValue||100)*.75)),X=Math.max(1,this.nRadInner+Math.sqrt(va)/
Math.sqrt(this.nMaxValue)*(this.nRadOuter-this.nRadInner)*Z),X=map.Dom.newShape("circle",this.targetGroup,this.mX,this.mY,X,"fill:none;stroke:#444444;stroke-width:1px;"),X.setAttributeNS(szMapNs,"tooltip","range "+String((this.nMaxValue||100)*.25)+"-"+String((this.nMaxValue||100)*.5)),X=Math.max(1,this.nRadInner+Math.sqrt(ia)/Math.sqrt(this.nMaxValue)*(this.nRadOuter-this.nRadInner)*Z),X=map.Dom.newShape("circle",this.targetGroup,this.mX,this.mY,X,"fill:none;stroke:#444444;stroke-width:3px;stroke-dasharray:50 50"),
X.setAttributeNS(szMapNs,"tooltip","range "+String((this.nMaxValue||100)*0)+"-"+String((this.nMaxValue||100)*.25)));if(this.szStyle.match(/HALF/))for(ma=this.donutPartsA.length,d=0;d<ma;d++)this.donutPartsA[d].nEndAngle>270&&(this.donutPartsA.push(this.donutPartsA.splice(d,1)[0]),this.partsA.push(this.partsA.splice(d,1)[0]),ma--,d=-1);this.frameGroup=t("g",this.targetDocument,this.targetGroup,{});for(d=0;d<ma;d++)X=K(this.targetDocument,this.frameGroup,this.mX,this.mY,this.donutPartsA[d].nRadOuter?
this.donutPartsA[d].nRadOuter:this.nRadOuter,this.nRadInner,this.donutPartsA[d].nHeight,this.donutPartsA[d].nStartAngle,this.donutPartsA[d].nEndAngle,this.donutPartsA[d].color,null,null,this.szLine,this.nLineWidth*(this.donutPartsA[d].nRadOuter?this.donutPartsA[d].nRadOuter:this.nRadOuter)/300,this.szStyle,this.donutPartsA[d].nOffset,this.nBow),this.szStyle.match(/SILENT/)||(X.setAttributeNS(szMapNs,"tooltip",this.partsA[d].szInfo?this.partsA[d].szText+this.partsA[d].szInfo:Math.round(this.partsA[d].nInfoValue*
10)/10+" % "),this.partsA[d].szOver&&X.setAttributeNS(szMapNs,"onover",this.partsA[d].szOver),this.partsA[d].szOut&&X.setAttributeNS(szMapNs,"onout",this.partsA[d].szOut)),this.donutPartsA[d].nOpacity&&(X.style.setProperty("stroke-opacity","0.6",""),X.style.setProperty("fill-opacity","0.1","")),this.donutPartsA[d].objNode=X;for(d=this.donutPartsA.length-1;d>=ma;d--)X=K(this.targetDocument,this.frameGroup,this.mX,this.mY,this.donutPartsA[d].nRadOuter?this.donutPartsA[d].nRadOuter:this.nRadOuter,this.nRadInner,
this.donutPartsA[d].nHeight,this.donutPartsA[d].nStartAngle,this.donutPartsA[d].nEndAngle,this.donutPartsA[d].color,null,null,this.szLine,this.nLineWidth*(this.donutPartsA[d].nRadOuter?this.donutPartsA[d].nRadOuter:this.nRadOuter)/300,this.szStyle,this.donutPartsA[d].nOffset,this.nBow),this.szStyle.match(/SILENT/)||(X.setAttributeNS(szMapNs,"tooltip",this.partsA[d].szInfo?this.partsA[d].szText+this.partsA[d].szInfo:Math.round(this.partsA[d].nInfoValue*10)/10+" % "),this.partsA[d].szOver&&X.setAttributeNS(szMapNs,
"onover",this.partsA[d].szOver),this.partsA[d].szOut&&X.setAttributeNS(szMapNs,"onout",this.partsA[d].szOut)),this.donutPartsA[d].nOpacity&&(X.style.setProperty("stroke-opacity","0.6",""),X.style.setProperty("fill-opacity","0.1","")),this.donutPartsA[d].objNode=X;this.szStyle.match(/3D/)&&this.frameGroup.setAttributeNS(null,"transform","matrix(1 0 0 0.5 0 0)")}else t("circle",this.targetDocument,this.targetGroup,{id:"emptypie",cx:this.mX,cy:this.mY,r:this.nRadOuter,style:"fill:none;stroke:gray"}),
X=this.targetDocument,ma=t("text",X,this.targetGroup,{x:String(this.mX),y:String(this.mY),style:"fill:gray;font-size:"+this.nRadOuter/5+";text-anchor:middle;"}),X=X.createTextNode("Pie error: no values !"),ma.appendChild(X)};Ea.prototype.getTextPosition=function(W){if(!this.donutPartsA[W])return null;var X=this.donutPartsA[W].nRadOuter?this.donutPartsA[W].nRadOuter:this.nRadOuter;var Z=this.donutPartsA[W].nStartAngle;var ia=this.donutPartsA[W].nEndAngle;if(Z==ia)return null;ia=Z<ia?(Z+ia)/2:Math.min(360,
(Z+ia+360)/2)%360;Z=ia<180?this.nRadOuterMaxR?this.nRadOuterMaxR+(this.nRadOuterMaxL>this.nRadOuterMaxR?Math.min(this.nRadOuterMaxR,(this.nRadOuterMaxL-this.nRadOuterMaxR)/2):0):this.nRadOuter:this.nRadOuterMaxL?this.nRadOuterMaxL+(this.nRadOuterMaxR>this.nRadOuterMaxL?Math.min(this.nRadOuterMaxL,(this.nRadOuterMaxR-this.nRadOuterMaxL)/2):0):this.nRadOuter;return{x:Math.sin(ia/180*Math.PI)*Z*1.1,y:-Math.cos(ia/180*Math.PI)*Z*1.1-this.donutPartsA[W].nHeight,lx:Math.sin(ia/180*Math.PI)*X,ly:-Math.cos(ia/
180*Math.PI)*X-this.donutPartsA[W].nHeight}};window.DonutCharts=new function(){this.newChart=function(W,X,Z,ia,ma,va){return new Ea(W,X,Z,ia,ma,va)};this.partOver=A;this.partOut=J;this.partDown=L;this.partUp=da;this.partDrawOut=V;this.partDrawIn=U}})();
