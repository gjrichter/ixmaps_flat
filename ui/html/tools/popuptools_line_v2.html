<!DOCTYPE HTML>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>iXMaps Search Results</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="author" content="iXMaps Team">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"> 
	<meta name="description" content="Interactive mapping tools and controls for iXMaps">

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

	<style type="text/css">
		/* Reset and base styles */
		* {
			box-sizing: border-box;
		}
		
		body {
			margin: 0;
			padding: 0;
			font-size: 14px;
			overflow: hidden;
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
		}
		
		/* Link styles */
		a {
			color: #3641E2;
			text-decoration: none;
			transition: color 0.2s ease;
		}
		
		a:hover {
			color: #1a1f8a;
			text-decoration: underline;
		}
		
		/* Utility classes */
		.midlink {
			margin-left: 2px;
			margin-right: 2px;
			vertical-align: middle;
		}
		
		.blackHover {
			color: #888;
			font-size: 1.3em;
			padding: 0 0.3em;
			transition: color 0.2s ease;
		}
		
		.blackHover:hover {
			color: #333;
		}
		
		/* Toolbar styles */
		#toolbar {
			display: none;
		}
		
		#toolbar a {
			color: #444;
			vertical-align: middle;
		}
		
		/* Tool line styles */
		.tool-line {
			font-size: 13px;
			float: left;
			vertical-align: middle;
			margin: 3px 5px;
			padding: 4px 0 0 0;
			border-radius: 4px;
			transition: background-color 0.2s ease;
		}
		
		.tool-line:hover {
			background-color: rgba(0,0,0,0.05);
		}
		
		/* Button groups */
		.button-group {
			float: left;
			margin: 0 0.5em;
			display: flex;
			align-items: center;
			gap: 4px;
		}
		
		.button-group-spaced {
			float: left;
			margin-left: 15px;
		}
		
		/* Control buttons */
		.control-btn {
			height: 23px;
			border: 1px solid #ccc;
			border-radius: 4px;
			background: white;
			cursor: pointer;
			transition: all 0.2s ease;
			padding: 0 8px;
		}
		
		.control-btn:hover {
			background: #f0f0f0;
			border-color: #999;
		}
		
		/* Icon buttons */
		.icon-btn {
			display: inline-flex;
			align-items: center;
			justify-content: center;
			width: 24px;
			height: 24px;
			border: none;
			background: transparent;
			cursor: pointer;
			border-radius: 4px;
			transition: background-color 0.2s ease;
		}
		
		.icon-btn:hover {
			background-color: rgba(0,0,0,0.1);
		}
		
		/* Measurement tools */
		.measurement-tool {
			height: 22px;
			width: 22px;
			border: 1px solid #ccc;
			border-radius: 4px;
			background-size: 22px 22px;
			background-repeat: no-repeat;
			background-position: center;
			cursor: pointer;
			transition: all 0.2s ease;
		}
		
		.measurement-tool:hover {
			border-color: #3641E2;
			transform: scale(1.05);
		}
		
		/* Selection tools */
		.selection-tool {
			height: 22px;
			width: 22px;
			border: 1px solid #ccc;
			border-radius: 4px;
			background-size: 16px 16px;
			background-repeat: no-repeat;
			background-position: center 3px;
			cursor: pointer;
			transition: all 0.2s ease;
		}
		
		.selection-tool:hover {
			border-color: #3641E2;
			transform: scale(1.05);
		}
		
		/* Help text */
		.help-text {
			font-family: Arial, sans-serif;
			color: #aaaaaa;
			vertical-align: middle;
			font-size: 12px;
		}
		
		/* Custom button styles to replace jQuery UI */
		.custom-button {
			display: inline-block;
			padding: 6px 12px;
			margin: 0 2px;
			border: 1px solid #ccc;
			border-radius: 4px;
			background: #f8f9fa;
			color: #333;
			text-decoration: none;
			font-size: 13px;
			cursor: pointer;
			transition: all 0.2s ease;
			vertical-align: middle;
		}
		
		.custom-button:hover {
			background: #e9ecef;
			border-color: #adb5bd;
		}
		
		.custom-button.active {
			background: #007bff;
			color: white;
			border-color: #0056b3;
		}
		
		.custom-button-group {
			display: inline-flex;
			border: 1px solid #ccc;
			border-radius: 4px;
			overflow: hidden;
		}
		
		.custom-button-group .custom-button {
			border: none;
			border-right: 1px solid #ccc;
			border-radius: 0;
			margin: 0;
		}
		
		.custom-button-group .custom-button:last-child {
			border-right: none;
		}
		
		.custom-button-group .custom-button:first-child {
			border-top-left-radius: 4px;
			border-bottom-left-radius: 4px;
		}
		
		.custom-button-group .custom-button:last-child {
			border-top-right-radius: 4px;
			border-bottom-right-radius: 4px;
		}
		
		/* Responsive improvements */
		@media (max-width: 768px) {
			.tool-line {
				float: none;
				margin: 5px 0;
				width: 100%;
			}
			
			.button-group {
				float: none;
				margin: 5px 0;
				justify-content: center;
			}
		}
	</style>
</head>

<body onload="InitAll()">

	<div id="toolbar" role="toolbar" aria-label="Map Tools">
		
		<div class="toolbar-header" style="float:left; padding-bottom:0.5em;">
			<button id="selectline" class="custom-button" title="Switch to next toolbar" style=""><span id="selectline-id"> Theme </span> &rarr;</button>
		</div>

		<div id="Theme" class="tool-line" role="group" aria-label="Theme Controls">
			<div id="Theme-opacity" class="button-group">
				<a href="javascript:api.changeThemeStyle(null,'opacity:0.66;','factor');" aria-label="Decrease opacity">
					<i class="bi bi-dash-circle" title="Open extended tools dialog"></i>
				</a>
				<a class="midlink" href="javascript:api.toggleSVGMapOpacity();" title="Switch theme display">opacity</a>
				<a href="javascript:api.changeThemeStyle(null,'opacity:1.5;','factor');" aria-label="Increase opacity">
					<i class="bi bi-plus-circle" title="Open extended tools dialog"></i>
				</a>
			</div>

			<div id="chartsize-group" class="button-group button-group-spaced">
				<a href="javascript:api.changeObjectScaling(0.75);" aria-label="Decrease chart size">
					<i class="bi bi-dash-circle" title="Decrease chart size"></i>
				</a>
				<a href="javascript:api.changeObjectScaling(0);" title="Set default chart size">size</a>
				<a href="javascript:api.changeObjectScaling(1/0.75);" aria-label="Increase chart size">
					<i class="bi bi-plus-circle" title="Increase chart size"></i>
				</a>
			</div>

			<div class="button-group" style="margin-left:10px; margin-right:8px;"> 
				<a id="valuebutton" href="javascript:toggle_values();" title="Toggle theme value display">
					<span style="font-family:times;font-weight:bold;font-size:1em;color:#444;">&nbsp;T</span>
					<span style="color:#76A8B8;font-weight:bold;margin-left:-3px;">&nbsp;&#177;</span>
				</a>
			</div> 

			<div id="color-group" class="button-group" style="margin-top:-1px">
				<a id="xcolor" href="javascript:ixmaps.popupSelectColorScheme();" title="Select color scheme">
					<span id="xcolor-label" style="vertical-align:-0.5px;font-size:11px;line-height:11px;background-color:white;"></span>
				</a>
			</div>
			
			<div id="advanced-group" class="button-group" style="margin-left:8px">
				<a href="javascript:ixmaps.popupThemeEditor();" aria-label="Open theme code editor">
					<i class="icon shareIcon blackHover share_bitly icon-pencil" title="Open theme code editor" tabindex="0"></i>
				</a>

				<a href="javascript:ixmaps.popupExtendedTools();" aria-label="Open extended tools dialog">
					<i class="icon shareIcon blackHover share_bitly icon-wrench" title="Open extended tools dialog" tabindex="0"></i>
				</a>

				<a href="javascript:ixmaps.popupShare();" aria-label="Share a short link">
					<i class="icon shareIcon blackHover share_bitly icon-redo2" title="Share a short link" tabindex="0"></i>
				</a>

				<a href="javascript:ixmaps.popupThemeInfo();" aria-label="Show info of actual theme">
					<i class="icon shareIcon blackHover share_bitly icon-info" title="Show info of actual theme" tabindex="0"></i>
				</a>

				<a href="javascript:ixmaps.popupThemeCharts();" aria-label="Chart type menu">
					<i class="icon shareIcon blackHover share_bitly icon-pie-chart" title="Chart type menu" tabindex="0"></i>
				</a>

				<a href="javascript:ixmaps.popupThemeTable();" aria-label="Theme data table">
					<i class="icon shareIcon blackHover share_bitly icon-table2" title="Theme data table" tabindex="0"></i>
				</a>
			</div>
		</div>

		<div id="Theme2" class="tool-line" role="group" aria-label="Advanced Theme Controls">
			<div id="Theme-blur" class="button-group">
				<a href="javascript:api.changeThemeStyle(null,'blur:-0.25;','add');" aria-label="Decrease blur">
					<i class="bi bi-dash-circle" title="Decrease blur"></i>
				</a>
				<a class="midlink" href="javascript:api.changeThemeStyle(null,'blur:toggle');" title="Switch theme blur">blur</a>
				<a href="javascript:api.changeThemeStyle(null,'blur:0.25;','add');" aria-label="Increase blur">
					<i class="bi bi-plus-circle" title="Increase blur"></i>
				</a>
			</div>

			<div id="Theme-grid" class="button-group button-group-spaced">
				<a href="javascript:api.changeThemeStyle(null,'gridwidth:1.5','factor');" aria-label="Increase grid width">
					<i class="bi bi-dash-circle" title="Increase grid width"></i>
				</a>
				<a class="midlink" href="javascript:api.changeThemeStyle(null,'type:AGGREGATE','toggle');api.changeThemeStyle(null,'gridwidth:auto');" title="Switch aggregation grid">grid</a>
				<a href="javascript:api.changeThemeStyle(null,'gridwidth:0.66','factor');" aria-label="Decrease grid width">
					<i class="bi bi-plus-circle" title="Decrease grid width"></i>
				</a>
			</div>

			<div id="Theme-size" class="button-group button-group-spaced">
				<a class="midlink" href="javascript:api.changeThemeStyle(null,'type:SIZE','toggle');" title="Switch dynamic size">size</a>
			</div>

			<div id="Theme-shadow" class="button-group button-group-spaced">
				<a class="midlink" href="javascript:api.changeThemeStyle(null,'shadow:toggle','toggle');" title="Switch chart shadow">shadow</a>
			</div>

			<div id="Theme-sort" class="button-group button-group-spaced">
				<a class="midlink" href="javascript:api.changeThemeStyle(null,'type:SORT','toggle');" title="Switch sorting parts">sort</a>
			</div>

			<div id="Theme-clip-parts" class="button-group button-group-spaced">
				<span style="color:#aaa" title="Limit chart parts shown">chart parts:
					<a href='javascript:api.changeThemeStyle(null,"clipparts:1");' title="Only first part">1</a>
					<a href='javascript:api.changeThemeStyle(null,"clipparts:2");' title="2 parts">2</a>
					<a href='javascript:api.changeThemeStyle(null,"clipparts:3");' title="3 parts">3</a>
					<a href='javascript:api.changeThemeStyle(null,"clipparts:4");' title="4 parts">4</a>
					<a href='javascript:api.changeThemeStyle(null,"clipparts:5");' title="5 parts">5</a>
					<a href='javascript:api.changeThemeStyle(null,"clipparts:0");' title="All parts">all</a>
				</span>
			</div>
		</div>

		<div id="Map" class="tool-line" role="group" aria-label="Map Controls">
			<div style="float:left; margin-top:2px">
				<span class="button-group">
					<a href="javascript:api.setSVGMapOpacity(-0.1,'relative');" aria-label="Decrease map opacity">
						<i class="bi bi-dash-circle" title="Decrease map opacity"></i>
					</a>
					<a class="midlink" href="javascript:api.toggleSVGMapOpacity();" title="Switch theme display">opacity</a>
					<a href="javascript:api.setSVGMapOpacity(0.1,'relative');" aria-label="Increase map opacity">
						<i class="bi bi-plus-circle" title="Increase map opacity"></i>
					</a>
				</span> 

				<span class="button-group">
					<a href="javascript:api.changeLineScaling(0.75);" aria-label="Decrease border size">
						<i class="bi bi-dash-circle" title="Decrease border size"></i>
					</a>
					<a class="midlink" href="javascript:api.changeLineScaling(0);" title="Set default border size">border</a>
					<a href="javascript:api.changeLineScaling(1/0.75);" aria-label="Increase border size">
						<i class="bi bi-plus-circle" title="Increase border size"></i>
					</a>
				</span> 

				<span class="button-group">
					<a href="javascript:api.changeLabelScaling(0.75);" aria-label="Decrease label size">
						<i class="bi bi-dash-circle" title="Decrease label size"></i>
					</a>
					<a class="midlink" href="javascript:api.changeLabelScaling(0);" title="Set default label size">label</a>
					<a href="javascript:api.changeLabelScaling(1/0.75);" aria-label="Increase label size">
						<i class="bi bi-plus-circle" title="Increase label size"></i>
					</a>
				</span> 
			</div>

			<div style="float:left; margin-top:1px">
				<span class="button-group">
					<a href="javascript:api.toggleThemeLegends();" title="Show/hide legend">
						<span style="font-family:times;font-weight:bold;font-size:1em;color:#444;">&#177; legend</span>
					</a>
				</span> 
			</div>

			<div style="float:left;">
				<span id="advanced-group" class="button-group" style="margin-left:2px;">
					<a href="javascript:ixmaps.popupThemeEditor();" aria-label="Open theme editor">
						<i class="icon shareIcon blackHover share_bitly icon-pencil" title="Open theme editor" tabindex="0"></i>
					</a>

					<a href="javascript:ixmaps.popupExtendedTools();" aria-label="Open extended tools">
						<i class="icon shareIcon blackHover share_bitly icon-wrench" title="Open extended tools" tabindex="0"></i>
					</a>

					<a href="javascript:ixmaps.popupShare();" aria-label="Share map">
						<i class="icon shareIcon blackHover share_bitly icon-redo2" title="Share map" tabindex="0"></i>
					</a>

					<a href="javascript:ixmaps.popupExport();" style="margin-left:0.5em;vertical-align:6px;" aria-label="Export SVG">
						<i class="icon shareIcon blackHover share_bitly icon-download" title="Share map" tabindex="0"> <span style="font-size:0.8em">SVG</span></i>
					</a>
				</span>
			</div>
		</div>

		<div id="Layer" class="tool-line" role="group" aria-label="Layer Controls">
			<div style="float:left; margin-top:2px">
				<span class="button-group">
					<a href="javascript:api.setSVGMapOpacity(-0.1,'relative');" aria-label="Decrease overlay opacity">
						<i class="bi bi-dash-circle" title="Decrease overlay opacity"></i>
					</a>
					<a class="midlink" href="javascript:api.toggleSVGMapOpacity();" title="Switch overlay display">overlay</a>
					<a href="javascript:api.setSVGMapOpacity(0.1,'relative');" aria-label="Increase overlay opacity">
						<i class="bi bi-plus-circle" title="Increase overlay opacity"></i>
					</a>
				</span>

				<span class="button-group">
					<a href="javascript:api.setHTMLMapOpacity(-0.1,'relative');" aria-label="Decrease basemap opacity">
						<i class="bi bi-dash-circle" title="Decrease basemap opacity"></i>
					</a>
					<a class="midlink" href="javascript:api.HTML_toggleMap();" title="Switch basemap display">basemap</a>
					<a href="javascript:api.setHTMLMapOpacity(0.1,'relative');" aria-label="Increase basemap opacity">
						<i class="bi bi-plus-circle" title="Increase basemap opacity"></i>
					</a>
				</span>
			</div>

			<div style="float:left; margin-top:2px">
				<span id="layerinfo-group" style="margin-left:5px; margin-top:5px">
					<a href="javascript:ixmaps.popupThemeInfo();" aria-label="Show layer info">
						<i class="icon shareIcon blackHover share_bitly icon-info" title="Show layer info" tabindex="0"></i>
					</a>
				</span>
			</div>
		</div>
		
		<div id="Measure" class="tool-line" role="group" aria-label="Measurement Tools">
			<span id="measure-group" style="vertical-align:middle">
				<button type="button" id="measure-coordinate" data-image="coord.png"
				class="measurement-tool"
				onclick="javascript:api.mapTool('coord');"
				title="Show lat/lon coordinates" aria-label="Show coordinates">&nbsp;</button>

				<button type="button" id="measure-measurement" data-image="measure.png" 
				class="measurement-tool"
				onclick="javascript:api.mapTool('measurement');"
				title="Measure length with buffer" aria-label="Measure length">&nbsp;</button>

				<button type="button" id="measure-polyline" data-image="polyline.png" 
				class="measurement-tool"
				onclick="javascript:api.mapTool('polyline');"
				title="Measure complex distance" aria-label="Measure polyline">&nbsp;</button>

				<button type="button" id="measure-polygon" data-image="polygon.png"
				class="measurement-tool"
				onclick="javascript:api.mapTool('polygon');"
				title="Measure area" aria-label="Measure area">&nbsp;</button>
			</span>

			<span class="help-text">&nbsp;&nbsp;(Activate various distance/area measurement tools)</span>
		</div>
		
		<div id="Select" class="tool-line" role="group" aria-label="Selection Tools">
			<span id="select-group">
				<button type="button" id="select-rect" data-image="selectrect.png" 
				class="selection-tool"
				onclick="javascript:api.mapTool('selectrect');"
				title="Select with rectangle" aria-label="Rectangle selection">&nbsp;&nbsp;&nbsp;</button>
				
				<button type="button" id="select-buffer" data-image="selectbuffer.png" 
				class="selection-tool"
				onclick="javascript:api.mapTool('selectbuffer');"
				title="Select with circle buffer" aria-label="Buffer selection">&nbsp;&nbsp;&nbsp;</button>
			</span>
			
			<span class="help-text">&nbsp;&nbsp;(Activate theme item selection by rectangular or circle buffer)</span>
		</div>
	</div>

	<!-- Scripts -->
	<!-- 
	<script src="../../../ui/js/tools/colorscheme.js"></script>
	<script src="../../../ui/js/tools/colorselect.js"></script>
	-->
	<script type="text/javascript">
        
		// Global namespace
		window.ixmaps = window.ixmaps || {};
		
		// Carousel array for toolbar rotation
		ixmaps.carousellA = [];

		// jQuery extensions
		jQuery.fn.extend({
			/**
			 * Extend jQuery for one line toolbar
			 */ 
			collect: function(){
				return this.each(function() {
					ixmaps.carousellA.push($(this).attr("id"));
				});
			}
		});

        // Main initialization
		$(function() {
			// Initialize toolbar buttons with standard event handlers
			$("#selectline").click(function() {
				carousell();
				return false;
			});
			
			$("#selectline-icon").click(function() {
				carousell();
				return false;
			});

			// Collect and hide tool lines
			$(".tool-line")
				.collect()
				.hide();

			// Show default theme line
			$("#Theme").show();

			// Initialize dynamic opacity button
			$("#dopacity").click(function() {
				toggle_dopacity();
				return false;
			});

			// Hide dynamic opacity buttons initially
			$("#dopacitybuttons").hide();

			// Initialize color scheme button (no jQuery UI needed)
			// $("#xcolor") is already a link, no initialization needed

			// Initialize measurement tools (no jQuery UI needed)
			// These are already standard HTML buttons with onclick handlers

			// Initialize selection tools (no jQuery UI needed)
			// These are already standard HTML buttons with onclick handlers

			// Show toolbar
			$("#toolbar").show();
		});

        // API and parent window references
		var api = ixmaps;
		var parentWindow = null;
        
		/* ------------------------------------------------------------------ * 
			Initialization functions
		 * ------------------------------------------------------------------ */

        // Reset body margins
        window.document.body.topMargin = 0;
        window.document.body.leftMargin = 0;

        // Initialize theme line if theme exists
        if (api.getThemes()) {
            init_theme_line();
        } else {
            carousell();
        }

        // Give the parent our init function
        api.initThemeTools = init_theme_line;

		/**
		 * Rotate through different tool sets
		 */
		function carousell() {
			$("#" + ixmaps.carousellA[0]).hide();
			ixmaps.carousellA.push(ixmaps.carousellA.shift());
			
			// Skip Theme if no theme object exists
			if ((ixmaps.carousellA[0] == "Theme") && !api.getThemeObj()) {
				ixmaps.carousellA.push(ixmaps.carousellA.shift());
			}
			
			$("#" + ixmaps.carousellA[0]).show();
			$("#selectline-id").text(ixmaps.carousellA[0]);

			api.mapTool("idle");
		}

		/**
		 * Initialize theme-specific controls
		 */
		function init_theme_line() {
 
            if (api && api.getThemeStyleString) {
				var szThemeStyle = api.getThemeStyleString();
				
				// Handle dynamic opacity modes
				if (szThemeStyle && szThemeStyle.match(/DOPACITYLOG/)) {
					$("#dopacitybuttons").show();
					$("#dopacity").text("log");
				} else if (szThemeStyle && szThemeStyle.match(/DOPACITYMEAN/)) {
					$("#dopacitybuttons").show();
					$("#dopacity").text("mean");
				} else if (szThemeStyle && szThemeStyle.match(/DOPACITYMAX/)) {
					$("#dopacitybuttons").show();
					$("#dopacity").text("max");
				} else if (szThemeStyle && szThemeStyle.match(/DOPACITY/)) {
					$("#dopacitybuttons").show();
					$("#dopacity").text("dyn");
				} else {
					$("#dopacitybuttons").hide();
					$("#dopacity").text("linear");
				}
				
				// Handle chart vs opacity groups
				if (szThemeStyle && szThemeStyle.match(/CHART/)) {
					$("#chartsize-group").show();
					$("#dopacity-group").hide();
				} else {
					$("#chartsize-group").hide();
					$("#dopacity-group").show();
				}
			}
			
			// Initialize color scheme
			var objTheme = api.getThemes().at(-1);
			if (objTheme && objTheme.origColorScheme) {
				var colorArgA = objTheme.origColorScheme.slice(0);

				if (isNaN(colorArgA[0])) {
					ixmaps.setColors(colorArgA.join('|'), "directly_defined_colors", 7);
				} else {
					colorArgA.shift();	
					ixmaps.setColors(colorArgA.join('|'), 7);
				}
			}
		}

		// Popup functions
		ixmaps.popupSelectColorScheme = function(szHtml) {
			var szElement = "colorList";	
			api.openDialog(null, szElement, null, "Color Schemes", '280,60', 80, 300);
			parentWindow.$("#" + szElement)[0].innerHTML = ixmaps.getColors();
			api.onDialogClose = function(){ 
				setTimeout("init_theme_line();", 100); 
			};
		};
																	   
		ixmaps.popupThemeInfo = function(szHtml) {
			var szElement = "info";	
			api.openDialog(null, szElement, './tools/theme_info.html', 'Theme Info', '10,103', 380, 600);
		};

		ixmaps.popupThemeCharts = function() {
			var szElement = "charts";	
			api.openDialog(null, szElement, './tools/theme_charts.html', 'Theme Charts', '10,103', 380, 600);
		};

		ixmaps.popupLayerInfo = function(szHtml) {
			// Layer == themes
			var layerA = ixmaps.embeddedSVG.window.map.Query.getThemes();
		
			var szElement = "editor";	
			api.openDialog(null, szElement, null, "Layer", '10,103', 400, 300);

			var szInfo = "";

			for (var i = 0; i < layerA.length; i++) {
				szInfo += "<table cellpadding='0' style='margin-top:5px;'>";	
				szInfo += "<tr><td>" + (i + 1) + ": </td><td>" + layerA[i] + "</td></tr>";	
			}

			szInfo += "</table>";	

			parentWindow.$("#" + szElement)[0].innerHTML = "<div id=\"code\" name=\"code\" style=\"font-family:Consolas,monospace;font-size:0.6em;width:98%;height:90%;\">" + szInfo + "</div>";
			api.onDialogClose = function(){ 
				setTimeout("init_theme_line();", 100); 
			};
		};

		ixmaps.popupExtendedTools = function() {
			api.openDialog(null, 'editor', ixmaps.szResourceBase+"ui/html/tools/popuptools_jquery.html", 'tools', '10,103', 380, 500);
		};

		ixmaps.popupShare = function() {
			api.shareMap('dialog', '10,103');
		};
		
		ixmaps.popupExport = function() {
			api.exportMap('dialog', '10,103');
		};
		
		ixmaps.popupThemeTable = function() {
			api.viewTable('dialog', '10,103');
		};
		
		ixmaps.initThemeTools = function() {
			init_theme_line();
		};

		/**
		 * Toggle dynamic opacity modes
		 */
		function toggle_dopacity() {
			var szThemeStyle = api.getThemeStyleString();
			
			if (szThemeStyle && szThemeStyle.match(/DOPACITYLOG/)) {
				api.changeThemeStyle(null, 'type:DOPACITYLOG;', 'remove');
				api.changeThemeStyle(null, 'type:DOPACITYMAX;dopacityscale:5;', 'toggle');
			} else if (szThemeStyle && szThemeStyle.match(/DOPACITYMAX/)) {
				api.changeThemeStyle(null, 'type:DOPACITYMAX;', 'remove');
			} else if (szThemeStyle && szThemeStyle.match(/DOPACITY/)) {
				api.changeThemeStyle(null, 'type:DOPACITY;', 'remove');
				api.changeThemeStyle(null, 'type:DOPACITYLOG;dopacityscale:5;', 'toggle');
			} else {
				api.changeThemeStyle(null, 'type:DOPACITY;dopacityscale:5;', 'toggle');
			}
			
			setTimeout("init_theme_line()", 100);
		}

		/**
		 * Toggle theme value display
		 */
		function toggle_values() {
			var szThemeStyle = api.getThemeStyleString();
			
			if (szThemeStyle && szThemeStyle.match(/VALUES/)) {
				api.changeThemeStyle(null, 'type:VALUES;', 'remove');
			} else {
				api.changeThemeStyle(null, 'type:VALUES;', 'add');
			}
		}

		// ===========================================
		// Preload images for better performance
		// ===========================================
		function preloadImages(imageUrls) {
			const promises = imageUrls.map(url => {
				return new Promise((resolve, reject) => {
					const img = new Image();
					img.onload = () => {
						console.log(`Image preloaded: ${url}`);
						resolve();
					};
					img.onerror = () => {
						console.warn(`Failed to preload image: ${url}`);
						resolve(); // Don't fail the entire preload process
					};
					img.src = url;
				});
			});
			return Promise.all(promises);
		}

		// ===========================================
		// Set image sources dynamically using data attributes
		// ===========================================
		function setImageSources() {
			// Find all images with data-image attribute
			const images = document.querySelectorAll('img[data-image]');
			
			images.forEach(img => {
				const imageName = img.getAttribute('data-image');
				const fullUrl = ixmaps.szResourceBase + 'ui/resources/images/' + imageName;
				img.src = fullUrl;
				
				// Add error handling for individual images
				img.onerror = () => {
					console.warn(`Failed to load image: ${fullUrl}`);
					// Optionally set a fallback image or hide the element
				};
				
				console.log(`Set image source: ${fullUrl}`);
			});

			const bgimages = document.querySelectorAll('button[data-image]');
			
			bgimages.forEach(button => {
				const imageName = button.getAttribute('data-image');
				const fullUrl = ixmaps.szResourceBase + 'ui/resources/images/' + imageName;
				button.style.background = "url("+fullUrl+")";
				
				// Add error handling for individual images
				button.onerror = () => {
					console.warn(`Failed to load image: ${fullUrl}`);
					// Optionally set a fallback image or hide the element
				};
				
				console.log(`Set image source: ${fullUrl}`);
			});
		}
		// ===========================================
		// Load all resources sequentially
		// ===========================================
		
		async function loadAllResources() {
			try {
				console.log('Loading CSS resources...');
				
				console.log('Preloading images...');
				
				// Preload chart style images
				const chartImages = [
					ixmaps.szResourceBase + 'ui/resources/images/coord.png',
					ixmaps.szResourceBase + 'ui/resources/images/measure.png',
					ixmaps.szResourceBase + 'ui/resources/images/polyline.png',
					ixmaps.szResourceBase + 'ui/resources/images/polygon.png',
					ixmaps.szResourceBase + 'ui/resources/images/selectrect.png',
					ixmaps.szResourceBase + 'ui/resources/images/selectbuffer.png'
				];
				await preloadImages(chartImages);
				
				// Set image sources dynamically after preloading
				setImageSources();
				
				console.log('All resources loaded successfully');
				
			} catch (error) {
				console.error('Error loading resources:', error);
				alert('Failed to load required resources. Please refresh the page.');
			}
		}

		loadAllResources();


	</script>

</body>
</html>
