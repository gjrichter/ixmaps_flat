<!DOCTYPE html>
<html>
  
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="ixmaps embed example">
	<meta name="author" content="guenter richter">
	<link rel="shortcut icon" href="https://gjrichter.github.io/ixmaps/ui/resources/images/ixmaps_logo.png">
 
	<title>Created by Composer</title>
</head>
 
<body style="margin:0;padding:0;">
 
	<!-- here goes the map -->
	<div id="map-div"></div>
 
	<!-- include the ixmaps API -->
	<script src="../../ui/js/htmlgui_flat.js"></script>
 
	<script type="text/javascript" charset="utf-8">
        
        process_kelvin = function(data){
            data.column("prod.0.val.0.val").map(function(value){
                return value - 273.15;
            })   
        }
 
		// create and embed the map
		// ! reference to "map-div", the hosting html div

		ixmaps.embed("map-div", {
			mapService: "leaflet_vt",
			mapType: "CartoDB - Positron",
			map: "../../maps/svg/maps/generic/mercator.svg",
			name: "map_1",
			mode: "pan",
			legend: "true",
			tools: "true",
			search: "Europe",
			about: "test"
		},
		map => map
		.options({
			featurescaling: "true",
			objectscaling: "dynamic",
			normalSizeScale: "100000",
			dynamicSizePow: "0.1",
			flushChartDraw: "1000000",
			flushPaintShape: "1000000",
			basemapopacity: "0.5",
			worksilent: "false",
			loadsilent: "false",
			hideOnPan:  "false",
			freezeOnPan:"false",
		})
		.require("../../ui/js/tools/tooltip_mustache.js")
		.attribution("powered by <a href=\"http://ixmaps.com\" target=\"_blank\">iXMaps</a>")
		.view({
			center: {
				lat: "41.97018746617801",
				lng: "13.367701027046254"
				},
			zoom: "5.449113598520312"
			})
		.layer(ixmaps.layer("World Mercator", layer => layer
			.data({
				url: "https://meteohub.mistralportal.it/api/observations?q=reftime:%20%3E=2025-07-02%2012:00,%3C=2025-07-02%2013:59;product:B12101;license:CCBY_COMPLIANT;timerange:254,0,0;level:103,2000,0,0&reliabilityCheck=true&last=true&ts=1751462143620",
				type: "json",
				name: "data_1751459866345_623",
				cache: "true",
                process: process_kelvin.toString()
				})
			.binding({
				geo: "stat.lat|stat.lon",
				value: "prod.0.val.0.val"
				})
			.type("CHART|BUBBLE|AURA|SIZE|HEADTAIL|VALUES")
			.style({
				colorscheme: [
					"7",
					"#36A6B1",
					"#794073",
					"3colors",
					"#DDA729"],
				fillopacity: "0.7",
				shadow: "false",
				visible: "true",
				showdata: "true",
				units: "",
				scale: "1",
				sizepow: "2",
				valuescale: "1",
				valuedecimals: "1",
                valuesupper: "1:1000000"
				})
			.meta({
				title: "[title]",
				snippet: "",
				description: "",
				name: "data_1751459866345_623",
				tooltip: "{{theme.item.chart}}{{theme.item.data}}"
				})
		))
	);
	</script>
</body>
</html>
